var PI=Object.defineProperty;var OI=t=>{throw TypeError(t)};var LI=(t,e,n)=>e in t?PI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var on=(t,e,n)=>LI(t,typeof e!="symbol"?e+"":e,n);var ga=(t,e,n)=>e.has(t)?OI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function DI(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function j_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $_={exports:{}},pu={},F_={exports:{}},dt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dl=Symbol.for("react.element"),MI=Symbol.for("react.portal"),NI=Symbol.for("react.fragment"),jI=Symbol.for("react.strict_mode"),$I=Symbol.for("react.profiler"),FI=Symbol.for("react.provider"),UI=Symbol.for("react.context"),BI=Symbol.for("react.forward_ref"),zI=Symbol.for("react.suspense"),HI=Symbol.for("react.memo"),WI=Symbol.for("react.lazy"),Bm=Symbol.iterator;function GI(t){return t===null||typeof t!="object"?null:(t=Bm&&t[Bm]||t["@@iterator"],typeof t=="function"?t:null)}var U_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},B_=Object.assign,z_={};function Vo(t,e,n){this.props=t,this.context=e,this.refs=z_,this.updater=n||U_}Vo.prototype.isReactComponent={};Vo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Vo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function H_(){}H_.prototype=Vo.prototype;function Kp(t,e,n){this.props=t,this.context=e,this.refs=z_,this.updater=n||U_}var Xp=Kp.prototype=new H_;Xp.constructor=Kp;B_(Xp,Vo.prototype);Xp.isPureReactComponent=!0;var zm=Array.isArray,W_=Object.prototype.hasOwnProperty,Qp={current:null},G_={key:!0,ref:!0,__self:!0,__source:!0};function V_(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)W_.call(e,r)&&!G_.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Dl,type:t,key:i,ref:o,props:s,_owner:Qp.current}}function VI(t,e){return{$$typeof:Dl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Jp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Dl}function YI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Hm=/\/+/g;function Of(t,e){return typeof t=="object"&&t!==null&&t.key!=null?YI(""+t.key):e.toString(36)}function Yc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Dl:case MI:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Of(o,0):r,zm(s)?(n="",t!=null&&(n=t.replace(Hm,"$&/")+"/"),Yc(s,e,n,"",function(d){return d})):s!=null&&(Jp(s)&&(s=VI(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Hm,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",zm(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Of(i,l);o+=Yc(i,e,n,c,s)}else if(c=GI(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Of(i,l++),o+=Yc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function bc(t,e,n){if(t==null)return t;var r=[],s=0;return Yc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function KI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var kn={current:null},Kc={transition:null},XI={ReactCurrentDispatcher:kn,ReactCurrentBatchConfig:Kc,ReactCurrentOwner:Qp};function Y_(){throw Error("act(...) is not supported in production builds of React.")}dt.Children={map:bc,forEach:function(t,e,n){bc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return bc(t,function(){e++}),e},toArray:function(t){return bc(t,function(e){return e})||[]},only:function(t){if(!Jp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};dt.Component=Vo;dt.Fragment=NI;dt.Profiler=$I;dt.PureComponent=Kp;dt.StrictMode=jI;dt.Suspense=zI;dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XI;dt.act=Y_;dt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=B_({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Qp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)W_.call(e,c)&&!G_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Dl,type:t.type,key:s,ref:i,props:r,_owner:o}};dt.createContext=function(t){return t={$$typeof:UI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:FI,_context:t},t.Consumer=t};dt.createElement=V_;dt.createFactory=function(t){var e=V_.bind(null,t);return e.type=t,e};dt.createRef=function(){return{current:null}};dt.forwardRef=function(t){return{$$typeof:BI,render:t}};dt.isValidElement=Jp;dt.lazy=function(t){return{$$typeof:WI,_payload:{_status:-1,_result:t},_init:KI}};dt.memo=function(t,e){return{$$typeof:HI,type:t,compare:e===void 0?null:e}};dt.startTransition=function(t){var e=Kc.transition;Kc.transition={};try{t()}finally{Kc.transition=e}};dt.unstable_act=Y_;dt.useCallback=function(t,e){return kn.current.useCallback(t,e)};dt.useContext=function(t){return kn.current.useContext(t)};dt.useDebugValue=function(){};dt.useDeferredValue=function(t){return kn.current.useDeferredValue(t)};dt.useEffect=function(t,e){return kn.current.useEffect(t,e)};dt.useId=function(){return kn.current.useId()};dt.useImperativeHandle=function(t,e,n){return kn.current.useImperativeHandle(t,e,n)};dt.useInsertionEffect=function(t,e){return kn.current.useInsertionEffect(t,e)};dt.useLayoutEffect=function(t,e){return kn.current.useLayoutEffect(t,e)};dt.useMemo=function(t,e){return kn.current.useMemo(t,e)};dt.useReducer=function(t,e,n){return kn.current.useReducer(t,e,n)};dt.useRef=function(t){return kn.current.useRef(t)};dt.useState=function(t){return kn.current.useState(t)};dt.useSyncExternalStore=function(t,e,n){return kn.current.useSyncExternalStore(t,e,n)};dt.useTransition=function(){return kn.current.useTransition()};dt.version="18.3.1";F_.exports=dt;var L=F_.exports;const $=j_(L);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QI=L,JI=Symbol.for("react.element"),qI=Symbol.for("react.fragment"),ZI=Object.prototype.hasOwnProperty,ew=QI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tw={key:!0,ref:!0,__self:!0,__source:!0};function K_(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)ZI.call(e,r)&&!tw.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:JI,type:t,key:i,ref:o,props:s,_owner:ew.current}}pu.Fragment=qI;pu.jsx=K_;pu.jsxs=K_;$_.exports=pu;var a=$_.exports,bh={},X_={exports:{}},Gn={},Q_={exports:{}},J_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(y,g){var I=y.length;y.push(g);e:for(;0<I;){var A=I-1>>>1,M=y[A];if(0<s(M,g))y[A]=g,y[I]=M,I=A;else break e}}function n(y){return y.length===0?null:y[0]}function r(y){if(y.length===0)return null;var g=y[0],I=y.pop();if(I!==g){y[0]=I;e:for(var A=0,M=y.length,Q=M>>>1;A<Q;){var F=2*(A+1)-1,ye=y[F],R=F+1,Ie=y[R];if(0>s(ye,I))R<M&&0>s(Ie,ye)?(y[A]=Ie,y[R]=I,A=R):(y[A]=ye,y[F]=I,A=F);else if(R<M&&0>s(Ie,I))y[A]=Ie,y[R]=I,A=R;else break e}}return g}function s(y,g){var I=y.sortIndex-g.sortIndex;return I!==0?I:y.id-g.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,f=3,E=!1,k=!1,T=!1,N=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(y){for(var g=n(d);g!==null;){if(g.callback===null)r(d);else if(g.startTime<=y)r(d),g.sortIndex=g.expirationTime,e(c,g);else break;g=n(d)}}function p(y){if(T=!1,S(y),!k)if(n(c)!==null)k=!0,w(D);else{var g=n(d);g!==null&&C(p,g.startTime-y)}}function D(y,g){k=!1,T&&(T=!1,v(G),G=-1),E=!0;var I=f;try{for(S(g),h=n(c);h!==null&&(!(h.expirationTime>g)||y&&!xe());){var A=h.callback;if(typeof A=="function"){h.callback=null,f=h.priorityLevel;var M=A(h.expirationTime<=g);g=t.unstable_now(),typeof M=="function"?h.callback=M:h===n(c)&&r(c),S(g)}else r(c);h=n(c)}if(h!==null)var Q=!0;else{var F=n(d);F!==null&&C(p,F.startTime-g),Q=!1}return Q}finally{h=null,f=I,E=!1}}var H=!1,ne=null,G=-1,q=5,he=-1;function xe(){return!(t.unstable_now()-he<q)}function je(){if(ne!==null){var y=t.unstable_now();he=y;var g=!0;try{g=ne(!0,y)}finally{g?fe():(H=!1,ne=null)}}else H=!1}var fe;if(typeof _=="function")fe=function(){_(je)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,P=ie.port2;ie.port1.onmessage=je,fe=function(){P.postMessage(null)}}else fe=function(){N(je,0)};function w(y){ne=y,H||(H=!0,fe())}function C(y,g){G=N(function(){y(t.unstable_now())},g)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(y){y.callback=null},t.unstable_continueExecution=function(){k||E||(k=!0,w(D))},t.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<y?Math.floor(1e3/y):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(y){switch(f){case 1:case 2:case 3:var g=3;break;default:g=f}var I=f;f=g;try{return y()}finally{f=I}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(y,g){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var I=f;f=y;try{return g()}finally{f=I}},t.unstable_scheduleCallback=function(y,g,I){var A=t.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?A+I:A):I=A,y){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=I+M,y={id:u++,callback:g,priorityLevel:y,startTime:I,expirationTime:M,sortIndex:-1},I>A?(y.sortIndex=I,e(d,y),n(c)===null&&y===n(d)&&(T?(v(G),G=-1):T=!0,C(p,I-A))):(y.sortIndex=M,e(c,y),k||E||(k=!0,w(D))),y},t.unstable_shouldYield=xe,t.unstable_wrapCallback=function(y){var g=f;return function(){var I=f;f=g;try{return y.apply(this,arguments)}finally{f=I}}}})(J_);Q_.exports=J_;var nw=Q_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rw=L,Hn=nw;function ue(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var q_=new Set,rl={};function Di(t,e){Po(t,e),Po(t+"Capture",e)}function Po(t,e){for(rl[t]=e,t=0;t<e.length;t++)q_.add(e[t])}var es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Eh=Object.prototype.hasOwnProperty,sw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Wm={},Gm={};function iw(t){return Eh.call(Gm,t)?!0:Eh.call(Wm,t)?!1:sw.test(t)?Gm[t]=!0:(Wm[t]=!0,!1)}function ow(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function aw(t,e,n,r){if(e===null||typeof e>"u"||ow(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Rn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var dn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){dn[t]=new Rn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];dn[e]=new Rn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){dn[t]=new Rn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){dn[t]=new Rn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){dn[t]=new Rn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){dn[t]=new Rn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){dn[t]=new Rn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){dn[t]=new Rn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){dn[t]=new Rn(t,5,!1,t.toLowerCase(),null,!1,!1)});var qp=/[\-:]([a-z])/g;function Zp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(qp,Zp);dn[e]=new Rn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(qp,Zp);dn[e]=new Rn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(qp,Zp);dn[e]=new Rn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){dn[t]=new Rn(t,1,!1,t.toLowerCase(),null,!1,!1)});dn.xlinkHref=new Rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){dn[t]=new Rn(t,1,!1,t.toLowerCase(),null,!0,!0)});function eg(t,e,n,r){var s=dn.hasOwnProperty(e)?dn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(aw(e,n,s,r)&&(n=null),r||s===null?iw(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var as=rw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ec=Symbol.for("react.element"),ro=Symbol.for("react.portal"),so=Symbol.for("react.fragment"),tg=Symbol.for("react.strict_mode"),Sh=Symbol.for("react.profiler"),Z_=Symbol.for("react.provider"),ex=Symbol.for("react.context"),ng=Symbol.for("react.forward_ref"),Ih=Symbol.for("react.suspense"),wh=Symbol.for("react.suspense_list"),rg=Symbol.for("react.memo"),vs=Symbol.for("react.lazy"),tx=Symbol.for("react.offscreen"),Vm=Symbol.iterator;function ma(t){return t===null||typeof t!="object"?null:(t=Vm&&t[Vm]||t["@@iterator"],typeof t=="function"?t:null)}var Bt=Object.assign,Lf;function Aa(t){if(Lf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Lf=e&&e[1]||""}return`
`+Lf+t}var Df=!1;function Mf(t,e){if(!t||Df)return"";Df=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Df=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Aa(t):""}function lw(t){switch(t.tag){case 5:return Aa(t.type);case 16:return Aa("Lazy");case 13:return Aa("Suspense");case 19:return Aa("SuspenseList");case 0:case 2:case 15:return t=Mf(t.type,!1),t;case 11:return t=Mf(t.type.render,!1),t;case 1:return t=Mf(t.type,!0),t;default:return""}}function Th(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case so:return"Fragment";case ro:return"Portal";case Sh:return"Profiler";case tg:return"StrictMode";case Ih:return"Suspense";case wh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case ex:return(t.displayName||"Context")+".Consumer";case Z_:return(t._context.displayName||"Context")+".Provider";case ng:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case rg:return e=t.displayName||null,e!==null?e:Th(t.type)||"Memo";case vs:e=t._payload,t=t._init;try{return Th(t(e))}catch{}}return null}function cw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Th(e);case 8:return e===tg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Vs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function nx(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dw(t){var e=nx(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Sc(t){t._valueTracker||(t._valueTracker=dw(t))}function rx(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=nx(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function vd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ch(t,e){var n=e.checked;return Bt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Ym(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Vs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function sx(t,e){e=e.checked,e!=null&&eg(t,"checked",e,!1)}function kh(t,e){sx(t,e);var n=Vs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Rh(t,e.type,n):e.hasOwnProperty("defaultValue")&&Rh(t,e.type,Vs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Km(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Rh(t,e,n){(e!=="number"||vd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Pa=Array.isArray;function vo(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Vs(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Ah(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ue(91));return Bt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Xm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ue(92));if(Pa(n)){if(1<n.length)throw Error(ue(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Vs(n)}}function ix(t,e){var n=Vs(e.value),r=Vs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Qm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ox(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ph(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ox(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ic,ax=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ic=Ic||document.createElement("div"),Ic.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ic.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function sl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ja={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},uw=["Webkit","ms","Moz","O"];Object.keys(ja).forEach(function(t){uw.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ja[e]=ja[t]})});function lx(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ja.hasOwnProperty(t)&&ja[t]?(""+e).trim():e+"px"}function cx(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=lx(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var fw=Bt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Oh(t,e){if(e){if(fw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ue(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ue(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ue(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ue(62))}}function Lh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dh=null;function sg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Mh=null,_o=null,xo=null;function Jm(t){if(t=jl(t)){if(typeof Mh!="function")throw Error(ue(280));var e=t.stateNode;e&&(e=_u(e),Mh(t.stateNode,t.type,e))}}function dx(t){_o?xo?xo.push(t):xo=[t]:_o=t}function ux(){if(_o){var t=_o,e=xo;if(xo=_o=null,Jm(t),e)for(t=0;t<e.length;t++)Jm(e[t])}}function fx(t,e){return t(e)}function hx(){}var Nf=!1;function px(t,e,n){if(Nf)return t(e,n);Nf=!0;try{return fx(t,e,n)}finally{Nf=!1,(_o!==null||xo!==null)&&(hx(),ux())}}function il(t,e){var n=t.stateNode;if(n===null)return null;var r=_u(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ue(231,e,typeof n));return n}var Nh=!1;if(es)try{var ya={};Object.defineProperty(ya,"passive",{get:function(){Nh=!0}}),window.addEventListener("test",ya,ya),window.removeEventListener("test",ya,ya)}catch{Nh=!1}function hw(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var $a=!1,_d=null,xd=!1,jh=null,pw={onError:function(t){$a=!0,_d=t}};function gw(t,e,n,r,s,i,o,l,c){$a=!1,_d=null,hw.apply(pw,arguments)}function mw(t,e,n,r,s,i,o,l,c){if(gw.apply(this,arguments),$a){if($a){var d=_d;$a=!1,_d=null}else throw Error(ue(198));xd||(xd=!0,jh=d)}}function Mi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function gx(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function qm(t){if(Mi(t)!==t)throw Error(ue(188))}function yw(t){var e=t.alternate;if(!e){if(e=Mi(t),e===null)throw Error(ue(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return qm(s),t;if(i===r)return qm(s),e;i=i.sibling}throw Error(ue(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(ue(189))}}if(n.alternate!==r)throw Error(ue(190))}if(n.tag!==3)throw Error(ue(188));return n.stateNode.current===n?t:e}function mx(t){return t=yw(t),t!==null?yx(t):null}function yx(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=yx(t);if(e!==null)return e;t=t.sibling}return null}var vx=Hn.unstable_scheduleCallback,Zm=Hn.unstable_cancelCallback,vw=Hn.unstable_shouldYield,_w=Hn.unstable_requestPaint,Ht=Hn.unstable_now,xw=Hn.unstable_getCurrentPriorityLevel,ig=Hn.unstable_ImmediatePriority,_x=Hn.unstable_UserBlockingPriority,bd=Hn.unstable_NormalPriority,bw=Hn.unstable_LowPriority,xx=Hn.unstable_IdlePriority,gu=null,Lr=null;function Ew(t){if(Lr&&typeof Lr.onCommitFiberRoot=="function")try{Lr.onCommitFiberRoot(gu,t,void 0,(t.current.flags&128)===128)}catch{}}var mr=Math.clz32?Math.clz32:ww,Sw=Math.log,Iw=Math.LN2;function ww(t){return t>>>=0,t===0?32:31-(Sw(t)/Iw|0)|0}var wc=64,Tc=4194304;function Oa(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ed(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Oa(l):(i&=o,i!==0&&(r=Oa(i)))}else o=n&~s,o!==0?r=Oa(o):i!==0&&(r=Oa(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-mr(e),s=1<<n,r|=t[n],e&=~s;return r}function Tw(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cw(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-mr(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=Tw(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function $h(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function bx(){var t=wc;return wc<<=1,!(wc&4194240)&&(wc=64),t}function jf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ml(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-mr(e),t[e]=n}function kw(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-mr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function og(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-mr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Et=0;function Ex(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Sx,ag,Ix,wx,Tx,Fh=!1,Cc=[],Os=null,Ls=null,Ds=null,ol=new Map,al=new Map,xs=[],Rw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ey(t,e){switch(t){case"focusin":case"focusout":Os=null;break;case"dragenter":case"dragleave":Ls=null;break;case"mouseover":case"mouseout":Ds=null;break;case"pointerover":case"pointerout":ol.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":al.delete(e.pointerId)}}function va(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=jl(e),e!==null&&ag(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Aw(t,e,n,r,s){switch(e){case"focusin":return Os=va(Os,t,e,n,r,s),!0;case"dragenter":return Ls=va(Ls,t,e,n,r,s),!0;case"mouseover":return Ds=va(Ds,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return ol.set(i,va(ol.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,al.set(i,va(al.get(i)||null,t,e,n,r,s)),!0}return!1}function Cx(t){var e=mi(t.target);if(e!==null){var n=Mi(e);if(n!==null){if(e=n.tag,e===13){if(e=gx(n),e!==null){t.blockedOn=e,Tx(t.priority,function(){Ix(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Xc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Uh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Dh=r,n.target.dispatchEvent(r),Dh=null}else return e=jl(n),e!==null&&ag(e),t.blockedOn=n,!1;e.shift()}return!0}function ty(t,e,n){Xc(t)&&n.delete(e)}function Pw(){Fh=!1,Os!==null&&Xc(Os)&&(Os=null),Ls!==null&&Xc(Ls)&&(Ls=null),Ds!==null&&Xc(Ds)&&(Ds=null),ol.forEach(ty),al.forEach(ty)}function _a(t,e){t.blockedOn===e&&(t.blockedOn=null,Fh||(Fh=!0,Hn.unstable_scheduleCallback(Hn.unstable_NormalPriority,Pw)))}function ll(t){function e(s){return _a(s,t)}if(0<Cc.length){_a(Cc[0],t);for(var n=1;n<Cc.length;n++){var r=Cc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Os!==null&&_a(Os,t),Ls!==null&&_a(Ls,t),Ds!==null&&_a(Ds,t),ol.forEach(e),al.forEach(e),n=0;n<xs.length;n++)r=xs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<xs.length&&(n=xs[0],n.blockedOn===null);)Cx(n),n.blockedOn===null&&xs.shift()}var bo=as.ReactCurrentBatchConfig,Sd=!0;function Ow(t,e,n,r){var s=Et,i=bo.transition;bo.transition=null;try{Et=1,lg(t,e,n,r)}finally{Et=s,bo.transition=i}}function Lw(t,e,n,r){var s=Et,i=bo.transition;bo.transition=null;try{Et=4,lg(t,e,n,r)}finally{Et=s,bo.transition=i}}function lg(t,e,n,r){if(Sd){var s=Uh(t,e,n,r);if(s===null)Yf(t,e,r,Id,n),ey(t,r);else if(Aw(s,t,e,n,r))r.stopPropagation();else if(ey(t,r),e&4&&-1<Rw.indexOf(t)){for(;s!==null;){var i=jl(s);if(i!==null&&Sx(i),i=Uh(t,e,n,r),i===null&&Yf(t,e,r,Id,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Yf(t,e,r,null,n)}}var Id=null;function Uh(t,e,n,r){if(Id=null,t=sg(r),t=mi(t),t!==null)if(e=Mi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=gx(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Id=t,null}function kx(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xw()){case ig:return 1;case _x:return 4;case bd:case bw:return 16;case xx:return 536870912;default:return 16}default:return 16}}var Cs=null,cg=null,Qc=null;function Rx(){if(Qc)return Qc;var t,e=cg,n=e.length,r,s="value"in Cs?Cs.value:Cs.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Qc=s.slice(t,1<r?1-r:void 0)}function Jc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function kc(){return!0}function ny(){return!1}function Vn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?kc:ny,this.isPropagationStopped=ny,this}return Bt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=kc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=kc)},persist:function(){},isPersistent:kc}),e}var Yo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dg=Vn(Yo),Nl=Bt({},Yo,{view:0,detail:0}),Dw=Vn(Nl),$f,Ff,xa,mu=Bt({},Nl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ug,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xa&&(xa&&t.type==="mousemove"?($f=t.screenX-xa.screenX,Ff=t.screenY-xa.screenY):Ff=$f=0,xa=t),$f)},movementY:function(t){return"movementY"in t?t.movementY:Ff}}),ry=Vn(mu),Mw=Bt({},mu,{dataTransfer:0}),Nw=Vn(Mw),jw=Bt({},Nl,{relatedTarget:0}),Uf=Vn(jw),$w=Bt({},Yo,{animationName:0,elapsedTime:0,pseudoElement:0}),Fw=Vn($w),Uw=Bt({},Yo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Bw=Vn(Uw),zw=Bt({},Yo,{data:0}),sy=Vn(zw),Hw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ww={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Gw[t])?!!e[t]:!1}function ug(){return Vw}var Yw=Bt({},Nl,{key:function(t){if(t.key){var e=Hw[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Jc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ww[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ug,charCode:function(t){return t.type==="keypress"?Jc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Jc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Kw=Vn(Yw),Xw=Bt({},mu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iy=Vn(Xw),Qw=Bt({},Nl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ug}),Jw=Vn(Qw),qw=Bt({},Yo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Zw=Vn(qw),eT=Bt({},mu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),tT=Vn(eT),nT=[9,13,27,32],fg=es&&"CompositionEvent"in window,Fa=null;es&&"documentMode"in document&&(Fa=document.documentMode);var rT=es&&"TextEvent"in window&&!Fa,Ax=es&&(!fg||Fa&&8<Fa&&11>=Fa),oy=" ",ay=!1;function Px(t,e){switch(t){case"keyup":return nT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ox(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var io=!1;function sT(t,e){switch(t){case"compositionend":return Ox(e);case"keypress":return e.which!==32?null:(ay=!0,oy);case"textInput":return t=e.data,t===oy&&ay?null:t;default:return null}}function iT(t,e){if(io)return t==="compositionend"||!fg&&Px(t,e)?(t=Rx(),Qc=cg=Cs=null,io=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ax&&e.locale!=="ko"?null:e.data;default:return null}}var oT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ly(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!oT[t.type]:e==="textarea"}function Lx(t,e,n,r){dx(r),e=wd(e,"onChange"),0<e.length&&(n=new dg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ua=null,cl=null;function aT(t){Wx(t,0)}function yu(t){var e=lo(t);if(rx(e))return t}function lT(t,e){if(t==="change")return e}var Dx=!1;if(es){var Bf;if(es){var zf="oninput"in document;if(!zf){var cy=document.createElement("div");cy.setAttribute("oninput","return;"),zf=typeof cy.oninput=="function"}Bf=zf}else Bf=!1;Dx=Bf&&(!document.documentMode||9<document.documentMode)}function dy(){Ua&&(Ua.detachEvent("onpropertychange",Mx),cl=Ua=null)}function Mx(t){if(t.propertyName==="value"&&yu(cl)){var e=[];Lx(e,cl,t,sg(t)),px(aT,e)}}function cT(t,e,n){t==="focusin"?(dy(),Ua=e,cl=n,Ua.attachEvent("onpropertychange",Mx)):t==="focusout"&&dy()}function dT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return yu(cl)}function uT(t,e){if(t==="click")return yu(e)}function fT(t,e){if(t==="input"||t==="change")return yu(e)}function hT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var _r=typeof Object.is=="function"?Object.is:hT;function dl(t,e){if(_r(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Eh.call(e,s)||!_r(t[s],e[s]))return!1}return!0}function uy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function fy(t,e){var n=uy(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=uy(n)}}function Nx(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Nx(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function jx(){for(var t=window,e=vd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=vd(t.document)}return e}function hg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function pT(t){var e=jx(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Nx(n.ownerDocument.documentElement,n)){if(r!==null&&hg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=fy(n,i);var o=fy(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var gT=es&&"documentMode"in document&&11>=document.documentMode,oo=null,Bh=null,Ba=null,zh=!1;function hy(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;zh||oo==null||oo!==vd(r)||(r=oo,"selectionStart"in r&&hg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ba&&dl(Ba,r)||(Ba=r,r=wd(Bh,"onSelect"),0<r.length&&(e=new dg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=oo)))}function Rc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ao={animationend:Rc("Animation","AnimationEnd"),animationiteration:Rc("Animation","AnimationIteration"),animationstart:Rc("Animation","AnimationStart"),transitionend:Rc("Transition","TransitionEnd")},Hf={},$x={};es&&($x=document.createElement("div").style,"AnimationEvent"in window||(delete ao.animationend.animation,delete ao.animationiteration.animation,delete ao.animationstart.animation),"TransitionEvent"in window||delete ao.transitionend.transition);function vu(t){if(Hf[t])return Hf[t];if(!ao[t])return t;var e=ao[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in $x)return Hf[t]=e[n];return t}var Fx=vu("animationend"),Ux=vu("animationiteration"),Bx=vu("animationstart"),zx=vu("transitionend"),Hx=new Map,py="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zs(t,e){Hx.set(t,e),Di(e,[t])}for(var Wf=0;Wf<py.length;Wf++){var Gf=py[Wf],mT=Gf.toLowerCase(),yT=Gf[0].toUpperCase()+Gf.slice(1);Zs(mT,"on"+yT)}Zs(Fx,"onAnimationEnd");Zs(Ux,"onAnimationIteration");Zs(Bx,"onAnimationStart");Zs("dblclick","onDoubleClick");Zs("focusin","onFocus");Zs("focusout","onBlur");Zs(zx,"onTransitionEnd");Po("onMouseEnter",["mouseout","mouseover"]);Po("onMouseLeave",["mouseout","mouseover"]);Po("onPointerEnter",["pointerout","pointerover"]);Po("onPointerLeave",["pointerout","pointerover"]);Di("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Di("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Di("onBeforeInput",["compositionend","keypress","textInput","paste"]);Di("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Di("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Di("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var La="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vT=new Set("cancel close invalid load scroll toggle".split(" ").concat(La));function gy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,mw(r,e,void 0,t),t.currentTarget=null}function Wx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;gy(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;gy(s,l,d),i=c}}}if(xd)throw t=jh,xd=!1,jh=null,t}function Ot(t,e){var n=e[Yh];n===void 0&&(n=e[Yh]=new Set);var r=t+"__bubble";n.has(r)||(Gx(e,t,2,!1),n.add(r))}function Vf(t,e,n){var r=0;e&&(r|=4),Gx(n,t,r,e)}var Ac="_reactListening"+Math.random().toString(36).slice(2);function ul(t){if(!t[Ac]){t[Ac]=!0,q_.forEach(function(n){n!=="selectionchange"&&(vT.has(n)||Vf(n,!1,t),Vf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ac]||(e[Ac]=!0,Vf("selectionchange",!1,e))}}function Gx(t,e,n,r){switch(kx(e)){case 1:var s=Ow;break;case 4:s=Lw;break;default:s=lg}n=s.bind(null,e,n,t),s=void 0,!Nh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Yf(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=mi(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}px(function(){var d=i,u=sg(n),h=[];e:{var f=Hx.get(t);if(f!==void 0){var E=dg,k=t;switch(t){case"keypress":if(Jc(n)===0)break e;case"keydown":case"keyup":E=Kw;break;case"focusin":k="focus",E=Uf;break;case"focusout":k="blur",E=Uf;break;case"beforeblur":case"afterblur":E=Uf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":E=ry;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":E=Nw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":E=Jw;break;case Fx:case Ux:case Bx:E=Fw;break;case zx:E=Zw;break;case"scroll":E=Dw;break;case"wheel":E=tT;break;case"copy":case"cut":case"paste":E=Bw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":E=iy}var T=(e&4)!==0,N=!T&&t==="scroll",v=T?f!==null?f+"Capture":null:f;T=[];for(var _=d,S;_!==null;){S=_;var p=S.stateNode;if(S.tag===5&&p!==null&&(S=p,v!==null&&(p=il(_,v),p!=null&&T.push(fl(_,p,S)))),N)break;_=_.return}0<T.length&&(f=new E(f,k,null,n,u),h.push({event:f,listeners:T}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",E=t==="mouseout"||t==="pointerout",f&&n!==Dh&&(k=n.relatedTarget||n.fromElement)&&(mi(k)||k[ts]))break e;if((E||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,E?(k=n.relatedTarget||n.toElement,E=d,k=k?mi(k):null,k!==null&&(N=Mi(k),k!==N||k.tag!==5&&k.tag!==6)&&(k=null)):(E=null,k=d),E!==k)){if(T=ry,p="onMouseLeave",v="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(T=iy,p="onPointerLeave",v="onPointerEnter",_="pointer"),N=E==null?f:lo(E),S=k==null?f:lo(k),f=new T(p,_+"leave",E,n,u),f.target=N,f.relatedTarget=S,p=null,mi(u)===d&&(T=new T(v,_+"enter",k,n,u),T.target=S,T.relatedTarget=N,p=T),N=p,E&&k)t:{for(T=E,v=k,_=0,S=T;S;S=Zi(S))_++;for(S=0,p=v;p;p=Zi(p))S++;for(;0<_-S;)T=Zi(T),_--;for(;0<S-_;)v=Zi(v),S--;for(;_--;){if(T===v||v!==null&&T===v.alternate)break t;T=Zi(T),v=Zi(v)}T=null}else T=null;E!==null&&my(h,f,E,T,!1),k!==null&&N!==null&&my(h,N,k,T,!0)}}e:{if(f=d?lo(d):window,E=f.nodeName&&f.nodeName.toLowerCase(),E==="select"||E==="input"&&f.type==="file")var D=lT;else if(ly(f))if(Dx)D=fT;else{D=dT;var H=cT}else(E=f.nodeName)&&E.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(D=uT);if(D&&(D=D(t,d))){Lx(h,D,n,u);break e}H&&H(t,f,d),t==="focusout"&&(H=f._wrapperState)&&H.controlled&&f.type==="number"&&Rh(f,"number",f.value)}switch(H=d?lo(d):window,t){case"focusin":(ly(H)||H.contentEditable==="true")&&(oo=H,Bh=d,Ba=null);break;case"focusout":Ba=Bh=oo=null;break;case"mousedown":zh=!0;break;case"contextmenu":case"mouseup":case"dragend":zh=!1,hy(h,n,u);break;case"selectionchange":if(gT)break;case"keydown":case"keyup":hy(h,n,u)}var ne;if(fg)e:{switch(t){case"compositionstart":var G="onCompositionStart";break e;case"compositionend":G="onCompositionEnd";break e;case"compositionupdate":G="onCompositionUpdate";break e}G=void 0}else io?Px(t,n)&&(G="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(G="onCompositionStart");G&&(Ax&&n.locale!=="ko"&&(io||G!=="onCompositionStart"?G==="onCompositionEnd"&&io&&(ne=Rx()):(Cs=u,cg="value"in Cs?Cs.value:Cs.textContent,io=!0)),H=wd(d,G),0<H.length&&(G=new sy(G,t,null,n,u),h.push({event:G,listeners:H}),ne?G.data=ne:(ne=Ox(n),ne!==null&&(G.data=ne)))),(ne=rT?sT(t,n):iT(t,n))&&(d=wd(d,"onBeforeInput"),0<d.length&&(u=new sy("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:d}),u.data=ne))}Wx(h,e)})}function fl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function wd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=il(t,n),i!=null&&r.unshift(fl(t,i,s)),i=il(t,e),i!=null&&r.push(fl(t,i,s))),t=t.return}return r}function Zi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function my(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=il(n,i),c!=null&&o.unshift(fl(n,c,l))):s||(c=il(n,i),c!=null&&o.push(fl(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var _T=/\r\n?/g,xT=/\u0000|\uFFFD/g;function yy(t){return(typeof t=="string"?t:""+t).replace(_T,`
`).replace(xT,"")}function Pc(t,e,n){if(e=yy(e),yy(t)!==e&&n)throw Error(ue(425))}function Td(){}var Hh=null,Wh=null;function Gh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Vh=typeof setTimeout=="function"?setTimeout:void 0,bT=typeof clearTimeout=="function"?clearTimeout:void 0,vy=typeof Promise=="function"?Promise:void 0,ET=typeof queueMicrotask=="function"?queueMicrotask:typeof vy<"u"?function(t){return vy.resolve(null).then(t).catch(ST)}:Vh;function ST(t){setTimeout(function(){throw t})}function Kf(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),ll(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);ll(e)}function Ms(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function _y(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ko=Math.random().toString(36).slice(2),Rr="__reactFiber$"+Ko,hl="__reactProps$"+Ko,ts="__reactContainer$"+Ko,Yh="__reactEvents$"+Ko,IT="__reactListeners$"+Ko,wT="__reactHandles$"+Ko;function mi(t){var e=t[Rr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ts]||n[Rr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=_y(t);t!==null;){if(n=t[Rr])return n;t=_y(t)}return e}t=n,n=t.parentNode}return null}function jl(t){return t=t[Rr]||t[ts],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function lo(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ue(33))}function _u(t){return t[hl]||null}var Kh=[],co=-1;function ei(t){return{current:t}}function Lt(t){0>co||(t.current=Kh[co],Kh[co]=null,co--)}function Pt(t,e){co++,Kh[co]=t.current,t.current=e}var Ys={},yn=ei(Ys),Mn=ei(!1),Ei=Ys;function Oo(t,e){var n=t.type.contextTypes;if(!n)return Ys;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Nn(t){return t=t.childContextTypes,t!=null}function Cd(){Lt(Mn),Lt(yn)}function xy(t,e,n){if(yn.current!==Ys)throw Error(ue(168));Pt(yn,e),Pt(Mn,n)}function Vx(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ue(108,cw(t)||"Unknown",s));return Bt({},n,r)}function kd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ys,Ei=yn.current,Pt(yn,t),Pt(Mn,Mn.current),!0}function by(t,e,n){var r=t.stateNode;if(!r)throw Error(ue(169));n?(t=Vx(t,e,Ei),r.__reactInternalMemoizedMergedChildContext=t,Lt(Mn),Lt(yn),Pt(yn,t)):Lt(Mn),Pt(Mn,n)}var Wr=null,xu=!1,Xf=!1;function Yx(t){Wr===null?Wr=[t]:Wr.push(t)}function TT(t){xu=!0,Yx(t)}function ti(){if(!Xf&&Wr!==null){Xf=!0;var t=0,e=Et;try{var n=Wr;for(Et=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Wr=null,xu=!1}catch(s){throw Wr!==null&&(Wr=Wr.slice(t+1)),vx(ig,ti),s}finally{Et=e,Xf=!1}}return null}var uo=[],fo=0,Rd=null,Ad=0,Xn=[],Qn=0,Si=null,Vr=1,Yr="";function ui(t,e){uo[fo++]=Ad,uo[fo++]=Rd,Rd=t,Ad=e}function Kx(t,e,n){Xn[Qn++]=Vr,Xn[Qn++]=Yr,Xn[Qn++]=Si,Si=t;var r=Vr;t=Yr;var s=32-mr(r)-1;r&=~(1<<s),n+=1;var i=32-mr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Vr=1<<32-mr(e)+s|n<<s|r,Yr=i+t}else Vr=1<<i|n<<s|r,Yr=t}function pg(t){t.return!==null&&(ui(t,1),Kx(t,1,0))}function gg(t){for(;t===Rd;)Rd=uo[--fo],uo[fo]=null,Ad=uo[--fo],uo[fo]=null;for(;t===Si;)Si=Xn[--Qn],Xn[Qn]=null,Yr=Xn[--Qn],Xn[Qn]=null,Vr=Xn[--Qn],Xn[Qn]=null}var zn=null,Bn=null,Mt=!1,ur=null;function Xx(t,e){var n=Zn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Ey(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,zn=t,Bn=Ms(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,zn=t,Bn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Si!==null?{id:Vr,overflow:Yr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Zn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,zn=t,Bn=null,!0):!1;default:return!1}}function Xh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Qh(t){if(Mt){var e=Bn;if(e){var n=e;if(!Ey(t,e)){if(Xh(t))throw Error(ue(418));e=Ms(n.nextSibling);var r=zn;e&&Ey(t,e)?Xx(r,n):(t.flags=t.flags&-4097|2,Mt=!1,zn=t)}}else{if(Xh(t))throw Error(ue(418));t.flags=t.flags&-4097|2,Mt=!1,zn=t}}}function Sy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;zn=t}function Oc(t){if(t!==zn)return!1;if(!Mt)return Sy(t),Mt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Gh(t.type,t.memoizedProps)),e&&(e=Bn)){if(Xh(t))throw Qx(),Error(ue(418));for(;e;)Xx(t,e),e=Ms(e.nextSibling)}if(Sy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ue(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Bn=Ms(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Bn=null}}else Bn=zn?Ms(t.stateNode.nextSibling):null;return!0}function Qx(){for(var t=Bn;t;)t=Ms(t.nextSibling)}function Lo(){Bn=zn=null,Mt=!1}function mg(t){ur===null?ur=[t]:ur.push(t)}var CT=as.ReactCurrentBatchConfig;function ba(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ue(309));var r=n.stateNode}if(!r)throw Error(ue(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(ue(284));if(!n._owner)throw Error(ue(290,t))}return t}function Lc(t,e){throw t=Object.prototype.toString.call(e),Error(ue(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Iy(t){var e=t._init;return e(t._payload)}function Jx(t){function e(v,_){if(t){var S=v.deletions;S===null?(v.deletions=[_],v.flags|=16):S.push(_)}}function n(v,_){if(!t)return null;for(;_!==null;)e(v,_),_=_.sibling;return null}function r(v,_){for(v=new Map;_!==null;)_.key!==null?v.set(_.key,_):v.set(_.index,_),_=_.sibling;return v}function s(v,_){return v=Fs(v,_),v.index=0,v.sibling=null,v}function i(v,_,S){return v.index=S,t?(S=v.alternate,S!==null?(S=S.index,S<_?(v.flags|=2,_):S):(v.flags|=2,_)):(v.flags|=1048576,_)}function o(v){return t&&v.alternate===null&&(v.flags|=2),v}function l(v,_,S,p){return _===null||_.tag!==6?(_=nh(S,v.mode,p),_.return=v,_):(_=s(_,S),_.return=v,_)}function c(v,_,S,p){var D=S.type;return D===so?u(v,_,S.props.children,p,S.key):_!==null&&(_.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===vs&&Iy(D)===_.type)?(p=s(_,S.props),p.ref=ba(v,_,S),p.return=v,p):(p=sd(S.type,S.key,S.props,null,v.mode,p),p.ref=ba(v,_,S),p.return=v,p)}function d(v,_,S,p){return _===null||_.tag!==4||_.stateNode.containerInfo!==S.containerInfo||_.stateNode.implementation!==S.implementation?(_=rh(S,v.mode,p),_.return=v,_):(_=s(_,S.children||[]),_.return=v,_)}function u(v,_,S,p,D){return _===null||_.tag!==7?(_=bi(S,v.mode,p,D),_.return=v,_):(_=s(_,S),_.return=v,_)}function h(v,_,S){if(typeof _=="string"&&_!==""||typeof _=="number")return _=nh(""+_,v.mode,S),_.return=v,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Ec:return S=sd(_.type,_.key,_.props,null,v.mode,S),S.ref=ba(v,null,_),S.return=v,S;case ro:return _=rh(_,v.mode,S),_.return=v,_;case vs:var p=_._init;return h(v,p(_._payload),S)}if(Pa(_)||ma(_))return _=bi(_,v.mode,S,null),_.return=v,_;Lc(v,_)}return null}function f(v,_,S,p){var D=_!==null?_.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return D!==null?null:l(v,_,""+S,p);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Ec:return S.key===D?c(v,_,S,p):null;case ro:return S.key===D?d(v,_,S,p):null;case vs:return D=S._init,f(v,_,D(S._payload),p)}if(Pa(S)||ma(S))return D!==null?null:u(v,_,S,p,null);Lc(v,S)}return null}function E(v,_,S,p,D){if(typeof p=="string"&&p!==""||typeof p=="number")return v=v.get(S)||null,l(_,v,""+p,D);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Ec:return v=v.get(p.key===null?S:p.key)||null,c(_,v,p,D);case ro:return v=v.get(p.key===null?S:p.key)||null,d(_,v,p,D);case vs:var H=p._init;return E(v,_,S,H(p._payload),D)}if(Pa(p)||ma(p))return v=v.get(S)||null,u(_,v,p,D,null);Lc(_,p)}return null}function k(v,_,S,p){for(var D=null,H=null,ne=_,G=_=0,q=null;ne!==null&&G<S.length;G++){ne.index>G?(q=ne,ne=null):q=ne.sibling;var he=f(v,ne,S[G],p);if(he===null){ne===null&&(ne=q);break}t&&ne&&he.alternate===null&&e(v,ne),_=i(he,_,G),H===null?D=he:H.sibling=he,H=he,ne=q}if(G===S.length)return n(v,ne),Mt&&ui(v,G),D;if(ne===null){for(;G<S.length;G++)ne=h(v,S[G],p),ne!==null&&(_=i(ne,_,G),H===null?D=ne:H.sibling=ne,H=ne);return Mt&&ui(v,G),D}for(ne=r(v,ne);G<S.length;G++)q=E(ne,v,G,S[G],p),q!==null&&(t&&q.alternate!==null&&ne.delete(q.key===null?G:q.key),_=i(q,_,G),H===null?D=q:H.sibling=q,H=q);return t&&ne.forEach(function(xe){return e(v,xe)}),Mt&&ui(v,G),D}function T(v,_,S,p){var D=ma(S);if(typeof D!="function")throw Error(ue(150));if(S=D.call(S),S==null)throw Error(ue(151));for(var H=D=null,ne=_,G=_=0,q=null,he=S.next();ne!==null&&!he.done;G++,he=S.next()){ne.index>G?(q=ne,ne=null):q=ne.sibling;var xe=f(v,ne,he.value,p);if(xe===null){ne===null&&(ne=q);break}t&&ne&&xe.alternate===null&&e(v,ne),_=i(xe,_,G),H===null?D=xe:H.sibling=xe,H=xe,ne=q}if(he.done)return n(v,ne),Mt&&ui(v,G),D;if(ne===null){for(;!he.done;G++,he=S.next())he=h(v,he.value,p),he!==null&&(_=i(he,_,G),H===null?D=he:H.sibling=he,H=he);return Mt&&ui(v,G),D}for(ne=r(v,ne);!he.done;G++,he=S.next())he=E(ne,v,G,he.value,p),he!==null&&(t&&he.alternate!==null&&ne.delete(he.key===null?G:he.key),_=i(he,_,G),H===null?D=he:H.sibling=he,H=he);return t&&ne.forEach(function(je){return e(v,je)}),Mt&&ui(v,G),D}function N(v,_,S,p){if(typeof S=="object"&&S!==null&&S.type===so&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Ec:e:{for(var D=S.key,H=_;H!==null;){if(H.key===D){if(D=S.type,D===so){if(H.tag===7){n(v,H.sibling),_=s(H,S.props.children),_.return=v,v=_;break e}}else if(H.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===vs&&Iy(D)===H.type){n(v,H.sibling),_=s(H,S.props),_.ref=ba(v,H,S),_.return=v,v=_;break e}n(v,H);break}else e(v,H);H=H.sibling}S.type===so?(_=bi(S.props.children,v.mode,p,S.key),_.return=v,v=_):(p=sd(S.type,S.key,S.props,null,v.mode,p),p.ref=ba(v,_,S),p.return=v,v=p)}return o(v);case ro:e:{for(H=S.key;_!==null;){if(_.key===H)if(_.tag===4&&_.stateNode.containerInfo===S.containerInfo&&_.stateNode.implementation===S.implementation){n(v,_.sibling),_=s(_,S.children||[]),_.return=v,v=_;break e}else{n(v,_);break}else e(v,_);_=_.sibling}_=rh(S,v.mode,p),_.return=v,v=_}return o(v);case vs:return H=S._init,N(v,_,H(S._payload),p)}if(Pa(S))return k(v,_,S,p);if(ma(S))return T(v,_,S,p);Lc(v,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,_!==null&&_.tag===6?(n(v,_.sibling),_=s(_,S),_.return=v,v=_):(n(v,_),_=nh(S,v.mode,p),_.return=v,v=_),o(v)):n(v,_)}return N}var Do=Jx(!0),qx=Jx(!1),Pd=ei(null),Od=null,ho=null,yg=null;function vg(){yg=ho=Od=null}function _g(t){var e=Pd.current;Lt(Pd),t._currentValue=e}function Jh(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Eo(t,e){Od=t,yg=ho=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ln=!0),t.firstContext=null)}function nr(t){var e=t._currentValue;if(yg!==t)if(t={context:t,memoizedValue:e,next:null},ho===null){if(Od===null)throw Error(ue(308));ho=t,Od.dependencies={lanes:0,firstContext:t}}else ho=ho.next=t;return e}var yi=null;function xg(t){yi===null?yi=[t]:yi.push(t)}function Zx(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,xg(e)):(n.next=s.next,s.next=n),e.interleaved=n,ns(t,r)}function ns(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var _s=!1;function bg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function e1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Jr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ns(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ht&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ns(t,n)}return s=r.interleaved,s===null?(e.next=e,xg(r)):(e.next=s.next,s.next=e),r.interleaved=e,ns(t,n)}function qc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,og(t,n)}}function wy(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ld(t,e,n,r){var s=t.updateQueue;_s=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,u=d=c=null,l=i;do{var f=l.lane,E=l.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:E,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=t,T=l;switch(f=e,E=n,T.tag){case 1:if(k=T.payload,typeof k=="function"){h=k.call(E,h,f);break e}h=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=T.payload,f=typeof k=="function"?k.call(E,h,f):k,f==null)break e;h=Bt({},h,f);break e;case 2:_s=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else E={eventTime:E,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=E,c=h):u=u.next=E,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);wi|=o,t.lanes=o,t.memoizedState=h}}function Ty(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(ue(191,s));s.call(r)}}}var $l={},Dr=ei($l),pl=ei($l),gl=ei($l);function vi(t){if(t===$l)throw Error(ue(174));return t}function Eg(t,e){switch(Pt(gl,e),Pt(pl,t),Pt(Dr,$l),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ph(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ph(e,t)}Lt(Dr),Pt(Dr,e)}function Mo(){Lt(Dr),Lt(pl),Lt(gl)}function t1(t){vi(gl.current);var e=vi(Dr.current),n=Ph(e,t.type);e!==n&&(Pt(pl,t),Pt(Dr,n))}function Sg(t){pl.current===t&&(Lt(Dr),Lt(pl))}var jt=ei(0);function Dd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Qf=[];function Ig(){for(var t=0;t<Qf.length;t++)Qf[t]._workInProgressVersionPrimary=null;Qf.length=0}var Zc=as.ReactCurrentDispatcher,Jf=as.ReactCurrentBatchConfig,Ii=0,Ut=null,Kt=null,Zt=null,Md=!1,za=!1,ml=0,kT=0;function hn(){throw Error(ue(321))}function wg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!_r(t[n],e[n]))return!1;return!0}function Tg(t,e,n,r,s,i){if(Ii=i,Ut=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Zc.current=t===null||t.memoizedState===null?OT:LT,t=n(r,s),za){i=0;do{if(za=!1,ml=0,25<=i)throw Error(ue(301));i+=1,Zt=Kt=null,e.updateQueue=null,Zc.current=DT,t=n(r,s)}while(za)}if(Zc.current=Nd,e=Kt!==null&&Kt.next!==null,Ii=0,Zt=Kt=Ut=null,Md=!1,e)throw Error(ue(300));return t}function Cg(){var t=ml!==0;return ml=0,t}function kr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zt===null?Ut.memoizedState=Zt=t:Zt=Zt.next=t,Zt}function rr(){if(Kt===null){var t=Ut.alternate;t=t!==null?t.memoizedState:null}else t=Kt.next;var e=Zt===null?Ut.memoizedState:Zt.next;if(e!==null)Zt=e,Kt=t;else{if(t===null)throw Error(ue(310));Kt=t,t={memoizedState:Kt.memoizedState,baseState:Kt.baseState,baseQueue:Kt.baseQueue,queue:Kt.queue,next:null},Zt===null?Ut.memoizedState=Zt=t:Zt=Zt.next=t}return Zt}function yl(t,e){return typeof e=="function"?e(t):e}function qf(t){var e=rr(),n=e.queue;if(n===null)throw Error(ue(311));n.lastRenderedReducer=t;var r=Kt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((Ii&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,Ut.lanes|=u,wi|=u}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,_r(r,e.memoizedState)||(Ln=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Ut.lanes|=i,wi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Zf(t){var e=rr(),n=e.queue;if(n===null)throw Error(ue(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);_r(i,e.memoizedState)||(Ln=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function n1(){}function r1(t,e){var n=Ut,r=rr(),s=e(),i=!_r(r.memoizedState,s);if(i&&(r.memoizedState=s,Ln=!0),r=r.queue,kg(o1.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Zt!==null&&Zt.memoizedState.tag&1){if(n.flags|=2048,vl(9,i1.bind(null,n,r,s,e),void 0,null),nn===null)throw Error(ue(349));Ii&30||s1(n,e,s)}return s}function s1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ut.updateQueue,e===null?(e={lastEffect:null,stores:null},Ut.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function i1(t,e,n,r){e.value=n,e.getSnapshot=r,a1(e)&&l1(t)}function o1(t,e,n){return n(function(){a1(e)&&l1(t)})}function a1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!_r(t,n)}catch{return!0}}function l1(t){var e=ns(t,1);e!==null&&yr(e,t,1,-1)}function Cy(t){var e=kr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yl,lastRenderedState:t},e.queue=t,t=t.dispatch=PT.bind(null,Ut,t),[e.memoizedState,t]}function vl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ut.updateQueue,e===null?(e={lastEffect:null,stores:null},Ut.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function c1(){return rr().memoizedState}function ed(t,e,n,r){var s=kr();Ut.flags|=t,s.memoizedState=vl(1|e,n,void 0,r===void 0?null:r)}function bu(t,e,n,r){var s=rr();r=r===void 0?null:r;var i=void 0;if(Kt!==null){var o=Kt.memoizedState;if(i=o.destroy,r!==null&&wg(r,o.deps)){s.memoizedState=vl(e,n,i,r);return}}Ut.flags|=t,s.memoizedState=vl(1|e,n,i,r)}function ky(t,e){return ed(8390656,8,t,e)}function kg(t,e){return bu(2048,8,t,e)}function d1(t,e){return bu(4,2,t,e)}function u1(t,e){return bu(4,4,t,e)}function f1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function h1(t,e,n){return n=n!=null?n.concat([t]):null,bu(4,4,f1.bind(null,e,t),n)}function Rg(){}function p1(t,e){var n=rr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&wg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function g1(t,e){var n=rr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&wg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function m1(t,e,n){return Ii&21?(_r(n,e)||(n=bx(),Ut.lanes|=n,wi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ln=!0),t.memoizedState=n)}function RT(t,e){var n=Et;Et=n!==0&&4>n?n:4,t(!0);var r=Jf.transition;Jf.transition={};try{t(!1),e()}finally{Et=n,Jf.transition=r}}function y1(){return rr().memoizedState}function AT(t,e,n){var r=$s(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},v1(t))_1(e,n);else if(n=Zx(t,e,n,r),n!==null){var s=In();yr(n,t,r,s),x1(n,e,r)}}function PT(t,e,n){var r=$s(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(v1(t))_1(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,_r(l,o)){var c=e.interleaved;c===null?(s.next=s,xg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=Zx(t,e,s,r),n!==null&&(s=In(),yr(n,t,r,s),x1(n,e,r))}}function v1(t){var e=t.alternate;return t===Ut||e!==null&&e===Ut}function _1(t,e){za=Md=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function x1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,og(t,n)}}var Nd={readContext:nr,useCallback:hn,useContext:hn,useEffect:hn,useImperativeHandle:hn,useInsertionEffect:hn,useLayoutEffect:hn,useMemo:hn,useReducer:hn,useRef:hn,useState:hn,useDebugValue:hn,useDeferredValue:hn,useTransition:hn,useMutableSource:hn,useSyncExternalStore:hn,useId:hn,unstable_isNewReconciler:!1},OT={readContext:nr,useCallback:function(t,e){return kr().memoizedState=[t,e===void 0?null:e],t},useContext:nr,useEffect:ky,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ed(4194308,4,f1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ed(4194308,4,t,e)},useInsertionEffect:function(t,e){return ed(4,2,t,e)},useMemo:function(t,e){var n=kr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=kr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=AT.bind(null,Ut,t),[r.memoizedState,t]},useRef:function(t){var e=kr();return t={current:t},e.memoizedState=t},useState:Cy,useDebugValue:Rg,useDeferredValue:function(t){return kr().memoizedState=t},useTransition:function(){var t=Cy(!1),e=t[0];return t=RT.bind(null,t[1]),kr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ut,s=kr();if(Mt){if(n===void 0)throw Error(ue(407));n=n()}else{if(n=e(),nn===null)throw Error(ue(349));Ii&30||s1(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,ky(o1.bind(null,r,i,t),[t]),r.flags|=2048,vl(9,i1.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=kr(),e=nn.identifierPrefix;if(Mt){var n=Yr,r=Vr;n=(r&~(1<<32-mr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ml++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kT++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},LT={readContext:nr,useCallback:p1,useContext:nr,useEffect:kg,useImperativeHandle:h1,useInsertionEffect:d1,useLayoutEffect:u1,useMemo:g1,useReducer:qf,useRef:c1,useState:function(){return qf(yl)},useDebugValue:Rg,useDeferredValue:function(t){var e=rr();return m1(e,Kt.memoizedState,t)},useTransition:function(){var t=qf(yl)[0],e=rr().memoizedState;return[t,e]},useMutableSource:n1,useSyncExternalStore:r1,useId:y1,unstable_isNewReconciler:!1},DT={readContext:nr,useCallback:p1,useContext:nr,useEffect:kg,useImperativeHandle:h1,useInsertionEffect:d1,useLayoutEffect:u1,useMemo:g1,useReducer:Zf,useRef:c1,useState:function(){return Zf(yl)},useDebugValue:Rg,useDeferredValue:function(t){var e=rr();return Kt===null?e.memoizedState=t:m1(e,Kt.memoizedState,t)},useTransition:function(){var t=Zf(yl)[0],e=rr().memoizedState;return[t,e]},useMutableSource:n1,useSyncExternalStore:r1,useId:y1,unstable_isNewReconciler:!1};function cr(t,e){if(t&&t.defaultProps){e=Bt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function qh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Bt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Eu={isMounted:function(t){return(t=t._reactInternals)?Mi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=In(),s=$s(t),i=Jr(r,s);i.payload=e,n!=null&&(i.callback=n),e=Ns(t,i,s),e!==null&&(yr(e,t,s,r),qc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=In(),s=$s(t),i=Jr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ns(t,i,s),e!==null&&(yr(e,t,s,r),qc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=In(),r=$s(t),s=Jr(n,r);s.tag=2,e!=null&&(s.callback=e),e=Ns(t,s,r),e!==null&&(yr(e,t,r,n),qc(e,t,r))}};function Ry(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!dl(n,r)||!dl(s,i):!0}function b1(t,e,n){var r=!1,s=Ys,i=e.contextType;return typeof i=="object"&&i!==null?i=nr(i):(s=Nn(e)?Ei:yn.current,r=e.contextTypes,i=(r=r!=null)?Oo(t,s):Ys),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Eu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Ay(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Eu.enqueueReplaceState(e,e.state,null)}function Zh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},bg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=nr(i):(i=Nn(e)?Ei:yn.current,s.context=Oo(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(qh(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Eu.enqueueReplaceState(s,s.state,null),Ld(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function No(t,e){try{var n="",r=e;do n+=lw(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function eh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ep(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var MT=typeof WeakMap=="function"?WeakMap:Map;function E1(t,e,n){n=Jr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){$d||($d=!0,dp=r),ep(t,e)},n}function S1(t,e,n){n=Jr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){ep(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){ep(t,e),typeof r!="function"&&(js===null?js=new Set([this]):js.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Py(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new MT;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=XT.bind(null,t,e,n),e.then(t,t))}function Oy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ly(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Jr(-1,1),e.tag=2,Ns(n,e,1))),n.lanes|=1),t)}var NT=as.ReactCurrentOwner,Ln=!1;function En(t,e,n,r){e.child=t===null?qx(e,null,n,r):Do(e,t.child,n,r)}function Dy(t,e,n,r,s){n=n.render;var i=e.ref;return Eo(e,s),r=Tg(t,e,n,r,i,s),n=Cg(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,rs(t,e,s)):(Mt&&n&&pg(e),e.flags|=1,En(t,e,r,s),e.child)}function My(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!jg(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,I1(t,e,i,r,s)):(t=sd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:dl,n(o,r)&&t.ref===e.ref)return rs(t,e,s)}return e.flags|=1,t=Fs(i,r),t.ref=e.ref,t.return=e,e.child=t}function I1(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(dl(i,r)&&t.ref===e.ref)if(Ln=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Ln=!0);else return e.lanes=t.lanes,rs(t,e,s)}return tp(t,e,n,r,s)}function w1(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Pt(go,Un),Un|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Pt(go,Un),Un|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Pt(go,Un),Un|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Pt(go,Un),Un|=r;return En(t,e,s,n),e.child}function T1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function tp(t,e,n,r,s){var i=Nn(n)?Ei:yn.current;return i=Oo(e,i),Eo(e,s),n=Tg(t,e,n,r,i,s),r=Cg(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,rs(t,e,s)):(Mt&&r&&pg(e),e.flags|=1,En(t,e,n,s),e.child)}function Ny(t,e,n,r,s){if(Nn(n)){var i=!0;kd(e)}else i=!1;if(Eo(e,s),e.stateNode===null)td(t,e),b1(e,n,r),Zh(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=nr(d):(d=Nn(n)?Ei:yn.current,d=Oo(e,d));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Ay(e,o,r,d),_s=!1;var f=e.memoizedState;o.state=f,Ld(e,r,o,s),c=e.memoizedState,l!==r||f!==c||Mn.current||_s?(typeof u=="function"&&(qh(e,n,u,r),c=e.memoizedState),(l=_s||Ry(e,n,l,r,f,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,e1(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:cr(e.type,l),o.props=d,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=nr(c):(c=Nn(n)?Ei:yn.current,c=Oo(e,c));var E=n.getDerivedStateFromProps;(u=typeof E=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==c)&&Ay(e,o,r,c),_s=!1,f=e.memoizedState,o.state=f,Ld(e,r,o,s);var k=e.memoizedState;l!==h||f!==k||Mn.current||_s?(typeof E=="function"&&(qh(e,n,E,r),k=e.memoizedState),(d=_s||Ry(e,n,d,r,f,k,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,k,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,k,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),o.props=r,o.state=k,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return np(t,e,n,r,i,s)}function np(t,e,n,r,s,i){T1(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&by(e,n,!1),rs(t,e,i);r=e.stateNode,NT.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Do(e,t.child,null,i),e.child=Do(e,null,l,i)):En(t,e,l,i),e.memoizedState=r.state,s&&by(e,n,!0),e.child}function C1(t){var e=t.stateNode;e.pendingContext?xy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&xy(t,e.context,!1),Eg(t,e.containerInfo)}function jy(t,e,n,r,s){return Lo(),mg(s),e.flags|=256,En(t,e,n,r),e.child}var rp={dehydrated:null,treeContext:null,retryLane:0};function sp(t){return{baseLanes:t,cachePool:null,transitions:null}}function k1(t,e,n){var r=e.pendingProps,s=jt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Pt(jt,s&1),t===null)return Qh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=wu(o,r,0,null),t=bi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=sp(n),e.memoizedState=rp,t):Ag(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return jT(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Fs(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=Fs(l,i):(i=bi(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?sp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=rp,r}return i=t.child,t=i.sibling,r=Fs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Ag(t,e){return e=wu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Dc(t,e,n,r){return r!==null&&mg(r),Do(e,t.child,null,n),t=Ag(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function jT(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=eh(Error(ue(422))),Dc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=wu({mode:"visible",children:r.children},s,0,null),i=bi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Do(e,t.child,null,o),e.child.memoizedState=sp(o),e.memoizedState=rp,i);if(!(e.mode&1))return Dc(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(ue(419)),r=eh(i,r,void 0),Dc(t,e,o,r)}if(l=(o&t.childLanes)!==0,Ln||l){if(r=nn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ns(t,s),yr(r,t,s,-1))}return Ng(),r=eh(Error(ue(421))),Dc(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=QT.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Bn=Ms(s.nextSibling),zn=e,Mt=!0,ur=null,t!==null&&(Xn[Qn++]=Vr,Xn[Qn++]=Yr,Xn[Qn++]=Si,Vr=t.id,Yr=t.overflow,Si=e),e=Ag(e,r.children),e.flags|=4096,e)}function $y(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Jh(t.return,e,n)}function th(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function R1(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(En(t,e,r.children,n),r=jt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$y(t,n,e);else if(t.tag===19)$y(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Pt(jt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Dd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),th(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Dd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}th(e,!0,n,null,i);break;case"together":th(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function td(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function rs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),wi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ue(153));if(e.child!==null){for(t=e.child,n=Fs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Fs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function $T(t,e,n){switch(e.tag){case 3:C1(e),Lo();break;case 5:t1(e);break;case 1:Nn(e.type)&&kd(e);break;case 4:Eg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Pt(Pd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Pt(jt,jt.current&1),e.flags|=128,null):n&e.child.childLanes?k1(t,e,n):(Pt(jt,jt.current&1),t=rs(t,e,n),t!==null?t.sibling:null);Pt(jt,jt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return R1(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Pt(jt,jt.current),r)break;return null;case 22:case 23:return e.lanes=0,w1(t,e,n)}return rs(t,e,n)}var A1,ip,P1,O1;A1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ip=function(){};P1=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,vi(Dr.current);var i=null;switch(n){case"input":s=Ch(t,s),r=Ch(t,r),i=[];break;case"select":s=Bt({},s,{value:void 0}),r=Bt({},r,{value:void 0}),i=[];break;case"textarea":s=Ah(t,s),r=Ah(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Td)}Oh(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(rl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(rl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Ot("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};O1=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ea(t,e){if(!Mt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function pn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function FT(t,e,n){var r=e.pendingProps;switch(gg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pn(e),null;case 1:return Nn(e.type)&&Cd(),pn(e),null;case 3:return r=e.stateNode,Mo(),Lt(Mn),Lt(yn),Ig(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Oc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ur!==null&&(hp(ur),ur=null))),ip(t,e),pn(e),null;case 5:Sg(e);var s=vi(gl.current);if(n=e.type,t!==null&&e.stateNode!=null)P1(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ue(166));return pn(e),null}if(t=vi(Dr.current),Oc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Rr]=e,r[hl]=i,t=(e.mode&1)!==0,n){case"dialog":Ot("cancel",r),Ot("close",r);break;case"iframe":case"object":case"embed":Ot("load",r);break;case"video":case"audio":for(s=0;s<La.length;s++)Ot(La[s],r);break;case"source":Ot("error",r);break;case"img":case"image":case"link":Ot("error",r),Ot("load",r);break;case"details":Ot("toggle",r);break;case"input":Ym(r,i),Ot("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ot("invalid",r);break;case"textarea":Xm(r,i),Ot("invalid",r)}Oh(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Pc(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Pc(r.textContent,l,t),s=["children",""+l]):rl.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Ot("scroll",r)}switch(n){case"input":Sc(r),Km(r,i,!0);break;case"textarea":Sc(r),Qm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Td)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ox(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Rr]=e,t[hl]=r,A1(t,e,!1,!1),e.stateNode=t;e:{switch(o=Lh(n,r),n){case"dialog":Ot("cancel",t),Ot("close",t),s=r;break;case"iframe":case"object":case"embed":Ot("load",t),s=r;break;case"video":case"audio":for(s=0;s<La.length;s++)Ot(La[s],t);s=r;break;case"source":Ot("error",t),s=r;break;case"img":case"image":case"link":Ot("error",t),Ot("load",t),s=r;break;case"details":Ot("toggle",t),s=r;break;case"input":Ym(t,r),s=Ch(t,r),Ot("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Bt({},r,{value:void 0}),Ot("invalid",t);break;case"textarea":Xm(t,r),s=Ah(t,r),Ot("invalid",t);break;default:s=r}Oh(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?cx(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&ax(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&sl(t,c):typeof c=="number"&&sl(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(rl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Ot("scroll",t):c!=null&&eg(t,i,c,o))}switch(n){case"input":Sc(t),Km(t,r,!1);break;case"textarea":Sc(t),Qm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Vs(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?vo(t,!!r.multiple,i,!1):r.defaultValue!=null&&vo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Td)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return pn(e),null;case 6:if(t&&e.stateNode!=null)O1(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ue(166));if(n=vi(gl.current),vi(Dr.current),Oc(e)){if(r=e.stateNode,n=e.memoizedProps,r[Rr]=e,(i=r.nodeValue!==n)&&(t=zn,t!==null))switch(t.tag){case 3:Pc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Pc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Rr]=e,e.stateNode=r}return pn(e),null;case 13:if(Lt(jt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Mt&&Bn!==null&&e.mode&1&&!(e.flags&128))Qx(),Lo(),e.flags|=98560,i=!1;else if(i=Oc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(ue(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ue(317));i[Rr]=e}else Lo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;pn(e),i=!1}else ur!==null&&(hp(ur),ur=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||jt.current&1?Qt===0&&(Qt=3):Ng())),e.updateQueue!==null&&(e.flags|=4),pn(e),null);case 4:return Mo(),ip(t,e),t===null&&ul(e.stateNode.containerInfo),pn(e),null;case 10:return _g(e.type._context),pn(e),null;case 17:return Nn(e.type)&&Cd(),pn(e),null;case 19:if(Lt(jt),i=e.memoizedState,i===null)return pn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Ea(i,!1);else{if(Qt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Dd(t),o!==null){for(e.flags|=128,Ea(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Pt(jt,jt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ht()>jo&&(e.flags|=128,r=!0,Ea(i,!1),e.lanes=4194304)}else{if(!r)if(t=Dd(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ea(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Mt)return pn(e),null}else 2*Ht()-i.renderingStartTime>jo&&n!==1073741824&&(e.flags|=128,r=!0,Ea(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ht(),e.sibling=null,n=jt.current,Pt(jt,r?n&1|2:n&1),e):(pn(e),null);case 22:case 23:return Mg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Un&1073741824&&(pn(e),e.subtreeFlags&6&&(e.flags|=8192)):pn(e),null;case 24:return null;case 25:return null}throw Error(ue(156,e.tag))}function UT(t,e){switch(gg(e),e.tag){case 1:return Nn(e.type)&&Cd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Mo(),Lt(Mn),Lt(yn),Ig(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Sg(e),null;case 13:if(Lt(jt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ue(340));Lo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Lt(jt),null;case 4:return Mo(),null;case 10:return _g(e.type._context),null;case 22:case 23:return Mg(),null;case 24:return null;default:return null}}var Mc=!1,mn=!1,BT=typeof WeakSet=="function"?WeakSet:Set,Se=null;function po(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){zt(t,e,r)}else n.current=null}function op(t,e,n){try{n()}catch(r){zt(t,e,r)}}var Fy=!1;function zT(t,e){if(Hh=Sd,t=jx(),hg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=t,f=null;t:for(;;){for(var E;h!==n||s!==0&&h.nodeType!==3||(l=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(E=h.firstChild)!==null;)f=h,h=E;for(;;){if(h===t)break t;if(f===n&&++d===s&&(l=o),f===i&&++u===r&&(c=o),(E=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=E}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Wh={focusedElem:t,selectionRange:n},Sd=!1,Se=e;Se!==null;)if(e=Se,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Se=t;else for(;Se!==null;){e=Se;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var T=k.memoizedProps,N=k.memoizedState,v=e.stateNode,_=v.getSnapshotBeforeUpdate(e.elementType===e.type?T:cr(e.type,T),N);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ue(163))}}catch(p){zt(e,e.return,p)}if(t=e.sibling,t!==null){t.return=e.return,Se=t;break}Se=e.return}return k=Fy,Fy=!1,k}function Ha(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&op(e,n,i)}s=s.next}while(s!==r)}}function Su(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function ap(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function L1(t){var e=t.alternate;e!==null&&(t.alternate=null,L1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Rr],delete e[hl],delete e[Yh],delete e[IT],delete e[wT])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function D1(t){return t.tag===5||t.tag===3||t.tag===4}function Uy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||D1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function lp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Td));else if(r!==4&&(t=t.child,t!==null))for(lp(t,e,n),t=t.sibling;t!==null;)lp(t,e,n),t=t.sibling}function cp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(cp(t,e,n),t=t.sibling;t!==null;)cp(t,e,n),t=t.sibling}var ln=null,dr=!1;function ms(t,e,n){for(n=n.child;n!==null;)M1(t,e,n),n=n.sibling}function M1(t,e,n){if(Lr&&typeof Lr.onCommitFiberUnmount=="function")try{Lr.onCommitFiberUnmount(gu,n)}catch{}switch(n.tag){case 5:mn||po(n,e);case 6:var r=ln,s=dr;ln=null,ms(t,e,n),ln=r,dr=s,ln!==null&&(dr?(t=ln,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ln.removeChild(n.stateNode));break;case 18:ln!==null&&(dr?(t=ln,n=n.stateNode,t.nodeType===8?Kf(t.parentNode,n):t.nodeType===1&&Kf(t,n),ll(t)):Kf(ln,n.stateNode));break;case 4:r=ln,s=dr,ln=n.stateNode.containerInfo,dr=!0,ms(t,e,n),ln=r,dr=s;break;case 0:case 11:case 14:case 15:if(!mn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&op(n,e,o),s=s.next}while(s!==r)}ms(t,e,n);break;case 1:if(!mn&&(po(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){zt(n,e,l)}ms(t,e,n);break;case 21:ms(t,e,n);break;case 22:n.mode&1?(mn=(r=mn)||n.memoizedState!==null,ms(t,e,n),mn=r):ms(t,e,n);break;default:ms(t,e,n)}}function By(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new BT),e.forEach(function(r){var s=JT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function lr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:ln=l.stateNode,dr=!1;break e;case 3:ln=l.stateNode.containerInfo,dr=!0;break e;case 4:ln=l.stateNode.containerInfo,dr=!0;break e}l=l.return}if(ln===null)throw Error(ue(160));M1(i,o,s),ln=null,dr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){zt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)N1(e,t),e=e.sibling}function N1(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(lr(e,t),Cr(t),r&4){try{Ha(3,t,t.return),Su(3,t)}catch(T){zt(t,t.return,T)}try{Ha(5,t,t.return)}catch(T){zt(t,t.return,T)}}break;case 1:lr(e,t),Cr(t),r&512&&n!==null&&po(n,n.return);break;case 5:if(lr(e,t),Cr(t),r&512&&n!==null&&po(n,n.return),t.flags&32){var s=t.stateNode;try{sl(s,"")}catch(T){zt(t,t.return,T)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&sx(s,i),Lh(l,o);var d=Lh(l,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?cx(s,h):u==="dangerouslySetInnerHTML"?ax(s,h):u==="children"?sl(s,h):eg(s,u,h,d)}switch(l){case"input":kh(s,i);break;case"textarea":ix(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var E=i.value;E!=null?vo(s,!!i.multiple,E,!1):f!==!!i.multiple&&(i.defaultValue!=null?vo(s,!!i.multiple,i.defaultValue,!0):vo(s,!!i.multiple,i.multiple?[]:"",!1))}s[hl]=i}catch(T){zt(t,t.return,T)}}break;case 6:if(lr(e,t),Cr(t),r&4){if(t.stateNode===null)throw Error(ue(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(T){zt(t,t.return,T)}}break;case 3:if(lr(e,t),Cr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ll(e.containerInfo)}catch(T){zt(t,t.return,T)}break;case 4:lr(e,t),Cr(t);break;case 13:lr(e,t),Cr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Lg=Ht())),r&4&&By(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(mn=(d=mn)||u,lr(e,t),mn=d):lr(e,t),Cr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(Se=t,u=t.child;u!==null;){for(h=Se=u;Se!==null;){switch(f=Se,E=f.child,f.tag){case 0:case 11:case 14:case 15:Ha(4,f,f.return);break;case 1:po(f,f.return);var k=f.stateNode;if(typeof k.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(T){zt(r,n,T)}}break;case 5:po(f,f.return);break;case 22:if(f.memoizedState!==null){Hy(h);continue}}E!==null?(E.return=f,Se=E):Hy(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=lx("display",o))}catch(T){zt(t,t.return,T)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(T){zt(t,t.return,T)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:lr(e,t),Cr(t),r&4&&By(t);break;case 21:break;default:lr(e,t),Cr(t)}}function Cr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(D1(n)){var r=n;break e}n=n.return}throw Error(ue(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(sl(s,""),r.flags&=-33);var i=Uy(t);cp(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Uy(t);lp(t,l,o);break;default:throw Error(ue(161))}}catch(c){zt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function HT(t,e,n){Se=t,j1(t)}function j1(t,e,n){for(var r=(t.mode&1)!==0;Se!==null;){var s=Se,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Mc;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||mn;l=Mc;var d=mn;if(Mc=o,(mn=c)&&!d)for(Se=s;Se!==null;)o=Se,c=o.child,o.tag===22&&o.memoizedState!==null?Wy(s):c!==null?(c.return=o,Se=c):Wy(s);for(;i!==null;)Se=i,j1(i),i=i.sibling;Se=s,Mc=l,mn=d}zy(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Se=i):zy(t)}}function zy(t){for(;Se!==null;){var e=Se;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:mn||Su(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!mn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:cr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Ty(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ty(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&ll(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ue(163))}mn||e.flags&512&&ap(e)}catch(f){zt(e,e.return,f)}}if(e===t){Se=null;break}if(n=e.sibling,n!==null){n.return=e.return,Se=n;break}Se=e.return}}function Hy(t){for(;Se!==null;){var e=Se;if(e===t){Se=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Se=n;break}Se=e.return}}function Wy(t){for(;Se!==null;){var e=Se;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Su(4,e)}catch(c){zt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){zt(e,s,c)}}var i=e.return;try{ap(e)}catch(c){zt(e,i,c)}break;case 5:var o=e.return;try{ap(e)}catch(c){zt(e,o,c)}}}catch(c){zt(e,e.return,c)}if(e===t){Se=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Se=l;break}Se=e.return}}var WT=Math.ceil,jd=as.ReactCurrentDispatcher,Pg=as.ReactCurrentOwner,tr=as.ReactCurrentBatchConfig,ht=0,nn=null,Vt=null,cn=0,Un=0,go=ei(0),Qt=0,_l=null,wi=0,Iu=0,Og=0,Wa=null,On=null,Lg=0,jo=1/0,Hr=null,$d=!1,dp=null,js=null,Nc=!1,ks=null,Fd=0,Ga=0,up=null,nd=-1,rd=0;function In(){return ht&6?Ht():nd!==-1?nd:nd=Ht()}function $s(t){return t.mode&1?ht&2&&cn!==0?cn&-cn:CT.transition!==null?(rd===0&&(rd=bx()),rd):(t=Et,t!==0||(t=window.event,t=t===void 0?16:kx(t.type)),t):1}function yr(t,e,n,r){if(50<Ga)throw Ga=0,up=null,Error(ue(185));Ml(t,n,r),(!(ht&2)||t!==nn)&&(t===nn&&(!(ht&2)&&(Iu|=n),Qt===4&&bs(t,cn)),jn(t,r),n===1&&ht===0&&!(e.mode&1)&&(jo=Ht()+500,xu&&ti()))}function jn(t,e){var n=t.callbackNode;Cw(t,e);var r=Ed(t,t===nn?cn:0);if(r===0)n!==null&&Zm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Zm(n),e===1)t.tag===0?TT(Gy.bind(null,t)):Yx(Gy.bind(null,t)),ET(function(){!(ht&6)&&ti()}),n=null;else{switch(Ex(r)){case 1:n=ig;break;case 4:n=_x;break;case 16:n=bd;break;case 536870912:n=xx;break;default:n=bd}n=G1(n,$1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function $1(t,e){if(nd=-1,rd=0,ht&6)throw Error(ue(327));var n=t.callbackNode;if(So()&&t.callbackNode!==n)return null;var r=Ed(t,t===nn?cn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Ud(t,r);else{e=r;var s=ht;ht|=2;var i=U1();(nn!==t||cn!==e)&&(Hr=null,jo=Ht()+500,xi(t,e));do try{YT();break}catch(l){F1(t,l)}while(!0);vg(),jd.current=i,ht=s,Vt!==null?e=0:(nn=null,cn=0,e=Qt)}if(e!==0){if(e===2&&(s=$h(t),s!==0&&(r=s,e=fp(t,s))),e===1)throw n=_l,xi(t,0),bs(t,r),jn(t,Ht()),n;if(e===6)bs(t,r);else{if(s=t.current.alternate,!(r&30)&&!GT(s)&&(e=Ud(t,r),e===2&&(i=$h(t),i!==0&&(r=i,e=fp(t,i))),e===1))throw n=_l,xi(t,0),bs(t,r),jn(t,Ht()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(ue(345));case 2:fi(t,On,Hr);break;case 3:if(bs(t,r),(r&130023424)===r&&(e=Lg+500-Ht(),10<e)){if(Ed(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){In(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Vh(fi.bind(null,t,On,Hr),e);break}fi(t,On,Hr);break;case 4:if(bs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-mr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ht()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*WT(r/1960))-r,10<r){t.timeoutHandle=Vh(fi.bind(null,t,On,Hr),r);break}fi(t,On,Hr);break;case 5:fi(t,On,Hr);break;default:throw Error(ue(329))}}}return jn(t,Ht()),t.callbackNode===n?$1.bind(null,t):null}function fp(t,e){var n=Wa;return t.current.memoizedState.isDehydrated&&(xi(t,e).flags|=256),t=Ud(t,e),t!==2&&(e=On,On=n,e!==null&&hp(e)),t}function hp(t){On===null?On=t:On.push.apply(On,t)}function GT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!_r(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function bs(t,e){for(e&=~Og,e&=~Iu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-mr(e),r=1<<n;t[n]=-1,e&=~r}}function Gy(t){if(ht&6)throw Error(ue(327));So();var e=Ed(t,0);if(!(e&1))return jn(t,Ht()),null;var n=Ud(t,e);if(t.tag!==0&&n===2){var r=$h(t);r!==0&&(e=r,n=fp(t,r))}if(n===1)throw n=_l,xi(t,0),bs(t,e),jn(t,Ht()),n;if(n===6)throw Error(ue(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,fi(t,On,Hr),jn(t,Ht()),null}function Dg(t,e){var n=ht;ht|=1;try{return t(e)}finally{ht=n,ht===0&&(jo=Ht()+500,xu&&ti())}}function Ti(t){ks!==null&&ks.tag===0&&!(ht&6)&&So();var e=ht;ht|=1;var n=tr.transition,r=Et;try{if(tr.transition=null,Et=1,t)return t()}finally{Et=r,tr.transition=n,ht=e,!(ht&6)&&ti()}}function Mg(){Un=go.current,Lt(go)}function xi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,bT(n)),Vt!==null)for(n=Vt.return;n!==null;){var r=n;switch(gg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Cd();break;case 3:Mo(),Lt(Mn),Lt(yn),Ig();break;case 5:Sg(r);break;case 4:Mo();break;case 13:Lt(jt);break;case 19:Lt(jt);break;case 10:_g(r.type._context);break;case 22:case 23:Mg()}n=n.return}if(nn=t,Vt=t=Fs(t.current,null),cn=Un=e,Qt=0,_l=null,Og=Iu=wi=0,On=Wa=null,yi!==null){for(e=0;e<yi.length;e++)if(n=yi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}yi=null}return t}function F1(t,e){do{var n=Vt;try{if(vg(),Zc.current=Nd,Md){for(var r=Ut.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Md=!1}if(Ii=0,Zt=Kt=Ut=null,za=!1,ml=0,Pg.current=null,n===null||n.return===null){Qt=1,_l=e,Vt=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=cn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var E=Oy(o);if(E!==null){E.flags&=-257,Ly(E,o,l,i,e),E.mode&1&&Py(i,d,e),e=E,c=d;var k=e.updateQueue;if(k===null){var T=new Set;T.add(c),e.updateQueue=T}else k.add(c);break e}else{if(!(e&1)){Py(i,d,e),Ng();break e}c=Error(ue(426))}}else if(Mt&&l.mode&1){var N=Oy(o);if(N!==null){!(N.flags&65536)&&(N.flags|=256),Ly(N,o,l,i,e),mg(No(c,l));break e}}i=c=No(c,l),Qt!==4&&(Qt=2),Wa===null?Wa=[i]:Wa.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var v=E1(i,c,e);wy(i,v);break e;case 1:l=c;var _=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof _.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(js===null||!js.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var p=S1(i,l,e);wy(i,p);break e}}i=i.return}while(i!==null)}z1(n)}catch(D){e=D,Vt===n&&n!==null&&(Vt=n=n.return);continue}break}while(!0)}function U1(){var t=jd.current;return jd.current=Nd,t===null?Nd:t}function Ng(){(Qt===0||Qt===3||Qt===2)&&(Qt=4),nn===null||!(wi&268435455)&&!(Iu&268435455)||bs(nn,cn)}function Ud(t,e){var n=ht;ht|=2;var r=U1();(nn!==t||cn!==e)&&(Hr=null,xi(t,e));do try{VT();break}catch(s){F1(t,s)}while(!0);if(vg(),ht=n,jd.current=r,Vt!==null)throw Error(ue(261));return nn=null,cn=0,Qt}function VT(){for(;Vt!==null;)B1(Vt)}function YT(){for(;Vt!==null&&!vw();)B1(Vt)}function B1(t){var e=W1(t.alternate,t,Un);t.memoizedProps=t.pendingProps,e===null?z1(t):Vt=e,Pg.current=null}function z1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=UT(n,e),n!==null){n.flags&=32767,Vt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Qt=6,Vt=null;return}}else if(n=FT(n,e,Un),n!==null){Vt=n;return}if(e=e.sibling,e!==null){Vt=e;return}Vt=e=t}while(e!==null);Qt===0&&(Qt=5)}function fi(t,e,n){var r=Et,s=tr.transition;try{tr.transition=null,Et=1,KT(t,e,n,r)}finally{tr.transition=s,Et=r}return null}function KT(t,e,n,r){do So();while(ks!==null);if(ht&6)throw Error(ue(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ue(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(kw(t,i),t===nn&&(Vt=nn=null,cn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Nc||(Nc=!0,G1(bd,function(){return So(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=tr.transition,tr.transition=null;var o=Et;Et=1;var l=ht;ht|=4,Pg.current=null,zT(t,n),N1(n,t),pT(Wh),Sd=!!Hh,Wh=Hh=null,t.current=n,HT(n),_w(),ht=l,Et=o,tr.transition=i}else t.current=n;if(Nc&&(Nc=!1,ks=t,Fd=s),i=t.pendingLanes,i===0&&(js=null),Ew(n.stateNode),jn(t,Ht()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if($d)throw $d=!1,t=dp,dp=null,t;return Fd&1&&t.tag!==0&&So(),i=t.pendingLanes,i&1?t===up?Ga++:(Ga=0,up=t):Ga=0,ti(),null}function So(){if(ks!==null){var t=Ex(Fd),e=tr.transition,n=Et;try{if(tr.transition=null,Et=16>t?16:t,ks===null)var r=!1;else{if(t=ks,ks=null,Fd=0,ht&6)throw Error(ue(331));var s=ht;for(ht|=4,Se=t.current;Se!==null;){var i=Se,o=i.child;if(Se.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Se=d;Se!==null;){var u=Se;switch(u.tag){case 0:case 11:case 15:Ha(8,u,i)}var h=u.child;if(h!==null)h.return=u,Se=h;else for(;Se!==null;){u=Se;var f=u.sibling,E=u.return;if(L1(u),u===d){Se=null;break}if(f!==null){f.return=E,Se=f;break}Se=E}}}var k=i.alternate;if(k!==null){var T=k.child;if(T!==null){k.child=null;do{var N=T.sibling;T.sibling=null,T=N}while(T!==null)}}Se=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Se=o;else e:for(;Se!==null;){if(i=Se,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ha(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,Se=v;break e}Se=i.return}}var _=t.current;for(Se=_;Se!==null;){o=Se;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,Se=S;else e:for(o=_;Se!==null;){if(l=Se,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Su(9,l)}}catch(D){zt(l,l.return,D)}if(l===o){Se=null;break e}var p=l.sibling;if(p!==null){p.return=l.return,Se=p;break e}Se=l.return}}if(ht=s,ti(),Lr&&typeof Lr.onPostCommitFiberRoot=="function")try{Lr.onPostCommitFiberRoot(gu,t)}catch{}r=!0}return r}finally{Et=n,tr.transition=e}}return!1}function Vy(t,e,n){e=No(n,e),e=E1(t,e,1),t=Ns(t,e,1),e=In(),t!==null&&(Ml(t,1,e),jn(t,e))}function zt(t,e,n){if(t.tag===3)Vy(t,t,n);else for(;e!==null;){if(e.tag===3){Vy(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(js===null||!js.has(r))){t=No(n,t),t=S1(e,t,1),e=Ns(e,t,1),t=In(),e!==null&&(Ml(e,1,t),jn(e,t));break}}e=e.return}}function XT(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=In(),t.pingedLanes|=t.suspendedLanes&n,nn===t&&(cn&n)===n&&(Qt===4||Qt===3&&(cn&130023424)===cn&&500>Ht()-Lg?xi(t,0):Og|=n),jn(t,e)}function H1(t,e){e===0&&(t.mode&1?(e=Tc,Tc<<=1,!(Tc&130023424)&&(Tc=4194304)):e=1);var n=In();t=ns(t,e),t!==null&&(Ml(t,e,n),jn(t,n))}function QT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),H1(t,n)}function JT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ue(314))}r!==null&&r.delete(e),H1(t,n)}var W1;W1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Mn.current)Ln=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ln=!1,$T(t,e,n);Ln=!!(t.flags&131072)}else Ln=!1,Mt&&e.flags&1048576&&Kx(e,Ad,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;td(t,e),t=e.pendingProps;var s=Oo(e,yn.current);Eo(e,n),s=Tg(null,e,r,t,s,n);var i=Cg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Nn(r)?(i=!0,kd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,bg(e),s.updater=Eu,e.stateNode=s,s._reactInternals=e,Zh(e,r,t,n),e=np(null,e,r,!0,i,n)):(e.tag=0,Mt&&i&&pg(e),En(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(td(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=ZT(r),t=cr(r,t),s){case 0:e=tp(null,e,r,t,n);break e;case 1:e=Ny(null,e,r,t,n);break e;case 11:e=Dy(null,e,r,t,n);break e;case 14:e=My(null,e,r,cr(r.type,t),n);break e}throw Error(ue(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cr(r,s),tp(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cr(r,s),Ny(t,e,r,s,n);case 3:e:{if(C1(e),t===null)throw Error(ue(387));r=e.pendingProps,i=e.memoizedState,s=i.element,e1(t,e),Ld(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=No(Error(ue(423)),e),e=jy(t,e,r,n,s);break e}else if(r!==s){s=No(Error(ue(424)),e),e=jy(t,e,r,n,s);break e}else for(Bn=Ms(e.stateNode.containerInfo.firstChild),zn=e,Mt=!0,ur=null,n=qx(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Lo(),r===s){e=rs(t,e,n);break e}En(t,e,r,n)}e=e.child}return e;case 5:return t1(e),t===null&&Qh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Gh(r,s)?o=null:i!==null&&Gh(r,i)&&(e.flags|=32),T1(t,e),En(t,e,o,n),e.child;case 6:return t===null&&Qh(e),null;case 13:return k1(t,e,n);case 4:return Eg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Do(e,null,r,n):En(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cr(r,s),Dy(t,e,r,s,n);case 7:return En(t,e,e.pendingProps,n),e.child;case 8:return En(t,e,e.pendingProps.children,n),e.child;case 12:return En(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Pt(Pd,r._currentValue),r._currentValue=o,i!==null)if(_r(i.value,o)){if(i.children===s.children&&!Mn.current){e=rs(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Jr(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Jh(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ue(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Jh(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}En(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Eo(e,n),s=nr(s),r=r(s),e.flags|=1,En(t,e,r,n),e.child;case 14:return r=e.type,s=cr(r,e.pendingProps),s=cr(r.type,s),My(t,e,r,s,n);case 15:return I1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cr(r,s),td(t,e),e.tag=1,Nn(r)?(t=!0,kd(e)):t=!1,Eo(e,n),b1(e,r,s),Zh(e,r,s,n),np(null,e,r,!0,t,n);case 19:return R1(t,e,n);case 22:return w1(t,e,n)}throw Error(ue(156,e.tag))};function G1(t,e){return vx(t,e)}function qT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zn(t,e,n,r){return new qT(t,e,n,r)}function jg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ZT(t){if(typeof t=="function")return jg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ng)return 11;if(t===rg)return 14}return 2}function Fs(t,e){var n=t.alternate;return n===null?(n=Zn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function sd(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")jg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case so:return bi(n.children,s,i,e);case tg:o=8,s|=8;break;case Sh:return t=Zn(12,n,e,s|2),t.elementType=Sh,t.lanes=i,t;case Ih:return t=Zn(13,n,e,s),t.elementType=Ih,t.lanes=i,t;case wh:return t=Zn(19,n,e,s),t.elementType=wh,t.lanes=i,t;case tx:return wu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Z_:o=10;break e;case ex:o=9;break e;case ng:o=11;break e;case rg:o=14;break e;case vs:o=16,r=null;break e}throw Error(ue(130,t==null?t:typeof t,""))}return e=Zn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function bi(t,e,n,r){return t=Zn(7,t,r,e),t.lanes=n,t}function wu(t,e,n,r){return t=Zn(22,t,r,e),t.elementType=tx,t.lanes=n,t.stateNode={isHidden:!1},t}function nh(t,e,n){return t=Zn(6,t,null,e),t.lanes=n,t}function rh(t,e,n){return e=Zn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function e2(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jf(0),this.expirationTimes=jf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function $g(t,e,n,r,s,i,o,l,c){return t=new e2(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Zn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},bg(i),t}function t2(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ro,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function V1(t){if(!t)return Ys;t=t._reactInternals;e:{if(Mi(t)!==t||t.tag!==1)throw Error(ue(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Nn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ue(171))}if(t.tag===1){var n=t.type;if(Nn(n))return Vx(t,n,e)}return e}function Y1(t,e,n,r,s,i,o,l,c){return t=$g(n,r,!0,t,s,i,o,l,c),t.context=V1(null),n=t.current,r=In(),s=$s(n),i=Jr(r,s),i.callback=e??null,Ns(n,i,s),t.current.lanes=s,Ml(t,s,r),jn(t,r),t}function Tu(t,e,n,r){var s=e.current,i=In(),o=$s(s);return n=V1(n),e.context===null?e.context=n:e.pendingContext=n,e=Jr(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ns(s,e,o),t!==null&&(yr(t,s,o,i),qc(t,s,o)),o}function Bd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Yy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Fg(t,e){Yy(t,e),(t=t.alternate)&&Yy(t,e)}function n2(){return null}var K1=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ug(t){this._internalRoot=t}Cu.prototype.render=Ug.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ue(409));Tu(t,e,null,null)};Cu.prototype.unmount=Ug.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ti(function(){Tu(null,t,null,null)}),e[ts]=null}};function Cu(t){this._internalRoot=t}Cu.prototype.unstable_scheduleHydration=function(t){if(t){var e=wx();t={blockedOn:null,target:t,priority:e};for(var n=0;n<xs.length&&e!==0&&e<xs[n].priority;n++);xs.splice(n,0,t),n===0&&Cx(t)}};function Bg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ku(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Ky(){}function r2(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Bd(o);i.call(d)}}var o=Y1(e,r,t,0,null,!1,!1,"",Ky);return t._reactRootContainer=o,t[ts]=o.current,ul(t.nodeType===8?t.parentNode:t),Ti(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Bd(c);l.call(d)}}var c=$g(t,0,!1,null,null,!1,!1,"",Ky);return t._reactRootContainer=c,t[ts]=c.current,ul(t.nodeType===8?t.parentNode:t),Ti(function(){Tu(e,c,n,r)}),c}function Ru(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=Bd(o);l.call(c)}}Tu(e,o,t,s)}else o=r2(n,e,t,s,r);return Bd(o)}Sx=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Oa(e.pendingLanes);n!==0&&(og(e,n|1),jn(e,Ht()),!(ht&6)&&(jo=Ht()+500,ti()))}break;case 13:Ti(function(){var r=ns(t,1);if(r!==null){var s=In();yr(r,t,1,s)}}),Fg(t,1)}};ag=function(t){if(t.tag===13){var e=ns(t,134217728);if(e!==null){var n=In();yr(e,t,134217728,n)}Fg(t,134217728)}};Ix=function(t){if(t.tag===13){var e=$s(t),n=ns(t,e);if(n!==null){var r=In();yr(n,t,e,r)}Fg(t,e)}};wx=function(){return Et};Tx=function(t,e){var n=Et;try{return Et=t,e()}finally{Et=n}};Mh=function(t,e,n){switch(e){case"input":if(kh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=_u(r);if(!s)throw Error(ue(90));rx(r),kh(r,s)}}}break;case"textarea":ix(t,n);break;case"select":e=n.value,e!=null&&vo(t,!!n.multiple,e,!1)}};fx=Dg;hx=Ti;var s2={usingClientEntryPoint:!1,Events:[jl,lo,_u,dx,ux,Dg]},Sa={findFiberByHostInstance:mi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},i2={bundleType:Sa.bundleType,version:Sa.version,rendererPackageName:Sa.rendererPackageName,rendererConfig:Sa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:as.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=mx(t),t===null?null:t.stateNode},findFiberByHostInstance:Sa.findFiberByHostInstance||n2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jc.isDisabled&&jc.supportsFiber)try{gu=jc.inject(i2),Lr=jc}catch{}}Gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=s2;Gn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bg(e))throw Error(ue(200));return t2(t,e,null,n)};Gn.createRoot=function(t,e){if(!Bg(t))throw Error(ue(299));var n=!1,r="",s=K1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=$g(t,1,!1,null,null,n,!1,r,s),t[ts]=e.current,ul(t.nodeType===8?t.parentNode:t),new Ug(e)};Gn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ue(188)):(t=Object.keys(t).join(","),Error(ue(268,t)));return t=mx(e),t=t===null?null:t.stateNode,t};Gn.flushSync=function(t){return Ti(t)};Gn.hydrate=function(t,e,n){if(!ku(e))throw Error(ue(200));return Ru(null,t,e,!0,n)};Gn.hydrateRoot=function(t,e,n){if(!Bg(t))throw Error(ue(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=K1;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Y1(e,null,t,1,n??null,s,!1,i,o),t[ts]=e.current,ul(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Cu(e)};Gn.render=function(t,e,n){if(!ku(e))throw Error(ue(200));return Ru(null,t,e,!1,n)};Gn.unmountComponentAtNode=function(t){if(!ku(t))throw Error(ue(40));return t._reactRootContainer?(Ti(function(){Ru(null,null,t,!1,function(){t._reactRootContainer=null,t[ts]=null})}),!0):!1};Gn.unstable_batchedUpdates=Dg;Gn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!ku(n))throw Error(ue(200));if(t==null||t._reactInternals===void 0)throw Error(ue(38));return Ru(t,e,n,!1,r)};Gn.version="18.3.1-next-f1338f8080-20240426";function X1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(X1)}catch(t){console.error(t)}}X1(),X_.exports=Gn;var o2=X_.exports,Xy=o2;bh.createRoot=Xy.createRoot,bh.hydrateRoot=Xy.hydrateRoot;const Qy=20,zg=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],Jy=(t,e)=>{const n=zg.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},qy=t=>{const e=zg.find(n=>n.id===t);return(e==null?void 0:e.se)||null},Jn=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function Hg(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function a2(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function l2(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const Q1=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],J1=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],q1=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function Gr(t){const e=Jn.find(n=>n.id===t);return e||Jn.find(n=>n.name===t)}function Z1(){return Jn.map(t=>t.name).sort((t,e)=>e.length-t.length)}function $c(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function c2(t,e){const n=[];let r=0;return t.forEach(s=>{const i=Gr(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function Zy(t,e,n,r){const i=c2(n==="SENKA"?Q1:n==="AJA"?J1:q1,t);return{id:t,name:e,class:n,hp:Qy,maxHp:Qy,pp:0,maxPp:0,sep:2,deck:a2(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function id(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),l=Hg(o),c=Zy("p1",t,e,l),d=Zy("p2",n,r,l);c.hand=c.deck.splice(0,4),d.hand=d.deck.splice(0,4);let u,h;return i?(u="p1",h=t,c.maxPp=1,c.pp=1,d.maxPp=0,d.pp=0):(u="p2",h=n,c.maxPp=0,c.pp=0,d.maxPp=1,d.pp=1),{phase:"INIT",rngSeed:Math.floor(l()*1e6),activePlayerId:u,firstPlayerId:u,players:{p1:c,p2:d},turnCount:1,pendingEffects:[],logs:[` 1 - ${h} `],winnerId:void 0}}function pp(t){return t==="p1"?"p2":"p1"}function d2(t,e,n,r,s,i){var h,f,E,k,T,N,v,_,S,p,D,H,ne,G,q,he,xe,je,fe,ie,P;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(w=>w?{...w,passiveAbilities:w.passiveAbilities?[...w.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(w=>w?{...w,passiveAbilities:w.passiveAbilities?[...w.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const l=Hg(o.rngSeed||999);o.rngSeed=Math.floor(l()*1e6);const c=pp(e),d=w=>{for(const C of["p1","p2"]){const y=o.players[C].board.findIndex(g=>(g==null?void 0:g.instanceId)===w);if(y!==-1&&o.players[C].board[y])return{card:o.players[C].board[y],player:o.players[C],index:y}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const w=o.players[e];if(w.graveyard.length<r.necromance)return console.log(`[Engine] : ${w.graveyard.length} < ${r.necromance}`),o;const C=w.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${w.name}  ${r.necromance} `),console.log(`[Engine] : ${C.map(y=>y.name).join(", ")} `)}const u=(w,C)=>{var g;const y=(g=w.triggers)==null?void 0:g.find(I=>I.trigger==="LAST_WORD");if(y){const I=y.effects.map(A=>({sourceCard:w,effect:A,sourcePlayerId:C}));o.pendingEffects=[...o.pendingEffects||[],...I],o.logs.push(`${w.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${w.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const w=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const C=d(s);if(C){const{card:y,player:g,index:I}=C;if(y.hasBarrier)y.hasBarrier=!1,o.logs.push(`${y.name} `);else if(y.currentHealth-=w,o.logs.push(`${n.name}  ${y.name}  ${w} `),y.currentHealth<=0){y.currentHealth=Math.min(0,y.currentHealth);const A=Object.keys(o.players).find(M=>o.players[M]===g)||c;u(y,A),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name} `)}}}else if(r.targetType==="OPPONENT"){const C=o.players[c];if(C.leaderDamageShield)C.leaderDamageShield=!1,o.logs.push(`${n.name}  ${w} `);else{const y=C.board.some(I=>{var A;return(A=I==null?void 0:I.passiveAbilities)==null?void 0:A.includes("LEADER_DAMAGE_CAP")}),g=y?Math.min(w,1):w;C.hp-=g,y&&w>1?o.logs.push(`${n.name}  ${w} 1`):o.logs.push(`${n.name}  ${g} `),C.hp<=0&&(o.winnerId=e,o.logs.push(`${C.name} `))}}break}case"AOE_DAMAGE":{const w=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const C=o.players[c].board,y=i&&i.length>0?new Set(i):null;C.forEach(I=>{if(I){if(y&&!y.has(I.instanceId))return;I.hasBarrier?(I.hasBarrier=!1,o.logs.push(`${I.name} `)):I.currentHealth-=w}}),C.filter(I=>I&&I.currentHealth<=0).forEach(I=>{I&&(I.currentHealth=Math.min(0,I.currentHealth),u(I,c),o.players[c].graveyard.push(I),o.logs.push(`${I.name} `))}),o.logs.push(`${n.name}  ${w} `),C.forEach((I,A)=>{I&&I.currentHealth<=0&&(C[A]=null)})}break}case"DRAW":{const w=r.value||1,C=o.players[e];for(let y=0;y<w;y++)if(C.deck.length>0){const g=C.deck.pop();g&&(C.hand.length<9?C.hand.push(g):(C.graveyard.push(g),o.logs.push(`${C.name}${g.name}`)))}o.logs.push(`${C.name}  ${w} `);break}case"ADD_GRAVEYARD":{const w=r.value||1,C=o.players[e];for(let y=0;y<w;y++){const g={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(l()*1e3)}_${y}`};C.graveyard.push(g)}o.logs.push(`${C.name}  ${w} `);break}case"HEAL_LEADER":{const w=r.value||0,C=o.players[e];C.hp=Math.min(C.maxHp,C.hp+w),o.logs.push(`${C.name}  ${w} HP`);break}case"DESTROY":{const w=(C,y)=>{var g;return((g=C.passiveAbilities)==null?void 0:g.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===y};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const C=o.players[c].board,y=[];C.forEach(M=>{M&&(w(M,c)?(y.push(M),o.logs.push(`${M.name} `)):(u(M,c),o.players[c].graveyard.push(M)))}),o.players[c].board=y;const g=o.players[e].board,I=[],A=n.instanceId;g.forEach(M=>{M&&(A&&M.instanceId===A?I.push(M):w(M,e)?(I.push(M),o.logs.push(`${M.name} `)):(u(M,e),o.players[e].graveyard.push(M)))}),o.players[e].board=I,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const C=d(s);if(C){const{card:y,player:g,index:I}=C,A=Object.keys(o.players).find(M=>o.players[M].board.includes(y))||"";w(y,A)?o.logs.push(`${y.name} `):(y.currentHealth=1,u(y,A),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((h=r.conditions)!=null&&h.minTurn&&t.turnCount<r.conditions.minTurn)break;const w=r.targetCardId,C=Jn.find(y=>y.id===w);if(C){const y=o.players[e],g=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(l()*1e4)}`,I={...C,id:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,instanceId:g};y.hand.length<9?(y.hand.push(I),o.logs.push(`${y.name}  ${C.name} `)):(y.graveyard.push(I),o.logs.push(`${y.name}${C.name}`))}break}case"REDUCE_HAND_COST":{const w=r.value||0,C=((f=r.conditions)==null?void 0:f.nameIn)||[],y=o.players[e];let g=0;y.hand.forEach(I=>{if(C.includes(I.name)){const A=I.cost,M=Math.max(0,A-w);M!==A&&(I.cost=M,I.baseCost=M,g++)}}),g>0&&o.logs.push(`${n.name} -${w}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const w=o.players[e];w.leaderDamageShield=!0,o.logs.push(`${w.name} 0`);break}case"RANDOM_DESTROY":{const w=(I,A)=>{var M;return((M=I.passiveAbilities)==null?void 0:M.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===A},C=r.value||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const A=g.findIndex(M=>(M==null?void 0:M.instanceId)===I);if(A!==-1&&g[A]){const M=g[A];w(M,y)?o.logs.push(`${M.name} `):(M.currentHealth=1,u(M,y),o.players[y].graveyard.push(M),g[A]=null,o.logs.push(`${M.name}  ${n.name} `))}});else{const I=g.map((M,Q)=>!M||w(M,y)?-1:Q).filter(M=>M!==-1);for(let M=I.length-1;M>0;M--){const Q=Math.floor(l()*(M+1));[I[M],I[Q]]=[I[Q],I[M]]}I.slice(0,C).forEach(M=>{const Q=g[M];Q&&(Q.currentHealth=1,u(Q,y),o.players[y].graveyard.push(Q),g[M]=null,o.logs.push(`${Q.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const w=r.value||1,C=r.value2||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const A=g.findIndex(M=>(M==null?void 0:M.instanceId)===I);A!==-1&&g[A]&&(g[A].currentHealth=C,o.logs.push(`${g[A].name} HP ${C} `))});else{const I=g.map((M,Q)=>M?Q:-1).filter(M=>M!==-1);for(let M=I.length-1;M>0;M--){const Q=Math.floor(l()*(M+1));[I[M],I[Q]]=[I[Q],I[M]]}I.slice(0,w).forEach(M=>{const Q=g[M];Q&&(Q.currentHealth=C,o.logs.push(`${Q.name} HP ${C} `))})}break}case"RANDOM_DAMAGE":{const w=r.value2||1,C=r.value||0,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=M=>{const Q=g[M];Q&&(Q.hasBarrier?(Q.hasBarrier=!1,o.logs.push(`${Q.name} `)):(Q.currentHealth-=C,o.logs.push(`${n.name}  ${Q.name}  ${C} `)),Q.currentHealth<=0&&(Q.currentHealth=0,u(Q,y),o.players[y].graveyard.push(Q),g[M]=null,o.logs.push(`${Q.name} `)))},A=new Set;if(i&&i.length>0)i.forEach(M=>{const Q=g.findIndex(F=>(F==null?void 0:F.instanceId)===M);if(Q!==-1&&g[Q])A.add(M),I(Q);else{const F=g.map((ye,R)=>ye&&!A.has(ye.instanceId)?R:-1).filter(ye=>ye!==-1);if(F.length>0){const ye=Math.floor(l()*F.length),R=F[ye],Ie=g[R];A.add(Ie.instanceId),I(R)}}});else{const M=g.map((F,ye)=>F?ye:-1).filter(F=>F!==-1);for(let F=M.length-1;F>0;F--){const ye=Math.floor(l()*(F+1));[M[F],M[ye]]=[M[ye],M[F]]}M.slice(0,w).forEach(F=>{I(F)})}break}case"RANDOM_DAMAGE_BY_TURN":{const w=r.value||1,C=o.turnCount,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=A=>{var Q;const M=g[A];if(!M)return!1;if(M.hasBarrier)return M.hasBarrier=!1,o.logs.push(`${M.name} `),!0;if(M.currentHealth-=w,o.logs.push(`${n.name}  ${M.name}  ${w} `),M.currentHealth<=0){M.currentHealth=0;const F=Object.keys(o.players).find(R=>o.players[R]===o.players[y])||y,ye=(Q=M.triggers)==null?void 0:Q.find(R=>R.trigger==="LASTWORD");return ye&&ye.effects.forEach(R=>{o.pendingEffects.push({sourceCard:M,effect:R,sourcePlayerId:F})}),o.players[y].graveyard.push(M),g[A]=null,o.logs.push(`${M.name} `),!1}return!0};if(i&&i.length>0)for(let A=0;A<i.length;A++){const M=i[A],Q=g.findIndex(F=>(F==null?void 0:F.instanceId)===M);if(Q!==-1&&g[Q])I(Q);else{const F=g.map((ye,R)=>ye?R:-1).filter(ye=>ye!==-1);if(F.length>0){const ye=Math.floor(l()*F.length);I(F[ye])}}}else for(let A=0;A<C;A++){const M=g.map((F,ye)=>F?ye:-1).filter(F=>F!==-1);if(M.length===0)break;const Q=Math.floor(l()*M.length);I(M[Q])}break}case"SET_MAX_HP":{const w=r.value||20;if(r.targetType==="OPPONENT"){const C=o.players[c];C.maxHp=w,C.hp>w&&(C.hp=w)}break}case"SUMMON_CARD":{const w=r.targetCardId,C=Jn.find(y=>y.id===w);if(C){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...C,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:((E=C.passiveAbilities)==null?void 0:E.includes("STORM"))||((k=C.passiveAbilities)==null?void 0:k.includes("RUSH"))||!1,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((T=C.passiveAbilities)==null?void 0:T.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((N=C.passiveAbilities)==null?void 0:N.includes("STEALTH"))??!1};(v=C.tags)!=null&&v.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(M=>(M==null?void 0:M.name)==="")&&(I.passiveAbilities.push("STORM"),I.canAttack=!0,o.logs.push(`${C.name}   `)),y.board.push(I),o.logs.push(`${y.name}  ${C.name} `)}}break}case"SUMMON_CARD_RUSH":{const w=r.targetCardId,C=Jn.find(y=>y.id===w);if(C){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...C,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!0,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((_=C.passiveAbilities)==null?void 0:_.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((S=C.passiveAbilities)==null?void 0:S.includes("STEALTH"))??!1};let A=!1;(p=C.tags)!=null&&p.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(Q=>(Q==null?void 0:Q.name)==="")&&(I.passiveAbilities.push("STORM"),A=!0,o.logs.push(`${C.name}   `)),!A&&!I.passiveAbilities.includes("RUSH")&&I.passiveAbilities.push("RUSH"),y.board.push(I),o.logs.push(`${y.name}  ${C.name} ${A?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const w=r.targetCardId,C=Jn.find(I=>I.id===w),y=r.value||0,g=r.value2||0;if(C){const I=o.players[e];if(I.board.filter(M=>M!==null).length<5){const M=C.attack||0,Q=C.health||1,F=M+y,ye=Q+g,R={...C,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:ye,maxHealth:ye,health:ye,attack:F,currentAttack:F,baseAttack:M,baseHealth:Q,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((D=C.passiveAbilities)==null?void 0:D.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((H=C.passiveAbilities)==null?void 0:H.includes("STEALTH"))??!1};(ne=C.tags)!=null&&ne.includes("Knuckler")&&!R.passiveAbilities.includes("STORM")&&I.board.some(te=>(te==null?void 0:te.name)==="")&&(R.passiveAbilities.push("STORM"),R.canAttack=!0,o.logs.push(`${C.name}   `)),((G=R.passiveAbilities)!=null&&G.includes("RUSH")||(q=R.passiveAbilities)!=null&&q.includes("STORM"))&&(R.canAttack=!0),I.board.push(R),o.logs.push(`${I.name}  ${C.name} +${y}/+${g}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:R,effect:{type:"VISUAL_BUFF_ONLY",value:y,value2:g},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const w=r.targetCardId,C=Jn.find(g=>g.id===w),y=r.necromance||0;if(C){const g=o.players[e];let I=0;for(;!(g.board.filter(Q=>Q!==null).length>=5);){if(y>0&&g.graveyard.length<y){I===0&&o.logs.push(` ${C.name} `);break}if(y>0){const Q=g.graveyard.splice(-y,y);o.logs.push(` ${y} ${Q.map(F=>F.name).join(", ")} `)}const M={...C,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}_${I}`,canAttack:((he=C.passiveAbilities)==null?void 0:he.includes("STORM"))||((xe=C.passiveAbilities)==null?void 0:xe.includes("RUSH"))||!1,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((je=C.passiveAbilities)==null?void 0:je.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((fe=C.passiveAbilities)==null?void 0:fe.includes("STEALTH"))??!1};(ie=C.tags)!=null&&ie.includes("Knuckler")&&!M.passiveAbilities.includes("STORM")&&g.board.some(F=>(F==null?void 0:F.name)==="")&&(M.passiveAbilities.push("STORM"),M.canAttack=!0,o.logs.push(`${C.name}   `)),g.board.push(M),I++,o.logs.push(`${g.name}  ${C.name} `)}I>0&&o.logs.push(` ${I}  ${C.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const w=d(s);if(w){const{card:C,player:y,index:g}=w,I=Object.keys(o.players).find(Q=>o.players[Q]===y)||c,A=o.players[e];if(A.board.filter(Q=>Q!==null).length<5){y.board[g]=null,o.logs.push(`${C.name}  ${n.name} `);const Q={...C,instanceId:`stolen_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:C.health||C.currentHealth,maxHealth:C.health||C.maxHealth,currentAttack:C.attack||C.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};A.board.push(Q),o.logs.push(`${A.name}  ${Q.name} `)}else u(C,I),y.graveyard.push(C),y.board[g]=null,o.logs.push(`${C.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let w=null;if(r.targetType==="SELECT_FOLLOWER"&&s)w=d(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const y=o.players[c].board.map((g,I)=>({card:g,index:I})).filter(g=>g.card!==null);if(y.length>0){const g=Math.floor(l()*y.length),I=y[g];w={card:I.card,player:o.players[c],index:I.index}}}if(w){const{card:C,player:y,index:g}=w,I=Object.keys(o.players).find(Q=>o.players[Q]===y)||c;u(C,I),y.graveyard.push(C),y.board[g]=null,o.logs.push(`${C.name}  ${n.name} `);const A=o.players[e],M=Gr(C.name);if(M){const Q=Math.max(0,M.cost+(r.value||0)),F={...M,instanceId:`generated_${o.rngSeed}_${Math.floor(l()*1e3)}`,baseCost:Q,cost:Q,attackEffectType:M.attackEffectType};A.hand.push(F);const ye=r.value||0;o.logs.push(`${A.name}  ${F.name} ${ye>=0?"+":""}${ye}`)}}break}case"RETURN_TO_HAND":{const w=o.players[c].board;let C=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?C=w.findIndex(y=>(y==null?void 0:y.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&w.length>0&&(C=Math.floor(l()*w.length)),C!==-1&&w[C]){const y=w[C];o.players[c].board[C]=null;const g=o.players[c],I=Gr(y.id)||Gr(y.name),{currentHealth:A,maxHealth:M,canAttack:Q,attacksMade:F,hasEvolved:ye,baseAttack:R,baseHealth:Ie,turnPlayed:te,hasBarrier:Y,attack:Pe,health:be,...We}=y,we={...We,attack:(I==null?void 0:I.attack)??Pe,health:(I==null?void 0:I.health)??be};g.hand.length<9?(g.hand.push(we),o.logs.push(`${y.name} `)):(g.graveyard.push(we),o.logs.push(`${y.name} `))}break}case"RANDOM_BOUNCE":{const w=r.value||1,C=o.players[c].board;for(let y=0;y<w;y++){const g=C.map((st,Ke)=>st?Ke:-1).filter(st=>st!==-1);if(g.length===0)break;const I=g[Math.floor(l()*g.length)],A=C[I];C[I]=null;const M=o.players[c],Q=Gr(A.id)||Gr(A.name),{currentHealth:F,maxHealth:ye,canAttack:R,attacksMade:Ie,hasEvolved:te,baseAttack:Y,baseHealth:Pe,turnPlayed:be,hasBarrier:We,attack:we,health:Me,...mt}=A,tt={...mt,attack:(Q==null?void 0:Q.attack)??we,health:(Q==null?void 0:Q.health)??Me};M.hand.length<9?(M.hand.push(tt),o.logs.push(`${A.name} `)):(M.graveyard.push(tt),o.logs.push(`${A.name} `))}break}case"GRANT_PASSIVE":{const w=r.targetPassive;if(!w)break;if(r.targetType==="SELF"){const C=n;if(C.instanceId){const g=o.players[e].board.find(I=>(I==null?void 0:I.instanceId)===C.instanceId);g&&(w==="BARRIER"?(g.hasBarrier=!0,o.logs.push(`${g.name} `)):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(w)||(g.passiveAbilities.push(w),o.logs.push(`${g.name}  ${$c(w)} `)),(w==="STORM"||w==="RUSH")&&(g.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const C=d(s);if(C){const{card:y}=C;w==="BARRIER"?(y.hasBarrier=!0,o.logs.push(`${y.name} `)):(y.passiveAbilities||(y.passiveAbilities=[]),y.passiveAbilities.includes(w)||(y.passiveAbilities.push(w),o.logs.push(`${y.name}  ${$c(w)} `)),(w==="STORM"||w==="RUSH")&&(y.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const C=o.players[e];let y=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${C.board.filter(g=>g).length} units, condition tag=${(P=r.conditions)==null?void 0:P.tag}`),C.board.forEach(g=>{var I,A,M;if(g){if(console.log(`[GRANT_PASSIVE] Checking: ${g.name}, tags=${g.tags}, passives=${g.passiveAbilities}`),(I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching tag`);return}if((M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name)){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching nameIn`);return}w==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(w)||(g.passiveAbilities.push(w),y++,console.log(`[GRANT_PASSIVE] Granted ${w} to ${g.name}`),(w==="STORM"||w==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${$c(w)} `),console.log(`[GRANT_PASSIVE] Total granted: ${y}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const C=o.players[e];let y=0;C.board.forEach(g=>{var I,A,M;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;w==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(w)||(g.passiveAbilities.push(w),y++,(w==="STORM"||w==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${$c(w)} `)}break}case"BUFF_STATS":{const w=r.value||0,C=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(g=>{var I,A,M;if(g){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+w,g.currentAttack=(g.currentAttack||0)+w,g.health=(g.health||0)+C,g.maxHealth=(g.maxHealth||0)+C,g.currentHealth=(g.currentHealth||0)+C,o.logs.push(`${g.name}  +${w}/+${C} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(g=>{var I,A,M;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+w,g.currentAttack=(g.currentAttack||0)+w,g.health=(g.health||0)+C,g.maxHealth=(g.maxHealth||0)+C,g.currentHealth=(g.currentHealth||0)+C,o.logs.push(`${g.name}  +${w}/+${C} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const y=d(s);if(y){const{card:g}=y;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+w,g.currentAttack=(g.currentAttack||0)+w,g.health=(g.health||0)+C,g.maxHealth=(g.maxHealth||0)+C,g.currentHealth=(g.currentHealth||0)+C,o.logs.push(`${g.name}  +${w}/+${C} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const y=o.players[c].board,g=y.map((I,A)=>I?A:-1).filter(I=>I!==-1);if(g.length>0){const I=g[Math.floor(l()*g.length)],A=y[I];A.baseAttack||(A.baseAttack=A.attack||0),A.baseHealth||(A.baseHealth=A.health||0),A.attack=(A.attack||0)+w,A.currentAttack=(A.currentAttack||0)+w,A.health=(A.health||0)+C,A.maxHealth=(A.maxHealth||0)+C,A.currentHealth=(A.currentHealth||0)+C,A.currentAttack<0&&(A.currentAttack=0),A.attack&&A.attack<0&&(A.attack=0);const M=w>=0?`+${w}`:`${w}`,Q=C>=0?`+${C}`:`${C}`;o.logs.push(`${A.name}  ${M}/${Q} `)}else o.logs.push("")}break}}return o}const u2=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let l=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(l=Math.max(0,o-2)),i.cost!==l?{...i,cost:l,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},f2=(t,e)=>{let n=h2(t,e);return n=u2(n),n.lastHash=l2(n),n},h2=(t,e)=>{var s,i,o,l,c,d,u,h,f,E,k,T,N,v,_,S,p,D,H,ne,G,q,he,xe,je;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(fe=>fe?{...fe,passiveAbilities:fe.passiveAbilities?[...fe.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(fe=>fe?{...fe,passiveAbilities:fe.passiveAbilities?[...fe.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=Hg(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const fe=t.activePlayerId,ie=n.players[fe];ie.extraPpActive&&(ie.id!==t.firstPlayerId&&(n.turnCount<=5?ie.extraPpUsedEarly=!0:ie.extraPpUsedLate=!0),ie.extraPpActive=!1);const P=[...n.pendingEffects||[]];ie.board.forEach(y=>{y&&y.triggers&&y.triggers.filter(g=>g.trigger==="END_OF_TURN").forEach(g=>{g.effects.forEach(I=>{P.push({sourceCard:y,effect:I,sourcePlayerId:fe})})})});const w=pp(fe),C=n.players[w];if(C.board.forEach((y,g)=>{y&&y.triggers&&y.triggers.filter(I=>I.trigger==="START_OF_TURN").forEach(I=>{I.effects.forEach(A=>{A.type==="DESTROY_SELF"?y&&(n.players[w].graveyard.push(y),n.players[w].board[g]=null,n.logs.push(`${y.name} `)):P.push({sourceCard:y,effect:A,sourcePlayerId:w})})})}),n.players[w].board=n.players[w].board.filter(Boolean),C.maxPp=Math.min(10,C.maxPp+1),C.pp=C.maxPp,C.deck.length>0){const y=C.deck.pop();y&&(C.hand.length<9?C.hand.push(y):(C.graveyard.push(y),n.logs.push(`${C.name}${y.name}`)))}return C.board=C.board.filter(Boolean),C.board.forEach(y=>{y&&(y.canAttack=!0,y.attacksMade=0,y.turnPlayed=-1)}),C.canEvolveThisTurn=!0,n.activePlayerId=w,n.pendingEffects=P,w===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${C.name} `),n}case"CONCEDE":{const fe=e.playerId,ie=n.players[fe];if(!ie)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${fe}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const P=pp(fe);return n.phase="GAME_OVER",n.winnerId=P,n.logs.push(`${ie.name} `),console.log(`[Engine] CONCEDE: ${fe} surrendered. Winner: ${P}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[fe,...ie]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${fe.effect.type} from ${fe.sourceCard.name}. Remaining: ${ie.length}`);const P=((s=e.payload)==null?void 0:s.targetId)||fe.targetId;let w=d2(n,fe.sourcePlayerId,fe.sourceCard,fe.effect,P,fe.targetIds);const C=(w.pendingEffects||[]).filter(g=>{var I;return!((I=n.pendingEffects)!=null&&I.includes(g))}),y=[...ie,...C];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${ie.length}, NewlyAdded: ${C.length}, Final: ${y.length}`),y.length===0&&Object.values(w.players).forEach(g=>{g.board=g.board.filter(Boolean)}),{...w,pendingEffects:y}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:fe,targetId:ie,instanceId:P}=e.payload,w={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?w:C;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${fe}, instanceId=${P}, handLength=${y.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",y.hand.map(te=>`${te.name}(${te.instanceId})`));let g=fe;if(P){const te=y.hand.findIndex(Y=>Y.instanceId===P);if(te>=0)g=te,console.log(`[Engine] PLAY_CARD: Using instanceId ${P}, found at index ${te} (was ${fe})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${P} not found in hand!`),n}if(g<0||g>=y.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const I=y.hand[g];let A="";if(ie){const Y=(e.playerId==="p1"?C:w).board.find(Pe=>(Pe==null?void 0:Pe.instanceId)===ie);Y&&(A=` (: ${Y.name})`)}if(n.logs.push(`${y.name}  ${I.name} ${A}`),y.pp<I.cost)return n;const M=y.board.filter(te=>te!==null).length;if(I.type==="FOLLOWER"&&M>=5)return n;const Q=y.pp;y.pp-=I.cost,y.extraPpActive&&Q-1<I.cost&&(y.id!==t.firstPlayerId&&(n.turnCount<=5?y.extraPpUsedEarly=!0:y.extraPpUsedLate=!0),y.extraPpActive=!1,y.pp<0&&(y.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${y.name} PP`)),y.hand.splice(g,1);let F=I;if(I.type==="FOLLOWER"){const te={...I,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:I.attack||0,currentHealth:I.health||0,maxHealth:I.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=I.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:I.passiveAbilities?[...I.passiveAbilities]:[],hadStealth:((o=I.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((l=I.passiveAbilities)!=null&&l.includes("STORM")||(c=I.passiveAbilities)!=null&&c.includes("RUSH"))&&(te.canAttack=!0),(d=te.tags)!=null&&d.includes("Knuckler")&&!te.passiveAbilities.includes("STORM")&&y.board.some(Pe=>(Pe==null?void 0:Pe.name)==="")&&(te.passiveAbilities.push("STORM"),te.canAttack=!0,n.logs.push(`${te.name}   `)),y.board.push(te),F=te,te.name===""&&y.board.forEach(Y=>{var Pe,be;Y&&((Pe=Y.tags)!=null&&Pe.includes("Knuckler"))&&Y.instanceId!==te.instanceId&&((be=Y.passiveAbilities)!=null&&be.includes("STORM")||(Y.passiveAbilities||(Y.passiveAbilities=[]),Y.passiveAbilities.push("STORM"),Y.canAttack=!0,n.logs.push(`${Y.name}   `)))})}else y.graveyard.push({...I,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const ye=[];(u=I.triggers)==null||u.filter(te=>te.trigger==="FANFARE").forEach(te=>ye.push(...te.effects)),(h=I.triggerAbilities)!=null&&h.FANFARE&&ye.push(I.triggerAbilities.FANFARE);let R=[...n.pendingEffects||[]];return ye.forEach(te=>{if(te.conditions&&te.conditions.minTurn&&n.turnCount<te.conditions.minTurn)return;let Y;if(te.targetType==="OPPONENT"||te.targetType==="SELF"||te.targetType==="ALL_FOLLOWERS"||te.targetType==="ALL_OTHER_FOLLOWERS"||te.type==="RANDOM_DESTROY"||te.type==="RANDOM_SET_HP"||te.type==="AOE_DAMAGE"||te.type==="RANDOM_DAMAGE"||te.type==="RANDOM_DAMAGE_BY_TURN"){const be=e.playerId==="p1"?"p2":"p1",We=e.playerId;if(te.type==="RANDOM_DAMAGE_BY_TURN"){const we=te.targetType==="SELF"?We:be,Me=n.players[we].board,mt=n.turnCount;Y=[];for(let tt=0;tt<mt;tt++){const st=Me.map((Ne,nt)=>Ne?nt:-1).filter(Ne=>Ne!==-1);if(st.length===0)break;const Ke=Math.floor(r()*st.length);Y.push(Me[st[Ke]].instanceId)}}else if(te.type==="RANDOM_DESTROY"||te.type==="RANDOM_SET_HP"||te.type==="RANDOM_DAMAGE"){const we=te.targetType==="SELF"?We:be,Me=n.players[we].board,mt=te.type==="RANDOM_DAMAGE"?te.value2||1:te.value||1,tt=Me.map((Ke,Ne)=>Ke?Ne:-1).filter(Ke=>Ke!==-1);for(let Ke=tt.length-1;Ke>0;Ke--){const Ne=Math.floor(r()*(Ke+1));[tt[Ke],tt[Ne]]=[tt[Ne],tt[Ke]]}Y=tt.slice(0,mt).map(Ke=>Me[Ke].instanceId)}else if(te.targetType==="ALL_FOLLOWERS"||te.type==="AOE_DAMAGE"){const we=te.type==="GRANT_PASSIVE"||te.type==="BUFF_STATS",Me=we?We:be;Y=n.players[Me].board.filter(tt=>tt!==null).map(tt=>tt.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${we?"ally":"enemy"}): ${Y.length} units`)}else te.targetType==="ALL_OTHER_FOLLOWERS"&&(Y=n.players[We].board.filter(Me=>Me!==null&&Me.instanceId!==F.instanceId).map(Me=>Me.instanceId))}const Pe=te.targetType==="SELECT_FOLLOWER"||te.targetType==="SELECT_ALLY_FOLLOWER"||te.targetType==="SELECT_OTHER_ALLY_FOLLOWER";R.push({sourceCard:F,effect:te,sourcePlayerId:e.playerId,targetId:Pe?ie:void 0,targetIds:Y})}),console.log(`[Engine] PLAY_CARD: Queued ${ye.length} effects. Total pending: ${R.length}`),{...n,players:{p1:w,p2:C},pendingEffects:R}}case"EVOLVE":{const{followerIndex:fe,targetId:ie,useSep:P}=e.payload,w={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(F=>F?{...F,passiveAbilities:F.passiveAbilities?[...F.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(F=>F?{...F,passiveAbilities:F.passiveAbilities?[...F.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?w:C,g=y.board[fe];if(!g||g.hasEvolved)return n;const I=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${g.name}, useSep=${P}, isRemote=${I}, turn=${t.turnCount}`),n.logs.push(`${y.name}  ${g.name} ${P?"":""}`),P){if(!I){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(y.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}y.sep=Math.max(0,y.sep-1),y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=3,g.currentHealth+=3,g.maxHealth+=3,g.canAttack=!0;const F=[...g.passiveAbilities||[]];F.includes("IMMUNE_TO_DAMAGE_MY_TURN")||F.push("IMMUNE_TO_DAMAGE_MY_TURN"),!F.includes("STORM")&&!F.includes("RUSH")&&F.push("RUSH"),g.passiveAbilities=F,console.log(`[Engine] Super Evolved ${g.name}! SEP remaining: ${y.sep}`)}else{if(!I){const R=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<R)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${R}`),n;if(y.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}y.evolutionsUsed+=1,y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=2,g.currentHealth+=2,g.maxHealth+=2,g.canAttack=!0;const F=[...g.passiveAbilities||[]];!F.includes("STORM")&&!F.includes("RUSH")&&F.push("RUSH"),g.passiveAbilities=F}const A=[];(f=g.triggers)==null||f.filter(F=>F.trigger==="EVOLVE").forEach(F=>A.push(...F.effects)),(E=g.triggerAbilities)!=null&&E.EVOLVE&&A.push(g.triggerAbilities.EVOLVE),P&&((k=g.triggers)==null||k.filter(F=>F.trigger==="SUPER_EVOLVE").forEach(F=>A.push(...F.effects)));let M=[...n.pendingEffects||[]];return A.forEach(F=>{if(F.conditions&&F.conditions.minTurn&&n.turnCount<F.conditions.minTurn)return;let ye;const R=e.playerId==="p1"?"p2":"p1",Ie=e.playerId;if(F.type==="RANDOM_DESTROY"||F.type==="RANDOM_SET_HP"||F.type==="RANDOM_DAMAGE"){const te=F.targetType==="SELF"?Ie:R,Y=n.players[te].board,Pe=F.type==="RANDOM_DAMAGE"?F.value2||1:F.value||1,be=Y.map((we,Me)=>we?Me:-1).filter(we=>we!==-1);for(let we=be.length-1;we>0;we--){const Me=Math.floor(r()*(we+1));[be[we],be[Me]]=[be[Me],be[we]]}ye=be.slice(0,Pe).map(we=>Y[we].instanceId)}else F.targetType==="ALL_FOLLOWERS"||F.type==="AOE_DAMAGE"?(ye=n.players[R].board.filter(Y=>Y!==null).map(Y=>Y.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${ye.length} units`)):F.targetType==="ALL_OTHER_FOLLOWERS"&&(ye=n.players[Ie].board.filter(Y=>Y!==null&&Y.instanceId!==g.instanceId).map(Y=>Y.instanceId));M.push({sourceCard:g,effect:F,sourcePlayerId:e.playerId,targetId:ie,targetIds:ye})}),console.log(`[Engine] EVOLVE: Queued ${A.length} effects. Total pending: ${M.length}`),{...n,players:{p1:w,p2:C},pendingEffects:M}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:fe,targetIndex:ie,targetIsLeader:P}=e.payload,w={...n.players.p1,board:n.players.p1.board.map(Y=>Y?{...Y,passiveAbilities:Y.passiveAbilities?[...Y.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,board:n.players.p2.board.map(Y=>Y?{...Y,passiveAbilities:Y.passiveAbilities?[...Y.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1",g=y?w:C,I=y?C:w,A=g.board[fe];if(!A||!A.canAttack)return n;const M=I.board.filter(Y=>{var Pe,be;return Y&&((Pe=Y.passiveAbilities)==null?void 0:Pe.includes("WARD"))&&!((be=Y.passiveAbilities)!=null&&be.includes("STEALTH"))}),Q=((T=A.passiveAbilities)==null?void 0:T.includes("STEALTH"))||A.hadStealth;if(M.length>0&&!Q){if(P)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const Y=I.board[ie];if(Y&&!((N=Y.passiveAbilities)!=null&&N.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(P===!1){const Y=I.board[ie];if(Y&&((v=Y.passiveAbilities)!=null&&v.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const F=(_=A.passiveAbilities)==null?void 0:_.includes("RUSH"),ye=(S=A.passiveAbilities)==null?void 0:S.includes("STORM");if(F&&!ye&&P&&A.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(p=A.passiveAbilities)!=null&&p.includes("STEALTH")&&(A.passiveAbilities=A.passiveAbilities.filter(Y=>Y!=="STEALTH"),n.logs.push(`${A.name} `)),A.canAttack=!1,A.attacksMade=(A.attacksMade||0)+1,(D=A.passiveAbilities)!=null&&D.includes("DOUBLE_ATTACK")&&A.attacksMade<2&&(A.canAttack=!0);const R=A.currentAttack;console.log(`[Engine] Attack: ${A.name} (${R}) -> Target (Leader? ${P}). DefHP before: ${I.hp}`);const Ie=(Y,Pe)=>{var We;const be=(We=Y.triggers)==null?void 0:We.find(we=>we.trigger==="LAST_WORD");if(be){const we=be.effects.map(Me=>({sourceCard:Y,effect:Me,sourcePlayerId:Pe}));n.pendingEffects=[...n.pendingEffects||[],...we],n.logs.push(`${Y.name} `),console.log(`[Engine] Last Word triggered for ${Y.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(P){const Y="";if(n.logs.push(`${A.name}  ${Y} `),I.leaderDamageShield)I.leaderDamageShield=!1,n.logs.push(`${A.name}  ${Y}  ${R} `);else{const Pe=I.board.some(We=>{var we;return(we=We==null?void 0:We.passiveAbilities)==null?void 0:we.includes("LEADER_DAMAGE_CAP")}),be=Pe?Math.min(R,1):R;I.hp-=be,Pe&&R>1?n.logs.push(`${A.name}  ${Y}  ${R} 1`):n.logs.push(`${A.name}  ${Y}  ${be} `),I.hp<=0&&(n.winnerId=e.playerId)}}else{const Y=I.board[ie];if(!Y)return console.log(`[Engine] Attack target at index ${ie} no longer exists. Skipping.`),n;n.logs.push(`${A.name}  ${Y.name} `);let Pe=R;(H=Y.passiveAbilities)!=null&&H.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Pe=0,n.logs.push(`${Y.name} `)):Y.hasBarrier&&Pe>0?(Pe=0,Y.hasBarrier=!1,n.logs.push(`${Y.name} `)):n.logs.push(`${A.name}  ${Y.name}  ${Pe} `),Y.currentHealth-=Pe;const be=y?"p2":"p1",We=((ne=Y.passiveAbilities)==null?void 0:ne.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===be;(G=A.passiveAbilities)!=null&&G.includes("BANE")&&Y.currentHealth>0&&(We?n.logs.push(`${Y.name} `):(Y.currentHealth=0,Y.killedByBane=!0,n.logs.push(`${A.name}  ${Y.name} `)));let we=Y.currentAttack;(q=A.passiveAbilities)!=null&&q.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(we=0,n.logs.push(`${A.name} `)),A.hasBarrier&&we>0?(we=0,A.hasBarrier=!1,n.logs.push(`${A.name} `)):we>0&&n.logs.push(`${Y.name}  ${A.name}  ${we} `),A.currentHealth-=we;const Me=y?"p1":"p2";A.currentHealth<=0&&((he=A.passiveAbilities)!=null&&he.includes("GUTS_MY_TURN"))&&n.activePlayerId===Me&&(A.currentHealth=1,n.logs.push(`${A.name} 1`));const mt=((xe=A.passiveAbilities)==null?void 0:xe.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===Me;(je=Y.passiveAbilities)!=null&&je.includes("BANE")&&A.currentHealth>0&&(mt?n.logs.push(`${A.name} `):(A.currentHealth=0,A.killedByBane=!0,n.logs.push(`${Y.name}  ${A.name} `)));const tt=Y.currentHealth<=0,st=A.currentHealth<=0;tt&&(Y.currentHealth=Math.min(0,Y.currentHealth),I.graveyard.push(Y),I.board[ie]=null,n.logs.push(`${Y.name} `)),st&&(A.currentHealth=Math.min(0,A.currentHealth),g.graveyard.push(A),g.board[fe]=null,n.logs.push(`${A.name} `)),tt&&Ie(Y,y?"p2":"p1"),st&&Ie(A,y?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${w.hp}, P2 HP: ${C.hp}`);const te={...n,players:{p1:w,p2:C}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${te.players.p1.hp}, finalState.players.p2.hp: ${te.players.p2.hp}`),te}case"REINIT_GAME":{const{p1Class:fe,p2Class:ie}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${fe}, p2=${ie}`),id("Player 1",fe,"Player 2",ie)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:fe,name:ie}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",fe,ie),t.players[fe]?{...t,players:{...t.players,[fe]:{...t.players[fe],name:ie}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",fe),t)}case"TOGGLE_EXTRA_PP":{const fe=e.playerId,ie=n.players[fe];if(!(fe!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==fe)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(ie.extraPpActive)return ie.extraPpActive=!1,ie.pp=Math.max(0,ie.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",ie.pp),n;if(n.turnCount<=5){if(ie.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(ie.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return ie.extraPpActive=!0,ie.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",ie.pp),n}default:return t}},Au=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},p2=Au("/leaders/azya_leader.png"),g2=Au("/leaders/senka_leader.png"),m2=Au("/leaders/yoRuka_leader.png"),y2=1280,v2=720,_2={SENKA:{primary:"#e94560",gradient:"linear-gradient(135deg, #2c0b0e 0%, #1a1a2e 100%)",shadow:"rgba(233, 69, 96, 0.3)"},AJA:{primary:"#45a2e9",gradient:"linear-gradient(135deg, #0f1c2e 0%, #1a1a2e 100%)",shadow:"rgba(69, 162, 233, 0.3)"},YORUKA:{primary:"#a855f7",gradient:"linear-gradient(135deg, #1a0f2e 0%, #1a1a2e 100%)",shadow:"rgba(168, 85, 247, 0.3)"}},x2={SENKA:"",AJA:"",YORUKA:"Y"},b2={SENKA:g2,AJA:p2,YORUKA:m2},Ia=["SENKA","AJA","YORUKA"],E2=({classType:t,onSelectCard:e})=>{const[n,r]=L.useState(1),[s,i]=L.useState(Ia.indexOf(t));L.useEffect(()=>{const D=()=>{const H=window.innerWidth/y2,ne=window.innerHeight/v2;r(Math.min(H,ne))};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]);const o=D=>D==="SENKA"?Q1:D==="AJA"?J1:q1,l=Ia[s],d=o(l).filter(D=>!D.cardId.startsWith("TOKEN_")).map(D=>({card:Jn.find(H=>H.id===D.cardId),count:D.count})).filter(D=>D.card),u=_2[l],h=x2[l],f=b2[l],E=180*n,k=250*n,T=110*n,N=155*n,v=.6*n,_=1.8*n,S=()=>{i(D=>(D-1+Ia.length)%Ia.length)},p=()=>{i(D=>(D+1)%Ia.length)};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",background:u.gradient,color:"white",position:"relative",paddingBottom:`${40*n}px`},children:[a.jsxs("h2",{style:{fontSize:`${_}rem`,marginTop:`${80*n}px`,marginBottom:`${20*n}px`,fontFamily:"sans-serif",color:u.primary,textShadow:`0 0 20px ${u.shadow}`},children:[h," - "]}),a.jsxs("div",{style:{display:"flex",gap:`${2*n}rem`,width:"95%",maxWidth:`${1100*n}px`,alignItems:"flex-start",justifyContent:"center"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:`${.8*n}rem`},children:[a.jsx("button",{onClick:S,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${u.primary}`,borderRadius:"50%",color:u.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:D=>{D.currentTarget.style.background=u.primary,D.currentTarget.style.color="white"},onMouseOut:D=>{D.currentTarget.style.background="rgba(0, 0, 0, 0.5)",D.currentTarget.style.color=u.primary},children:"<"}),a.jsxs("div",{style:{width:E,height:k,border:`3px solid ${u.primary}`,borderRadius:10*n,background:"linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.8) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",boxShadow:`0 8px 30px ${u.shadow}`,overflow:"hidden",position:"relative"},children:[a.jsx("img",{src:f,alt:h,style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.2*n}rem`,color:u.primary,margin:0,fontFamily:"sans-serif"},children:h})})]}),a.jsx("button",{onClick:p,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${u.primary}`,borderRadius:"50%",color:u.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:D=>{D.currentTarget.style.background=u.primary,D.currentTarget.style.color="white"},onMouseOut:D=>{D.currentTarget.style.background="rgba(0, 0, 0, 0.5)",D.currentTarget.style.color=u.primary},children:">"})]}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:`${1*n}rem`},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${T}px, 1fr))`,gap:`${v}rem`,width:"100%",padding:`${10*n}px`,maxHeight:`${(N+v*16)*3+40*n}px`,overflowY:"auto",overflowX:"hidden"},children:d.map(({card:D,count:H})=>a.jsxs("div",{onClick:()=>e(D.id),style:{width:T,height:N,border:`2px solid ${u.primary}`,borderRadius:8*n,background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 15px ${u.shadow}`,position:"relative",overflow:"hidden"},onMouseOver:ne=>{ne.currentTarget.style.transform="translateY(-5px) scale(1.05)",ne.currentTarget.style.boxShadow=`0 8px 25px ${u.shadow}`},onMouseOut:ne=>{ne.currentTarget.style.transform="translateY(0) scale(1)",ne.currentTarget.style.boxShadow=`0 4px 15px ${u.shadow}`},children:[a.jsx("div",{style:{width:"100%",height:"65%",overflow:"hidden",borderBottom:`1px solid ${u.primary}`},children:a.jsx("img",{src:Au(D.imageUrl||`/cards/${D.id}.png`),alt:D.name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:ne=>{ne.currentTarget.style.display="none"}})}),a.jsxs("div",{style:{padding:`${5*n}px`,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"},children:[a.jsx("h3",{style:{fontSize:`${.7*n}rem`,margin:`0 0 ${3*n}px 0`,fontFamily:"sans-serif",color:u.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.name}),a.jsxs("p",{style:{fontSize:`${.6*n}rem`,color:"#ffcc00",margin:0,fontFamily:"sans-serif",fontWeight:"bold"},children:[": ",D.cost]})]}),a.jsx("div",{style:{position:"absolute",bottom:`${5*n}px`,right:`${5*n}px`,background:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:50,width:`${22*n}px`,height:`${22*n}px`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.7*n}rem`,fontWeight:"bold",fontFamily:"sans-serif",border:`2px solid ${u.primary}`,boxShadow:`0 0 10px ${u.shadow}`},children:H})]},D.id))}),a.jsxs("div",{style:{fontSize:`${.85*n}rem`,color:"#aaa",fontFamily:"sans-serif",textAlign:"center"},children:[" ",d.length," "]})]})]})]})},S2=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},I2=1280,w2=720,T2=({cardId:t,onOpenRelatedCard:e,onBack:n,onSetHomeCard:r})=>{const[s,i]=L.useState(1),[o,l]=L.useState(!1);L.useEffect(()=>{const v=()=>{const _=window.innerWidth/I2,S=window.innerHeight/w2;i(Math.min(_,S))};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const c=Jn.find(v=>v.id===t);if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"sans-serif",fontSize:`${1.5*s}rem`},children:""});const d=(v,_)=>S2(v||_),u=d(c.imageUrl,`/cards/${c.id}.png`),h=c.type==="FOLLOWER"?d(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,f=200*s,E=280*s,k=1*s,T="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",N=()=>{r&&(r(t),l(!0),setTimeout(()=>l(!1),1500))};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:T,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*s}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*s}px`,left:`${15*s}px`,zIndex:100},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*s}px ${16*s}px`,fontSize:`${.9*s}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*s}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:v=>v.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:v=>v.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{display:"flex",gap:`${2*s}rem`,padding:`${20*s}px ${30*s}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*s}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",gap:`${k}rem`,flex:"0 0 auto"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:[a.jsx("div",{style:{width:f,height:E,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:u,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*s}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:[a.jsx("div",{style:{width:f,height:E,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:h||u,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*s}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:a.jsx("div",{style:{width:f,height:E,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:u,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})})}),a.jsxs("div",{style:{flex:"1 1 auto",maxWidth:`${450*s}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*s}px`,borderRadius:`${12*s}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*s}px`,minHeight:`${450*s}px`,maxHeight:`${550*s}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*s}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:c.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*s}px`,fontSize:`${1.2*s}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*s}rem`,margin:`0 0 ${8*s}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*s}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*s}rem`,margin:`0 0 ${8*s}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*s}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]}),a.jsxs("div",{style:{display:"flex",gap:`${12*s}px`,flexWrap:"wrap",marginTop:`${10*s}px`},children:[a.jsx("button",{onClick:N,disabled:o,style:{padding:`${.9*s}rem ${1.8*s}rem`,background:o?"#10b981":"#3b82f6",color:"white",border:"none",borderRadius:`${8*s}px`,fontSize:`${1*s}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:o?"default":"pointer",transition:"all 0.2s",boxShadow:o?"0 4px 15px rgba(16, 185, 129, 0.3)":"0 4px 15px rgba(59, 130, 246, 0.3)",flex:1},onMouseOver:v=>{o||(v.currentTarget.style.background="#2563eb",v.currentTarget.style.transform="translateY(-2px)",v.currentTarget.style.boxShadow="0 6px 20px rgba(59, 130, 246, 0.4)")},onMouseOut:v=>{o||(v.currentTarget.style.background="#3b82f6",v.currentTarget.style.transform="translateY(0)",v.currentTarget.style.boxShadow="0 4px 15px rgba(59, 130, 246, 0.3)")},children:o?" ":""}),c.relatedCards&&c.relatedCards.length>0&&a.jsxs("button",{onClick:()=>e(t),style:{padding:`${.9*s}rem ${1.8*s}rem`,background:"#4ade80",color:"white",border:"none",borderRadius:`${8*s}px`,fontSize:`${1*s}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 15px rgba(74, 222, 128, 0.3)",flex:1},onMouseOver:v=>{v.currentTarget.style.background="#22c55e",v.currentTarget.style.transform="translateY(-2px)",v.currentTarget.style.boxShadow="0 6px 20px rgba(74, 222, 128, 0.4)"},onMouseOut:v=>{v.currentTarget.style.background="#4ade80",v.currentTarget.style.transform="translateY(0)",v.currentTarget.style.boxShadow="0 4px 15px rgba(74, 222, 128, 0.3)"},children:[" (",c.relatedCards.length,")"]})]})]})]})]})},C2=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},k2=1280,R2=720,A2=({parentCardId:t,relatedCardIds:e,onBack:n})=>{const[r,s]=L.useState(1),[i,o]=L.useState(0);L.useEffect(()=>{const S=()=>{const p=window.innerWidth/k2,D=window.innerHeight/R2;s(Math.min(p,D))};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const l=e[i],c=Jn.find(S=>S.id===l),d=()=>{o(S=>S>0?S-1:e.length-1)},u=()=>{o(S=>S<e.length-1?S+1:0)};if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const h=(S,p)=>C2(S||p),f=h(c.imageUrl,`/cards/${c.id}.png`),E=c.type==="FOLLOWER"?h(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,k=200*r,T=280*r,N=1*r,v="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",_={fontSize:`${2*r}rem`,background:"rgba(0, 0, 0, 0.5)",padding:`${.8*r}rem ${1.2*r}rem`,borderRadius:`${8*r}px`,cursor:"pointer",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",transition:"all 0.2s",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:v,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*r}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*r}px`,left:`${15*r}px`,zIndex:100},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*r}px ${16*r}px`,fontSize:`${.9*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*r}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{position:"absolute",top:`${15*r}px`,right:`${15*r}px`,zIndex:100,fontSize:`${1*r}rem`,opacity:.8,fontWeight:"bold",background:"rgba(0, 0, 0, 0.5)",padding:`${8*r}px ${16*r}px`,borderRadius:`${6*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)"},children:[i+1," / ",e.length]}),a.jsxs("div",{style:{display:"flex",gap:`${2*r}rem`,padding:`${20*r}px ${30*r}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*r}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",alignItems:"center",flex:"0 0 auto"},children:a.jsx("button",{onClick:d,style:_,onMouseOver:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:"<"})}),a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",gap:`${N}rem`,flex:"0 0 auto"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:k,height:T,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:k,height:T,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:E||f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:a.jsx("div",{style:{width:k,height:T,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})})}),a.jsx("div",{style:{display:"flex",alignItems:"center",flex:"0 0 auto"},children:a.jsx("button",{onClick:u,style:_,onMouseOver:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:">"})}),a.jsxs("div",{style:{flex:"1 1 auto",maxWidth:`${450*r}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*r}px`,minHeight:`${450*r}px`,maxHeight:`${550*r}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:c.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]})]})]})]})},Es=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},P2=1280,O2=720,L2=Es("/leaders/azya_leader.png"),D2=Es("/leaders/senka_leader.png"),M2=Es("/leaders/yoRuka_leader.png"),N2=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r,onSetHomeCard:s,homeCardId:i=null,isAnonymous:o=!0,userId:l=null,onNavigateToRegister:c,onNavigateToLogin:d,onNavigateToProfile:u,onLogout:h})=>{const[f,E]=L.useState("title"),[k,T]=L.useState(!1);L.useEffect(()=>{console.log(" TitleScreen auth state:",{isAnonymous:o,userId:l})},[o,l]);const[N,v]=L.useState("home"),[_,S]=L.useState(!1),[p,D]=L.useState(""),[H,ne]=L.useState(!1),[G,q]=L.useState("class"),[he,xe]=L.useState(null),[je,fe]=L.useState(null),[ie,P]=L.useState([]),[w,C]=L.useState(25),[y,g]=L.useState(!1),I=L.useRef(0),A=L.useRef(0),M=L.useRef(0),Q=L.useRef(0),F=L.useRef(0),ye=L.useRef(null),[R,Ie]=L.useState(1);L.useEffect(()=>{const z=()=>{const ut=window.innerWidth/P2,vt=window.innerHeight/O2;Ie(Math.min(ut,vt))};return z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]);const te=()=>{T(!0),setTimeout(()=>{E("home"),T(!1)},600)},Y=z=>{const ut=z%360;return ut<0?ut+360:ut},Pe=()=>{ye.current!==null&&(cancelAnimationFrame(ye.current),ye.current=null)},be=z=>{Pe(),g(!0),I.current=z.clientX,A.current=w,M.current=Date.now(),Q.current=z.clientX,F.current=0},We=z=>{if(!y)return;const ut=Date.now(),vt=ut-M.current,sr=z.clientX-Q.current;vt>0&&(F.current=sr/vt);const ii=z.clientX-I.current,ra=A.current+ii*.5;C(Y(ra)),M.current=ut,Q.current=z.clientX},we=()=>{g(!1);let z=F.current*.5;const ut=.95,vt=.1,sr=()=>{Math.abs(z)>vt?(C(ii=>Y(ii+z)),z*=ut,ye.current=requestAnimationFrame(sr)):ye.current=null};Math.abs(z)>vt&&sr()};L.useEffect(()=>()=>{Pe()},[]);const Me=z=>{t(z==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},mt=()=>{ne(!0)},tt=()=>{ne(!1),h&&h()},st=()=>{ne(!1)},Ke=z=>{xe(z),q("card-list")},Ne=z=>{fe(z),q("card-detail")},nt=z=>{const ut=Jn.find(vt=>vt.id===z);ut&&ut.relatedCards&&ut.relatedCards.length>0&&(fe(z),P(ut.relatedCards),q("related-card"))},yt=()=>{fe(null),q("card-list")},kt=()=>{P([]),q("card-detail")};L.useEffect(()=>{N!=="gallery"&&(q("class"),xe(null),fe(null),P([]))},[N]);const se=9*R;if(f==="title")return a.jsxs("div",{className:"screen title-screen",onClick:te,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Es("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),a.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:k?"translateY(-100vh)":"translateY(0)",transition:k?"transform 0.6s ease-in":"none"},children:[a.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${se}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*R}rem`,whiteSpace:"nowrap",marginBottom:`${2*R}rem`},children:""}),a.jsx("div",{style:{fontSize:`${2*R}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*R}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),a.jsx("p",{style:{position:"absolute",bottom:20*R,opacity:.5,fontSize:`${.8*R}rem`,zIndex:2},children:"Ver 1.04 Beta"}),a.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const Fe=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return a.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:We,onMouseUp:we,onMouseLeave:we,children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Es("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),a.jsx("div",{style:{position:"absolute",top:20*R,left:"50%",transform:"translateX(-50%)",fontFamily:"Tamanegi, sans-serif",fontSize:`${2.5*R}rem`,color:"#fff",textShadow:"0 0 15px rgba(233, 69, 96, 0.7)",letterSpacing:`${.2*R}rem`,zIndex:10},children:""}),a.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*R,position:"relative",zIndex:2},children:[N==="home"&&a.jsxs("div",{style:{position:"absolute",left:50*R,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[a.jsxs("div",{onMouseDown:be,style:{width:200*R,height:280*R,transformStyle:"preserve-3d",transform:`rotateY(${w}deg)`,transition:y?"none":"transform 0.3s ease-out",cursor:y?"grabbing":"grab"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*R,background:i?`url(${Es(`/cards/${i}.png`)})`:"linear-gradient(135deg, #2d3748 0%, #1a202c 100%)",backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${i?"#e94560":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!i&&a.jsxs("span",{style:{fontSize:`${.9*R}rem`,color:"#718096",textAlign:"center",padding:20*R},children:["",a.jsx("br",{}),"",a.jsx("br",{}),""]})}),a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*R,background:i?`url(${Es(`/cards/${i}_evolved.png`)})`:`url(${Es("/cards/sleeve_default.png")})`,backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${i?"#a855f7":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!i&&a.jsx("span",{style:{fontSize:`${.8*R}rem`,color:"#718096"},children:""})})]}),a.jsx("p",{style:{textAlign:"center",marginTop:10*R,fontSize:`${.75*R}rem`,color:"#888"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*R},children:[N==="home"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*R}rem`,marginBottom:`${1*R}rem`},children:""}),a.jsx("p",{style:{fontSize:`${1*R}rem`,color:"#aaa"},children:""})]}),N==="solo"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*R}rem`,marginBottom:`${1*R}rem`,color:"#e94560"},children:""}),a.jsx("button",{onClick:()=>t("CPU"),style:{padding:`${1*R}rem ${3*R}rem`,fontSize:`${1.2*R}rem`,background:"#e94560",border:"none",borderRadius:8*R,color:"white",cursor:"pointer",fontWeight:"bold"},children:"CPU"})]}),N==="room"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*R}rem`,marginBottom:`${1.5*R}rem`,color:"#60a5fa"},children:""}),_?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*R}rem`,alignItems:"center"},children:[a.jsx("input",{type:"text",placeholder:"ID",value:p,onChange:z=>D(z.target.value),style:{padding:`${.8*R}rem`,fontSize:`${1*R}rem`,width:250*R,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*R,color:"white",textAlign:"center"}}),a.jsxs("div",{style:{display:"flex",gap:`${.5*R}rem`},children:[a.jsx("button",{onClick:()=>S(!1),style:{padding:`${.6*R}rem ${1.5*R}rem`,fontSize:`${1*R}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*R,color:"#888",cursor:"pointer"},children:""}),a.jsx("button",{onClick:()=>t("JOIN",p),disabled:!p,style:{padding:`${.6*R}rem ${1.5*R}rem`,fontSize:`${1*R}rem`,background:p?"#a855f7":"#333",border:"none",borderRadius:6*R,color:"white",cursor:p?"pointer":"not-allowed",opacity:p?1:.5},children:""})]})]}):a.jsxs("div",{style:{display:"flex",gap:`${3*R}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>t("HOST"),style:{width:200*R,height:280*R,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*R,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:z=>{z.currentTarget.style.transform="rotateY(0deg) scale(1.05)",z.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:z=>{z.currentTarget.style.transform="rotateY(15deg)",z.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*R}rem`,marginBottom:`${.5*R}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*R}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*R}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*R}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*R}rem`},children:["ID",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>S(!0),style:{width:200*R,height:280*R,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*R,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:z=>{z.currentTarget.style.transform="rotateY(0deg) scale(1.05)",z.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:z=>{z.currentTarget.style.transform="rotateY(-15deg)",z.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*R}rem`,marginBottom:`${.5*R}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*R}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*R}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*R}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*R}rem`},children:["ID",a.jsx("br",{}),""]})]})]})]}),N==="random"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*R}rem`,marginBottom:`${1.5*R}rem`,color:"#4ade80"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*R}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>Me("casual"),style:{width:200*R,height:280*R,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*R,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:z=>{z.currentTarget.style.transform="rotateY(0deg) scale(1.05)",z.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:z=>{z.currentTarget.style.transform="rotateY(15deg)",z.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*R}rem`,marginBottom:`${.5*R}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*R}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*R}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*R}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*R}rem`},children:["",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>Me("ranked"),style:{width:200*R,height:280*R,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*R,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:z=>{z.currentTarget.style.transform="rotateY(0deg) scale(1.05)",z.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:z=>{z.currentTarget.style.transform="rotateY(-15deg)",z.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*R}rem`,marginBottom:`${.5*R}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*R}rem`,color:"#e94560",margin:0,marginBottom:`${.5*R}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*R}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*R}rem`},children:["",a.jsx("br",{}),""]})]})]})]}),N==="ranking"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*R}rem`,marginBottom:`${1*R}rem`,color:"#a855f7"},children:""}),a.jsx("p",{style:{fontSize:`${1*R}rem`,color:"#888"},children:"Coming Soon..."})]}),N==="gallery"&&a.jsxs(a.Fragment,{children:[G==="class"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*R}rem`,marginBottom:`${1.5*R}rem`,color:"#ec4899"},children:" - "}),a.jsxs("div",{style:{display:"flex",gap:`${1.2*R}rem`,justifyContent:"center",marginBottom:`${1*R}rem`},children:[a.jsxs("div",{onClick:()=>Ke("SENKA"),style:{width:200*R,height:280*R,border:"1px solid #444",borderRadius:10*R,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:z=>{z.currentTarget.style.transform="scale(1.05)",z.currentTarget.style.boxShadow="0 8px 30px rgba(233, 69, 96, 0.4)"},onMouseOut:z=>{z.currentTarget.style.transform="scale(1)",z.currentTarget.style.boxShadow="0 4px 20px rgba(233, 69, 96, 0.2)"},children:[a.jsx("img",{src:D2,alt:"Senka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*R}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*R}rem`,color:"#e94560",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>Ke("AJA"),style:{width:200*R,height:280*R,border:"1px solid #444",borderRadius:10*R,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:z=>{z.currentTarget.style.transform="scale(1.05)",z.currentTarget.style.boxShadow="0 8px 30px rgba(69, 162, 233, 0.4)"},onMouseOut:z=>{z.currentTarget.style.transform="scale(1)",z.currentTarget.style.boxShadow="0 4px 20px rgba(69, 162, 233, 0.2)"},children:[a.jsx("img",{src:L2,alt:"Azya",style:{width:"100%",height:"75%",objectFit:"cover",objectPosition:"center top"}}),a.jsx("div",{style:{padding:`${8*R}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*R}rem`,color:"#45a2e9",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>Ke("YORUKA"),style:{width:200*R,height:280*R,border:"1px solid #444",borderRadius:10*R,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:z=>{z.currentTarget.style.transform="scale(1.05)",z.currentTarget.style.boxShadow="0 8px 30px rgba(168, 85, 247, 0.4)"},onMouseOut:z=>{z.currentTarget.style.transform="scale(1)",z.currentTarget.style.boxShadow="0 4px 20px rgba(168, 85, 247, 0.2)"},children:[a.jsx("img",{src:M2,alt:"Yoruka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*R}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*R}rem`,color:"#a855f7",margin:0,fontFamily:"sans-serif"},children:"Y"})})]})]})]}),G==="card-list"&&he&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(E2,{classType:he,onSelectCard:Ne})}),G==="card-detail"&&je&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(T2,{cardId:je,onOpenRelatedCard:nt,onBack:yt,onSetHomeCard:s})}),G==="related-card"&&je&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(A2,{parentCardId:je,relatedCardIds:ie,onBack:kt})})]}),N==="settings"&&a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*R,padding:`${2*R}rem`,minWidth:400*R},children:[a.jsx("h2",{style:{fontSize:`${1.8*R}rem`,marginBottom:`${1.5*R}rem`,color:"#6b7280",textAlign:"center"},children:""}),a.jsxs("div",{style:{marginBottom:`${1.5*R}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*R}rem`},children:[a.jsx("span",{style:{fontSize:`${1*R}rem`},children:"BGM"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*R,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:z=>n({bgmEnabled:z.target.checked}),style:{width:18*R,height:18*R}}),a.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*R}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:z=>n({bgm:parseFloat(z.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),a.jsxs("div",{style:{marginBottom:`${1.5*R}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*R}rem`},children:[a.jsx("span",{style:{fontSize:`${1*R}rem`},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*R,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:z=>n({seEnabled:z.target.checked}),style:{width:18*R,height:18*R}}),a.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*R}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:z=>n({se:parseFloat(z.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*R}rem`,marginTop:`${1*R}rem`,marginBottom:`${1.5*R}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*R}rem`,marginBottom:`${1*R}rem`,color:"#fff"},children:""}),a.jsx("button",{onClick:u,style:{width:"100%",padding:`${.6*R}rem ${1*R}rem`,fontSize:`${.9*R}rem`,background:"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:6*R,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.transform="scale(1.05)",onMouseLeave:z=>z.currentTarget.style.transform="scale(1)",children:""})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*R}rem`,marginTop:`${1*R}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*R}rem`,marginBottom:`${1*R}rem`,color:"#fff"},children:""}),o?a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*R}rem`,color:"#aaa",marginBottom:`${1*R}rem`},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*R,marginBottom:`${1*R}rem`},children:[a.jsx("button",{onClick:c,style:{flex:1,padding:`${.6*R}rem ${1*R}rem`,fontSize:`${.9*R}rem`,background:"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",border:"none",borderRadius:6*R,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.transform="scale(1.05)",onMouseLeave:z=>z.currentTarget.style.transform="scale(1)",children:""}),a.jsx("button",{onClick:d,style:{flex:1,padding:`${.6*R}rem ${1*R}rem`,fontSize:`${.9*R}rem`,background:"#555",border:"none",borderRadius:6*R,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.background="#666",onMouseLeave:z=>z.currentTarget.style.background="#555",children:""})]}),a.jsx("p",{style:{fontSize:`${.75*R}rem`,color:"#888",textAlign:"center",lineHeight:1.4},children:""})]}):a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*R}rem`,color:"#4ade80",marginBottom:`${.5*R}rem`,fontWeight:"bold"},children:""}),a.jsxs("p",{style:{fontSize:`${.85*R}rem`,color:"#fff",marginBottom:`${.3*R}rem`},children:["ID: ",a.jsx("span",{style:{color:"#4a9eff",fontWeight:"bold"},children:l||""})]}),a.jsx("button",{onClick:mt,style:{width:"100%",padding:`${.6*R}rem ${1*R}rem`,fontSize:`${.9*R}rem`,background:"#d32f2f",border:"none",borderRadius:6*R,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s",marginTop:`${.5*R}rem`},onMouseEnter:z=>z.currentTarget.style.background="#b71c1c",onMouseLeave:z=>z.currentTarget.style.background="#d32f2f",children:""})]})]})]})]})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:70*R,background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:`${.5*R}rem`,padding:`0 ${1*R}rem`,zIndex:3},children:Fe.map(z=>a.jsx("button",{onClick:()=>v(z.id),style:{flex:1,maxWidth:140*R,padding:`${.6*R}rem ${.5*R}rem`,fontSize:`${.85*R}rem`,background:N===z.id?z.color:"transparent",border:N===z.id?"none":`2px solid ${z.color}`,borderRadius:8*R,color:N===z.id?"white":z.color,cursor:"pointer",transition:"all 0.2s",fontWeight:N===z.id?"bold":"normal"},children:z.label},z.id))}),a.jsx("p",{style:{position:"absolute",bottom:75*R,right:20*R,opacity:.5,fontSize:`${.7*R}rem`,zIndex:2},children:"Ver 1.04 Beta"}),H&&a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.7)",zIndex:100},children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*R,padding:`${2*R}rem`,minWidth:300*R,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{fontSize:`${1.2*R}rem`,marginBottom:`${1*R}rem`,color:"#fff",textAlign:"center"},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*R,marginTop:`${1.5*R}rem`},children:[a.jsx("button",{onClick:st,style:{flex:1,padding:`${.6*R}rem ${1*R}rem`,fontSize:`${.9*R}rem`,background:"#555",border:"none",borderRadius:6*R,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.background="#666",onMouseLeave:z=>z.currentTarget.style.background="#555",children:""}),a.jsx("button",{onClick:tt,style:{flex:1,padding:`${.6*R}rem ${1*R}rem`,fontSize:`${.9*R}rem`,background:"#d32f2f",border:"none",borderRadius:6*R,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.background="#b71c1c",onMouseLeave:z=>z.currentTarget.style.background="#d32f2f",children:""})]})]})})]})},j2=()=>{};var ev={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eb={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pe=function(t,e){if(!t)throw Xo(e)},Xo=function(t){return new Error("Firebase Database ("+eb.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tb=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},$2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Wg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,u=i>>2,h=(i&3)<<4|l>>4;let f=(l&15)<<2|d>>6,E=d&63;c||(E=64,o||(f=64)),r.push(n[u],n[h],n[f],n[E])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(tb(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):$2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||h==null)throw new F2;const f=i<<2|l>>4;if(r.push(f),d!==64){const E=l<<4&240|d>>2;if(r.push(E),h!==64){const k=d<<6&192|h;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class F2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const nb=function(t){const e=tb(t);return Wg.encodeByteArray(e,!0)},zd=function(t){return nb(t).replace(/\./g,"")},Hd=function(t){try{return Wg.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U2(t){return rb(void 0,t)}function rb(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!B2(n)||(t[n]=rb(t[n],e[n]));return t}function B2(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2=()=>z2().__FIREBASE_DEFAULTS__,W2=()=>{if(typeof process>"u"||typeof ev>"u")return;const t=ev.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},G2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Hd(t[1]);return e&&JSON.parse(e)},Gg=()=>{try{return j2()||H2()||W2()||G2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},sb=t=>{var e,n;return(n=(e=Gg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},V2=t=>{const e=sb(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},ib=()=>{var t;return(t=Gg())==null?void 0:t.config},ob=t=>{var e;return(e=Gg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ab(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[zd(JSON.stringify(n)),zd(JSON.stringify(o)),""].join(".")}const Va={};function K2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Va))Va[e]?t.emulator.push(e):t.prod.push(e);return t}function X2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let tv=!1;function lb(t,e){if(typeof window>"u"||typeof document>"u"||!Qo(window.location.host)||Va[t]===e||Va[t]||tv)return;Va[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=K2().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,E){f.setAttribute("width","24"),f.setAttribute("id",E),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function d(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{tv=!0,o()},f}function u(f,E){f.setAttribute("id",E),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=X2(r),E=n("text"),k=document.getElementById(E)||document.createElement("span"),T=n("learnmore"),N=document.getElementById(T)||document.createElement("a"),v=n("preprendIcon"),_=document.getElementById(v)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const S=f.element;l(S),u(N,T);const p=d();c(_,v),S.append(_,k,N,p),document.body.appendChild(S)}i?(k.innerText="Preview backend disconnected.",_.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(_.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",E)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Vg(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Tn())}function Q2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function J2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function cb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function q2(){const t=Tn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Z2(){return eb.NODE_ADMIN===!0}function eC(){try{return typeof indexedDB=="object"}catch{return!1}}function tC(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nC="FirebaseError";class ni extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=nC,Object.setPrototypeOf(this,ni.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Fl.prototype.create)}}class Fl{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?rC(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ni(s,l,r)}}function rC(t,e){return t.replace(sC,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const sC=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xl(t){return JSON.parse(t)}function Xt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const db=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=xl(Hd(i[0])||""),n=xl(Hd(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},iC=function(t){const e=db(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},oC=function(t){const e=db(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function br(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ci(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Wd(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Gd(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function ki(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(nv(i)&&nv(o)){if(!ki(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function nv(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jo(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Da(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ma(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let h=0;h<80;h++){h<40?h<20?(d=l^i&(o^l),u=1518500249):(d=i^o^l,u=1859775393):h<60?(d=i&o|l&(i|o),u=2400959708):(d=i^o^l,u=3395469782);const f=(s<<5|s>>>27)+d+c+u+r[h]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function lC(t,e){const n=new cC(t,e);return n.subscribe.bind(n)}class cC{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");dC(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=sh),s.error===void 0&&(s.error=sh),s.complete===void 0&&(s.complete=sh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function dC(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function sh(){}function $o(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,pe(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Pu=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(t){return t&&t._delegate?t._delegate:t}class Ri{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new fr;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pC(e))try{this.getOrInitializeService({instanceIdentifier:hi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=hi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=hi){return this.instances.has(e)}getOptions(e=hi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:hC(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=hi){return this.component?this.component.multipleInstances?e:hi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function hC(t){return t===hi?void 0:t}function pC(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new fC(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(wt||(wt={}));const mC={debug:wt.DEBUG,verbose:wt.VERBOSE,info:wt.INFO,warn:wt.WARN,error:wt.ERROR,silent:wt.SILENT},yC=wt.INFO,vC={[wt.DEBUG]:"log",[wt.VERBOSE]:"log",[wt.INFO]:"info",[wt.WARN]:"warn",[wt.ERROR]:"error"},_C=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=vC[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Yg{constructor(e){this.name=e,this._logLevel=yC,this._logHandler=_C,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in wt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?mC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,wt.DEBUG,...e),this._logHandler(this,wt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,wt.VERBOSE,...e),this._logHandler(this,wt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,wt.INFO,...e),this._logHandler(this,wt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,wt.WARN,...e),this._logHandler(this,wt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,wt.ERROR,...e),this._logHandler(this,wt.ERROR,...e)}}const xC=(t,e)=>e.some(n=>t instanceof n);let rv,sv;function bC(){return rv||(rv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function EC(){return sv||(sv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ub=new WeakMap,gp=new WeakMap,fb=new WeakMap,ih=new WeakMap,Kg=new WeakMap;function SC(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Us(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&ub.set(n,t)}).catch(()=>{}),Kg.set(e,t),e}function IC(t){if(gp.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});gp.set(t,e)}let mp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return gp.get(t);if(e==="objectStoreNames")return t.objectStoreNames||fb.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Us(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function wC(t){mp=t(mp)}function TC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(oh(this),e,...n);return fb.set(r,e.sort?e.sort():[e]),Us(r)}:EC().includes(t)?function(...e){return t.apply(oh(this),e),Us(ub.get(this))}:function(...e){return Us(t.apply(oh(this),e))}}function CC(t){return typeof t=="function"?TC(t):(t instanceof IDBTransaction&&IC(t),xC(t,bC())?new Proxy(t,mp):t)}function Us(t){if(t instanceof IDBRequest)return SC(t);if(ih.has(t))return ih.get(t);const e=CC(t);return e!==t&&(ih.set(t,e),Kg.set(e,t)),e}const oh=t=>Kg.get(t);function kC(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=Us(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Us(o.result),c.oldVersion,c.newVersion,Us(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const RC=["get","getKey","getAll","getAllKeys","count"],AC=["put","add","delete","clear"],ah=new Map;function iv(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(ah.get(e))return ah.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=AC.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||RC.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return ah.set(e,i),i}wC(t=>({...t,get:(e,n,r)=>iv(e,n)||t.get(e,n,r),has:(e,n)=>!!iv(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(OC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function OC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const yp="@firebase/app",ov="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ss=new Yg("@firebase/app"),LC="@firebase/app-compat",DC="@firebase/analytics-compat",MC="@firebase/analytics",NC="@firebase/app-check-compat",jC="@firebase/app-check",$C="@firebase/auth",FC="@firebase/auth-compat",UC="@firebase/database",BC="@firebase/data-connect",zC="@firebase/database-compat",HC="@firebase/functions",WC="@firebase/functions-compat",GC="@firebase/installations",VC="@firebase/installations-compat",YC="@firebase/messaging",KC="@firebase/messaging-compat",XC="@firebase/performance",QC="@firebase/performance-compat",JC="@firebase/remote-config",qC="@firebase/remote-config-compat",ZC="@firebase/storage",ek="@firebase/storage-compat",tk="@firebase/firestore",nk="@firebase/ai",rk="@firebase/firestore-compat",sk="firebase",ik="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vp="[DEFAULT]",ok={[yp]:"fire-core",[LC]:"fire-core-compat",[MC]:"fire-analytics",[DC]:"fire-analytics-compat",[jC]:"fire-app-check",[NC]:"fire-app-check-compat",[$C]:"fire-auth",[FC]:"fire-auth-compat",[UC]:"fire-rtdb",[BC]:"fire-data-connect",[zC]:"fire-rtdb-compat",[HC]:"fire-fn",[WC]:"fire-fn-compat",[GC]:"fire-iid",[VC]:"fire-iid-compat",[YC]:"fire-fcm",[KC]:"fire-fcm-compat",[XC]:"fire-perf",[QC]:"fire-perf-compat",[JC]:"fire-rc",[qC]:"fire-rc-compat",[ZC]:"fire-gcs",[ek]:"fire-gcs-compat",[tk]:"fire-fst",[rk]:"fire-fst-compat",[nk]:"fire-vertex","fire-js":"fire-js",[sk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vd=new Map,ak=new Map,_p=new Map;function av(t,e){try{t.container.addComponent(e)}catch(n){ss.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Fo(t){const e=t.name;if(_p.has(e))return ss.debug(`There were multiple attempts to register component ${e}.`),!1;_p.set(e,t);for(const n of Vd.values())av(n,t);for(const n of ak.values())av(n,t);return!0}function Xg(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function qn(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Bs=new Fl("app","Firebase",lk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ri("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Bs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qo=ik;function hb(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:vp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Bs.create("bad-app-name",{appName:String(s)});if(n||(n=ib()),!n)throw Bs.create("no-options");const i=Vd.get(s);if(i){if(ki(n,i.options)&&ki(r,i.config))return i;throw Bs.create("duplicate-app",{appName:s})}const o=new gC(s);for(const c of _p.values())o.addComponent(c);const l=new ck(n,r,o);return Vd.set(s,l),l}function pb(t=vp){const e=Vd.get(t);if(!e&&t===vp&&ib())return hb();if(!e)throw Bs.create("no-app",{appName:t});return e}function zs(t,e,n){let r=ok[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ss.warn(o.join(" "));return}Fo(new Ri(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk="firebase-heartbeat-database",uk=1,bl="firebase-heartbeat-store";let lh=null;function gb(){return lh||(lh=kC(dk,uk,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(bl)}catch(n){console.warn(n)}}}}).catch(t=>{throw Bs.create("idb-open",{originalErrorMessage:t.message})})),lh}async function fk(t){try{const n=(await gb()).transaction(bl),r=await n.objectStore(bl).get(mb(t));return await n.done,r}catch(e){if(e instanceof ni)ss.warn(e.message);else{const n=Bs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ss.warn(n.message)}}}async function lv(t,e){try{const r=(await gb()).transaction(bl,"readwrite");await r.objectStore(bl).put(e,mb(t)),await r.done}catch(n){if(n instanceof ni)ss.warn(n.message);else{const r=Bs.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ss.warn(r.message)}}}function mb(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk=1024,pk=30;class gk{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new yk(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=cv();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>pk){const o=vk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ss.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=cv(),{heartbeatsToSend:r,unsentEntries:s}=mk(this._heartbeatsCache.heartbeats),i=zd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ss.warn(n),""}}}function cv(){return new Date().toISOString().substring(0,10)}function mk(t,e=hk){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),dv(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),dv(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class yk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return eC()?tC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await fk(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function dv(t){return zd(JSON.stringify({version:2,heartbeats:t})).length}function vk(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _k(t){Fo(new Ri("platform-logger",e=>new PC(e),"PRIVATE")),Fo(new Ri("heartbeat",e=>new gk(e),"PRIVATE")),zs(yp,ov,t),zs(yp,ov,"esm2020"),zs("fire-js","")}_k("");var xk="firebase",bk="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zs(xk,bk,"app");var uv={};const fv="@firebase/database",hv="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yb="";function Ek(t){yb=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Xt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:xl(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return br(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vb=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Sk(e)}}catch{}return new Ik},_i=vb("localStorage"),wk=vb("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Io=new Yg("@firebase/database"),_b=function(){let t=1;return function(){return t++}}(),xb=function(t){const e=uC(t),n=new aC;n.update(e);const r=n.digest();return Wg.encodeByteArray(r)},Ul=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Ul.apply(null,r):typeof r=="object"?e+=Xt(r):e+=r,e+=" "}return e};let Ya=null,pv=!0;const Tk=function(t,e){pe(!0,"Can't turn on custom loggers persistently."),Io.logLevel=wt.VERBOSE,Ya=Io.log.bind(Io)},tn=function(...t){if(pv===!0&&(pv=!1,Ya===null&&wk.get("logging_enabled")===!0&&Tk()),Ya){const e=Ul.apply(null,t);Ya(e)}},Bl=function(t){return function(...e){tn(t,...e)}},xp=function(...t){const e="FIREBASE INTERNAL ERROR: "+Ul(...t);Io.error(e)},is=function(...t){const e=`FIREBASE FATAL ERROR: ${Ul(...t)}`;throw Io.error(e),new Error(e)},wn=function(...t){const e="FIREBASE WARNING: "+Ul(...t);Io.warn(e)},Ck=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&wn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ou=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},kk=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Uo="[MIN_NAME]",Ai="[MAX_NAME]",Ni=function(t,e){if(t===e)return 0;if(t===Uo||e===Ai)return-1;if(e===Uo||t===Ai)return 1;{const n=gv(t),r=gv(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},Rk=function(t,e){return t===e?0:t<e?-1:1},wa=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Xt(e))},Qg=function(t){if(typeof t!="object"||t===null)return Xt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Xt(e[r]),n+=":",n+=Qg(t[e[r]]);return n+="}",n},bb=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function rn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Eb=function(t){pe(!Ou(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,l,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=l+r,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const d=[];for(c=n;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(s?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(u.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},Ak=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Pk=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Ok(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const Lk=new RegExp("^-?(0*)\\d{1,10}$"),Dk=-2147483648,Mk=2147483647,gv=function(t){if(Lk.test(t)){const e=Number(t);if(e>=Dk&&e<=Mk)return e}return null},Zo=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw wn("Exception was thrown by user callback.",n),e},Math.floor(0))}},Nk=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ka=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,qn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){wn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(tn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',wn(e)}}class od{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}od.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jg="5",Sb="v",Ib="s",wb="r",Tb="f",Cb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,kb="ls",Rb="p",bp="ac",Ab="websocket",Pb="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob{constructor(e,n,r,s,i=!1,o="",l=!1,c=!1,d=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=_i.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&_i.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function Fk(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Lb(t,e,n){pe(typeof e=="string","typeof type must == string"),pe(typeof n=="object","typeof params must == object");let r;if(e===Ab)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Pb)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Fk(t)&&(n.ns=t.namespace);const s=[];return rn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(){this.counters_={}}incrementCounter(e,n=1){br(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return U2(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch={},dh={};function qg(t){const e=t.toString();return ch[e]||(ch[e]=new Uk),ch[e]}function Bk(t,e){const n=t.toString();return dh[n]||(dh[n]=e()),dh[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Zo(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv="start",Hk="close",Wk="pLPCommand",Gk="pRTLPCB",Db="id",Mb="pw",Nb="ser",Vk="cb",Yk="seg",Kk="ts",Xk="d",Qk="dframe",jb=1870,$b=30,Jk=jb-$b,qk=25e3,Zk=3e4;class mo{constructor(e,n,r,s,i,o,l){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Bl(e),this.stats_=qg(n),this.urlFn=c=>(this.appCheckToken&&(c[bp]=this.appCheckToken),Lb(n,Pb,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new zk(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Zk)),kk(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Zg((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===mv)this.id=l,this.password=c;else if(o===Hk)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[mv]="t",r[Nb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Vk]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Sb]=Jg,this.transportSessionId&&(r[Ib]=this.transportSessionId),this.lastSessionId&&(r[kb]=this.lastSessionId),this.applicationId&&(r[Rb]=this.applicationId),this.appCheckToken&&(r[bp]=this.appCheckToken),typeof location<"u"&&location.hostname&&Cb.test(location.hostname)&&(r[wb]=Tb);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){mo.forceAllow_=!0}static forceDisallow(){mo.forceDisallow_=!0}static isAvailable(){return mo.forceAllow_?!0:!mo.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Ak()&&!Pk()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Xt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=nb(n),s=bb(r,Jk);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[Qk]="t",r[Db]=e,r[Mb]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Xt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Zg{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=_b(),window[Wk+this.uniqueCallbackIdentifier]=e,window[Gk+this.uniqueCallbackIdentifier]=n,this.myIFrame=Zg.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){tn("frame writing exception"),l.stack&&tn(l.stack),tn(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||tn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Db]=this.myID,e[Mb]=this.myPW,e[Nb]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+$b+r.length<=jb;){const o=this.pendingSegs.shift();r=r+"&"+Yk+s+"="+o.seg+"&"+Kk+s+"="+o.ts+"&"+Xk+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(qk)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{tn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e5=16384,t5=45e3;let Yd=null;typeof MozWebSocket<"u"?Yd=MozWebSocket:typeof WebSocket<"u"&&(Yd=WebSocket);class hr{constructor(e,n,r,s,i,o,l){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Bl(this.connId),this.stats_=qg(n),this.connURL=hr.connectionURL_(n,o,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[Sb]=Jg,typeof location<"u"&&location.hostname&&Cb.test(location.hostname)&&(o[wb]=Tb),n&&(o[Ib]=n),r&&(o[kb]=r),s&&(o[bp]=s),i&&(o[Rb]=i),Lb(e,Ab,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,_i.set("previous_websocket_failure",!0);try{let r;Z2(),this.mySock=new Yd(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){hr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Yd!==null&&!hr.forceDisallow_}static previouslyFailed(){return _i.isInMemoryStorage||_i.get("previous_websocket_failure")===!0}markConnectionHealthy(){_i.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=xl(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(pe(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Xt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=bb(n,e5);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(t5))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}hr.responsesRequiredToBeHealthy=2;hr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class El{static get ALL_TRANSPORTS(){return[mo,hr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=hr&&hr.isAvailable();let r=n&&!hr.previouslyFailed();if(e.webSocketOnly&&(n||wn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[hr];else{const s=this.transports_=[];for(const i of El.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);El.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}El.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n5=6e4,r5=5e3,s5=10*1024,i5=100*1024,uh="t",yv="d",o5="s",vv="r",a5="e",_v="o",xv="a",bv="n",Ev="p",l5="h";class c5{constructor(e,n,r,s,i,o,l,c,d,u){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Bl("c:"+this.id+":"),this.transportManager_=new El(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Ka(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>i5?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>s5?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(uh in e){const n=e[uh];n===xv?this.upgradeIfSecondaryHealthy_():n===vv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===_v&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=wa("t",e),r=wa("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Ev,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:xv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:bv,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=wa("t",e),r=wa("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=wa(uh,e);if(yv in e){const r=e[yv];if(n===l5){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===bv){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===o5?this.onConnectionShutdown_(r):n===vv?this.onReset_(r):n===a5?xp("Server Error: "+r):n===_v?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):xp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Jg!==r&&wn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Ka(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(n5))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ka(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(r5))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Ev,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(_i.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ub{constructor(e){this.allowedEvents_=e,this.listeners_={},pe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){pe(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd extends Ub{static getInstance(){return new Kd}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Vg()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return pe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sv=32,Iv=768;class St{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function gt(){return new St("")}function ot(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ks(t){return t.pieces_.length-t.pieceNum_}function Ct(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new St(t.pieces_,e)}function e0(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function d5(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Sl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Bb(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new St(e,0)}function Ft(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof St)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new St(n,0)}function lt(t){return t.pieceNum_>=t.pieces_.length}function Sn(t,e){const n=ot(t),r=ot(e);if(n===null)return e;if(n===r)return Sn(Ct(t),Ct(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function u5(t,e){const n=Sl(t,0),r=Sl(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=Ni(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function t0(t,e){if(Ks(t)!==Ks(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function er(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Ks(t)>Ks(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class f5{constructor(e,n){this.errorPrefix_=n,this.parts_=Sl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Pu(this.parts_[r]);zb(this)}}function h5(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Pu(e),zb(t)}function p5(t){const e=t.parts_.pop();t.byteLength_-=Pu(e),t.parts_.length>0&&(t.byteLength_-=1)}function zb(t){if(t.byteLength_>Iv)throw new Error(t.errorPrefix_+"has a key path longer than "+Iv+" bytes ("+t.byteLength_+").");if(t.parts_.length>Sv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Sv+") or object contains a cycle "+pi(t))}function pi(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0 extends Ub{static getInstance(){return new n0}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return pe(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ta=1e3,g5=60*5*1e3,wv=30*1e3,m5=1.3,y5=3e4,v5="server_kill",Tv=3;class qr extends Fb{constructor(e,n,r,s,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=qr.nextPersistentConnectionId_++,this.log_=Bl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ta,this.maxReconnectDelay_=g5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");n0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Kd.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Xt(i)),pe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new fr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),pe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),pe(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;qr.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&br(e,"w")){const r=Ci(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();wn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||oC(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=wv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=iC(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),pe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Xt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):xp("Unrecognized action received from server: "+Xt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){pe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ta,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ta,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>y5&&(this.reconnectDelay_=Ta),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*m5)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+qr.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,r())},d=function(h){pe(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?tn("getToken() completed but was canceled"):(tn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new c5(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,E=>{wn(E+" ("+this.repoInfo_.toString()+")"),this.interrupt(v5)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&wn(h),c())}}}interrupt(e){tn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){tn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Wd(this.interruptReasons_)&&(this.reconnectDelay_=Ta,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>Qg(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new St(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){tn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Tv&&(this.reconnectDelay_=wv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){tn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Tv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+yb.replace(/\./g,"-")]=1,Vg()?e["framework.cordova"]=1:cb()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Kd.getInstance().currentlyOnline();return Wd(this.interruptReasons_)&&e}}qr.nextPersistentConnectionId_=0;qr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new ct(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new ct(Uo,e),s=new ct(Uo,n);return this.compare(r,s)!==0}minPost(){return ct.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fc;class Hb extends Lu{static get __EMPTY_NODE(){return Fc}static set __EMPTY_NODE(e){Fc=e}compare(e,n){return Ni(e.name,n.name)}isDefinedOn(e){throw Xo("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return ct.MIN}maxPost(){return new ct(Ai,Fc)}makePost(e,n){return pe(typeof e=="string","KeyIndex indexValue must always be a string."),new ct(e,Fc)}toString(){return".key"}}const wo=new Hb;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class en{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??en.RED,this.left=s??Dn.EMPTY_NODE,this.right=i??Dn.EMPTY_NODE}copy(e,n,r,s,i){return new en(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Dn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Dn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,en.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,en.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}en.RED=!0;en.BLACK=!1;class _5{copy(e,n,r,s,i){return this}insert(e,n,r){return new en(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Dn{constructor(e,n=Dn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Dn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,en.BLACK,null,null))}remove(e){return new Dn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,en.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Uc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Uc(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Uc(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Uc(this.root_,null,this.comparator_,!0,e)}}Dn.EMPTY_NODE=new _5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x5(t,e){return Ni(t.name,e.name)}function r0(t,e){return Ni(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ep;function b5(t){Ep=t}const Wb=function(t){return typeof t=="number"?"number:"+Eb(t):"string:"+t},Gb=function(t){if(t.isLeafNode()){const e=t.val();pe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&br(e,".sv"),"Priority must be a string or number.")}else pe(t===Ep||t.isEmpty(),"priority of unexpected type.");pe(t===Ep||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cv;class qt{static set __childrenNodeConstructor(e){Cv=e}static get __childrenNodeConstructor(){return Cv}constructor(e,n=qt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,pe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Gb(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new qt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:qt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return lt(e)?this:ot(e)===".priority"?this.priorityNode_:qt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:qt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=ot(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(pe(r!==".priority"||Ks(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,qt.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ct(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Wb(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Eb(this.value_):e+=this.value_,this.lazyHash_=xb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===qt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof qt.__childrenNodeConstructor?-1:(pe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=qt.VALUE_TYPE_ORDER.indexOf(n),i=qt.VALUE_TYPE_ORDER.indexOf(r);return pe(s>=0,"Unknown leaf type: "+n),pe(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}qt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vb,Yb;function E5(t){Vb=t}function S5(t){Yb=t}class I5 extends Lu{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?Ni(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return ct.MIN}maxPost(){return new ct(Ai,new qt("[PRIORITY-POST]",Yb))}makePost(e,n){const r=Vb(e);return new ct(n,new qt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Nt=new I5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w5=Math.log(2);class T5{constructor(e){const n=i=>parseInt(Math.log(i)/w5,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Xd=function(t,e,n,r){t.sort(e);const s=function(c,d){const u=d-c;let h,f;if(u===0)return null;if(u===1)return h=t[c],f=n?n(h):h,new en(f,h.node,en.BLACK,null,null);{const E=parseInt(u/2,10)+c,k=s(c,E),T=s(E+1,d);return h=t[E],f=n?n(h):h,new en(f,h.node,en.BLACK,k,T)}},i=function(c){let d=null,u=null,h=t.length;const f=function(k,T){const N=h-k,v=h;h-=k;const _=s(N+1,v),S=t[N],p=n?n(S):S;E(new en(p,S.node,T,null,_))},E=function(k){d?(d.left=k,d=k):(u=k,d=k)};for(let k=0;k<c.count;++k){const T=c.nextBitIsOne(),N=Math.pow(2,c.count-(k+1));T?f(N,en.BLACK):(f(N,en.BLACK),f(N,en.RED))}return u},o=new T5(t.length),l=i(o);return new Dn(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fh;const eo={};class Kr{static get Default(){return pe(eo&&Nt,"ChildrenNode.ts has not been loaded"),fh=fh||new Kr({".priority":eo},{".priority":Nt}),fh}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Ci(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Dn?n:null}hasIndex(e){return br(this.indexSet_,e.toString())}addIndex(e,n){pe(e!==wo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(ct.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let l;s?l=Xd(r,e.getCompare()):l=eo;const c=e.toString(),d={...this.indexSet_};d[c]=e;const u={...this.indexes_};return u[c]=l,new Kr(u,d)}addToIndexes(e,n){const r=Gd(this.indexes_,(s,i)=>{const o=Ci(this.indexSet_,i);if(pe(o,"Missing index implementation for "+i),s===eo)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(ct.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),Xd(l,o.getCompare())}else return eo;else{const l=n.get(e.name);let c=s;return l&&(c=c.remove(new ct(e.name,l))),c.insert(e,e.node)}});return new Kr(r,this.indexSet_)}removeFromIndexes(e,n){const r=Gd(this.indexes_,s=>{if(s===eo)return s;{const i=n.get(e.name);return i?s.remove(new ct(e.name,i)):s}});return new Kr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ca;class He{static get EMPTY_NODE(){return Ca||(Ca=new He(new Dn(r0),null,Kr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Gb(this.priorityNode_),this.children_.isEmpty()&&pe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ca}updatePriority(e){return this.children_.isEmpty()?this:new He(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Ca:n}}getChild(e){const n=ot(e);return n===null?this:this.getImmediateChild(n).getChild(Ct(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(pe(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new ct(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Ca:this.priorityNode_;return new He(s,o,i)}}updateChild(e,n){const r=ot(e);if(r===null)return n;{pe(ot(e)!==".priority"||Ks(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Ct(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Nt,(o,l)=>{n[o]=l.val(e),r++,i&&He.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Wb(this.getPriority().val())+":"),this.forEachChild(Nt,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":xb(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new ct(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new ct(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new ct(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,ct.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,ct.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===zl?-1:0}withIndex(e){if(e===wo||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new He(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===wo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Nt),s=n.getIterator(Nt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===wo?null:this.indexMap_.get(e.toString())}}He.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class C5 extends He{constructor(){super(new Dn(r0),He.EMPTY_NODE,Kr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return He.EMPTY_NODE}isEmpty(){return!1}}const zl=new C5;Object.defineProperties(ct,{MIN:{value:new ct(Uo,He.EMPTY_NODE)},MAX:{value:new ct(Ai,zl)}});Hb.__EMPTY_NODE=He.EMPTY_NODE;qt.__childrenNodeConstructor=He;b5(zl);S5(zl);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k5=!0;function $t(t,e=null){if(t===null)return He.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),pe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new qt(n,$t(e))}if(!(t instanceof Array)&&k5){const n=[];let r=!1;if(rn(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=$t(l);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new ct(o,c)))}}),n.length===0)return He.EMPTY_NODE;const i=Xd(n,x5,o=>o.name,r0);if(r){const o=Xd(n,Nt.getCompare());return new He(i,$t(e),new Kr({".priority":o},{".priority":Nt}))}else return new He(i,$t(e),Kr.Default)}else{let n=He.EMPTY_NODE;return rn(t,(r,s)=>{if(br(t,r)&&r.substring(0,1)!=="."){const i=$t(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority($t(e))}}E5($t);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5 extends Lu{constructor(e){super(),this.indexPath_=e,pe(!lt(e)&&ot(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?Ni(e.name,n.name):i}makePost(e,n){const r=$t(e),s=He.EMPTY_NODE.updateChild(this.indexPath_,r);return new ct(n,s)}maxPost(){const e=He.EMPTY_NODE.updateChild(this.indexPath_,zl);return new ct(Ai,e)}toString(){return Sl(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5 extends Lu{compare(e,n){const r=e.node.compareTo(n.node);return r===0?Ni(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return ct.MIN}maxPost(){return ct.MAX}makePost(e,n){const r=$t(e);return new ct(n,r)}toString(){return".value"}}const P5=new A5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(t){return{type:"value",snapshotNode:t}}function Bo(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Il(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function wl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function O5(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){pe(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(Il(n,l)):pe(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Bo(n,r)):o.trackChildChange(wl(n,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Nt,(s,i)=>{n.hasChild(s)||r.trackChildChange(Il(s,i))}),n.isLeafNode()||n.forEachChild(Nt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(wl(s,i,o))}else r.trackChildChange(Bo(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?He.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl{constructor(e){this.indexedFilter_=new s0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Tl.getStartPost_(e),this.endPost_=Tl.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new ct(n,r))||(r=He.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=He.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(He.EMPTY_NODE);const i=this;return n.forEachChild(Nt,(o,l)=>{i.matches(new ct(o,l))||(s=s.updateImmediateChild(o,He.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Tl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new ct(n,r))||(r=He.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=He.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=He.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(He.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,He.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,E)=>h(E,f)}else o=this.index_.getCompare();const l=e;pe(l.numChildren()===this.limit_,"");const c=new ct(n,r),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(n)){const h=l.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,d,this.reverse_);for(;f!=null&&(f.name===n||l.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const E=f==null?1:o(f,c);if(u&&!r.isEmpty()&&E>=0)return i!=null&&i.trackChildChange(wl(n,r,h)),l.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(Il(n,h));const T=l.updateImmediateChild(n,He.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(Bo(f.name,f.node)),T.updateImmediateChild(f.name,f.node)):T}}else return r.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(Il(d.name,d.node)),i.trackChildChange(Bo(n,r))),l.updateImmediateChild(n,r).updateImmediateChild(d.name,He.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Nt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return pe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return pe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Uo}hasEnd(){return this.endSet_}getIndexEndValue(){return pe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return pe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ai}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return pe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Nt}copy(){const e=new i0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function D5(t){return t.loadsAllData()?new s0(t.getIndex()):t.hasLimit()?new L5(t):new Tl(t)}function kv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Nt?n="$priority":t.index_===P5?n="$value":t.index_===wo?n="$key":(pe(t.index_ instanceof R5,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Xt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Xt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Xt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Xt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Xt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Rv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Nt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd extends Fb{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(pe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Bl("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Qd.getListenId_(e,r),l={};this.listens_[o]=l;const c=kv(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(i,h,!1,r),Ci(this.listens_,o)===l){let f;d?d===401?f="permission_denied":f="rest_error:"+d:f="ok",s(f,null)}})}unlisten(e,n){const r=Qd.getListenId_(e,n);delete this.listens_[r]}get(e){const n=kv(e._queryParams),r=e._path.toString(),s=new fr;return this.restRequest_(r+".json",n,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Jo(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=xl(l.responseText)}catch{wn("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,c)}else l.status!==401&&l.status!==404&&wn("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(){this.rootNode_=He.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jd(){return{value:null,children:new Map}}function ea(t,e,n){if(lt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=ot(e);t.children.has(r)||t.children.set(r,Jd());const s=t.children.get(r);e=Ct(e),ea(s,e,n)}}function Sp(t,e){if(lt(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Nt,(r,s)=>{ea(t,new St(r),s)}),Sp(t,e)}}else if(t.children.size>0){const n=ot(e);return e=Ct(e),t.children.has(n)&&Sp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Ip(t,e,n){t.value!==null?n(e,t.value):N5(t,(r,s)=>{const i=new St(e.toString()+"/"+r);Ip(s,i,n)})}function N5(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j5{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&rn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Av=10*1e3,$5=30*1e3,F5=5*60*1e3;class U5{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new j5(e);const r=Av+($5-Av)*Math.random();Ka(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;rn(e,(s,i)=>{i>0&&br(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),Ka(this.reportStats_.bind(this),Math.floor(Math.random()*2*F5))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(pr||(pr={}));function o0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function a0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function l0(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qd{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=pr.ACK_USER_WRITE,this.source=o0()}operationForChild(e){if(lt(this.path)){if(this.affectedTree.value!=null)return pe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new St(e));return new qd(gt(),n,this.revert)}}else return pe(ot(this.path)===e,"operationForChild called for unrelated child."),new qd(Ct(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{constructor(e,n){this.source=e,this.path=n,this.type=pr.LISTEN_COMPLETE}operationForChild(e){return lt(this.path)?new Cl(this.source,gt()):new Cl(this.source,Ct(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=pr.OVERWRITE}operationForChild(e){return lt(this.path)?new Pi(this.source,gt(),this.snap.getImmediateChild(e)):new Pi(this.source,Ct(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=pr.MERGE}operationForChild(e){if(lt(this.path)){const n=this.children.subtree(new St(e));return n.isEmpty()?null:n.value?new Pi(this.source,gt(),n.value):new zo(this.source,gt(),n)}else return pe(ot(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new zo(this.source,Ct(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(lt(e))return this.isFullyInitialized()&&!this.filtered_;const n=ot(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function z5(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(O5(o.childName,o.snapshotNode))}),ka(t,s,"child_removed",e,r,n),ka(t,s,"child_added",e,r,n),ka(t,s,"child_moved",i,r,n),ka(t,s,"child_changed",e,r,n),ka(t,s,"value",e,r,n),s}function ka(t,e,n,r,s,i){const o=r.filter(l=>l.type===n);o.sort((l,c)=>W5(t,l,c)),o.forEach(l=>{const c=H5(t,l,i);s.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function H5(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function W5(t,e,n){if(e.childName==null||n.childName==null)throw Xo("Should only compare child_ events.");const r=new ct(e.childName,e.snapshotNode),s=new ct(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Du(t,e){return{eventCache:t,serverCache:e}}function Xa(t,e,n,r){return Du(new Xs(e,n,r),t.serverCache)}function Xb(t,e,n,r){return Du(t.eventCache,new Xs(e,n,r))}function Zd(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Oi(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hh;const G5=()=>(hh||(hh=new Dn(Rk)),hh);class At{static fromObject(e){let n=new At(null);return rn(e,(r,s)=>{n=n.set(new St(r),s)}),n}constructor(e,n=G5()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:gt(),value:this.value};if(lt(e))return null;{const r=ot(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Ct(e),n);return i!=null?{path:Ft(new St(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(lt(e))return this;{const n=ot(e),r=this.children.get(n);return r!==null?r.subtree(Ct(e)):new At(null)}}set(e,n){if(lt(e))return new At(n,this.children);{const r=ot(e),i=(this.children.get(r)||new At(null)).set(Ct(e),n),o=this.children.insert(r,i);return new At(this.value,o)}}remove(e){if(lt(e))return this.children.isEmpty()?new At(null):new At(null,this.children);{const n=ot(e),r=this.children.get(n);if(r){const s=r.remove(Ct(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new At(null):new At(this.value,i)}else return this}}get(e){if(lt(e))return this.value;{const n=ot(e),r=this.children.get(n);return r?r.get(Ct(e)):null}}setTree(e,n){if(lt(e))return n;{const r=ot(e),i=(this.children.get(r)||new At(null)).setTree(Ct(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new At(this.value,o)}}fold(e){return this.fold_(gt(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Ft(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,gt(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(lt(e))return null;{const i=ot(e),o=this.children.get(i);return o?o.findOnPath_(Ct(e),Ft(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,gt(),n)}foreachOnPath_(e,n,r){if(lt(e))return this;{this.value&&r(n,this.value);const s=ot(e),i=this.children.get(s);return i?i.foreachOnPath_(Ct(e),Ft(n,s),r):new At(null)}}foreach(e){this.foreach_(gt(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_(Ft(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e){this.writeTree_=e}static empty(){return new vr(new At(null))}}function Qa(t,e,n){if(lt(e))return new vr(new At(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Sn(s,e);return i=i.updateChild(o,n),new vr(t.writeTree_.set(s,i))}else{const s=new At(n),i=t.writeTree_.setTree(e,s);return new vr(i)}}}function wp(t,e,n){let r=t;return rn(n,(s,i)=>{r=Qa(r,Ft(e,s),i)}),r}function Pv(t,e){if(lt(e))return vr.empty();{const n=t.writeTree_.setTree(e,new At(null));return new vr(n)}}function Tp(t,e){return ji(t,e)!=null}function ji(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Sn(n.path,e)):null}function Ov(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Nt,(r,s)=>{e.push(new ct(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new ct(r,s.value))}),e}function Hs(t,e){if(lt(e))return t;{const n=ji(t,e);return n!=null?new vr(new At(n)):new vr(t.writeTree_.subtree(e))}}function Cp(t){return t.writeTree_.isEmpty()}function Ho(t,e){return Qb(gt(),t.writeTree_,e)}function Qb(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(pe(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=Qb(Ft(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(Ft(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(t,e){return eE(e,t)}function V5(t,e,n,r,s){pe(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=Qa(t.visibleWrites,e,n)),t.lastWriteId=r}function Y5(t,e,n,r){pe(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=wp(t.visibleWrites,e,n),t.lastWriteId=r}function K5(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function X5(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);pe(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&Q5(l,r.path)?s=!1:er(r.path,l.path)&&(i=!0)),o--}if(s){if(i)return J5(t),!0;if(r.snap)t.visibleWrites=Pv(t.visibleWrites,r.path);else{const l=r.children;rn(l,c=>{t.visibleWrites=Pv(t.visibleWrites,Ft(r.path,c))})}return!0}else return!1}function Q5(t,e){if(t.snap)return er(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&er(Ft(t.path,n),e))return!0;return!1}function J5(t){t.visibleWrites=Jb(t.allWrites,q5,gt()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function q5(t){return t.visible}function Jb(t,e,n){let r=vr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let l;if(i.snap)er(n,o)?(l=Sn(n,o),r=Qa(r,l,i.snap)):er(o,n)&&(l=Sn(o,n),r=Qa(r,gt(),i.snap.getChild(l)));else if(i.children){if(er(n,o))l=Sn(n,o),r=wp(r,l,i.children);else if(er(o,n))if(l=Sn(o,n),lt(l))r=wp(r,gt(),i.children);else{const c=Ci(i.children,ot(l));if(c){const d=c.getChild(Ct(l));r=Qa(r,gt(),d)}}}else throw Xo("WriteRecord should have .snap or .children")}}return r}function qb(t,e,n,r,s){if(!r&&!s){const i=ji(t.visibleWrites,e);if(i!=null)return i;{const o=Hs(t.visibleWrites,e);if(Cp(o))return n;if(n==null&&!Tp(o,gt()))return null;{const l=n||He.EMPTY_NODE;return Ho(o,l)}}}else{const i=Hs(t.visibleWrites,e);if(!s&&Cp(i))return n;if(!s&&n==null&&!Tp(i,gt()))return null;{const o=function(d){return(d.visible||s)&&(!r||!~r.indexOf(d.writeId))&&(er(d.path,e)||er(e,d.path))},l=Jb(t.allWrites,o,e),c=n||He.EMPTY_NODE;return Ho(l,c)}}}function Z5(t,e,n){let r=He.EMPTY_NODE;const s=ji(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Nt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=Hs(t.visibleWrites,e);return n.forEachChild(Nt,(o,l)=>{const c=Ho(Hs(i,new St(o)),l);r=r.updateImmediateChild(o,c)}),Ov(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=Hs(t.visibleWrites,e);return Ov(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function eR(t,e,n,r,s){pe(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Ft(e,n);if(Tp(t.visibleWrites,i))return null;{const o=Hs(t.visibleWrites,i);return Cp(o)?s.getChild(n):Ho(o,s.getChild(n))}}function tR(t,e,n,r){const s=Ft(e,n),i=ji(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=Hs(t.visibleWrites,s);return Ho(o,r.getNode().getImmediateChild(n))}else return null}function nR(t,e){return ji(t.visibleWrites,e)}function rR(t,e,n,r,s,i,o){let l;const c=Hs(t.visibleWrites,e),d=ji(c,gt());if(d!=null)l=d;else if(n!=null)l=Ho(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),f=i?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o);let E=f.getNext();for(;E&&u.length<s;)h(E,r)!==0&&u.push(E),E=f.getNext();return u}else return[]}function sR(){return{visibleWrites:vr.empty(),allWrites:[],lastWriteId:-1}}function eu(t,e,n,r){return qb(t.writeTree,t.treePath,e,n,r)}function c0(t,e){return Z5(t.writeTree,t.treePath,e)}function Lv(t,e,n,r){return eR(t.writeTree,t.treePath,e,n,r)}function tu(t,e){return nR(t.writeTree,Ft(t.treePath,e))}function iR(t,e,n,r,s,i){return rR(t.writeTree,t.treePath,e,n,r,s,i)}function d0(t,e,n){return tR(t.writeTree,t.treePath,e,n)}function Zb(t,e){return eE(Ft(t.treePath,e),t.writeTree)}function eE(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;pe(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),pe(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,wl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,Il(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,Bo(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,wl(r,e.snapshotNode,s.oldSnap));else throw Xo("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const tE=new aR;class u0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Xs(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return d0(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Oi(this.viewCache_),i=iR(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lR(t){return{filter:t}}function cR(t,e){pe(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),pe(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function dR(t,e,n,r,s){const i=new oR;let o,l;if(n.type===pr.OVERWRITE){const d=n;d.source.fromUser?o=kp(t,e,d.path,d.snap,r,s,i):(pe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!lt(d.path),o=nu(t,e,d.path,d.snap,r,s,l,i))}else if(n.type===pr.MERGE){const d=n;d.source.fromUser?o=fR(t,e,d.path,d.children,r,s,i):(pe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=Rp(t,e,d.path,d.children,r,s,l,i))}else if(n.type===pr.ACK_USER_WRITE){const d=n;d.revert?o=gR(t,e,d.path,r,s,i):o=hR(t,e,d.path,d.affectedTree,r,s,i)}else if(n.type===pr.LISTEN_COMPLETE)o=pR(t,e,n.path,r,i);else throw Xo("Unknown operation type: "+n.type);const c=i.getChanges();return uR(e,o,c),{viewCache:o,changes:c}}function uR(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Zd(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(Kb(Zd(e)))}}function nE(t,e,n,r,s,i){const o=e.eventCache;if(tu(r,n)!=null)return e;{let l,c;if(lt(n))if(pe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Oi(e),u=d instanceof He?d:He.EMPTY_NODE,h=c0(r,u);l=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const d=eu(r,Oi(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=ot(n);if(d===".priority"){pe(Ks(n)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=Lv(r,n,u,c);h!=null?l=t.filter.updatePriority(u,h):l=o.getNode()}else{const u=Ct(n);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const f=Lv(r,n,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(d).updateChild(u,f):h=o.getNode().getImmediateChild(d)}else h=d0(r,d,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),d,h,u,s,i):l=o.getNode()}}return Xa(e,l,o.isFullyInitialized()||lt(n),t.filter.filtersNodes())}}function nu(t,e,n,r,s,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if(lt(n))d=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const E=c.getNode().updateChild(n,r);d=u.updateFullNode(c.getNode(),E,null)}else{const E=ot(n);if(!c.isCompleteForPath(n)&&Ks(n)>1)return e;const k=Ct(n),N=c.getNode().getImmediateChild(E).updateChild(k,r);E===".priority"?d=u.updatePriority(c.getNode(),N):d=u.updateChild(c.getNode(),E,N,k,tE,null)}const h=Xb(e,d,c.isFullyInitialized()||lt(n),u.filtersNodes()),f=new u0(s,h,i);return nE(t,h,n,s,f,l)}function kp(t,e,n,r,s,i,o){const l=e.eventCache;let c,d;const u=new u0(s,e,i);if(lt(n))d=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Xa(e,d,!0,t.filter.filtersNodes());else{const h=ot(n);if(h===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),r),c=Xa(e,d,l.isFullyInitialized(),l.isFiltered());else{const f=Ct(n),E=l.getNode().getImmediateChild(h);let k;if(lt(f))k=r;else{const T=u.getCompleteChild(h);T!=null?e0(f)===".priority"&&T.getChild(Bb(f)).isEmpty()?k=T:k=T.updateChild(f,r):k=He.EMPTY_NODE}if(E.equals(k))c=e;else{const T=t.filter.updateChild(l.getNode(),h,k,f,u,o);c=Xa(e,T,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Dv(t,e){return t.eventCache.isCompleteForChild(e)}function fR(t,e,n,r,s,i,o){let l=e;return r.foreach((c,d)=>{const u=Ft(n,c);Dv(e,ot(u))&&(l=kp(t,l,u,d,s,i,o))}),r.foreach((c,d)=>{const u=Ft(n,c);Dv(e,ot(u))||(l=kp(t,l,u,d,s,i,o))}),l}function Mv(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function Rp(t,e,n,r,s,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;lt(n)?d=r:d=new At(null).setTree(n,r);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,f)=>{if(u.hasChild(h)){const E=e.serverCache.getNode().getImmediateChild(h),k=Mv(t,E,f);c=nu(t,c,new St(h),k,s,i,o,l)}}),d.children.inorderTraversal((h,f)=>{const E=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!u.hasChild(h)&&!E){const k=e.serverCache.getNode().getImmediateChild(h),T=Mv(t,k,f);c=nu(t,c,new St(h),T,s,i,o,l)}}),c}function hR(t,e,n,r,s,i,o){if(tu(s,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(lt(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return nu(t,e,n,c.getNode().getChild(n),s,i,l,o);if(lt(n)){let d=new At(null);return c.getNode().forEachChild(wo,(u,h)=>{d=d.set(new St(u),h)}),Rp(t,e,n,d,s,i,l,o)}else return e}else{let d=new At(null);return r.foreach((u,h)=>{const f=Ft(n,u);c.isCompleteForPath(f)&&(d=d.set(u,c.getNode().getChild(f)))}),Rp(t,e,n,d,s,i,l,o)}}function pR(t,e,n,r,s){const i=e.serverCache,o=Xb(e,i.getNode(),i.isFullyInitialized()||lt(n),i.isFiltered());return nE(t,o,n,r,tE,s)}function gR(t,e,n,r,s,i){let o;if(tu(r,n)!=null)return e;{const l=new u0(r,e,s),c=e.eventCache.getNode();let d;if(lt(n)||ot(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=eu(r,Oi(e));else{const h=e.serverCache.getNode();pe(h instanceof He,"serverChildren would be complete if leaf node"),u=c0(r,h)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=ot(n);let h=d0(r,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=t.filter.updateChild(c,u,h,Ct(n),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,He.EMPTY_NODE,Ct(n),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=eu(r,Oi(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||tu(r,gt())!=null,Xa(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new s0(r.getIndex()),i=D5(r);this.processor_=lR(i);const o=n.serverCache,l=n.eventCache,c=s.updateFullNode(He.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(He.EMPTY_NODE,l.getNode(),null),u=new Xs(c,o.isFullyInitialized(),s.filtersNodes()),h=new Xs(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=Du(h,u),this.eventGenerator_=new B5(this.query_)}get query(){return this.query_}}function yR(t){return t.viewCache_.serverCache.getNode()}function vR(t){return Zd(t.viewCache_)}function _R(t,e){const n=Oi(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!lt(e)&&!n.getImmediateChild(ot(e)).isEmpty())?n.getChild(e):null}function Nv(t){return t.eventRegistrations_.length===0}function xR(t,e){t.eventRegistrations_.push(e)}function jv(t,e,n){const r=[];if(n){pe(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function $v(t,e,n,r){e.type===pr.MERGE&&e.source.queryId!==null&&(pe(Oi(t.viewCache_),"We should always have a full cache before handling merges"),pe(Zd(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=dR(t.processor_,s,e,n,r);return cR(t.processor_,i.viewCache),pe(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,rE(t,i.changes,i.viewCache.eventCache.getNode(),null)}function bR(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Nt,(i,o)=>{r.push(Bo(i,o))}),n.isFullyInitialized()&&r.push(Kb(n.getNode())),rE(t,r,n.getNode(),e)}function rE(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return z5(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ru;class sE{constructor(){this.views=new Map}}function ER(t){pe(!ru,"__referenceConstructor has already been defined"),ru=t}function SR(){return pe(ru,"Reference.ts has not been loaded"),ru}function IR(t){return t.views.size===0}function f0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return pe(i!=null,"SyncTree gave us an op for an invalid query."),$v(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat($v(o,e,n,r));return i}}function iE(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=eu(n,s?r:null),c=!1;l?c=!0:r instanceof He?(l=c0(n,r),c=!1):(l=He.EMPTY_NODE,c=!1);const d=Du(new Xs(l,c,!1),new Xs(r,s,!1));return new mR(e,d)}return o}function wR(t,e,n,r,s,i){const o=iE(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),xR(o,n),bR(o,n)}function TR(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const l=Qs(t);if(s==="default")for(const[c,d]of t.views.entries())o=o.concat(jv(d,n,r)),Nv(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(s);c&&(o=o.concat(jv(c,n,r)),Nv(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!Qs(t)&&i.push(new(SR())(e._repo,e._path)),{removed:i,events:o}}function oE(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Ws(t,e){let n=null;for(const r of t.views.values())n=n||_R(r,e);return n}function aE(t,e){if(e._queryParams.loadsAllData())return Nu(t);{const r=e._queryIdentifier;return t.views.get(r)}}function lE(t,e){return aE(t,e)!=null}function Qs(t){return Nu(t)!=null}function Nu(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let su;function CR(t){pe(!su,"__referenceConstructor has already been defined"),su=t}function kR(){return pe(su,"Reference.ts has not been loaded"),su}let RR=1;class Fv{constructor(e){this.listenProvider_=e,this.syncPointTree_=new At(null),this.pendingWriteTree_=sR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function h0(t,e,n,r,s){return V5(t.pendingWriteTree_,e,n,r,s),s?ta(t,new Pi(o0(),e,n)):[]}function AR(t,e,n,r){Y5(t.pendingWriteTree_,e,n,r);const s=At.fromObject(n);return ta(t,new zo(o0(),e,s))}function Rs(t,e,n=!1){const r=K5(t.pendingWriteTree_,e);if(X5(t.pendingWriteTree_,e)){let i=new At(null);return r.snap!=null?i=i.set(gt(),!0):rn(r.children,o=>{i=i.set(new St(o),!0)}),ta(t,new qd(r.path,i,n))}else return[]}function Hl(t,e,n){return ta(t,new Pi(a0(),e,n))}function PR(t,e,n){const r=At.fromObject(n);return ta(t,new zo(a0(),e,r))}function OR(t,e){return ta(t,new Cl(a0(),e))}function LR(t,e,n){const r=p0(t,n);if(r){const s=g0(r),i=s.path,o=s.queryId,l=Sn(i,e),c=new Cl(l0(o),l);return m0(t,i,c)}else return[]}function iu(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||lE(o,e))){const c=TR(o,e,n,r);IR(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!s){const u=d.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(f,E)=>Qs(E));if(u&&!h){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const E=NR(f);for(let k=0;k<E.length;++k){const T=E[k],N=T.query,v=fE(t,T);t.listenProvider_.startListening(Ja(N),kl(t,N),v.hashFn,v.onComplete)}}}!h&&d.length>0&&!r&&(u?t.listenProvider_.stopListening(Ja(e),null):d.forEach(f=>{const E=t.queryToTagMap.get($u(f));t.listenProvider_.stopListening(Ja(f),E)}))}jR(t,d)}return l}function cE(t,e,n,r){const s=p0(t,r);if(s!=null){const i=g0(s),o=i.path,l=i.queryId,c=Sn(o,e),d=new Pi(l0(l),c,n);return m0(t,o,d)}else return[]}function DR(t,e,n,r){const s=p0(t,r);if(s){const i=g0(s),o=i.path,l=i.queryId,c=Sn(o,e),d=At.fromObject(n),u=new zo(l0(l),c,d);return m0(t,o,u)}else return[]}function Ap(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,E)=>{const k=Sn(f,s);i=i||Ws(E,k),o=o||Qs(E)});let l=t.syncPointTree_.get(s);l?(o=o||Qs(l),i=i||Ws(l,gt())):(l=new sE,t.syncPointTree_=t.syncPointTree_.set(s,l));let c;i!=null?c=!0:(c=!1,i=He.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((E,k)=>{const T=Ws(k,gt());T&&(i=i.updateImmediateChild(E,T))}));const d=lE(l,e);if(!d&&!e._queryParams.loadsAllData()){const f=$u(e);pe(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const E=$R();t.queryToTagMap.set(f,E),t.tagToQueryMap.set(E,f)}const u=Mu(t.pendingWriteTree_,s);let h=wR(l,e,n,u,i,c);if(!d&&!o&&!r){const f=aE(l,e);h=h.concat(FR(t,e,f))}return h}function ju(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=Sn(o,e),d=Ws(l,c);if(d)return d});return qb(s,e,i,n,!0)}function MR(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(d,u)=>{const h=Sn(d,n);r=r||Ws(u,h)});let s=t.syncPointTree_.get(n);s?r=r||Ws(s,gt()):(s=new sE,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new Xs(r,!0,!1):null,l=Mu(t.pendingWriteTree_,e._path),c=iE(s,e,l,i?o.getNode():He.EMPTY_NODE,i);return vR(c)}function ta(t,e){return dE(e,t.syncPointTree_,null,Mu(t.pendingWriteTree_,gt()))}function dE(t,e,n,r){if(lt(t.path))return uE(t,e,n,r);{const s=e.get(gt());n==null&&s!=null&&(n=Ws(s,gt()));let i=[];const o=ot(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=n?n.getImmediateChild(o):null,u=Zb(r,o);i=i.concat(dE(l,c,d,u))}return s&&(i=i.concat(f0(s,t,r,n))),i}}function uE(t,e,n,r){const s=e.get(gt());n==null&&s!=null&&(n=Ws(s,gt()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,d=Zb(r,o),u=t.operationForChild(o);u&&(i=i.concat(uE(u,l,c,d)))}),s&&(i=i.concat(f0(s,t,r,n))),i}function fE(t,e){const n=e.query,r=kl(t,n);return{hashFn:()=>(yR(e)||He.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?LR(t,n._path,r):OR(t,n._path);{const i=Ok(s,n);return iu(t,n,null,i)}}}}function kl(t,e){const n=$u(e);return t.queryToTagMap.get(n)}function $u(t){return t._path.toString()+"$"+t._queryIdentifier}function p0(t,e){return t.tagToQueryMap.get(e)}function g0(t){const e=t.indexOf("$");return pe(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new St(t.substr(0,e))}}function m0(t,e,n){const r=t.syncPointTree_.get(e);pe(r,"Missing sync point for query tag that we're tracking");const s=Mu(t.pendingWriteTree_,e);return f0(r,n,s,null)}function NR(t){return t.fold((e,n,r)=>{if(n&&Qs(n))return[Nu(n)];{let s=[];return n&&(s=oE(n)),rn(r,(i,o)=>{s=s.concat(o)}),s}})}function Ja(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(kR())(t._repo,t._path):t}function jR(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=$u(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function $R(){return RR++}function FR(t,e,n){const r=e._path,s=kl(t,e),i=fE(t,n),o=t.listenProvider_.startListening(Ja(e),s,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(r);if(s)pe(!Qs(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,h)=>{if(!lt(d)&&u&&Qs(u))return[Nu(u).query];{let f=[];return u&&(f=f.concat(oE(u).map(E=>E.query))),rn(h,(E,k)=>{f=f.concat(k)}),f}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(Ja(u),kl(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new y0(n)}node(){return this.node_}}class v0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Ft(this.path_,e);return new v0(this.syncTree_,n)}node(){return ju(this.syncTree_,this.path_)}}const UR=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Uv=function(t,e,n){if(!t||typeof t!="object")return t;if(pe(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return BR(t[".sv"],e,n);if(typeof t[".sv"]=="object")return zR(t[".sv"],e);pe(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},BR=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:pe(!1,"Unexpected server value: "+t)}},zR=function(t,e,n){t.hasOwnProperty("increment")||pe(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&pe(!1,"Unexpected increment value: "+r);const s=e.node();if(pe(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},hE=function(t,e,n,r){return x0(e,new v0(n,t),r)},_0=function(t,e,n){return x0(t,new y0(e),n)};function x0(t,e,n){const r=t.getPriority().val(),s=Uv(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,l=Uv(o.getValue(),e,n);return l!==o.getValue()||s!==o.getPriority().val()?new qt(l,$t(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new qt(s))),o.forEachChild(Nt,(l,c)=>{const d=x0(c,e.getImmediateChild(l),n);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function Fu(t,e){let n=e instanceof St?e:new St(e),r=t,s=ot(n);for(;s!==null;){const i=Ci(r.node.children,s)||{children:{},childCount:0};r=new b0(s,r,i),n=Ct(n),s=ot(n)}return r}function $i(t){return t.node.value}function E0(t,e){t.node.value=e,Pp(t)}function pE(t){return t.node.childCount>0}function HR(t){return $i(t)===void 0&&!pE(t)}function Uu(t,e){rn(t.node.children,(n,r)=>{e(new b0(n,t,r))})}function gE(t,e,n,r){n&&e(t),Uu(t,s=>{gE(s,e,!0)})}function WR(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Wl(t){return new St(t.parent===null?t.name:Wl(t.parent)+"/"+t.name)}function Pp(t){t.parent!==null&&GR(t.parent,t.name,t)}function GR(t,e,n){const r=HR(n),s=br(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,Pp(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,Pp(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VR=/[\[\].#$\/\u0000-\u001F\u007F]/,YR=/[\[\].#$\u0000-\u001F\u007F]/,ph=10*1024*1024,S0=function(t){return typeof t=="string"&&t.length!==0&&!VR.test(t)},mE=function(t){return typeof t=="string"&&t.length!==0&&!YR.test(t)},KR=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),mE(t)},I0=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!Ou(t)||t&&typeof t=="object"&&br(t,".sv")},ou=function(t,e,n,r){r&&e===void 0||Gl($o(t,"value"),e,n)},Gl=function(t,e,n){const r=n instanceof St?new f5(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+pi(r));if(typeof e=="function")throw new Error(t+"contains a function "+pi(r)+" with contents = "+e.toString());if(Ou(e))throw new Error(t+"contains "+e.toString()+" "+pi(r));if(typeof e=="string"&&e.length>ph/3&&Pu(e)>ph)throw new Error(t+"contains a string greater than "+ph+" utf8 bytes "+pi(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(rn(e,(o,l)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!S0(o)))throw new Error(t+" contains an invalid key ("+o+") "+pi(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);h5(r,o),Gl(t,l,r),p5(r)}),s&&i)throw new Error(t+' contains ".value" child '+pi(r)+" in addition to actual children.")}},XR=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=Sl(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!S0(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(u5);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&er(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},yE=function(t,e,n,r){const s=$o(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];rn(e,(o,l)=>{const c=new St(o);if(Gl(s,l,Ft(n,c)),e0(c)===".priority"&&!I0(l))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),XR(s,i)},QR=function(t,e,n){if(Ou(e))throw new Error($o(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!I0(e))throw new Error($o(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},vE=function(t,e,n,r){if(!mE(n))throw new Error($o(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},JR=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),vE(t,e,n)},As=function(t,e){if(ot(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},qR=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!S0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!KR(n))throw new Error($o(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Bu(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!t0(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function _E(t,e,n){Bu(t,n),xE(t,r=>t0(r,e))}function Wn(t,e,n){Bu(t,n),xE(t,r=>er(r,e)||er(e,r))}function xE(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(eA(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function eA(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Ya&&tn("event: "+n.toString()),Zo(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tA="repo_interrupt",nA=25;class rA{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ZR,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Jd(),this.transactionQueueTree_=new b0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function sA(t,e,n){if(t.stats_=qg(t.repoInfo_),t.forceRestClient_||Nk())t.server_=new Qd(t.repoInfo_,(r,s,i,o)=>{Bv(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>zv(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Xt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new qr(t.repoInfo_,e,(r,s,i,o)=>{Bv(t,r,s,i,o)},r=>{zv(t,r)},r=>{iA(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=Bk(t.repoInfo_,()=>new U5(t.stats_,t.server_)),t.infoData_=new M5,t.infoSyncTree_=new Fv({startListening:(r,s,i,o)=>{let l=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(l=Hl(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),w0(t,"connected",!1),t.serverSyncTree_=new Fv({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(l,c)=>{const d=o(l,c);Wn(t.eventQueue_,r._path,d)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function bE(t){const n=t.infoData_.getNode(new St(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Vl(t){return UR({timestamp:bE(t)})}function Bv(t,e,n,r,s){t.dataUpdateCount++;const i=new St(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=Gd(n,d=>$t(d));o=DR(t.serverSyncTree_,i,c,s)}else{const c=$t(n);o=cE(t.serverSyncTree_,i,c,s)}else if(r){const c=Gd(n,d=>$t(d));o=PR(t.serverSyncTree_,i,c)}else{const c=$t(n);o=Hl(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=Wo(t,i)),Wn(t.eventQueue_,l,o)}function zv(t,e){w0(t,"connected",e),e===!1&&cA(t)}function iA(t,e){rn(e,(n,r)=>{w0(t,n,r)})}function w0(t,e,n){const r=new St("/.info/"+e),s=$t(n);t.infoData_.updateSnapshot(r,s);const i=Hl(t.infoSyncTree_,r,s);Wn(t.eventQueue_,r,i)}function zu(t){return t.nextWriteId_++}function oA(t,e,n){const r=MR(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=$t(s).withIndex(e._queryParams.getIndex());Ap(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Hl(t.serverSyncTree_,e._path,i);else{const l=kl(t.serverSyncTree_,e);o=cE(t.serverSyncTree_,e._path,i,l)}return Wn(t.eventQueue_,e._path,o),iu(t.serverSyncTree_,e,n,null,!0),i},s=>(na(t,"get for query "+Xt(e)+" failed: "+s),Promise.reject(new Error(s))))}function aA(t,e,n,r,s){na(t,"set",{path:e.toString(),value:n,priority:r});const i=Vl(t),o=$t(n,r),l=ju(t.serverSyncTree_,e),c=_0(o,l,i),d=zu(t),u=h0(t.serverSyncTree_,e,c,d,!0);Bu(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(f,E)=>{const k=f==="ok";k||wn("set at "+e+" failed: "+f);const T=Rs(t.serverSyncTree_,d,!k);Wn(t.eventQueue_,e,T),Js(t,s,f,E)});const h=C0(t,e);Wo(t,h),Wn(t.eventQueue_,h,[])}function lA(t,e,n,r){na(t,"update",{path:e.toString(),value:n});let s=!0;const i=Vl(t),o={};if(rn(n,(l,c)=>{s=!1,o[l]=hE(Ft(e,l),$t(c),t.serverSyncTree_,i)}),s)tn("update() called with empty data.  Don't do anything."),Js(t,r,"ok",void 0);else{const l=zu(t),c=AR(t.serverSyncTree_,e,o,l);Bu(t.eventQueue_,c),t.server_.merge(e.toString(),n,(d,u)=>{const h=d==="ok";h||wn("update at "+e+" failed: "+d);const f=Rs(t.serverSyncTree_,l,!h),E=f.length>0?Wo(t,e):e;Wn(t.eventQueue_,E,f),Js(t,r,d,u)}),rn(n,d=>{const u=C0(t,Ft(e,d));Wo(t,u)}),Wn(t.eventQueue_,e,[])}}function cA(t){na(t,"onDisconnectEvents");const e=Vl(t),n=Jd();Ip(t.onDisconnect_,gt(),(s,i)=>{const o=hE(s,i,t.serverSyncTree_,e);ea(n,s,o)});let r=[];Ip(n,gt(),(s,i)=>{r=r.concat(Hl(t.serverSyncTree_,s,i));const o=C0(t,s);Wo(t,o)}),t.onDisconnect_=Jd(),Wn(t.eventQueue_,gt(),r)}function dA(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&Sp(t.onDisconnect_,e),Js(t,n,r,s)})}function Hv(t,e,n,r){const s=$t(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&ea(t.onDisconnect_,e,s),Js(t,r,i,o)})}function uA(t,e,n,r,s){const i=$t(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,l)=>{o==="ok"&&ea(t.onDisconnect_,e,i),Js(t,s,o,l)})}function fA(t,e,n,r){if(Wd(n)){tn("onDisconnect().update() called with empty data.  Don't do anything."),Js(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&rn(n,(o,l)=>{const c=$t(l);ea(t.onDisconnect_,Ft(e,o),c)}),Js(t,r,s,i)})}function hA(t,e,n){let r;ot(e._path)===".info"?r=Ap(t.infoSyncTree_,e,n):r=Ap(t.serverSyncTree_,e,n),_E(t.eventQueue_,e._path,r)}function pA(t,e,n){let r;ot(e._path)===".info"?r=iu(t.infoSyncTree_,e,n):r=iu(t.serverSyncTree_,e,n),_E(t.eventQueue_,e._path,r)}function gA(t){t.persistentConnection_&&t.persistentConnection_.interrupt(tA)}function na(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),tn(n,...e)}function Js(t,e,n,r){e&&Zo(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function mA(t,e,n,r,s,i){na(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:_b(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=T0(t,e,void 0);o.currentInputSnapshot=l;const c=o.update(l.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Gl("transaction failed: Data returned ",c,o.path),o.status=0;const d=Fu(t.transactionQueueTree_,e),u=$i(d)||[];u.push(o),E0(d,u);let h;typeof c=="object"&&c!==null&&br(c,".priority")?(h=Ci(c,".priority"),pe(I0(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(ju(t.serverSyncTree_,e)||He.EMPTY_NODE).getPriority().val();const f=Vl(t),E=$t(c,h),k=_0(E,l,f);o.currentOutputSnapshotRaw=E,o.currentOutputSnapshotResolved=k,o.currentWriteId=zu(t);const T=h0(t.serverSyncTree_,e,k,o.currentWriteId,o.applyLocally);Wn(t.eventQueue_,e,T),Hu(t,t.transactionQueueTree_)}}function T0(t,e,n){return ju(t.serverSyncTree_,e,n)||He.EMPTY_NODE}function Hu(t,e=t.transactionQueueTree_){if(e||Wu(t,e),$i(e)){const n=SE(t,e);pe(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&yA(t,Wl(e),n)}else pE(e)&&Uu(e,n=>{Hu(t,n)})}function yA(t,e,n){const r=n.map(d=>d.currentWriteId),s=T0(t,e,r);let i=s;const o=s.hash();for(let d=0;d<n.length;d++){const u=n[d];pe(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=Sn(e,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{na(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,u=u.concat(Rs(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Wu(t,Fu(t.transactionQueueTree_,e)),Hu(t,t.transactionQueueTree_),Wn(t.eventQueue_,e,u);for(let f=0;f<h.length;f++)Zo(h[f])}else{if(d==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{wn("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=d}Wo(t,e)}},o)}function Wo(t,e){const n=EE(t,e),r=Wl(n),s=SE(t,n);return vA(t,s,r),r}function vA(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=Sn(n,c.path);let u=!1,h;if(pe(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,s=s.concat(Rs(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=nA)u=!0,h="maxretry",s=s.concat(Rs(t.serverSyncTree_,c.currentWriteId,!0));else{const f=T0(t,c.path,o);c.currentInputSnapshot=f;const E=e[l].update(f.val());if(E!==void 0){Gl("transaction failed: Data returned ",E,c.path);let k=$t(E);typeof E=="object"&&E!=null&&br(E,".priority")||(k=k.updatePriority(f.getPriority()));const N=c.currentWriteId,v=Vl(t),_=_0(k,f,v);c.currentOutputSnapshotRaw=k,c.currentOutputSnapshotResolved=_,c.currentWriteId=zu(t),o.splice(o.indexOf(N),1),s=s.concat(h0(t.serverSyncTree_,c.path,_,c.currentWriteId,c.applyLocally)),s=s.concat(Rs(t.serverSyncTree_,N,!0))}else u=!0,h="nodata",s=s.concat(Rs(t.serverSyncTree_,c.currentWriteId,!0))}Wn(t.eventQueue_,n,s),s=[],u&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(h),!1,null))))}Wu(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)Zo(r[l]);Hu(t,t.transactionQueueTree_)}function EE(t,e){let n,r=t.transactionQueueTree_;for(n=ot(e);n!==null&&$i(r)===void 0;)r=Fu(r,n),e=Ct(e),n=ot(e);return r}function SE(t,e){const n=[];return IE(t,e,n),n.sort((r,s)=>r.order-s.order),n}function IE(t,e,n){const r=$i(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);Uu(e,s=>{IE(t,s,n)})}function Wu(t,e){const n=$i(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,E0(e,n.length>0?n:void 0)}Uu(e,r=>{Wu(t,r)})}function C0(t,e){const n=Wl(EE(t,e)),r=Fu(t.transactionQueueTree_,e);return WR(r,s=>{gh(t,s)}),gh(t,r),gE(r,s=>{gh(t,s)}),n}function gh(t,e){const n=$i(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(pe(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(pe(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Rs(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?E0(e,void 0):n.length=i+1,Wn(t.eventQueue_,Wl(e),s);for(let o=0;o<r.length;o++)Zo(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _A(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function xA(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):wn(`Invalid query segment '${n}' in query '${t}'`)}return e}const Wv=function(t,e){const n=bA(t),r=n.namespace;n.domain==="firebase.com"&&is(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&is("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Ck();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Ob(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new St(n.pathString)}},bA=function(t){let e="",n="",r="",s="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(s=_A(t.substring(u,h)));const f=xA(t.substring(Math.min(t.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const E=e.slice(0,d);if(E.toLowerCase()==="localhost")n="localhost";else if(E.split(".").length<=2)n=E;else{const k=e.indexOf(".");r=e.substring(0,k).toLowerCase(),n=e.substring(k+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:l,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",EA=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Gv.charAt(n%64),n=Math.floor(n/64);pe(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Gv.charAt(e[s]);return pe(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Xt(this.snapshot.exportVal())}}class IA{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wE{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return pe(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wA{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new fr;return dA(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){As("OnDisconnect.remove",this._path);const e=new fr;return Hv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){As("OnDisconnect.set",this._path),ou("OnDisconnect.set",e,this._path,!1);const n=new fr;return Hv(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){As("OnDisconnect.setWithPriority",this._path),ou("OnDisconnect.setWithPriority",e,this._path,!1),QR("OnDisconnect.setWithPriority",n);const r=new fr;return uA(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){As("OnDisconnect.update",this._path),yE("OnDisconnect.update",e,this._path);const n=new fr;return fA(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return lt(this._path)?null:e0(this._path)}get ref(){return new jr(this._repo,this._path)}get _queryIdentifier(){const e=Rv(this._queryParams),n=Qg(e);return n==="{}"?"default":n}get _queryObject(){return Rv(this._queryParams)}isEqual(e){if(e=Jt(e),!(e instanceof k0))return!1;const n=this._repo===e._repo,r=t0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+d5(this._path)}}class jr extends k0{constructor(e,n){super(e,n,new i0,!1)}get parent(){const e=Bb(this._path);return e===null?null:new jr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Go{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new St(e),r=Rl(this.ref,e);return new Go(this._node.getChild(n),r,Nt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Go(s,Rl(this.ref,r),Nt)))}hasChild(e){const n=new St(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ar(t,e){return t=Jt(t),t._checkNotDeleted("ref"),e!==void 0?Rl(t._root,e):t._root}function Rl(t,e){return t=Jt(t),ot(t._path)===null?JR("child","path",e):vE("child","path",e),new jr(t._repo,Ft(t._path,e))}function TA(t){return t=Jt(t),new wA(t._repo,t._path)}function CA(t,e){t=Jt(t),As("push",t._path),ou("push",e,t._path,!0);const n=bE(t._repo),r=EA(n),s=Rl(t,r),i=Rl(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Bc(t){return As("remove",t._path),Gu(t,null)}function Gu(t,e){t=Jt(t),As("set",t._path),ou("set",e,t._path,!1);const n=new fr;return aA(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function R0(t,e){yE("update",e,t._path);const n=new fr;return lA(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Vu(t){t=Jt(t);const e=new wE(()=>{}),n=new Yu(e);return oA(t._repo,t,n).then(r=>new Go(r,new jr(t._repo,t._path),t._queryParams.getIndex()))}class Yu{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new SA("value",this,new Go(e.snapshotNode,new jr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new IA(this,e,n):null}matches(e){return e instanceof Yu?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function kA(t,e,n,r,s){const i=new wE(n,void 0),o=new Yu(i);return hA(t._repo,t,o),()=>pA(t._repo,t,o)}function TE(t,e,n,r){return kA(t,"value",e)}ER(jr);CR(jr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RA="FIREBASE_DATABASE_EMULATOR_HOST",Op={};let AA=!1;function PA(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Qo(i);t.repoInfo_=new Ob(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function OA(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||is("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tn("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Wv(i,s),l=o.repoInfo,c;typeof process<"u"&&uv&&(c=uv[RA]),c?(i=`http://${c}?ns=${l.namespace}`,o=Wv(i,s),l=o.repoInfo):o.repoInfo.secure;const d=new $k(t.name,t.options,e);qR("Invalid Firebase Database URL",o),lt(o.path)||is("Database URL must point to the root of a Firebase Database (not including a child path).");const u=DA(l,t,d,new jk(t,n));return new MA(u,t)}function LA(t,e){const n=Op[e];(!n||n[t.key]!==t)&&is(`Database ${e}(${t.repoInfo_}) has already been deleted.`),gA(t),delete n[t.key]}function DA(t,e,n,r){let s=Op[e.name];s||(s={},Op[e.name]=s);let i=s[t.toURLString()];return i&&is("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new rA(t,AA,n,r),s[t.toURLString()]=i,i}class MA{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(sA(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new jr(this._repo,gt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(LA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&is("Cannot call "+e+" on a deleted database.")}}function NA(t=pb(),e){const n=Xg(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=V2("database");r&&jA(n,...r)}return n}function jA(t,e,n,r={}){t=Jt(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&ki(r,i.repoInfo_.emulatorOptions))return;is("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&is('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new od(od.OWNER);else if(r.mockUserToken){const l=typeof r.mockUserToken=="string"?r.mockUserToken:Y2(r.mockUserToken,t.app.options.projectId);o=new od(l)}Qo(e)&&(ab(e),lb("Database",!0)),PA(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $A(t){Ek(qo),Fo(new Ri("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return OA(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),zs(fv,hv,t),zs(fv,hv,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FA{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function UA(t,e,n){if(t=Jt(t),As("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new fr,i=(l,c,d)=>{let u=null;l?s.reject(l):(u=new Go(d,new jr(t._repo,t._path),Nt),s.resolve(new FA(c,u)))},o=TE(t,()=>{});return mA(t._repo,t._path,e,i,o,r),s.promise}qr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};qr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};$A();function CE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const BA=CE,kE=new Fl("auth","Firebase",CE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const au=new Yg("@firebase/auth");function zA(t,...e){au.logLevel<=wt.WARN&&au.warn(`Auth (${qo}): ${t}`,...e)}function ad(t,...e){au.logLevel<=wt.ERROR&&au.error(`Auth (${qo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xr(t,...e){throw A0(t,...e)}function Mr(t,...e){return A0(t,...e)}function RE(t,e,n){const r={...BA(),[e]:n};return new Fl("auth","Firebase",r).create(e,{appName:t.name})}function Zr(t){return RE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function A0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return kE.create(t,...e)}function ze(t,e,...n){if(!t)throw A0(e,...n)}function Xr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw ad(e),new Error(e)}function os(t,e){t||Xr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lp(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function HA(){return Vv()==="http:"||Vv()==="https:"}function Vv(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(HA()||J2()||"connection"in navigator)?navigator.onLine:!0}function GA(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e,n){this.shortDelay=e,this.longDelay=n,os(n>e,"Short delay should be less than long delay!"),this.isMobile=Vg()||cb()}get(){return WA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P0(t,e){os(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],KA=new Yl(3e4,6e4);function ri(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function si(t,e,n,r,s={}){return PE(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=Jo({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return Q2()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&Qo(t.emulatorConfig.host)&&(d.credentials="include"),AE.fetch()(await OE(t,t.config.apiHost,n,l),d)})}async function PE(t,e,n){t._canInitEmulator=!1;const r={...VA,...e};try{const s=new QA(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw zc(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw zc(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw zc(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw zc(t,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw RE(t,u,d);xr(t,u)}}catch(s){if(s instanceof ni)throw s;xr(t,"network-request-failed",{message:String(s)})}}async function Kl(t,e,n,r,s={}){const i=await si(t,e,n,r,s);return"mfaPendingCredential"in i&&xr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function OE(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?P0(t.config,s):`${t.config.apiScheme}://${s}`;return YA.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function XA(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class QA{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Mr(this.auth,"network-request-failed")),KA.get())})}}function zc(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Mr(t,e,r);return s.customData._tokenResponse=n,s}function Yv(t){return t!==void 0&&t.enterprise!==void 0}class JA{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return XA(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function qA(t,e){return si(t,"GET","/v2/recaptchaConfig",ri(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZA(t,e){return si(t,"POST","/v1/accounts:delete",e)}async function lu(t,e){return si(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qa(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function eP(t,e=!1){const n=Jt(t),r=await n.getIdToken(e),s=O0(r);ze(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:qa(mh(s.auth_time)),issuedAtTime:qa(mh(s.iat)),expirationTime:qa(mh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function mh(t){return Number(t)*1e3}function O0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return ad("JWT malformed, contained fewer than 3 sections"),null;try{const s=Hd(n);return s?JSON.parse(s):(ad("Failed to decode base64 JWT payload"),null)}catch(s){return ad("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Kv(t){const e=O0(t);return ze(e,"internal-error"),ze(typeof e.exp<"u","internal-error"),ze(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Al(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ni&&tP(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function tP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=qa(this.lastLoginAt),this.creationTime=qa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pl(t){var h;const e=t.auth,n=await t.getIdToken(),r=await Al(t,lu(e,{idToken:n}));ze(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?LE(s.providerUserInfo):[],o=sP(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Dp(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,u)}async function rP(t){const e=Jt(t);await Pl(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function sP(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function LE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iP(t,e){const n=await PE(t,{},async()=>{const r=Jo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await OE(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&Qo(t.emulatorConfig.host)&&(c.credentials="include"),AE.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function oP(t,e){return si(t,"POST","/v2/accounts:revokeToken",ri(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ze(e.idToken,"internal-error"),ze(typeof e.idToken<"u","internal-error"),ze(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Kv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ze(e.length!==0,"internal-error");const n=Kv(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ze(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await iP(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new To;return r&&(ze(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ze(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ze(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new To,this.toJSON())}_performRefresh(){return Xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ys(t,e){ze(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class gr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new nP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Dp(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Al(this,this.stsTokenManager.getToken(this.auth,e));return ze(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return eP(this,e)}reload(){return rP(this)}_assign(e){this!==e&&(ze(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new gr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){ze(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Pl(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(qn(this.auth.app))return Promise.reject(Zr(this.auth));const e=await this.getIdToken();return await Al(this,ZA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:E,providerData:k,stsTokenManager:T}=n;ze(h&&T,e,"internal-error");const N=To.fromJSON(this.name,T);ze(typeof h=="string",e,"internal-error"),ys(r,e.name),ys(s,e.name),ze(typeof f=="boolean",e,"internal-error"),ze(typeof E=="boolean",e,"internal-error"),ys(i,e.name),ys(o,e.name),ys(l,e.name),ys(c,e.name),ys(d,e.name),ys(u,e.name);const v=new gr({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:E,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:N,createdAt:d,lastLoginAt:u});return k&&Array.isArray(k)&&(v.providerData=k.map(_=>({..._}))),c&&(v._redirectEventId=c),v}static async _fromIdTokenResponse(e,n,r=!1){const s=new To;s.updateFromServerResponse(n);const i=new gr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Pl(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];ze(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?LE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new To;l.updateFromIdToken(r);const c=new gr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Dp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xv=new Map;function Qr(t){os(t instanceof Function,"Expected a class definition");let e=Xv.get(t);return e?(os(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Xv.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}DE.type="NONE";const Qv=DE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ld(t,e,n){return`firebase:${t}:${e}:${n}`}class Co{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=ld(this.userKey,s.apiKey,i),this.fullPersistenceKey=ld("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await lu(this.auth,{idToken:e}).catch(()=>{});return n?gr._fromGetAccountInfoResponse(this.auth,n,e):null}return gr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Co(Qr(Qv),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Qr(Qv);const o=ld(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const u=await d._get(o);if(u){let h;if(typeof u=="string"){const f=await lu(e,{idToken:u}).catch(()=>{});if(!f)break;h=await gr._fromGetAccountInfoResponse(e,f,u)}else h=gr._fromJSON(e,u);d!==i&&(l=h),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Co(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new Co(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jv(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($E(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ME(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(UE(e))return"Blackberry";if(BE(e))return"Webos";if(NE(e))return"Safari";if((e.includes("chrome/")||jE(e))&&!e.includes("edge/"))return"Chrome";if(FE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function ME(t=Tn()){return/firefox\//i.test(t)}function NE(t=Tn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function jE(t=Tn()){return/crios\//i.test(t)}function $E(t=Tn()){return/iemobile/i.test(t)}function FE(t=Tn()){return/android/i.test(t)}function UE(t=Tn()){return/blackberry/i.test(t)}function BE(t=Tn()){return/webos/i.test(t)}function L0(t=Tn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function aP(t=Tn()){var e;return L0(t)&&!!((e=window.navigator)!=null&&e.standalone)}function lP(){return q2()&&document.documentMode===10}function zE(t=Tn()){return L0(t)||FE(t)||BE(t)||UE(t)||/windows phone/i.test(t)||$E(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HE(t,e=[]){let n;switch(t){case"Browser":n=Jv(Tn());break;case"Worker":n=`${Jv(Tn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${qo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dP(t,e={}){return si(t,"GET","/v2/passwordPolicy",ri(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP=6;class fP{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??uP,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new qv(this),this.idTokenSubscription=new qv(this),this.beforeStateQueue=new cP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=kE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Qr(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Co.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await lu(this,{idToken:e}),r=await gr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(qn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ze(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Pl(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=GA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(qn(this.app))return Promise.reject(Zr(this));const n=e?Jt(e):null;return n&&ze(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ze(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return qn(this.app)?Promise.reject(Zr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return qn(this.app)?Promise.reject(Zr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Qr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await dP(this),n=new fP(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Fl("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await oP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Qr(e)||this._popupRedirectResolver;ze(n,this,"argument-error"),this.redirectPersistenceManager=await Co.create(this,[Qr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ze(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ze(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=HE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(qn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&zA(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Fi(t){return Jt(t)}class qv{constructor(e){this.auth=e,this.observer=null,this.addObserver=lC(n=>this.observer=n)}get next(){return ze(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ku={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function pP(t){Ku=t}function WE(t){return Ku.loadJS(t)}function gP(){return Ku.recaptchaEnterpriseScript}function mP(){return Ku.gapiScript}function yP(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class vP{constructor(){this.enterprise=new _P}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class _P{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const xP="recaptcha-enterprise",GE="NO_RECAPTCHA";class bP{constructor(e){this.type=xP,this.auth=Fi(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{qA(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new JA(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;Yv(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(GE)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new vP().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&Yv(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=gP();c.length!==0&&(c+=l),WE(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function Zv(t,e,n,r=!1,s=!1){const i=new bP(t);let o;if(s)o=GE;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function e_(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Zv(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Zv(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EP(t,e){const n=Xg(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(ki(i,e??{}))return s;xr(s,"already-initialized")}return n.initialize({options:e})}function SP(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Qr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function IP(t,e,n){const r=Fi(t);ze(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=VE(e),{host:o,port:l}=wP(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},u=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){ze(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ze(ki(d,r.config.emulator)&&ki(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,Qo(o)?(ab(`${i}//${o}${c}`),lb("Auth",!0)):TP()}function VE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function wP(t){const e=VE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:t_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:t_(o)}}}function t_(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function TP(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Xr("not implemented")}_getIdTokenResponse(e){return Xr("not implemented")}_linkToIdToken(e,n){return Xr("not implemented")}_getReauthenticationResolver(e){return Xr("not implemented")}}async function CP(t,e){return si(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kP(t,e){return Kl(t,"POST","/v1/accounts:signInWithPassword",ri(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RP(t,e){return Kl(t,"POST","/v1/accounts:signInWithEmailLink",ri(t,e))}async function AP(t,e){return Kl(t,"POST","/v1/accounts:signInWithEmailLink",ri(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol extends D0{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Ol(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Ol(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return e_(e,n,"signInWithPassword",kP);case"emailLink":return RP(e,{email:this._email,oobCode:this._password});default:xr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return e_(e,r,"signUpPassword",CP);case"emailLink":return AP(e,{idToken:n,email:this._email,oobCode:this._password});default:xr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ko(t,e){return Kl(t,"POST","/v1/accounts:signInWithIdp",ri(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP="http://localhost";class Li extends D0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Li(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):xr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Li(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return ko(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ko(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ko(e,n)}buildRequest(){const e={requestUri:PP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Jo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OP(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function LP(t){const e=Da(Ma(t)).link,n=e?Da(Ma(e)).deep_link_id:null,r=Da(Ma(t)).deep_link_id;return(r?Da(Ma(r)).link:null)||r||n||e||t}class M0{constructor(e){const n=Da(Ma(e)),r=n.apiKey??null,s=n.oobCode??null,i=OP(n.mode??null);ze(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=LP(e);try{return new M0(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(){this.providerId=Ui.PROVIDER_ID}static credential(e,n){return Ol._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=M0.parseLink(n);return ze(r,"argument-error"),Ol._fromEmailAndCode(e,r.code,r.tenantId)}}Ui.PROVIDER_ID="password";Ui.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ui.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl extends YE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss extends Xl{constructor(){super("facebook.com")}static credential(e){return Li._fromParams({providerId:Ss.PROVIDER_ID,signInMethod:Ss.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ss.credentialFromTaggedObject(e)}static credentialFromError(e){return Ss.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ss.credential(e.oauthAccessToken)}catch{return null}}}Ss.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ss.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is extends Xl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Li._fromParams({providerId:Is.PROVIDER_ID,signInMethod:Is.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Is.credentialFromTaggedObject(e)}static credentialFromError(e){return Is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Is.credential(n,r)}catch{return null}}}Is.GOOGLE_SIGN_IN_METHOD="google.com";Is.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Xl{constructor(){super("github.com")}static credential(e){return Li._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ws.credential(e.oauthAccessToken)}catch{return null}}}ws.GITHUB_SIGN_IN_METHOD="github.com";ws.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts extends Xl{constructor(){super("twitter.com")}static credential(e,n){return Li._fromParams({providerId:Ts.PROVIDER_ID,signInMethod:Ts.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ts.credentialFromTaggedObject(e)}static credentialFromError(e){return Ts.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Ts.credential(n,r)}catch{return null}}}Ts.TWITTER_SIGN_IN_METHOD="twitter.com";Ts.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(t,e){return Kl(t,"POST","/v1/accounts:signUp",ri(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await gr._fromIdTokenResponse(e,r,s),o=n_(r);return new qs({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=n_(r);return new qs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function n_(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MP(t){var s;if(qn(t.app))return Promise.reject(Zr(t));const e=Fi(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new qs({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await DP(e,{returnSecureToken:!0}),r=await qs._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu extends ni{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,cu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new cu(e,n,r,s)}}function KE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?cu._fromErrorAndOperation(t,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NP(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function XE(t,e,n=!1){const r=await Al(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return qs._forOperation(t,"link",r)}async function jP(t,e,n){await Pl(e);const r=NP(e.providerData);ze(r.has(n)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $P(t,e,n=!1){const{auth:r}=t;if(qn(r.app))return Promise.reject(Zr(r));const s="reauthenticate";try{const i=await Al(t,KE(r,s,e,t),n);ze(i.idToken,r,"internal-error");const o=O0(i.idToken);ze(o,r,"internal-error");const{sub:l}=o;return ze(t.uid===l,r,"user-mismatch"),qs._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&xr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QE(t,e,n=!1){if(qn(t.app))return Promise.reject(Zr(t));const r="signIn",s=await KE(t,r,e),i=await qs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function FP(t,e){return QE(Fi(t),e)}async function UP(t,e){const n=Jt(t);return await jP(!1,n,e.providerId),XE(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BP(t){const e=Fi(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function zP(t,e,n){return qn(t.app)?Promise.reject(Zr(t)):FP(Jt(t),Ui.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&BP(t),r})}function HP(t,e,n,r){return Jt(t).onIdTokenChanged(e,n,r)}function WP(t,e,n){return Jt(t).beforeAuthStateChanged(e,n)}function GP(t,e,n,r){return Jt(t).onAuthStateChanged(e,n,r)}function VP(t){return Jt(t).signOut()}const du="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(du,"1"),this.storage.removeItem(du),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YP=1e3,KP=10;class qE extends JE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);lP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,KP):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},YP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}qE.type="LOCAL";const XP=qE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE extends JE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}ZE.type="SESSION";const eS=ZE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QP(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Xu(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await QP(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Xu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=N0("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===d)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(u),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(){return window}function qP(t){Nr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tS(){return typeof Nr().WorkerGlobalScope<"u"&&typeof Nr().importScripts=="function"}async function ZP(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function eO(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function tO(){return tS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nS="firebaseLocalStorageDb",nO=1,uu="firebaseLocalStorage",rS="fbase_key";class Ql{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Qu(t,e){return t.transaction([uu],e?"readwrite":"readonly").objectStore(uu)}function rO(){const t=indexedDB.deleteDatabase(nS);return new Ql(t).toPromise()}function Mp(){const t=indexedDB.open(nS,nO);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(uu,{keyPath:rS})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(uu)?e(r):(r.close(),await rO(),e(await Mp()))})})}async function r_(t,e,n){const r=Qu(t,!0).put({[rS]:e,value:n});return new Ql(r).toPromise()}async function sO(t,e){const n=Qu(t,!1).get(e),r=await new Ql(n).toPromise();return r===void 0?null:r.value}function s_(t,e){const n=Qu(t,!0).delete(e);return new Ql(n).toPromise()}const iO=800,oO=3;class sS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Mp(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>oO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Xu._getInstance(tO()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await ZP(),!this.activeServiceWorker)return;this.sender=new JP(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||eO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Mp();return await r_(e,du,"1"),await s_(e,du),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>r_(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>sO(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>s_(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Qu(s,!1).getAll();return new Ql(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),iO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}sS.type="LOCAL";const aO=sS;new Yl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lO(t,e){return e?Qr(e):(ze(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0 extends D0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ko(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ko(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ko(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function cO(t){return QE(t.auth,new j0(t),t.bypassAuthState)}function dO(t){const{auth:e,user:n}=t;return ze(n,e,"internal-error"),$P(n,new j0(t),t.bypassAuthState)}async function uO(t){const{auth:e,user:n}=t;return ze(n,e,"internal-error"),XE(n,new j0(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cO;case"linkViaPopup":case"linkViaRedirect":return uO;case"reauthViaPopup":case"reauthViaRedirect":return dO;default:xr(this.auth,"internal-error")}}resolve(e){os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fO=new Yl(2e3,1e4);class yo extends iS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,yo.currentPopupAction&&yo.currentPopupAction.cancel(),yo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ze(e,this.auth,"internal-error"),e}async onExecution(){os(this.filter.length===1,"Popup operations only handle one event");const e=N0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Mr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Mr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Mr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,fO.get())};e()}}yo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hO="pendingRedirect",cd=new Map;class pO extends iS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=cd.get(this.auth._key());if(!e){try{const r=await gO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}cd.set(this.auth._key(),e)}return this.bypassAuthState||cd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function gO(t,e){const n=vO(e),r=yO(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function mO(t,e){cd.set(t._key(),e)}function yO(t){return Qr(t._redirectPersistence)}function vO(t){return ld(hO,t.config.apiKey,t.name)}async function _O(t,e,n=!1){if(qn(t.app))return Promise.reject(Zr(t));const r=Fi(t),s=lO(r,e),o=await new pO(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xO=10*60*1e3;class bO{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!EO(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!oS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Mr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=xO&&this.cachedEventUids.clear(),this.cachedEventUids.has(i_(e))}saveEventToCache(e){this.cachedEventUids.add(i_(e)),this.lastProcessedEventTime=Date.now()}}function i_(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function oS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function EO(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return oS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SO(t,e={}){return si(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wO=/^https?/;async function TO(t){if(t.config.emulator)return;const{authorizedDomains:e}=await SO(t);for(const n of e)try{if(CO(n))return}catch{}xr(t,"unauthorized-domain")}function CO(t){const e=Lp(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!wO.test(n))return!1;if(IO.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kO=new Yl(3e4,6e4);function o_(){const t=Nr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function RO(t){return new Promise((e,n)=>{var s,i,o;function r(){o_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{o_(),n(Mr(t,"network-request-failed"))},timeout:kO.get()})}if((i=(s=Nr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Nr().gapi)!=null&&o.load)r();else{const l=yP("iframefcb");return Nr()[l]=()=>{gapi.load?r():n(Mr(t,"network-request-failed"))},WE(`${mP()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw dd=null,e})}let dd=null;function AO(t){return dd=dd||RO(t),dd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PO=new Yl(5e3,15e3),OO="__/auth/iframe",LO="emulator/auth/iframe",DO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},MO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function NO(t){const e=t.config;ze(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?P0(e,LO):`https://${t.config.authDomain}/${OO}`,r={apiKey:e.apiKey,appName:t.name,v:qo},s=MO.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Jo(r).slice(1)}`}async function jO(t){const e=await AO(t),n=Nr().gapi;return ze(n,t,"internal-error"),e.open({where:document.body,url:NO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:DO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Mr(t,"network-request-failed"),l=Nr().setTimeout(()=>{i(o)},PO.get());function c(){Nr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $O={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},FO=500,UO=600,BO="_blank",zO="http://localhost";class a_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function HO(t,e,n,r=FO,s=UO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...$O,width:r.toString(),height:s.toString(),top:i,left:o},d=Tn().toLowerCase();n&&(l=jE(d)?BO:n),ME(d)&&(e=e||zO,c.scrollbars="yes");const u=Object.entries(c).reduce((f,[E,k])=>`${f}${E}=${k},`,"");if(aP(d)&&l!=="_self")return WO(e||"",l),new a_(null);const h=window.open(e||"",l,u);ze(h,t,"popup-blocked");try{h.focus()}catch{}return new a_(h)}function WO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GO="__/auth/handler",VO="emulator/auth/handler",YO=encodeURIComponent("fac");async function l_(t,e,n,r,s,i){ze(t.config.authDomain,t,"auth-domain-config-required"),ze(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:qo,eventId:s};if(e instanceof YE){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Wd(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof Xl){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await t._getAppCheckToken(),d=c?`#${YO}=${encodeURIComponent(c)}`:"";return`${KO(t)}?${Jo(l).slice(1)}${d}`}function KO({config:t}){return t.emulator?P0(t,VO):`https://${t.authDomain}/${GO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yh="webStorageSupport";class XO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=eS,this._completeRedirectFn=_O,this._overrideRedirectResult=mO}async _openPopup(e,n,r,s){var o;os((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await l_(e,n,r,Lp(),s);return HO(e,i,N0())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await l_(e,n,r,Lp(),s);return qP(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(os(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await jO(e),r=new bO(e);return n.register("authEvent",s=>(ze(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(yh,{type:yh},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[yh];i!==void 0&&n(!!i),xr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=TO(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return zE()||NE()||L0()}}const QO=XO;var c_="@firebase/auth",d_="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ze(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ZO(t){Fo(new Ri("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;ze(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:HE(t)},d=new hP(r,s,i,c);return SP(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Fo(new Ri("auth-internal",e=>{const n=Fi(e.getProvider("auth").getImmediate());return(r=>new JO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),zs(c_,d_,qO(t)),zs(c_,d_,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL=5*60,tL=ob("authIdTokenMaxAge")||eL;let u_=null;const nL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>tL)return;const s=n==null?void 0:n.token;u_!==s&&(u_=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function rL(t=pb()){const e=Xg(t,"auth");if(e.isInitialized())return e.getImmediate();const n=EP(t,{popupRedirectResolver:QO,persistence:[aO,XP,eS]}),r=ob("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=nL(i.toString());WP(n,o,()=>o(n.currentUser)),HP(n,l=>o(l))}}const s=sb("auth");return s&&IP(n,`http://${s}`),n}function sL(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}pP({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Mr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",sL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ZO("Browser");const iL={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},aS=hb(iL),Pr=NA(aS),Jl=rL(aS),$0=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],Ro={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},Or=t=>{for(const e of $0)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},Za=t=>$0.findIndex(e=>e.rank===t),lS=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),Hc=200,f_=100,oL=10,aL=20,lL=(t,e,n)=>{const r=Or(t),s=Or(n),i=Za(r),o=Za(s),l=e+1,c=Math.min((l-1)*oL,f_),d=Math.max(0,o-i),u=Math.min(d*aL,f_),h=100+c+u,f=Math.floor(Hc*h/100),E=t+f,k=Or(E),T=Za(k);return{newRating:E,ratingChange:f,newWinStreak:l,newRank:k,oldRank:r,isRankUp:T>i,isRankDown:!1,bonusBreakdown:{base:Hc,winStreakBonus:Math.floor(Hc*c/100),rankDiffBonus:Math.floor(Hc*u/100),total:f}}},cL=t=>{const e=Or(t),r=-$0.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=Or(s),o=Za(e),l=Za(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:l<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},h_=async(t,e,n)=>{const r=Ar(Pr,`players/${t}`),s=await Vu(r);if(s.exists()){const o=s.val();return o.userId||(await R0(r,{userId:e}),o.userId=e),o}const i={userId:e,playerName:n||"",createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await Gu(r,i),i},cS=async(t,e)=>{const n=Ar(Pr,`players/${t}/ratings/${e}`),r=await Vu(n);if(r.exists())return r.val();const s=lS();return await Gu(n,s),s},dL=async t=>{const e=Ar(Pr,`players/${t}/ratings`),n=await Vu(e);return n.exists()?n.val():{}},uL=async(t,e,n,r)=>{const s=Ar(Pr,`players/${t}/ratings/${e}`),i=Ar(Pr,`players/${t}`);await UA(s,o=>{const l=o||lS();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:l.totalMatches+1,wins:l.wins+(r?1:0),losses:l.losses+(r?0:1)}}),await R0(i,{lastMatchAt:Date.now()})},fL=async(t,e)=>{const n=Ar(Pr,`players/${t}`);await R0(n,{playerName:e})},F0=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},hL=F0("/leaders/azya_leader.png"),pL=F0("/leaders/senka_leader.png"),gL=F0("/leaders/yoRuka_leader.png"),mL=1280,yL=720,vL={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},_L=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:l=!0,onTimerEnabledChange:c,playerId:d})=>{const[u,h]=L.useState(1),[f,E]=L.useState({}),[k,T]=L.useState(!1);L.useEffect(()=>{const q=()=>{const he=window.innerWidth/mL,xe=window.innerHeight/yL;h(Math.min(he,xe))};return q(),window.addEventListener("resize",q),()=>window.removeEventListener("resize",q)},[]),L.useEffect(()=>{(async()=>{if(!d){T(!1);return}T(!0);try{const he=await dL(d);E(he)}catch(he){console.error("Failed to fetch class ratings:",he)}finally{T(!1)}})()},[d]);const N=200*u,v=280*u,_=2*u,S=1.4*u,p=.75*u,D=.65*u,H=1.2*u,ne=`${8*u}px ${16*u}px`,G=q=>{if(n!=="RANKED_MATCH"||!d||k)return null;const he=f[q];if(!he)return null;const xe=Or(he.rating),je=Ro[xe],fe=vL[xe];return a.jsxs("div",{style:{marginTop:`${4*u}px`,padding:`${4*u}px ${8*u}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*u,display:"flex",alignItems:"center",gap:`${6*u}px`},children:[a.jsx("span",{style:{fontSize:`${.7*u}rem`,fontWeight:"bold",color:fe,fontFamily:"Tamanegi, sans-serif"},children:je}),a.jsx("span",{style:{fontSize:`${.75*u}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:he.rating})]})};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[a.jsx("h2",{style:{fontSize:`${_}rem`,marginBottom:`${.5*u}rem`,marginTop:0},children:""}),a.jsxs("div",{style:{marginBottom:`${.8*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("label",{style:{fontSize:`${.9*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),a.jsx("input",{type:"text",value:i,onChange:q=>o(q.target.value),maxLength:12,placeholder:"",style:{padding:`${6*u}px ${12*u}px`,fontSize:`${.9*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*u,color:"white",outline:"none",width:180*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:q=>q.target.style.borderColor="#63b3ed",onBlur:q=>q.target.style.borderColor="#4a5568"})]}),a.jsxs("div",{style:{display:"flex",gap:`${H}rem`,marginBottom:`${1*u}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:N,height:v,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:pL,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),G("SENKA")]})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:N,height:v,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:hL,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),G("AJA")]})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:N,height:v,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:gL,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),G("YORUKA")]})]})]}),n==="CPU"&&s&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsx("div",{style:{display:"flex",gap:`${.6*u}rem`},children:["EASY","NORMAL","HARD"].map(q=>a.jsx("button",{onClick:()=>s(q),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:r===q?q==="EASY"?"#48bb78":q==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${q==="EASY"?"#48bb78":q==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:q==="EASY"?"":q==="NORMAL"?"":""},q))}),a.jsxs("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${.6*u}rem`},children:[a.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),a.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),a.jsx("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:l?"600":""})]}),a.jsx("button",{onClick:e,style:{background:"#333",padding:ne,fontSize:`${.9*u}rem`,marginBottom:`${.5*u}rem`},children:""})]})};class xL{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return bL(e).buffer}}function bL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function dS(t){return new EL(t).unpack()}function uS(t){const e=new SL,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class EL{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class SL{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,l=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new xL,this._textEncoder=new TextEncoder}}let fS=!0,hS=!0;function Na(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Bi(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,l){if(o!==e)return s.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function IL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(fS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function wL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(hS=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function pS(){if(typeof window=="object"){if(fS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function U0(t,e){hS&&console.warn(t+" is deprecated, please use "+e+" instead.")}function TL(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Na(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Na(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Na(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Na(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function p_(t){return Object.prototype.toString.call(t)==="[object Object]"}function gS(t){return p_(t)?Object.keys(t).reduce(function(e,n){const r=p_(t[n]),s=r?gS(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function Np(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Np(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{Np(t,t.get(s),n)})}))}function g_(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(l=>{l.type===r&&l.trackId===o.id&&Np(t,l,s)})}),s}const m_=pS;function mS(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,E){return f?f+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",d)]=u.ideal,c.optional.push(f),f={},f[h("max",d)]=u.ideal,c.optional.push(f)):(f[h("",d)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,d)]=u[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(k=>k.kind==="videoinput");let E=f.find(k=>h.some(T=>k.label.toLowerCase().includes(T)));return!E&&f.length&&h.includes("back")&&(E=f[f.length-1]),E&&(l.video.deviceId=d.exact?{exact:E.deviceId}:{ideal:E.deviceId}),l.video=r(l.video),m_("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return m_("chrome: "+JSON.stringify(l)),c(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,c,d){s(l,u=>{n.webkitGetUserMedia(u,c,h=>{d&&d(i(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function yS(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function vS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Bi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function _S(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=s.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(c=>c.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function xS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>g_(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),Bi(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>g_(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(l=>{l.track===r&&(s?o=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function bS(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(o);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function ES(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return bS(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(E=>E.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(T=>T===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const k=this._streams[h.id];if(k)k.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new t.MediaStream([u]);this._streams[h.id]=T,this._reverseStreams[T.id]=h,this.addStream(T)}return this.getSenders().find(T=>T.track===u)};function i(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const E=d._reverseStreams[f],k=d._streams[E.id];h=h.replace(new RegExp(k.id,"g"),E.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const E=d._reverseStreams[f],k=d._streams[E.id];h=h.replace(new RegExp(E.id,"g"),k.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],h={[d](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[k=>{const T=i(this,k);f[0].apply(null,[T])},k=>{f[1]&&f[1].apply(null,k)},arguments[2]]):u.apply(this,arguments).then(k=>i(this,k))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:i(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(T=>u.track===T)&&(f=this._streams[E])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function jp(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function SS(t,e){Bi(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const y_=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:SS,shimAddTrackRemoveTrack:ES,shimAddTrackRemoveTrackWithNative:bS,shimGetSendersWithDtmf:_S,shimGetUserMedia:mS,shimMediaStream:yS,shimOnTrack:vS,shimPeerConnection:jp,shimSenderReceiverGetStats:xS},Symbol.toStringTag,{value:"Module"}));function IS(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){U0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,l,c){l in o&&!(c in o)&&(o[c]=o[l],delete o[l])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const l=o.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function CL(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function wS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $p(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,l)}}function TS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function CS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Bi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function kS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){U0("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function RS(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function AS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function PS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function OS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function LS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const v_=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:AS,shimCreateAnswer:LS,shimCreateOffer:OS,shimGetDisplayMedia:CL,shimGetParameters:PS,shimGetUserMedia:IS,shimOnTrack:wS,shimPeerConnection:$p,shimRTCDataChannel:RS,shimReceiverGetStats:CS,shimRemoveStream:kS,shimSenderGetStats:TS},Symbol.toStringTag,{value:"Module"}));function DS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function MS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function NS(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f},e.createAnswer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f};let l=function(c,d,u){const h=s.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,d,u){const h=i.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,d,u){const h=o.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.addIceCandidate=l}function jS(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r($S(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function $S(t){return t&&t.video!==void 0?Object.assign({},t,{video:gS(t.video)}):t}function FS(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];l.urls===void 0&&l.url?(U0("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function US(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function BS(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function zS(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const __=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:zS,shimCallbacksAPI:NS,shimConstraints:$S,shimCreateOfferLegacy:BS,shimGetUserMedia:jS,shimLocalStreamsAPI:DS,shimRTCIceServerUrls:FS,shimRemoteStreamsAPI:MS,shimTrackEventTransceiver:US},Symbol.toStringTag,{value:"Module"}));var HS={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){const c=i[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{o.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(k=>parseInt(k,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let E={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&d&&(E.rtx={ssrc:d}),r.push(E),i&&(E=JSON.parse(JSON.stringify(E)),E.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(E))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(HS);var WS=HS.exports;const Ao=j_(WS),kL=DI({__proto__:null,default:Ao},[WS]);function ud(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Ao.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Bi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Fp(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Bi(t,"icecandidate",e=>{if(e.candidate){const n=Ao.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function fd(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Ao.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=Ao.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=Ao.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=s(c),u=i(arguments[0],c);let h;d===0&&u===0?h=Number.POSITIVE_INFINITY:d===0||u===0?h=Math.max(d,u):h=Math.min(d,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function hd(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},Bi(t,"datachannel",r=>(e(r.channel,r.target),r))}function Up(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Bp(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function pd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function gd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const RL=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Bp,shimAddIceCandidateNullOrEmpty:pd,shimConnectionState:Up,shimMaxMessageSize:fd,shimParameterlessSetLocalDescription:gd,shimRTCIceCandidate:ud,shimRTCIceCandidateRelayProtocol:Fp,shimSendThrowTypeError:hd},Symbol.toStringTag,{value:"Module"}));function AL({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=pS,r=TL(t),s={browserDetails:r,commonShim:RL,extractVersion:Na,disableLog:IL,disableWarnings:wL,sdp:kL};switch(r.browser){case"chrome":if(!y_||!jp||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=y_,pd(t,r),gd(t),mS(t,r),yS(t),jp(t,r),vS(t),ES(t,r),_S(t),xS(t),SS(t,r),ud(t),Fp(t),Up(t),fd(t,r),hd(t),Bp(t,r);break;case"firefox":if(!v_||!$p||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=v_,pd(t,r),gd(t),IS(t,r),$p(t,r),wS(t),kS(t),TS(t),CS(t),RS(t),AS(t),PS(t),OS(t),LS(t),ud(t),Up(t),fd(t,r),hd(t);break;case"safari":if(!__||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=__,pd(t,r),gd(t),FS(t),BS(t),NS(t),DS(t),MS(t),US(t),jS(t),zS(t),ud(t),Fp(t),fd(t,r),hd(t),Bp(t,r);break;default:n("Unsupported browser!");break}return s}const x_=AL({window:typeof window>"u"?void 0:window});function zi(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class GS{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const l=Math.min(r,o+this.chunkedMTU),c=e.slice(o,l),d={__peerData:this._dataCount,n:i,data:c,total:s};n.push(d),o=l,i++}return this._dataCount++,n}}}function PL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const vh=x_.default||x_,Ra=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return vh.browserDetails.browser}getVersion(){return vh.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=vh.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},OL=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),VS=()=>Math.random().toString(36).slice(2),b_={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class LL extends GS{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=b_,this.browser=Ra.getBrowser(),this.browserVersion=Ra.getVersion(),this.pack=uS,this.unpack=dS,this.supports=function(){const n={browser:Ra.isBrowserSupported(),webRTC:Ra.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(b_),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Ra.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=OL,this.randomToken=VS}}const Pn=new LL,DL="PeerJS: ";class ML{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[DL,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var ke=new ML,B0={},NL=Object.prototype.hasOwnProperty,Cn="~";function Ll(){}Object.create&&(Ll.prototype=Object.create(null),new Ll().__proto__||(Cn=!1));function jL(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function YS(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new jL(n,r||t,s),o=Cn?Cn+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function md(t,e){--t._eventsCount===0?t._events=new Ll:delete t._events[e]}function vn(){this._events=new Ll,this._eventsCount=0}vn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)NL.call(n,r)&&e.push(Cn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};vn.prototype.listeners=function(e){var n=Cn?Cn+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};vn.prototype.listenerCount=function(e){var n=Cn?Cn+e:e,r=this._events[n];return r?r.fn?1:r.length:0};vn.prototype.emit=function(e,n,r,s,i,o){var l=Cn?Cn+e:e;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var f=c.length,E;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,s);break;default:if(!u)for(E=1,u=new Array(d-1);E<d;E++)u[E-1]=arguments[E];c[h].fn.apply(c[h].context,u)}}return!0};vn.prototype.on=function(e,n,r){return YS(this,e,n,r,!1)};vn.prototype.once=function(e,n,r){return YS(this,e,n,r,!0)};vn.prototype.removeListener=function(e,n,r,s){var i=Cn?Cn+e:e;if(!this._events[i])return this;if(!n)return md(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&md(this,i);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==n||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:md(this,i)}return this};vn.prototype.removeAllListeners=function(e){var n;return e?(n=Cn?Cn+e:e,this._events[n]&&md(this,n)):(this._events=new Ll,this._eventsCount=0),this};vn.prototype.off=vn.prototype.removeListener;vn.prototype.addListener=vn.prototype.on;vn.prefixed=Cn;vn.EventEmitter=vn;B0=vn;var Hi={};zi(Hi,"ConnectionType",()=>Gs);zi(Hi,"PeerErrorType",()=>Gt);zi(Hi,"BaseConnectionErrorType",()=>zp);zi(Hi,"DataConnectionErrorType",()=>z0);zi(Hi,"SerializationType",()=>Ju);zi(Hi,"SocketEventType",()=>Ps);zi(Hi,"ServerMessageType",()=>gn);var Gs=function(t){return t.Data="data",t.Media="media",t}({}),Gt=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),zp=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),z0=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),Ju=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),Ps=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),gn=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const KS="1.5.5";class $L extends B0.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+KS),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),ke.log("Server message received:",i)}catch{ke.log("Invalid server message",s.data);return}this.emit(Ps.Message,i)},this._socket.onclose=s=>{this._disconnected||(ke.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(Ps.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),ke.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){ke.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:gn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Ps.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class XS{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Gs.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){ke.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;ke.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(ke.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:gn.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":ke.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(zp.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":ke.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(zp.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":ke.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},ke.log("Listening for data channel"),e.ondatachannel=o=>{ke.log("Received data channel");const l=o.channel;i.getConnection(n,r)._initializeDataChannel(l)},ke.log("Listening for remote stream"),e.ontrack=o=>{ke.log("Received remote stream");const l=o.streams[0],c=i.getConnection(n,r);if(c.type===Gs.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){ke.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);ke.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),ke.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Gs.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:gn.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Gt.WebRTC,s),ke.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(Gt.WebRTC,r),ke.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();ke.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),ke.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:gn.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(Gt.WebRTC,s),ke.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(Gt.WebRTC,r),ke.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;ke.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),ke.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(Gt.WebRTC,o),ke.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){ke.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),ke.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(Gt.WebRTC,n),ke.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(ke.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return ke.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){ke.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class QS extends B0.EventEmitter{emitError(e,n){ke.error("Error:",n),this.emit("error",new FL(`${e}`,n))}}class FL extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class JS extends QS{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var Wp;const tl=class tl extends JS{get type(){return Gs.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||tl.ID_PREFIX+Pn.randomToken(),this._negotiator=new XS(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{ke.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{ke.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){ke.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case gn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case gn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:ke.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){ke.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Wp=new WeakMap,ga(tl,Wp,tl.ID_PREFIX="mc_");let fu=tl;class UL{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,l=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",KS),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){ke.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Pn.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Pn.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw ke.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var Gp,Vp;const gi=class gi extends JS{get type(){return Gs.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||gi.ID_PREFIX+VS(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new XS(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{ke.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{ke.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{ke.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(z0.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case gn.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case gn.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:ke.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};Gp=new WeakMap,Vp=new WeakMap,ga(gi,Gp,gi.ID_PREFIX="dc_"),ga(gi,Vp,gi.MAX_BUFFERED_AMOUNT=8388608);let hu=gi;class H0 extends hu{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>hu.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return ke.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class _h extends H0{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new GS,this.serialization=Ju.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=dS(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=PL(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=uS(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);ke.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class BL extends H0{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Ju.None}}class zL extends H0{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Pn.chunkedMTU){this.emitError(z0.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Ju.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Yp;const nl=class nl extends QS{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:BL,json:zL,binary:_h,"binary-utf8":_h,default:_h},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Pn.CLOUD_HOST,port:Pn.CLOUD_PORT,path:"/",key:nl.DEFAULT_KEY,token:Pn.randomToken(),config:Pn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Pn.CLOUD_HOST?this._options.secure=Pn.isSecure():this._options.host==Pn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&ke.setLogFunction(this._options.logFunction),ke.logLevel=this._options.debug||0,this._api=new UL(n),this._socket=this._createServerConnection(),!Pn.supports.audioVideo&&!Pn.supports.data){this._delayedAbort(Gt.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Pn.validateId(r)){this._delayedAbort(Gt.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(Gt.ServerError,s))}_createServerConnection(){const e=new $L(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Ps.Message,n=>{this._handleMessage(n)}),e.on(Ps.Error,n=>{this._abort(Gt.SocketError,n)}),e.on(Ps.Disconnected,()=>{this.disconnected||(this.emitError(Gt.Network,"Lost connection to server."),this.disconnect())}),e.on(Ps.Close,()=>{this.disconnected||this._abort(Gt.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case gn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case gn.Error:this._abort(Gt.ServerError,r.msg);break;case gn.IdTaken:this._abort(Gt.UnavailableID,`ID "${this.id}" is taken`);break;case gn.InvalidKey:this._abort(Gt.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case gn.Leave:ke.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case gn.Expire:this.emitError(Gt.PeerUnavailable,`Could not connect to peer ${s}`);break;case gn.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),ke.warn(`Offer received for existing Connection ID:${i}`)),r.type===Gs.Media){const c=new fu(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===Gs.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{ke.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(i);for(const c of l)o.handleMessage(c);break}default:{if(!r){ke.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):ke.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){ke.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Gt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){ke.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Gt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){ke.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new fu(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){ke.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){ke.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(ke.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;ke.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)ke.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)ke.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(Gt.ServerError,n))}};Yp=new WeakMap,ga(nl,Yp,nl.DEFAULT_KEY="peerjs");let Hp=nl;var qS=Hp;class ZS{constructor(){on(this,"peer",null);on(this,"conn",null);on(this,"isHost",!1);on(this,"messageCallback",null);on(this,"connectionCallback",null);on(this,"closeCallback",null)}async connect(e){return this.peer=new qS,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const HL=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=L.useState(""),[l,c]=L.useState(!1),[d,u]=L.useState(!0),[h,f]=L.useState(null),[E,k]=L.useState(!1),[T,N]=L.useState(null),[v,_]=L.useState(!1),S=L.useRef(null);L.useEffect(()=>{const H=new ZS;return S.current=H,(async()=>{try{const G=await H.connect(t==="JOIN"?e:void 0);o(G),u(!1),H.onMessage(q=>{console.log("[LobbyScreen] Received message:",q),q.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",q.playerClass),N(q.playerClass))}),H.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(G){console.error("[LobbyScreen] Connection error:",G),f(G.toString()),u(!1)}})(),()=>{var G;(G=S.current)!=null&&G.isConnected()||H.disconnect()}},[t,e]),L.useEffect(()=>{l&&S.current&&!v&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var H;(H=S.current)==null||H.send({type:"CLASS_INFO",playerClass:n}),_(!0)},100))},[l,n,v]),L.useEffect(()=>{if(l&&S.current&&T){const H=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",T),r(S.current,T)},500);return()=>clearTimeout(H)}},[l,r,T]);const p=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const H=document.createElement("textarea");H.value=i,H.style.position="fixed",H.style.left="-999999px",H.style.top="-999999px",document.body.appendChild(H),H.focus(),H.select(),document.execCommand("copy"),document.body.removeChild(H)}k(!0),setTimeout(()=>k(!1),2e3)}catch(H){console.error("Failed to copy:",H),alert(`Room ID: ${i}

()`)}},D=()=>{S.current&&(S.current.disconnect(),S.current=null),s()};return a.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[a.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[h&&a.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[a.jsx("p",{children:""}),a.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:h})]}),d&&!h&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!d&&!l&&!h&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[a.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),a.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),a.jsx("button",{onClick:p,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:E?"#48bb78":"transparent",border:"2px solid "+(E?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:E?" ":"ID"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!d&&!l&&!h&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),l&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),a.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),a.jsx("button",{onClick:D,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:H=>{H.currentTarget.style.color="#fff",H.currentTarget.style.borderColor="#fff"},onMouseOut:H=>{H.currentTarget.style.color="#888",H.currentTarget.style.borderColor="#888"},children:" "}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class WL{constructor(){on(this,"myEntryRef",null);on(this,"listenerUnsubscribe",null);on(this,"myId","");on(this,"myPeerId","");on(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,l,c){this.myPeerId=e,this.hasMatched=!1;const d=Ar(Pr,`matchmaking/${s}`);try{const u=await Vu(d),h=[];if(u.exists()&&u.forEach(T=>{const N=T.val(),v=Date.now()-N.timestamp<5*60*1e3;N.peerId!==e&&v&&h.push({key:T.key,data:N})}),h.length>0){const T=h.sort((N,v)=>N.data.timestamp-v.data.timestamp)[0];await Bc(Ar(Pr,`matchmaking/${s}/${T.key}`)),i("matched"),o({peerId:T.data.peerId,playerName:T.data.playerName,playerClass:T.data.playerClass,isHost:!1,playerId:T.data.playerId,rating:T.data.rating});return}i("searching");const f=CA(d);this.myEntryRef=f,this.myId=f.key;const E={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...l!=null&&{playerId:l},...c!=null&&{rating:c},timestamp:Date.now()};await Gu(f,E),TA(f).remove();const k=s;this.listenerUnsubscribe=TE(d,async T=>{if(this.hasMatched||!T.exists())return;let N=!1,v=null;if(T.forEach(_=>{const S=_.val();_.key===this.myId?N=!0:S.peerId!==this.myPeerId&&(!v||S.timestamp>v.data.timestamp)&&(v={key:_.key,data:S})}),!N&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(v!==null&&N){const _=T.child(this.myId).val(),S=v;if(_&&_.timestamp<S.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await Bc(Ar(Pr,`matchmaking/${k}/${S.key}`)),await Bc(Ar(Pr,`matchmaking/${k}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:S.data.peerId,playerName:S.data.playerName,playerClass:S.data.playerClass,isHost:!0,playerId:S.data.playerId,rating:S.data.rating})}}})}catch(u){console.error("[Matchmaking] Error:",u),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await Bc(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const Wc=new WL;class E_{constructor(e,n,r=!1){on(this,"peer");on(this,"conn");on(this,"isHost",!1);on(this,"messageCallback",null);on(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const GL=1280,VL=720,S_={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},YL=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,l]=L.useState("idle"),[c,d]=L.useState("..."),[u,h]=L.useState(0),f=L.useRef(null),E=L.useRef(null),k=L.useRef(null),T=L.useRef(!1),N=L.useRef(!1),[v,_]=L.useState(0),[S,p]=L.useState(void 0),[D,H]=L.useState(1);L.useEffect(()=>{const q=()=>{const he=window.innerWidth/GL,xe=window.innerHeight/VL;H(Math.min(he,xe))};return q(),window.addEventListener("resize",q),()=>window.removeEventListener("resize",q)},[]),L.useEffect(()=>{if(o!=="searching")return;const q=setInterval(()=>{h(he=>{const xe=he+1;return xe>=60&&(l("error"),d(""),Wc.cancelMatchmaking(),E.current&&E.current.close(),f.current&&f.current.destroy()),xe})},1e3);return()=>clearInterval(q)},[o]),L.useEffect(()=>{let q=!0,he=0;return(async()=>{try{if(t==="ranked"&&r)try{he=(await cS(r,e)).rating,_(he)}catch(ie){console.error("[Matchmaking] Failed to get rating:",ie)}const je=new qS({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=je,await new Promise((ie,P)=>{je.on("open",()=>ie()),je.on("error",w=>P(w))}),!q)return;const fe=je.id;console.log("[Matchmaking] My PeerJS ID:",fe),je.on("connection",ie=>{console.log("[Matchmaking] Incoming connection from:",ie.peer),E.current=ie,ie.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),ie.on("data",P=>{if(P.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",P),ie.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?he:void 0}),q&&t==="ranked"&&p(P.rating),N.current=!0;const w=new E_(je,ie,!0);s(w,P.playerClass,!0,P.playerId,P.rating)}})})}),Wc.startMatchmaking(fe,n,e,t,ie=>{if(q)switch(l(ie),ie){case"searching":d("...");break;case"matched":d("...");break;case"error":d("");break}},async ie=>{if(q)if(console.log("[Matchmaking] Match found:",ie),k.current=ie,T.current=ie.isHost,ie.isHost)d("...");else{d("...");const P=je.connect(ie.peerId,{reliable:!0});E.current=P,P.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),P.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?he:void 0}),P.on("data",w=>{if(w.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",w),q&&t==="ranked"&&p(w.rating),N.current=!0;const C=new E_(je,P,!1);s(C,w.playerClass,!1,w.playerId,w.rating)}})}),P.on("error",w=>{console.error("[Matchmaking] Connection error:",w),l("error"),d("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?he:void 0)}catch(je){console.error("[Matchmaking] Init error:",je),q&&(l("error"),d(""))}})(),()=>{q=!1,Wc.cancelMatchmaking(),N.current||(E.current&&E.current.close(),f.current&&f.current.destroy())}},[t,e,n,r,s]);const ne=async()=>{await Wc.cancelMatchmaking(),E.current&&E.current.close(),f.current&&f.current.destroy(),i()},G=q=>{const he=Math.floor(q/60),xe=q%60;return`${he}:${xe.toString().padStart(2,"0")}`};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[a.jsx("div",{style:{fontSize:`${1.2*D}rem`,color:"#4ade80",marginBottom:`${1*D}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),a.jsx("div",{style:{fontSize:`${2*D}rem`,fontWeight:"bold",marginBottom:`${1*D}rem`,textAlign:"center"},children:c}),o==="searching"&&a.jsxs("div",{style:{fontSize:`${1.5*D}rem`,color:"#888",marginBottom:`${2*D}rem`},children:[": ",G(u)]}),(o==="searching"||o==="matched")&&a.jsx("div",{style:{width:80*D,height:80*D,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*D}rem`}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*D}rem`,marginBottom:`${2*D}rem`,padding:`${1*D}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*D},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*D}rem`},children:[a.jsx("div",{style:{fontSize:`${1*D}rem`},children:n||""}),a.jsx("div",{style:{fontSize:`${.9*D}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&v>0&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*D}rem`,fontSize:`${.85*D}rem`,color:"#aaa"},children:[a.jsx("span",{style:{fontWeight:"bold",color:S_[Or(v)],fontFamily:"Tamanegi, sans-serif"},children:Ro[Or(v)]}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:v})]}),t==="ranked"&&o==="matched"&&S!==void 0&&a.jsxs("div",{style:{marginTop:`${.5*D}rem`,padding:`${.5*D}rem ${1*D}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*D,fontSize:`${.8*D}rem`,color:"#aaa"},children:[": ",a.jsx("span",{style:{fontWeight:"bold",color:S_[Or(S)],fontFamily:"Tamanegi, sans-serif"},children:Ro[Or(S)]})," ",S]})]}),o!=="error"&&a.jsx("button",{onClick:ne,style:{padding:`${.8*D}rem ${2*D}rem`,fontSize:`${1*D}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*D,cursor:"pointer",transition:"all 0.2s"},onMouseOver:q=>{q.currentTarget.style.background="#e94560",q.currentTarget.style.color="white"},onMouseOut:q=>{q.currentTarget.style.background="transparent",q.currentTarget.style.color="#e94560"},children:""}),o==="error"&&a.jsx("button",{onClick:i,style:{padding:`${.8*D}rem ${2*D}rem`,fontSize:`${1*D}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*D,cursor:"pointer"},children:""}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},KL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},to=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:l,isSpecialSummoning:c,className:d,suppressPassives:u,isMyTurn:h,scale:f=1})=>{const E="currentAttack"in t?t.currentAttack:t.attack,k="currentHealth"in t?t.currentHealth:t.health,T="maxHealth"in t?t.maxHealth:t.health,N="canAttack"in t?t.canAttack:!1,v="turnPlayed"in t?t.turnPlayed:void 0,[_,S]=$.useState(!1);$.useEffect(()=>{if(c&&l){S(!0);const M=setTimeout(()=>S(!1),800);return()=>clearTimeout(M)}},[c,l]);const p="baseAttack"in t?t.baseAttack:void 0,D="baseHealth"in t?t.baseHealth:void 0,H=p!==void 0&&E>p,ne=D!==void 0&&(k>D||T>D),G="hasEvolved"in t?t.hasEvolved:!1,q="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,he=G&&q?q:t.imageUrl,xe=he?KL(he):void 0;let je=n==null?void 0:n.boxShadow,fe;const ie=t.passiveAbilities||t.abilities||[],P=ie.includes("WARD"),w=ie.includes("AURA"),C=ie.includes("STEALTH"),y=t.hasBarrier===!0||ie.includes("BARRIER")&&t.hasBarrier!==!1;if(r)je="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)je="0 0 10px #48bb78",fe="2px solid #48bb78";else if(N&&h){const M=ie.includes("STORM"),Q=ie.includes("RUSH"),F=o!==void 0&&v!==void 0&&v===o;let ye=!1;M||(F?ye=!0:(o===void 0||v===void 0)&&(ye=Q)),ye?je="0 0 10px #f6e05e":je="0 0 10px #48bb78"}const g=k<T;if(i==="art-only")return a.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:xe?a.jsx("img",{src:xe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const Q=t.type==="SPELL"?16:6,F=28*f,ye=.85*f;return a.jsxs("div",{className:`card mobile-hand ${d||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:je||(n==null?void 0:n.boxShadow),border:fe||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${Q}px ${Q}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${Q}px ${Q}px 6px 6px`},children:xe?a.jsx("img",{src:xe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),a.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[a.jsx("div",{style:{width:F,height:F,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${ye}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:F,height:F,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:F,height:F,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),a.jsx("span",{style:{zIndex:1,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${ye}rem`,textShadow:"0 1px 2px black"},children:E})]}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:F,height:F,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:F,height:F,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),a.jsx("span",{style:{zIndex:1,color:ne?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${ye}rem`,textShadow:"0 1px 2px black"},children:k})]})]})]})}const I=t.type==="SPELL"&&!l,A=I?20:8;return a.jsxs("div",{className:`card card-container ${N?"ready":""} ${l?"on-board":""} ${d||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:je||(N?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:fe||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:_?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:I?`${A}px ${A}px 8px 8px`:"8px"},onClick:e,children:[!l&&a.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:I?`${A}px ${A}px 0 0`:"8px 8px 0 0"},children:t.name}),a.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:l?"8px":"0 0 8px 8px",minHeight:0},children:[a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:l?"8px":"0 0 8px 8px",zIndex:1},children:[xe?a.jsx("img",{src:xe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!l&&a.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{position:"absolute",bottom:l?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),a.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),a.jsx("span",{style:{zIndex:11,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:E})]}),a.jsxs("div",{style:{position:"absolute",bottom:2*f,right:l?2*f:"auto",left:l?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f56565"}),a.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),a.jsx("span",{style:{zIndex:11,color:ne?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:k})]})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:P&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:y&&!_&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:w&&!_&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:C&&!_&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),_&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),a.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},XL=35e5;function eI(){const[t,e]=L.useState(()=>I_());return L.useEffect(()=>{const n=()=>{e(I_())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function I_(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>XL;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function QL(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const yd=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Gc=t=>yd(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),JL=yd("/assets/VS.png"),Kn=8,xh=240,qL=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:l,onOrbLand:c,onFadeInBoard:d,isMobile:u=!1})=>{const[h,f]=L.useState("fade-in"),[E,k]=L.useState(!1),{isLightMode:T}=eI(),N=QL(T),[v,_]=L.useState(1),[S,p]=L.useState(1),[D,H]=L.useState(0),[ne,G]=L.useState(0),[q,he]=L.useState(1),[xe,je]=L.useState({myX:0,myY:0,opX:0,opY:0}),[fe,ie]=L.useState(0),[P,w]=L.useState(0),[C,y]=L.useState([]),g=L.useMemo(()=>{const Y=window.innerWidth,Pe=window.innerHeight,be=s,We=(u?280:340)*be,we=Y-We,Me=We+we/2,mt=Me,tt=Pe- -20*be-xh*be/2,st=Me,Ke=-20*be+xh*be/2;return{player:{x:mt,y:tt},opponent:{x:st,y:Ke},leaderSize:xh*be}},[u,s]),I=L.useMemo(()=>{const Y=window.innerWidth,Pe=window.innerHeight,be=Y*.25,We=Pe*.5,we=Y*.75,Me=Pe*.5;return{myX:be,myY:We,opX:we,opY:Me}},[]),A=T?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,M=T?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,Q=N.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";L.useEffect(()=>{const Y={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(h==="complete"){d==null||d();const We=setTimeout(()=>{r()},700);return()=>clearTimeout(We)}const Pe={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},be=setTimeout(()=>{const We=Pe[h];We&&f(We)},Y[h]||1e3);return()=>clearTimeout(be)},[h,r,n]),L.useEffect(()=>{if(h==="vs-display"){const Y=setTimeout(()=>{k(!0),i==null||i(),setTimeout(()=>k(!1),300)},800);return()=>clearTimeout(Y)}},[h,i]),L.useEffect(()=>{h==="coin-toss"&&(o==null||o())},[h,o]),L.useEffect(()=>{if(h==="leaders-enter"){const Y=setTimeout(()=>{l==null||l()},1e3);return()=>clearTimeout(Y)}},[h,l]),L.useEffect(()=>{h==="nameplate"&&(l==null||l())},[h,l]),L.useEffect(()=>{if(h==="leader-to-orb"){const Pe=Date.now();let be;const We=()=>{const we=Date.now()-Pe,Me=Math.min(we/800,1),mt=1-Math.pow(1-Me,3);_(1-mt*.7),p(1-mt),H(mt*1.5),G(Math.min(mt*1.5,1)),Me<1&&(be=requestAnimationFrame(We))};return je(I),be=requestAnimationFrame(We),()=>cancelAnimationFrame(be)}},[h,I]),L.useEffect(()=>{if(h==="orb-pause"){const Pe=Date.now();let be;const We=()=>{const we=Date.now()-Pe,Me=Math.min(we/800,1);he(1-Me),Me<1&&(be=requestAnimationFrame(We))};return be=requestAnimationFrame(We),()=>cancelAnimationFrame(be)}},[h]),L.useEffect(()=>{if(h==="orb-fly"){const Pe=Date.now();let be;const We=I.myX,we=I.myY,Me=I.opX,mt=I.opY,tt=g.player.x,st=g.player.y,Ke=g.opponent.x,Ne=g.opponent.y,nt=()=>{const yt=Date.now()-Pe,kt=Math.min(yt/900,1),se=kt*kt*kt,Fe=We-200*s,z=(we+st)/2+100*s,ut=(1-se)*(1-se)*We+2*(1-se)*se*Fe+se*se*tt,vt=(1-se)*(1-se)*we+2*(1-se)*se*z+se*se*st,sr=Me+200*s,ii=(mt+Ne)/2-100*s,ra=(1-se)*(1-se)*Me+2*(1-se)*se*sr+se*se*Ke,ls=(1-se)*(1-se)*mt+2*(1-se)*se*ii+se*se*Ne;je({myX:ut,myY:vt,opX:ra,opY:ls}),H(1.5-se*1),kt<1&&(be=requestAnimationFrame(nt))};return be=requestAnimationFrame(nt),()=>cancelAnimationFrame(be)}},[h,I,g,s]),L.useEffect(()=>{if(h==="leader-appear"){const Pe=Date.now();let be;c==null||c(),k(!0),setTimeout(()=>k(!1),300);const We=g.player.x,we=g.player.y,Me=g.opponent.x,mt=g.opponent.y,tt=24,st=[];for(let nt=0;nt<tt;nt++){const yt=nt/tt*360+(Math.random()-.5)*15;st.push({id:nt,x:We,y:we,angle:yt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let nt=0;nt<tt;nt++){const yt=nt/tt*360+(Math.random()-.5)*15;st.push({id:tt+nt,x:Me,y:mt,angle:yt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}y(st);const Ke=setTimeout(()=>{y([])},800),Ne=()=>{const nt=Date.now()-Pe,yt=Math.min(nt/600,1),kt=1-Math.pow(1-yt,3);G(1-kt),ie(kt),w(kt),yt<1&&(be=requestAnimationFrame(Ne))};return be=requestAnimationFrame(Ne),()=>{cancelAnimationFrame(be),clearTimeout(Ke)}}},[h,c,g]);const F=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(h),ye=F>=3&&F<=9,R=F>=0&&F<=7,Ie=`polygon(0 0, ${50+Kn}% 0, ${50-Kn}% 100%, 0 100%)`,te=`polygon(${50+Kn}% 0, 100% 0, 100% 100%, ${50-Kn}% 100%)`;return a.jsxs("div",{style:{position:"fixed",inset:0,background:F>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:E?"screenShake 0.3s ease-in-out":void 0,pointerEvents:F>=9?"none":"auto"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:h==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),R&&a.jsxs("div",{style:{opacity:q,transition:"opacity 0.3s"},children:[F>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Ie,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${F>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:S},children:a.jsx("img",{src:Gc(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${v})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),F>=2&&F<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name})}),F>=5&&F<6&&a.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),F>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:te,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${F>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:S},children:a.jsx("img",{src:Gc(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${v})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),F>=2&&F<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name})}),F>=5&&F<6&&a.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),F>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:Q}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:Q}}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:Q}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),a.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),a.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),a.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:N.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Kn-.2}%`,y1:"0",x2:`${50-Kn-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:T?void 0:"url(#cyanGlow)",style:{animation:Q}})]})]}),F>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:M,zIndex:100,animation:Q,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:M,zIndex:100,animation:Q,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:M,zIndex:100,animation:Q,animationDelay:"0.3s"}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),a.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),a.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),a.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:N.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Kn+.2}%`,y1:"0",x2:`${50-Kn+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:T?void 0:"url(#pinkGlow)",style:{animation:Q,animationDelay:"0.3s"}})]})]})]}),F>=6&&F<=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:xe.myX,top:xe.myY,transform:`translate(-50%, -50%) scale(${D})`,opacity:ne,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:T?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),a.jsx("div",{style:{position:"fixed",left:xe.opX,top:xe.opY,transform:`translate(-50%, -50%) scale(${D})`,opacity:ne,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:T?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),F>=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:g.player.x,top:g.player.y,transform:`translate(-50%, -50%) scale(${fe})`,opacity:P,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Gc(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),a.jsx("div",{style:{position:"fixed",left:g.opponent.x,top:g.opponent.y,transform:`translate(-50%, -50%) scale(${fe})`,opacity:P,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Gc(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),C.map(Y=>a.jsx("div",{style:{position:"fixed",left:Y.x,top:Y.y,width:Y.size*s,height:Y.size*s,borderRadius:"50%",background:Y.color,boxShadow:`0 0 ${Y.size*.5*s}px ${Y.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${Y.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${Y.angle}deg`,"--particle-dist":`${Y.dist*s}px`}},Y.id)),ye&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:F===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:F>=7?Math.max(0,q):1,zIndex:200,pointerEvents:"none"},children:a.jsx("img",{src:JL,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),F>=4&&F<5&&a.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:a.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),a.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},ZL=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,l]=L.useState("start"),[c,d]=L.useState(null),[u,h]=L.useState([]);L.useEffect(()=>{if(e.current){const E=e.current.getBoundingClientRect();d({x:E.left+E.width/2,y:E.top+E.height/2,size:E.width})}},[e]),L.useEffect(()=>{r==null||r(o)},[o,r]),L.useEffect(()=>{const E={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const k={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},T=setTimeout(()=>{const N=k[o];N&&l(N)},E[o]||1e3);return()=>clearTimeout(T)},[o,n]),L.useEffect(()=>{if(o==="explode"&&c){const k=Array.from({length:60},(_,S)=>{const p=S/60*360,D=(Math.random()-.5)*12,H=p+D,ne=150+Math.random()*250,G=12+Math.random()*20;return{id:S,x:c.x,y:c.y,angle:H,distance:ne,size:G,delay:Math.random()*.1,duration:.6+Math.random()*.4}});h(k),s==null||s(1);const T=1e3,N=Date.now(),v=setInterval(()=>{const S=(Date.now()-N)/T;if(S>=1)s==null||s(0),clearInterval(v);else{const p=1-Math.pow(S,2);s==null||s(p)}},16);return()=>clearInterval(v)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&a.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&u.map(E=>a.jsx("div",{style:{position:"absolute",left:E.x,top:E.y,width:E.size*i,height:E.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${E.id} ${E.duration}s ease-out ${E.delay}s forwards`}},E.id)),f>=3&&a.jsx("style",{children:u.map(E=>{const k=E.angle*Math.PI/180,T=Math.cos(k)*E.distance,N=Math.sin(k)*E.distance;return`
                            @keyframes particleFly-${E.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${T}px), calc(-50% + ${N}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:a.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),a.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},e3=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:l=1,buttonSize:c=160,timerDuration:d=60})=>{const[u,h]=L.useState(d),[f,E]=L.useState(!1),[k,T]=L.useState(!1),N=L.useRef(null),v=L.useRef(""),_=L.useRef(0),S=L.useRef(r),p=L.useRef(!1),D=L.useId().replace(/:/g,"_");L.useEffect(()=>{S.current=r},[r]);const H=`${e}-${n}`,ne=L.useCallback(()=>{h(d),E(!1),T(!1),_.current=Date.now()+d*1e3,p.current=!1},[d]);if(L.useEffect(()=>{H!==v.current&&(v.current=H,ne())},[H,ne]),L.useEffect(()=>{if(!s||!t||i||o){N.current&&(clearInterval(N.current),N.current=null);return}return _.current===0&&(_.current=Date.now()+d*1e3),N.current=window.setInterval(()=>{const g=Date.now(),I=Math.max(0,(_.current-g)/1e3);h(I);const A=Math.ceil(I);A<=15&&A>10?(E(!0),T(!1)):A<=10?(E(!0),T(!0)):(E(!1),T(!1)),I<=0&&!p.current&&(p.current=!0,N.current&&(clearInterval(N.current),N.current=null),setTimeout(()=>S.current(),0))},16),()=>{N.current&&(clearInterval(N.current),N.current=null)}},[s,t,i,o,d]),!s||o)return null;const G=u/d,q=(c/2+12)*l,he=6*l,xe=2*Math.PI*q,je=-xe*(1-G),fe=Math.ceil(u),ie=k?Math.min(1,(10-fe)/10):0,P=Math.max(.05,.15-ie*.1);let w="#4299e1";f&&!k?w="#f6ad55":k&&(w="#e53e3e");const C=20*l,y=q*2+he+C*2;return a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:y,height:y,pointerEvents:"none",zIndex:10,animation:k?`timerShake${D} ${P}s ease-in-out infinite`:void 0},children:[a.jsxs("svg",{width:y,height:y,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[a.jsx("circle",{cx:y/2,cy:y/2,r:q,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:he}),a.jsx("circle",{cx:y/2,cy:y/2,r:q,fill:"none",stroke:w,strokeWidth:he,strokeLinecap:"round",strokeDasharray:xe,strokeDashoffset:je,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&a.jsx("circle",{cx:y/2,cy:y/2,r:q,fill:"none",stroke:w,strokeWidth:he*3,opacity:.4,style:{filter:`blur(${12*l}px)`,animation:k?`timerPulse${D} 0.5s ease-in-out infinite`:`timerPulse${D} 1s ease-in-out infinite`}})]}),a.jsx("style",{children:`
                @keyframes timerPulse${D} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${D} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*l}px, ${-2*l}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*l}px, ${2*l}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*l}px, ${1*l}px); }
                }
            `})]})};function t3(t,e){const[n,r]=L.useState(null),[s,i]=L.useState(""),[o,l]=L.useState(!1),[c,d]=L.useState(null),[u,h]=L.useState(!1);return L.useEffect(()=>{if(t==="CPU")return;const f=new ZS;return h(!0),(async()=>{try{const k=await f.connect(t==="JOIN"?e:void 0);i(k),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),l(!0),h(!1)})}catch(k){d(k.toString()),h(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:u,error:c,setConnected:l}}function w_(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function T_(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const et=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},n3=et("/leaders/azya_leader.png"),r3=et("/leaders/senka_leader.png"),s3=et("/leaders/yoRuka_leader.png"),i3=et("/sleeves/azya_sleeve.png"),o3=et("/sleeves/senka_sleeve.png"),a3=et("/sleeves/yoruka_sleeve.png"),el=t=>t==="YORUKA"?s3:t==="AJA"?n3:r3,ci=t=>t==="YORUKA"?a3:t==="AJA"?i3:o3,l3=1920,tI=1080,c3=()=>{const[t,e]=L.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=L.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/l3,s/tI);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return L.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},an=90,bn=120,di=an+18,no=240,d3=({x:t,y:e,onComplete:n,scale:r=1})=>{$.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=$.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},u3=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{$.useEffect(()=>{const E=setTimeout(s,1500);return()=>clearTimeout(E)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",l=i?"#ff4444":"#ffd93d",c="#ffd93d",d="rgba(255,217,61,0.8)",u=E=>E>=0?`+${E}`:`${E}`,h=80,f=110;return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&a.jsx("div",{style:{position:"absolute",left:-h/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(n)}),r!==0&&a.jsx("div",{style:{position:"absolute",left:h/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(r)}),[...Array(8)].map((E,k)=>a.jsx("div",{style:{position:"absolute",left:Math.cos(k*Math.PI/4)*60,top:Math.sin(k*Math.PI/4)*60,width:12,height:12,background:l,borderRadius:"50%",boxShadow:`0 0 10px ${l}, 0 0 20px ${l}`,animation:`buffSparkle 0.8s ease-out ${k*.1}s forwards`}},k))]})},f3=({x:t,y:e,onComplete:n,scale:r=1})=>($.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),a.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),a.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),h3=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=$.useMemo(()=>{let f=8,E=8,k=100,T=256;return t==="SHOT"&&(T=128),{cols:f,rows:E,fps:k,size:T}},[t]);if($.useEffect(()=>{const E=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,k=setTimeout(r,E);return()=>clearTimeout(k)},[r,t,o]),$.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(E,k=.5,T=0)=>{setTimeout(()=>{const N=new Audio(et(`/se/${E}`));N.volume=(s.se||.5)*k,N.play().catch(v=>console.warn("SE Play prevented",v))},T)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return a.jsx(d3,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return a.jsx(f3,{x:e,y:n,onComplete:r,scale:i});const l=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:l,height:l,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=et("/effects/thunder.png");t==="IMPACT"&&(f=et("/effects/impact.png")),t==="SUMI"&&(f=et("/effects/sumi.png")),t==="SHOT"&&(f=et("/effects/shot.png")),t==="ICE"&&(f=et("/effects/ice.png")),t==="WATER"&&(f=et("/effects/water.png")),t==="RAY"&&(f=et("/effects/ray.png")),t==="FIRE"&&(f=et("/effects/fire.png")),t==="SLASH"&&(f=et("/effects/slash.png")),t==="BLUE_FIRE"&&(f=et("/effects/blue_fire.png"));const E=o.cols*o.rows,k=Math.min(160,o.size)*i;return a.jsxs("div",{style:{...c,width:k,height:k,transform:`${(c==null?void 0:c.transform)||""}`},children:[a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${E/o.fps}s steps(1) forwards`}}),a.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:E}).map((T,N)=>{const v=N%o.cols,_=Math.floor(N/o.cols),S=v*(100/(o.cols-1)),p=_*(100/(o.rows-1));return`${N/(E-1)*100}% { background-position: ${S}% ${p}%; }`}).join(`
`)}
                    }
                `})]})}let u="",h="";if(t==="FIREBALL")u=et("/effects/fireball.png"),h="explode 0.5s ease-out forwards";else if(t==="BEAM")return a.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:a.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return u?a.jsxs("div",{style:c,children:[a.jsx("img",{src:u,style:{width:"100%",height:"100%",objectFit:"contain",animation:h}}),a.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},p3=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{$.useEffect(()=>{const d=setTimeout(s,1200);return()=>clearTimeout(d)},[s]);const o=r==="#48bb78",l=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return a.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${l}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,a.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},g3=({x:t,y:e})=>{const n=$.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},m3=({onClose:t})=>a.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[a.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),a.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsx("li",{children:"0"}),a.jsx("li",{children:"1PP110"}),a.jsx("li",{children:"PP"}),a.jsx("li",{children:""}),a.jsx("li",{children:"5"}),a.jsx("li",{children:"910"})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),a.jsxs("li",{children:[a.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),a.jsx("li",{children:"1111"}),a.jsx("li",{children:"+2/+2"}),a.jsx("li",{children:"+3/+3"})]})]}),a.jsxs("section",{children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),a.jsx("li",{children:"151612PP +1"})]})]})]})}),y3=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=$.useRef(null);$.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,d)=>{const u={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},h=p=>{p.target.style.color="#ffec8b",p.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=p=>{p.target.style.color="#ffd700",p.target.style.textShadow="none"},E=(p,D)=>a.jsx("span",{style:u,onMouseEnter:h,onMouseLeave:f,onClick:H=>{H.stopPropagation(),e==null||e(p)},children:p},D),k=Z1(),T=p=>p?!(/[a-zA-Z0-9]/.test(p)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(p)):!0,N=[];for(const p of k){let D=0;for(;;){const H=c.indexOf(p,D);if(H===-1)break;const ne=H>0?c[H-1]:void 0,G=H+p.length<c.length?c[H+p.length]:void 0,q=T(ne)&&T(G),he=N.some(xe=>H>=xe.start&&H<xe.end||H+p.length>xe.start&&H+p.length<=xe.end||H<=xe.start&&H+p.length>=xe.end);q&&!he&&N.push({start:H,end:H+p.length,name:p}),D=H+1}}if(N.length===0)return a.jsx("span",{children:c});N.sort((p,D)=>p.start-D.start);const v=[];let _=0,S=0;for(const p of N)p.start>_&&v.push(a.jsx("span",{children:c.slice(_,p.start)},S++)),v.push(E(p.name,S++)),_=p.end;return _<c.length&&v.push(a.jsx("span",{children:c.slice(_)},S++)),a.jsx(a.Fragment,{children:v})},o=r?Math.max(100,140*n):Math.max(150,200*n),l=r?Math.max(140,180*n):Math.max(180,220*n);return a.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:l,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,d)=>a.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},d))})]})},v3=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:l,playSE:c,scale:d,isLightMode:u=!1})=>{const[h,f]=$.useState(0),[E,k]=$.useState(0),[T,N]=$.useState(0),[v,_]=$.useState(0),[S,p]=$.useState(0),[D,H]=$.useState(.25),[ne,G]=$.useState({x:n,y:r}),[q,he]=$.useState(!1),[xe,je]=$.useState([]),[fe,ie]=$.useState([]),[P,w]=$.useState(!1),C=$.useRef(!1),y=$.useRef(null),g=$.useRef(i),I=$.useRef(o),A=$.useRef(c);$.useEffect(()=>{g.current=i,I.current=o,A.current=c},[i,o,c]);const M=360*d,Q=480*d;$.useEffect(()=>{var Y,Pe,be;console.log("[EvolutionAnimation] Phase:",s);let Ie,te=null;switch(s){case"ZOOM_IN":{G({x:n,y:r}),H(.25),k(0);const Ke=Date.now(),Ne=650,nt=.25,yt=.75,kt=setInterval(()=>{const z=Date.now()-Ke,ut=Math.min(z/Ne,1),vt=1-Math.pow(1-ut,2);k(-5*vt),H(nt+(yt-nt)*vt),ut>=1&&clearInterval(kt)},16);Ie=setTimeout(()=>{const z=280*d,ut=window.innerWidth-z,vt=z+ut*.4;G({x:vt,y:window.innerHeight/2-30*d})},50);const se=setTimeout(()=>{const z=new Audio(et("/se/kirakira.mp3"));z.volume=.35,z.play().catch(()=>{}),y.current=z},600),Fe=setTimeout(()=>{g.current("WHITE_FADE")},700);return()=>{clearTimeout(Ie),clearTimeout(Fe),clearTimeout(se),clearInterval(kt)}}case"WHITE_FADE":(Y=A.current)==null||Y.call(A,"magic_charge.mp3",.3);const We=Array(80).fill(0).map((Ke,Ne)=>{const nt=Ne/80*360,yt=(Math.random()-.5)*10,kt=nt+yt,se=200+Math.random()*600,Fe=Math.random()*1.8,ut=.5+(se-200)/600*.5,vt=24+Math.random()*48;return{id:Ne,angle:kt,dist:se,delay:Fe,duration:ut,size:vt}});je(We),w(!0);let we=0;return te=setInterval(()=>{we+=.025,_(Math.min(we,1)),p(Math.min(we*80,80)),N(we*15),we>=1.2&&(te&&clearInterval(te),w(!1),g.current("FLIP"))},40),()=>{te&&clearInterval(te)};case"FLIP":if((Pe=A.current)==null||Pe.call(A,"syakin.mp3",.8),(be=A.current)==null||be.call(A,"KO.mp3",.7),y.current){const Ke=y.current,Ne=300,nt=30,yt=Ne/nt,kt=Ke.volume/yt;let se=0;const Fe=setInterval(()=>{se++,Ke.volume=Math.max(0,Ke.volume-kt),se>=yt&&(clearInterval(Fe),Ke.pause(),y.current=null)},nt)}je([]);const Me=Date.now(),mt=400,tt=1200;return te=setInterval(()=>{const Ke=Date.now()-Me;if(Ke<mt){const Ne=Ke/mt,nt=1-Math.pow(1-Ne,3),yt=10+nt*160;if(f(yt),H(.75+nt*((l?1.2:1.1)-.75)),k(-5+nt*2),_(Math.max(1-Ne*3,0)),yt>90&&!C.current){C.current=!0;const se=Array(120).fill(0).map((Fe,z)=>{const ut=z/120*360,vt=(Math.random()-.5)*8,sr=18+Math.random()*42;return{id:z,angle:ut+vt,dist:200+Math.random()*400,size:sr*3,delay:Math.random()*.05}});ie(se)}}else{const Ne=Math.min((Ke-mt)/tt,1),nt=Ne<.5?2*Ne*Ne:1-Math.pow(-2*Ne+2,2)/2;if(f(170+nt*10),_(0),!C.current){C.current=!0;const yt=Array(120).fill(0).map((kt,se)=>{const Fe=se/120*360,z=(Math.random()-.5)*8,ut=18+Math.random()*42;return{id:se,angle:Fe+z,dist:200+Math.random()*400,size:ut*3,delay:Math.random()*.05}});ie(yt)}Ne>=1&&(te&&clearInterval(te),g.current("REVEAL"))}},16),()=>{te&&clearInterval(te)};case"REVEAL":let st=0;return te=setInterval(()=>{st+=.25,_(Math.max(1-st,0)),p(Math.max(60-st*60,0)),st>=1&&(te&&clearInterval(te),ie([]),g.current("ZOOM_OUT"))},40),()=>{te&&clearInterval(te)};case"ZOOM_OUT":{G({x:n,y:r});const Ke=Date.now(),Ne=250,nt=D,yt=-3;return te=setInterval(()=>{const kt=Date.now()-Ke,se=Math.min(kt/Ne,1),Fe=1-Math.pow(1-se,3);H(nt-(nt-.25)*Fe),k(yt*(1-Fe)),se>=1&&(te&&clearInterval(te),f(180),N(0),H(.25),k(0),g.current("LAND"))},16),()=>{te&&clearInterval(te)}}case"LAND":return I.current(),he(!0),Ie=setTimeout(()=>{g.current("DONE")},600),()=>clearTimeout(Ie)}return()=>{Ie&&clearTimeout(Ie),te&&clearInterval(te),y.current&&(y.current.pause(),y.current=null)}},[s]);const F=h+T,ye=E,R=P?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[a.jsx("style",{children:`
                ${xe.map(Ie=>`
                    @keyframes chargeParticleIn-${Ie.id} {
                        0% { opacity: 0; transform: rotate(${Ie.angle}deg) translateX(${Ie.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${Ie.angle}deg) translateX(${Ie.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${Ie.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${fe.map(Ie=>`
                    @keyframes burstParticleOut-${Ie.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${Ie.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${Ie.angle}deg) translateX(${Ie.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(u?xe.filter((Ie,te)=>te%2===0):xe).map(Ie=>a.jsx("div",{style:{position:"absolute",left:ne.x,top:ne.y,width:Ie.size*d,height:Ie.size*d,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:u?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:u?void 0:"blur(1px)",animation:`chargeParticleIn-${Ie.id} ${Ie.duration}s ease-in ${Ie.delay}s forwards`,transform:`rotate(${Ie.angle}deg) translateX(${Ie.dist*d}px)`,opacity:0,pointerEvents:"none"}},`charge-${Ie.id}`)),s==="WHITE_FADE"&&a.jsxs("div",{style:{position:"absolute",left:ne.x+R.x,top:ne.y+R.y,width:0,height:0,transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*d,height:500*d,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:u?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!u&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*d,height:600*d,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),a.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(u?fe.filter((Ie,te)=>te%2===0):fe).map(Ie=>a.jsx("div",{style:{position:"absolute",left:ne.x,top:ne.y,width:Ie.size*d,height:Ie.size*d,borderRadius:"50%",background:l?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:u?l?"0 0 8px #b794f4":"0 0 8px #fbd38d":l?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${Ie.id} 0.4s ease-out ${Ie.delay}s forwards`,pointerEvents:"none"}},`burst-${Ie.id}`)),a.jsxs("div",{style:{position:"absolute",left:ne.x+R.x,top:ne.y+R.y,transform:`translate(-50%, -50%) scale(${D}) perspective(1200px) rotateY(${F}deg) rotateZ(${ye}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!u&&a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:M*1.3,height:Q*1.2,background:l?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:S>1?1:0,transition:"opacity 0.4s"}}),a.jsxs("div",{style:{width:M,height:Q,borderRadius:16,overflow:"hidden",boxShadow:u?l?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":l?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[a.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:F<=90?2:1,opacity:F<=90?1:0},children:[a.jsx("img",{src:et(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+v*.5}) contrast(${1-v*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:v,pointerEvents:"none"}})]}),a.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:F>90?2:1,opacity:F>90?1:0},children:[a.jsx("img",{src:et(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+v*.5}) contrast(${1-v*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:v,pointerEvents:"none"}})]})]})]}),q&&a.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[a.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((Ie,te)=>{const Y=te/20*360,Pe=40+Math.random()*100;return a.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*d,height:8*d,borderRadius:"50%",background:"white","--angle":`${Y}deg`,"--dist":Pe,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${te}`)})]})]})},C_=et("/leaders/yoRuka_win.png"),k_=et("/leaders/yoRuka_lose.png"),_3=et("/leaders/senka_win.png"),x3=et("/leaders/senka_lose.png"),b3=et("/leaders/azya_win.png"),E3=et("/leaders/azya_lose.png"),S3=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],I3=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:l=!0,myRematchRequested:c,opponentRematchRequested:d,battleStats:u,selectedCardInfo:h,onCardInfoClick:f,victoryReason:E="normal",isRankedMatch:k=!1,ratingResult:T})=>{const N=t===e,_=(()=>{if(!N)return null;switch(E){case"disconnect":return"";case"surrender":return"";default:return null}})(),[S,p]=$.useState("bg-fade"),D=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(S);$.useEffect(()=>{const y={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(S==="complete")return;const g={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},I=setTimeout(()=>{const A=g[S];A&&p(A)},y[S]||0);return()=>clearTimeout(I)},[S]);const H=()=>n==="SENKA"?N?_3:x3:n==="AJA"?N?b3:E3:N?C_:k_,[ne,G]=$.useState(15),[q,he]=$.useState(!1),[xe,je]=$.useState(null),fe=o?c||d:c||q;$.useEffect(()=>{if(fe)return;const y=setInterval(()=>{G(g=>g<=1?(clearInterval(y),i(),0):g-1)},1e3);return()=>clearInterval(y)},[i,fe]);const ie=y=>{je(y),o&&!l&&s?s(y):r(y)},P=()=>{const y=!o||l?"":"";return o?c&&d?"...":c?"...":d?`${y}`:y:c?"...":y},w=()=>{const y={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return d&&!c?{...y,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...y,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...y,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},C=(y,g)=>({width:220,height:220,borderRadius:"50%",border:xe===y?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:y==="AJA"?`url(${el(y)}) center top/cover`:`url(${el(y)}) center/cover`,cursor:"pointer",transform:g?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:g?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:D>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[a.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:h?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[a.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${et(`/cards/${h.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:h.name}),a.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[a.jsxs("span",{children:[": ",h.cost]}),h.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[": ",h.attack]}),a.jsxs("span",{children:[": ",h.health]})]})]}),a.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:h.description||""}),a.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${H()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:D>=1?.9:0,transform:D>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:N?"#f6e05e":"#a0aec0",textShadow:N?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:D>=2?1:0,transform:D>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:D>=2?"float 3s ease-in-out infinite":"none"},children:N?"":""}),_&&a.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:D>=2?1:0,transform:D>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:_}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:D>=3?1:0,transform:D>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:u.turnCount}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:u.damageDealtToOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:u.damageReceivedFromOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:u.followersDestroyed}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),k&&T&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,marginTop:16,opacity:D>=4?1:0,transform:D>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,background:"rgba(0, 0, 0, 0.5)",padding:"12px 24px",borderRadius:12,border:`2px solid ${T.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[a.jsx("span",{style:{fontSize:"1.2rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),a.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:T.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[T.ratingChange>=0?"+":"",T.ratingChange]})]}),T.ratingChange>0&&(T.bonusBreakdown.winStreakBonus>0||T.bonusBreakdown.rankDiffBonus>0)&&a.jsxs("div",{style:{display:"flex",gap:16,fontSize:"0.85rem",color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[a.jsxs("span",{children:[": +",T.bonusBreakdown.base]}),T.bonusBreakdown.winStreakBonus>0&&a.jsxs("span",{style:{color:"#f6e05e"},children:[": +",T.bonusBreakdown.winStreakBonus]}),T.bonusBreakdown.rankDiffBonus>0&&a.jsxs("span",{style:{color:"#63b3ed"},children:[": +",T.bonusBreakdown.rankDiffBonus]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:"1rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:[a.jsx("span",{style:{color:S3(T.newRank),fontWeight:"bold"},children:Ro[T.newRank]}),a.jsx("span",{children:T.newRating})]}),T.isRankUp&&a.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[Ro[T.newRank],""]}),T.isRankDown&&a.jsxs("div",{style:{fontSize:"1.2rem",color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[Ro[T.newRank],""]})]}),a.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:N?"#f6e05e":"#e53e3e",textShadow:N?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:D>=5?1:0,transition:"opacity 0.4s ease-out"},children:N?"":""}),q&&!c?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),a.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[a.jsx(R_,{deckType:"SENKA",label:"",onSelect:ie,getStyle:C}),a.jsx(R_,{deckType:"AJA",label:"",onSelect:ie,getStyle:C})]}),a.jsx("button",{onClick:()=>he(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):a.jsxs("div",{style:{display:"flex",gap:20,opacity:D>=5?1:0,transform:D>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsx("button",{onClick:()=>{c||he(!0)},disabled:c,style:w(),onMouseDown:y=>{c||(y.currentTarget.style.transform="scale(0.95)")},onMouseUp:y=>y.currentTarget.style.transform="scale(1)",children:P()}),a.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!fe&&`(${ne})`]})]}),a.jsx("div",{onClick:()=>{q&&!c&&ie("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${N?C_:k_})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:q&&!c?"pointer":"default",opacity:D>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},R_=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=$.useState(!1);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[a.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),a.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},A_=(t,e)=>{const[n,r]=$.useState([]),s=$.useRef(!1);return $.useEffect(()=>{r(i=>{const o=[],l=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var u;if(!c)return;const d=l.get(c.instanceId);d?(o.push({...d,passiveAbilities:d.passiveAbilities?[...d.passiveAbilities]:[],hasBarrier:d.hasBarrier??((u=d.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1}),l.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),l.forEach(c=>{var d;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((d=c.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),$.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(l=>l.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),$.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const l=setTimeout(()=>{r(c=>c.filter(d=>!d.isDying))},300);return()=>clearTimeout(l)}},100);return()=>clearInterval(o)},[e]),n},w3=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:l,opponentClass:c,aiDifficulty:d="NORMAL",playerName:u,timerEnabled:h=!0,playerId:f,opponentPlayerId:E,opponentRating:k})=>{var Om,Lm,Dm,Mm,Nm,jm,$m,Fm,Um;const T=n==="CPU"||!o,N=t3(T?n==="CPU"?"CPU":n:"CPU",T?r:void 0),v=o||N.adapter,_=l!==void 0?l:N.connected,S=c3(),{scale:p,toGameX:D,toGameY:H}=S,{isLightMode:ne}=eI(),[G,q]=L.useState(!1);L.useEffect(()=>{(()=>{q("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const he=L.useCallback((m,x)=>({x:D(m),y:H(x)}),[D,H]),[xe,je]=L.useState(null),fe=$.useRef(S);L.useEffect(()=>{fe.current=S},[S]);const ie=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(v==null?void 0:v.isHost)===!0,P=ie?"p1":"p2",w=ie?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":v==null?void 0:v.isHost,isHost:ie,currentPlayerId:P,connected:_,"networkAdapter provided":!!o,networkConnected:l});const C=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),y=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!ie,[g,I]=L.useReducer(f2,null,()=>{const m=n==="CPU"?"CPU":"";return y?id(m,C,u,t):id(u,t,m,C)}),[A,M]=L.useState(!y),Q=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[F,ye]=$.useState(Q?!1:!y),[R,Ie]=$.useState(!1),[te,Y]=$.useState(!1),[Pe,be]=$.useState(!1),[We,we]=$.useState(Q),[Me,mt]=$.useState(!1),tt=$.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:Q,isJoinSide:y,gameSynced:A,waitingForIntroSync:We,opponentReadyForIntro:Me,showBattleIntro:F,"introSyncSentRef.current":tt.current});const[st,Ke]=$.useState(!1),[Ne,nt]=$.useState(null),[yt,kt]=$.useState(0),[se,Fe]=$.useState({x:0,y:0}),[z,ut]=$.useState("IDLE"),[vt,sr]=$.useState(null),[ii,ra]=$.useState(!1),[ls,W0]=$.useState(()=>Math.random()>.5),[nI,G0]=$.useState(!1),[V0,Y0]=$.useState(!1),[rI,K0]=$.useState("normal"),[Er,X0]=$.useState(t),[ql,sa]=$.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[sI,qu]=$.useState(null),[iI,oI]=$.useState(null),[Q0,J0]=$.useState(!1);$.useEffect(()=>{if(n!=="RANKED_MATCH"||!f||!g.winnerId||Q0)return;(async()=>{try{const x=await cS(f,Er),b=g.winnerId===P;let O;b?O=lL(x.rating,x.winStreak,k??0):O=cL(x.rating),await uL(f,Er,O,b),oI(O),J0(!0),console.log("[RatingUpdate] Rating updated:",O)}catch(x){console.error("[RatingUpdate] Failed to update rating:",x),J0(!0)}})()},[n,f,g.winnerId,P,Er,k,Q0]),$.useEffect(()=>{g.winnerId&&!st&&!Pe&&be(!0)},[g.winnerId,st,Pe]),$.useEffect(()=>{if(yt<=0){Fe({x:0,y:0});return}let m;const x=()=>{const b=Date.now()*.03,O=25*yt*p,j=Math.sin(b*7)*O+Math.sin(b*13)*O*.5,V=Math.cos(b*11)*O+Math.cos(b*17)*O*.3;Fe({x:j,y:V}),m=requestAnimationFrame(x)};return m=requestAnimationFrame(x),()=>cancelAnimationFrame(m)},[yt,p]);const[Zu,q0]=$.useState([]),aI=$.useRef(0),[ef,Z0]=$.useState(!1),[tf,Zl]=$.useState(null),[ia,Wi]=$.useState(null),$r=$.useRef(null),Sr=$.useRef(null),Ir=$.useRef(null),nf=$.useRef(g.logs.length),ec=L.useRef(!1),em=L.useRef(!1),tc=L.useRef(null);L.useEffect(()=>{const m=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&ie,x=Q?_&&v:_&&v&&z==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:m,isCasualOrRanked:Q,connected:_,"adapter exists":!!v,coinTossPhase:z,canSendInitGame:x,"initialStateSentRef.current":ec.current}),m&&x&&!ec.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),ec.current=!0;const b=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",ls);const O=Q?{...g,firstPlayerId:ls?"p1":"p2"}:g;v.send({type:"INIT_GAME",payload:O}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),v.send({type:"READY_FOR_INTRO"}),tt.current=!0)};setTimeout(b,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{Me||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),b())},2500)}},[n,_,v,g,z,ie,Q,Me]),L.useEffect(()=>{!Q||!v||!A||tt.current||y&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),v.send({type:"READY_FOR_INTRO"}),tt.current=!0)},[Q,v,A,y]),L.useEffect(()=>{!Q||!v||!We||ie&&Me&&tt.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),v.send({type:"START_INTRO"}),we(!1),ye(!0))},[Q,v,ie,Me,We]);const le=g.players[P],Le=g.players[w];L.useEffect(()=>{var x,b;const m=g.logs.length;if(m>nf.current)for(let O=nf.current;O<m;O++){const j=g.logs[O],V=j.match(/(.+?)  (\d+) /);if(V){const U=V[1],B=parseInt(V[2],10),K=(le==null?void 0:le.name)===U?P:w,de=aI.current++;q0(ee=>[...ee,{playerId:K,amount:B,key:de}]),setTimeout(()=>{q0(ee=>ee.filter(ge=>ge.key!==de))},1500)}const Z=j.match(/(.+?) (?:)?/);if(Z){const U=Z[1],B=(x=g.players[P])==null?void 0:x.board.find(ge=>(ge==null?void 0:ge.name)===U),K=(b=g.players[w])==null?void 0:b.board.find(ge=>(ge==null?void 0:ge.name)===U),de=B||K,ee=B?P:w;if(de){const ge=g.players[ee].board.findIndex(Te=>(Te==null?void 0:Te.instanceId)===de.instanceId),Qe=(ee===P?wr.current:or.current)[ge];if(Qe){const Te=Qe.getBoundingClientRect(),Ye=Te.left+Te.width/2,Ze=Te.top+Te.height/2;uc(Ge=>[...Ge,{id:Date.now()+Math.random(),value:0,x:Ye,y:Ze,color:"#e53e3e"}])}}}}nf.current=m},[g.logs.length,P,w,le==null?void 0:le.name,g.players]);const[rf,oa]=$.useState(!1),Fr=$.useRef(!1),_n=A_(((Om=g.players[P])==null?void 0:Om.board)||[],Fr),un=A_(((Lm=g.players[w])==null?void 0:Lm.board)||[],Fr),aa=$.useRef(_n),nc=$.useRef(un),[oi,rc]=$.useState(null),[sf,tm]=$.useState(-1),sc=$.useRef(null),[Gi,la]=$.useState([]),[J,Ur]=$.useState(null),[ft,Yn]=$.useState(null),[lI,nm]=$.useState([]),cI=$.useRef(0),rm=$.useRef(0),sm=$.useRef(null),im=$.useRef(J);im.current=J,$.useEffect(()=>{const m=J==null?void 0:J.sourceType;if(!m||m!=="BOARD"&&m!=="EVOLVE"){nm([]);return}const x=400,b=setInterval(()=>{const O=im.current;if(!O||O.sourceType!=="BOARD"&&O.sourceType!=="EVOLVE")return;const j=Date.now(),V=Math.PI*(3-Math.sqrt(5));rm.current+=V+(Math.random()-.5)*.3;const Z=rm.current,U=4+Math.random()*3,B={id:cI.current++,x:O.currentX,y:O.currentY,vx:Math.cos(Z)*U,vy:Math.sin(Z)*U,opacity:1,radius:3+Math.random()*2,createdAt:j};nm(K=>[...K.filter(ee=>j-ee.createdAt<x).map(ee=>({...ee,x:ee.x+ee.vx,y:ee.y+ee.vy,opacity:Math.max(0,1-(j-ee.createdAt)/x)})),B])},80);return()=>clearInterval(b)},[J==null?void 0:J.sourceType]),$.useEffect(()=>{const m=(J==null?void 0:J.sourceType)==="EVOLVE";if(m&&!Ir.current){const x=new Audio(et("/se/aura.mp3"));x.loop=!0,x.volume=0,x.play().catch(()=>{}),Ir.current=x;const b=300,O=30,j=b/O,V=.25/j;let Z=0;const U=setInterval(()=>{Z++,Ir.current&&(Ir.current.volume=Math.min(Z*V,.25)),Z>=j&&clearInterval(U)},O)}else if(!m&&Ir.current){const x=Ir.current,b=200,O=20,j=b/O,V=x.volume/j;let Z=0;const U=setInterval(()=>{Z++,x.volume=Math.max(0,x.volume-V),Z>=j&&(clearInterval(U),x.pause(),x.currentTime=0)},O);Ir.current=null}return()=>{!J&&Ir.current&&(Ir.current.pause(),Ir.current=null)}},[J==null?void 0:J.sourceType]);const[om,of]=$.useState(new Set),[am,ic]=$.useState(null),[lm,oc]=$.useState(null),[dI,cm]=$.useState(null),[Ue,Br]=$.useState(null),af=$.useCallback(m=>{const x=Gr(m);x&&(g.winnerId?qu(x):Br({card:x,owner:"OPPONENT",source:"LOG"}))},[g.winnerId]),uI=$.useCallback(m=>{const x=/([^]+)/g,b=[];let O=0,j,V=0;const Z=Z1();for(;(j=x.exec(m))!==null;){j.index>O&&b.push(a.jsx("span",{children:m.slice(O,j.index)},V++));const U=j[1];Z.includes(U)?b.push(a.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:K=>{K.target.style.color="#ffec8b",K.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:K=>{K.target.style.color="#ffd700",K.target.style.textShadow="none"},onClick:K=>{K.stopPropagation(),af(U)},children:["",U,""]},V++)):b.push(a.jsxs("span",{children:["",U,""]},V++)),O=j.index+j[0].length}return O<m.length&&b.push(a.jsx("span",{children:m.slice(O)},V++)),b.length>0?a.jsx(a.Fragment,{children:b}):m},[af]),[ac,Vi]=$.useState([]),Wt=(m,x,b,O)=>{if(!m)return;let j=window.innerWidth/2,V=window.innerHeight/2;const Z=x===w;if(b===void 0||b===-1){const B=Z?Ki:li;if(B.current){const K=B.current.getBoundingClientRect(),de=he(K.left+K.width/2,K.top+K.height/2);j=de.x,V=de.y}else V=Z?150:tI-250}else if(b!==void 0&&b>=0){const B=Z?or:wr,K=Z?nc.current:aa.current;let de=b;if(O){const ge=K.findIndex(Ee=>Ee&&Ee.instanceId===O);ge>=0&&(de=ge)}const ee=B.current[de];if(ee){const ge=ee.getBoundingClientRect(),Ee=he(ge.left+ge.width/2,ge.top+ge.height/2);j=Ee.x,V=Ee.y}}Vi(B=>[...B,{type:m,x:j,y:V,key:Date.now()+Math.random()}])},dm=(m,x,b,O,j)=>{let V=window.innerWidth/2,Z=window.innerHeight/2;const U=m===w,B=U?or:wr,K=U?nc.current:aa.current;let de=x;if(j){const ge=K.findIndex(Ee=>Ee&&Ee.instanceId===j);ge>=0&&(de=ge)}const ee=B.current[de];if(ee){const ge=ee.getBoundingClientRect(),Ee=he(ge.left+ge.width/2,ge.top+ge.height/2);V=Ee.x,Z=Ee.y}Vi(ge=>[...ge,{type:"BUFF",x:V,y:Z,key:Date.now()+Math.random(),atkBuff:b,hpBuff:O}])},ir=(m,x,b,O)=>{Wt(m,x,b,O),n==="HOST"&&_&&v&&v.send({type:"EFFECT",payload:{effectType:m,targetPlayerId:x||"",targetIndex:b??-1,targetInstanceId:O}})},ca=(m,x,b,O,j)=>{dm(m,x,b,O,j),n==="HOST"&&_&&v&&v.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:m,targetIndex:x,targetInstanceId:j,isBuff:!0,atkBuff:b,hpBuff:O}})},um=$.useRef([]),fm=$.useRef([]);$.useEffect(()=>{var O,j;const m=(V,Z,U)=>{Z.forEach(B=>{if(!B)return;if(!V.find(de=>de&&de.instanceId===B.instanceId)&&B.killedByBane){const de=U===w,ee=de?or:wr,Ee=(de?nc.current:aa.current).findIndex(Qe=>Qe&&Qe.instanceId===B.instanceId);if(Ee>=0&&ee.current[Ee]){const Te=ee.current[Ee].getBoundingClientRect(),Ye=he(Te.left+Te.width/2,Te.top+Te.height/2);Vi(Ze=>[...Ze,{type:"BANE",x:Ye.x,y:Ye.y,key:Date.now()+Math.random()}])}}})},x=((O=g.players[P])==null?void 0:O.board)||[],b=((j=g.players[w])==null?void 0:j.board)||[];m(x,um.current,P),m(b,fm.current,w),um.current=x.map(V=>V?{...V}:null),fm.current=b.map(V=>V?{...V}:null)},[g.players,P,w]);const lf=600,[cs,da]=$.useState(null),cf=$.useRef({player:0,opponent:0}),[Rt,ua]=$.useState(()=>{try{const m=localStorage.getItem("audioSettings");if(m){const x=JSON.parse(m);if(x.enabled!==void 0){const{enabled:b,...O}=x;return{...O,bgmEnabled:b,seEnabled:b}}return x}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),xt=$.useCallback((m,x=.5)=>{if(!Rt.seEnabled)return;const b=new Audio(et(`/se/${m}`));b.volume=Rt.se*x,b.play().catch(O=>console.warn("SE Play prevented",O))},[Rt]),lc=$.useRef(null);$.useEffect(()=>{if(J&&ft&&!lc.current)xt("Buon.mp3",.25);else if(J&&ft&&lc.current){const m=lc.current;(m.instanceId!==ft.instanceId||m.index!==ft.index||m.playerId!==ft.playerId)&&xt("Buon.mp3",.25)}lc.current=ft},[ft,J,xt]);const xn=$.useRef(null),[fI,hm]=$.useState(!1);$.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Rt)),xn.current&&(xn.current.volume=Rt.bgmEnabled?Rt.bgm:0,Rt.bgmEnabled?xn.current.paused&&xn.current.play().catch(m=>console.warn("Auto-play prevented",m)):xn.current.pause())},[Rt]);const[hI,cc]=$.useState(!1),[pI,df]=$.useState(!1),[gI,dc]=$.useState(!1),mI=$.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),dc(!1),cc(!1),n!=="CPU"&&v&&v.send({type:"SURRENDER",payload:{playerId:P}}),I({type:"CONCEDE",playerId:P})},[n,v,P]),[zr,uf]=$.useState(!1),ff=$.useRef(!1),[pm,gm]=$.useState(!1),[it,ai]=$.useState(null),Yi=$.useRef(null),Ki=$.useRef(null),or=$.useRef([]),wr=$.useRef([]),li=$.useRef(null),[yI,uc]=$.useState([]),fc=$.useRef({player:20,opponent:20}),hc=$.useRef({player:0,opponent:0}),fa=$.useRef(new Map);$.useEffect(()=>{var j,V,Z,U;if(!le||!Le)return;const m=fc.current.opponent-Le.hp;m>0&&sa(B=>({...B,damageDealtToOpponent:B.damageDealtToOpponent+m}));const x=fc.current.player-le.hp;x>0&&sa(B=>({...B,damageReceivedFromOpponent:B.damageReceivedFromOpponent+x}));const b=hc.current.opponent-(((j=Le.board)==null?void 0:j.filter(B=>B).length)||0);b>0&&sa(B=>({...B,followersDestroyed:B.followersDestroyed+b}));const O=hc.current.player-(((V=le.board)==null?void 0:V.filter(B=>B).length)||0);O>0&&sa(B=>({...B,myFollowersDestroyed:B.myFollowersDestroyed+O})),fc.current={player:le.hp,opponent:Le.hp},hc.current={player:((Z=le.board)==null?void 0:Z.filter(B=>B).length)||0,opponent:((U=Le.board)==null?void 0:U.filter(B=>B).length)||0}},[le==null?void 0:le.hp,Le==null?void 0:Le.hp,(Dm=le==null?void 0:le.board)==null?void 0:Dm.length,(Mm=Le==null?void 0:Le.board)==null?void 0:Mm.length]);const sn=$.useRef(null),mm="lastPlayedBgm",ym=$.useCallback(m=>{const x={AJA:[et("/bgm/Green Misty Mountains.mp3"),et("/bgm/Jade Moon.mp3"),et("/bgm/amaama.mp3"),et("/bgm/kingetsu.mp3")],SENKA:[et("/bgm/ouka.mp3"),et("/bgm/Jade Moon.mp3"),et("/bgm/amaama.mp3"),et("/bgm/kingetsu.mp3")]},b=x[m]||x.SENKA,O=sessionStorage.getItem(mm),j=b.length>1?b.filter(Z=>Z!==O):b,V=j[Math.floor(Math.random()*j.length)];return sessionStorage.setItem(mm,V),encodeURI(V)},[]),[hf,vm]=$.useState(null);$.useEffect(()=>{var m,x;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${rf}, pendingEffects.length=${((m=g.pendingEffects)==null?void 0:m.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(rf){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(g.pendingEffects&&g.pendingEffects.length>0){const b=g.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${b.effect.type} from ${b.sourceCard.name}`),sc.current===b){console.log("[PendingEffects] Early return: same effect already processed");return}if(sc.current=b,oa(!0),Fr.current=!0,b.effect.type==="GENERATE_CARD"&&b.effect.targetCardId){const me=[b],X=g.pendingEffects||[];for(let Re=1;Re<X.length;Re++){const _e=X[Re];if(_e.effect.type==="GENERATE_CARD"&&_e.sourceCard.id===b.sourceCard.id&&_e.sourcePlayerId===b.sourcePlayerId)me.push(_e);else break}const ce=120,re=20,W=-(me.length*ce+(me.length-1)*re-ce)/2,oe=b.sourcePlayerId===P,ve=oe?window.innerWidth-200*p:200*p,Oe=oe?window.innerHeight-100*p:100*p,Ce=me.map((Re,_e)=>({card:Gr(Re.effect.targetCardId),status:"APPEAR",targetX:ve,targetY:Oe,xOffset:W+_e*(ce+re)})).filter(Re=>Re.card);if(Ce.length>0){la(Ce),sn.current&&clearTimeout(sn.current),sn.current=setTimeout(()=>{la(Re=>Re.map(_e=>({..._e,status:"FLY"}))),sn.current=setTimeout(()=>{la([]),oa(!1),Fr.current=!1,(n==="CPU"||n==="HOST")&&(me.forEach(Re=>{I({type:"RESOLVE_EFFECT",playerId:Re.sourcePlayerId,payload:{targetId:Re.targetId}})}),n==="HOST"&&_&&v&&setTimeout(()=>{const Re=rt.current;v.send({type:"GAME_STATE",payload:Re})},50)),sn.current=null},600)},800);return}}const O=b.effect.type==="DAMAGE"||b.effect.type==="AOE_DAMAGE"||b.effect.type==="RANDOM_DAMAGE"||b.effect.type==="RANDOM_DAMAGE_BY_TURN",j=b.effect.type==="DESTROY"||b.effect.type==="RANDOM_DESTROY",V=b.effect.type==="HEAL_LEADER",Z=b.effect.type==="RANDOM_SET_HP",U=b.effect.type==="SET_MAX_HP",B=b.effect.type==="RETURN_TO_HAND",K=b.effect.type==="SUMMON_CARD"||b.effect.type==="SUMMON_CARD_RUSH",de=b.effect.type==="VISUAL_BUFF_ONLY",ee=b.effect.type==="BUFF_STATS",ge=V||B||K||de||ee?600:50;if(O){let me=b.sourceCard.attackEffectType||"SLASH";b.sourceCard.id==="c_alice"&&b.effect.targetType==="SELECT_FOLLOWER"&&(me="WATER");const X=b.sourcePlayerId===P?w:P,ce=X===P?_n:un;if(b.effect.type==="AOE_DAMAGE")g.players[X].board.forEach(ae=>{if(ae){const W=ce.findIndex(oe=>(oe==null?void 0:oe.instanceId)===ae.instanceId);W!==-1&&ir(me,X,W,ae.instanceId)}});else if(b.targetIds)b.effect.type==="RANDOM_DAMAGE_BY_TURN"?b.targetIds.forEach((ae,W)=>{setTimeout(()=>{const oe=ce.findIndex(ve=>(ve==null?void 0:ve.instanceId)===ae);oe!==-1&&ir(me,X,oe,ae)},W*300)}):b.targetIds.forEach(re=>{const ae=ce.findIndex(W=>(W==null?void 0:W.instanceId)===re);ae!==-1&&ir(me,X,ae,re)});else if(b.effect.targetType==="OPPONENT")ir(me,X,-1),$n();else if(b.targetId){const re=ce.findIndex(ae=>(ae==null?void 0:ae.instanceId)===b.targetId);re!==-1&&ir(me,X,re,b.targetId)}}else if(j){let me=b.sourceCard.attackEffectType||"IMPACT";const X=b.sourcePlayerId===P?w:P,ce=X===P?_n:un;if(b.effect.targetType==="ALL_OTHER_FOLLOWERS"){ce.forEach((W,oe)=>{W&&W.instanceId!==b.sourceCard.instanceId&&ir(me,X,oe,W.instanceId)});const re=b.sourcePlayerId;(re===P?_n:un).forEach((W,oe)=>{W&&W.instanceId!==b.sourceCard.instanceId&&ir(me,re,oe,W.instanceId)}),$n()}else if(b.targetIds)b.targetIds.forEach(re=>{const ae=ce.findIndex(W=>(W==null?void 0:W.instanceId)===re);ae!==-1&&ir(me,X,ae,re)});else if(b.targetId){const re=ce.findIndex(ae=>(ae==null?void 0:ae.instanceId)===b.targetId);re!==-1&&ir(me,X,re,b.targetId)}}else if(V){const me=b.sourcePlayerId;ir("HEAL",me)}else if(U){const me=b.sourcePlayerId===P?w:P;ir("RAY",me,-1),$n()}if(b.effect.type==="BUFF_STATS"){const me=b.effect.value??0,X=b.effect.value2??0,ce=b.sourcePlayerId;if(b.effect.targetType==="SELF"){const ae=(ce===P?_n:un).findIndex(W=>(W==null?void 0:W.instanceId)===b.sourceCard.instanceId);ae!==-1&&ca(ce,ae,me,X,b.sourceCard.instanceId)}else if(b.effect.targetType==="ALL_FOLLOWERS"){const re=ce===P?_n:un,ae=g.players[ce].board,W=b.effect.conditions;ae.forEach(oe=>{var ve;if(oe){if(W!=null&&W.tag&&!((ve=oe.tags)!=null&&ve.includes(W.tag))||W!=null&&W.nameIn&&!W.nameIn.includes(oe.name))return;const Oe=re.findIndex(Ce=>(Ce==null?void 0:Ce.instanceId)===oe.instanceId);Oe!==-1&&ca(ce,Oe,me,X,oe.instanceId)}})}else if(b.effect.targetType==="ALL_OTHER_FOLLOWERS"){const re=ce===P?_n:un,ae=g.players[ce].board,W=b.effect.conditions;ae.forEach(oe=>{var ve;if(oe&&oe.instanceId!==b.sourceCard.instanceId){if(W!=null&&W.tag&&!((ve=oe.tags)!=null&&ve.includes(W.tag))||W!=null&&W.nameIn&&!W.nameIn.includes(oe.name))return;const Oe=re.findIndex(Ce=>(Ce==null?void 0:Ce.instanceId)===oe.instanceId);Oe!==-1&&ca(ce,Oe,me,X,oe.instanceId)}})}else if(b.targetId){const ae=(ce===P?_n:un).findIndex(W=>(W==null?void 0:W.instanceId)===b.targetId);ae!==-1&&ca(ce,ae,me,X,b.targetId)}}if(de){const me=b.effect.value??0,X=b.effect.value2??0,ce=b.sourcePlayerId,re=b.sourceCard;setTimeout(()=>{const ae=ce===P?_n:un;if(re!=null&&re.instanceId){const W=ae.findIndex(oe=>(oe==null?void 0:oe.instanceId)===re.instanceId);W!==-1&&ca(ce,W,me,X,re.instanceId)}},300)}sn.current&&clearTimeout(sn.current);const Qe=O||j||Z||U,Te=b.effect.type==="RANDOM_DAMAGE_BY_TURN",Ye=Te?((x=b.targetIds)==null?void 0:x.length)||g.turnCount:1,Ze=Te?Ye*300+300:0,Ge=Te?Ze:Qe?700:ge,Ve=Te?200:Qe?700:0;sn.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(I({type:"RESOLVE_EFFECT",playerId:b.sourcePlayerId,payload:{targetId:b.targetId}}),n==="HOST"&&_&&v&&setTimeout(()=>{const me=rt.current;v.send({type:"GAME_STATE",payload:me})},50)),Ve>0?sn.current=setTimeout(()=>{oa(!1),Fr.current=!1,sn.current=null},Ve):(oa(!1),Fr.current=!1,sn.current=null)},Ge)}else sc.current=null,sn.current&&(clearTimeout(sn.current),sn.current=null)},[g.pendingEffects,rf,P,w,n,_,v]),$.useEffect(()=>{if(g.activePlayerId!==P)return;const m=P===g.firstPlayerId,x=g.turnCount,b=m?5:4;if(x===(m?7:6)){if(sf===x)return;rc("SUPER_EVOLVE_READY"),tm(x),setTimeout(()=>rc(null),2500)}else if(x===b){if(sf===x)return;rc("EVOLVE_READY"),tm(x),setTimeout(()=>rc(null),2500)}},[g.turnCount,g.activePlayerId,P,sf,g.firstPlayerId]);const pc=$.useRef(g.players);$.useEffect(()=>{const m=pc.current,x=new Set;if(Object.keys(g.players).forEach(b=>{const O=g.players[b],j=m[b];if(!j)return;const V=new Set(j.board.filter(U=>U).map(U=>U.instanceId)),Z=new Set(j.hand.filter(U=>U).map(U=>U.instanceId));O.board.forEach(U=>{if(!U)return;const B=U.instanceId;!V.has(B)&&!Z.has(B)&&x.add(B)})}),x.size>0){of(O=>new Set([...O,...x]));const b=setTimeout(()=>{of(new Set)},1e3);return()=>clearTimeout(b)}},[g.players]),$.useEffect(()=>{const m=pc.current,x=g.players;let b=[];const O=j=>{const V=j.getBoundingClientRect();return{x:V.left+V.width/2,y:V.top+V.height/2}};Object.keys(x).forEach(j=>{const V=x[j],Z=m[j];if(Z&&V.hp<Z.hp){const U=Z.hp-V.hp,K=j===P?li.current:Ki.current;if(K){const de=O(K);b.push({id:Date.now()+Math.random(),value:U,x:de.x,y:de.y,color:"#e53e3e"})}}else if(Z&&V.hp>Z.hp){const U=V.hp-Z.hp,K=j===P?li.current:Ki.current;if(K){const de=O(K);b.push({id:Date.now()+Math.random(),value:"+"+U,x:de.x,y:de.y,color:"#48bb78"})}}Z==null||Z.board.forEach(U=>{if(!U)return;const B=V.board.find(K=>(K==null?void 0:K.instanceId)===U.instanceId);if(B){const K=V.board.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===B.instanceId),ge=(j===P?wr.current:or.current)[K];if(ge){const Ee=O(ge);if(fa.current.set(U.instanceId,Ee),B.currentHealth<U.currentHealth){const Qe=U.currentHealth-B.currentHealth;b.push({id:Date.now()+Math.random(),value:Qe,x:Ee.x,y:Ee.y,color:"#e53e3e"})}else if(B.currentHealth>U.currentHealth){const Qe=B.hasEvolved&&!U.hasEvolved,Te=B.currentAttack!==U.currentAttack||B.maxHealth!==U.maxHealth;if(!Qe&&!Te){const Ye=B.currentHealth-U.currentHealth;b.push({id:Date.now()+Math.random(),value:"+"+Ye,x:Ee.x,y:Ee.y,color:"#48bb78"})}}else B.currentHealth===U.currentHealth&&U.hasBarrier&&!B.hasBarrier&&b.push({id:Date.now()+Math.random(),value:0,x:Ee.x,y:Ee.y,color:"#e53e3e"})}}else{const K=V.graveyard.find(ee=>ee.instanceId===U.instanceId);let de=0;if(K){const ee=K.currentHealth||0;ee<=0?de=U.currentHealth-ee:de=0}else de=U.currentHealth;if(de>0){const ee=fa.current.get(U.instanceId);ee&&(ee.x!==0||ee.y!==0)&&b.push({id:Date.now()+Math.random(),value:de,x:ee.x,y:ee.y,color:"#e53e3e"})}fa.current.delete(U.instanceId)}})}),b.length>0&&(uc(V=>[...V,...b]),b.some(V=>V.color!=="#48bb78")&&$n()),pc.current=x},[g.players,P,w]);const pf=$.useRef(null),$n=()=>{pf.current||(gm(!0),pf.current=setTimeout(()=>{gm(!1),pf.current=null},300))},gf=L.useCallback(m=>{uc([]),Vi([]),la([]),Fn(null),Xi(null),da(null),of(new Set),ds.current=!1,mf.current=null,sa({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),fc.current={player:20,opponent:20},hc.current={player:0,opponent:0},qu(null),be(!1),Ke(!1),nt(null),G0(!1),Y0(!1);const x=m||Er;m&&X0(m);let b=C;e==="CPU"&&(x==="YORUKA"?b=Math.random()<.5?"SENKA":"AJA":b=x==="SENKA"?"AJA":"SENKA");const j=id(u,x,e==="ONLINE"?"":"CPU",b);pc.current=j.players,cf.current={player:j.players.p1.hand.length,opponent:j.players.p2.hand.length},vm(null),ye(n!=="JOIN"),W0(Math.random()>.5),ut("IDLE"),sr(null),ra(!1),n==="HOST"&&(ec.current=!1),I({type:"SYNC_STATE",payload:j})},[Er,C,e,n]),vI=L.useCallback(()=>{if(ye(!1),Ie(!1),Y(!0),sr(ls?"FIRST":"SECOND"),!ls){const m={...g,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...g.players.p1,maxPp:0,pp:0},p2:{...g.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${g.players.p2.name} `]};I({type:"SYNC_STATE",payload:m})}ut("DONE")},[g,ls]);L.useEffect(()=>{},[g.phase,z,n,xt,_]),$.useEffect(()=>{if(hf===le.class&&xn.current)return;const m=ym(le.class);console.log(`[BGM] Initializing track: ${m} for class: ${le.class}`),xn.current&&(xn.current.pause(),xn.current=null);const x=new Audio(m);x.loop=!0,x.volume=Rt.bgm,xn.current=x,vm(le.class)},[le.class,ym,hf]),$.useEffect(()=>()=>{xn.current&&(console.log("[GameScreen] Stopping BGM on unmount"),xn.current.pause(),xn.current=null)},[]),$.useEffect(()=>{if(!xn.current)return;const m=xn.current,x=()=>{m.paused&&Rt.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),m.play().then(()=>{console.log("[BGM] Play success"),b()}).catch(O=>console.warn("[BGM] Play failed on interaction:",O)))},b=()=>{document.removeEventListener("click",x),document.removeEventListener("keydown",x),document.removeEventListener("touchstart",x)};return Rt.bgmEnabled?(document.addEventListener("click",x),document.addEventListener("keydown",x),document.addEventListener("touchstart",x),m.play().then(()=>{console.log("[BGM] Immediate play success"),b()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(m.pause(),b()),()=>{b()}},[Rt.bgmEnabled,Rt.bgm,hf]),L.useEffect(()=>{if(!v){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",v.isHost);const m=x=>{var b,O,j,V,Z;if(console.log("[GameScreen] Received message:",x.type,x),x.type==="HANDSHAKE"){const U=(b=x.payload)==null?void 0:b.name,B=typeof U=="string"&&U.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",B),tc.current=B,I({type:"UPDATE_PLAYER_NAME",payload:{playerId:P==="p1"?"p2":"p1",name:B}});return}if(x.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),I({type:"SYNC_STATE",payload:x.payload}),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:P,name:u}});const U=P==="p1"?"p2":"p1";tc.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",tc.current),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:U,name:tc.current}})),M(!0);const B=x.payload.firstPlayerId===P;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",x.payload.firstPlayerId,"currentPlayerId:",P,"isJoinSideFirst:",B),W0(B),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):ye(!0);return}if(x.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),mt(!0);return}if(x.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),we(!1),ye(!0);return}if(x.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),I({type:"SYNC_STATE",payload:x.payload}),oa(!1),Fr.current=!1,sc.current=null,la([]),sn.current&&(clearTimeout(sn.current),sn.current=null),!pa.current&&!Ji.current&&(fn.current=!1);return}if(x.type==="EFFECT"){const{effectType:U,targetPlayerId:B,targetIndex:K,targetInstanceId:de,isBuff:ee,atkBuff:ge,hpBuff:Ee}=x.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",U,B,K,de),setTimeout(()=>{ee&&ge!==void 0&&Ee!==void 0?dm(B,K,ge,Ee,de):Wt(U,B,K,de)},50);return}if(x.type==="EVOLVE_ANIM"){const{playerId:U,followerIndex:B,useSep:K,targetId:de,instanceId:ee}=x.payload,ge=(O=g.players[U])==null?void 0:O.board[B];if(ge){const Ee=ge.evolvedImageUrl||((j=Gr(ge.id))==null?void 0:j.evolvedImageUrl),Qe=ee||ge.instanceId,Te=un.findIndex(X=>X&&X.instanceId===Qe),Ye=Te>=0?or.current[Te]:null,Ze=fe.current.scale,Ge=window.innerHeight/2;let Ve=window.innerWidth/2,me=Ge-70*Ze;if(Ye){const X=Ye.getBoundingClientRect();Ve=X.left+X.width/2,me=X.top+X.height/2}Xi({card:ge,evolvedImageUrl:Ee,startX:Ve,startY:me,phase:"ZOOM_IN",followerIndex:B,sourcePlayerId:U,useSep:K||!1,targetId:de,isRemote:!0}),xt("fon.mp3",.7)}return}if(x.type==="PLAY_CARD_ANIM"){const{playerId:U,card:B,targetBoardIndex:K}=x.payload;if(B){const de=((V=g.players[U])==null?void 0:V.board)||[],ee=typeof K=="number"?K:de.filter(W=>W!==null).length,ge=fe.current.scale,Ee=window.innerWidth/2,Qe=window.innerHeight/2,Te=Ee,Ye=80*ge,Ze=Ee,Ge=Qe-100*ge,ce=-((Math.max(1,ee+1)-1)*di*ge)/2+ee*di*ge,re=Ee+ce,ae=Qe-70*ge;B.type==="SPELL"?Fn({card:B,sourceIndex:-1,startX:Te,startY:Ye,targetX:Ze,targetY:Ge,playerClass:(Le==null?void 0:Le.class)||"SENKA",onComplete:()=>{Fn(null)}}):Fn({card:B,sourceIndex:-1,startX:Te,startY:Ye,targetX:Ze,targetY:Ge,finalX:re,finalY:ae,playerClass:(Le==null?void 0:Le.class)||"SENKA",onComplete:()=>{xt("gan.mp3",.6),$n(),Fn(null)}})}return}if(x.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),Y0(!0);return}if(x.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),gf(Er);return}if(x.type==="SURRENDER"){const U=(Z=x.payload)==null?void 0:Z.playerId;if(g.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if(U===P){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${P}). Ignoring.`);return}if(U!==w){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${U}. Expected: ${w}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",U),K0("surrender"),I({type:"CONCEDE",playerId:U});return}if(x.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",x.stampId),Sr.current&&(clearTimeout(Sr.current),Sr.current=null);const U=qy(x.stampId);U&&xt(U,.6);const B={stampId:x.stampId,playerId:w,playerClass:x.playerClass||(Le==null?void 0:Le.class)||"SENKA",timestamp:Date.now()};Wi(null),requestAnimationFrame(()=>{Wi(B)}),Sr.current=setTimeout(()=>{Wi(K=>(K==null?void 0:K.timestamp)===B.timestamp?null:K),Sr.current=null},3e3);return}if(x.type==="ACTION"){const U=x.payload;if(console.log("[GameScreen] Processing remote action:",U.type,"from player:",U.playerId),I({...U,isRemote:!0}),U.type==="ATTACK"){const{playerId:B,payload:K}=U,de=g.players[B],ee=de==null?void 0:de.board[K.attackerIndex],ge=K.targetIsLeader?-1:K.targetIndex,Ee=B==="p1"?"p2":"p1";if(ee){const Qe=g.players[Ee],Te=K.targetIsLeader?null:Qe==null?void 0:Qe.board[K.targetIndex],Ye=Te?Te.instanceId:void 0;Wt(ee.attackEffectType,Ee,ge,Ye)}}else U.type==="PLAY_CARD"||U.type==="EVOLVE"||U.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",U.playerId==="p1"?"p2":"p1"),Qi.current=!1)}};return v.onMessage(m),n!=="CPU"&&!em.current&&(em.current=!0,v.send({type:"HANDSHAKE",payload:{name:u,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",u,t)),v.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&g.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&g.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),K0("disconnect");const x={...g,phase:"GAME_OVER",winnerId:P,logs:[...g.logs,""]};I({type:"SYNC_STATE",payload:x});return}alert(`
`),s()}),()=>{}},[v,g,xt,Wt,n,s,P]);const ds=$.useRef(!1),mf=$.useRef(null),An=$.useRef(null),[Xe,Fn]=$.useState(null),[Dt,Xi]=$.useState(null),fn=$.useRef(!1),ha=$.useRef(null),Qi=$.useRef(!1),yf=$.useRef(ac),vf=$.useRef(Gi),pa=$.useRef(Xe),Ji=$.useRef(Dt);L.useEffect(()=>{yf.current=ac,vf.current=Gi,pa.current=Xe,Ji.current=Dt},[ac,Gi,Xe,Dt]),L.useEffect(()=>{if(Xe&&Xe.card.name===""&&Rt.seEnabled){const m=new Audio(et("/se/beam.mp3"));m.volume=Rt.se*.8,m.play().catch(x=>console.warn("SE Play prevented",x))}},[Xe,Rt]),L.useEffect(()=>{aa.current=_n,nc.current=un},[_n,un]),L.useEffect(()=>{const m=x=>{const b=x.getBoundingClientRect();return{x:b.left+b.width/2,y:b.top}};_n.forEach((x,b)=>{if(x&&x.instanceId){const O=wr.current[b];if(O){const j=m(O);(j.x!==0||j.y!==0)&&fa.current.set(x.instanceId,j)}}}),un.forEach((x,b)=>{if(x&&x.instanceId){const O=or.current[b];if(O){const j=m(O);(j.x!==0||j.y!==0)&&fa.current.set(x.instanceId,j)}}})},[_n,un]);const gc=(m,x,b,O)=>{const j=Tr.current.board,V=O?j.findIndex(ee=>ee&&ee.instanceId===O):m,Z=V>=0?j[V]:null;if(!Z)return;if(Z.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const U=wr.current[m];let B=window.innerWidth/2,K=window.innerHeight/2;if(U){const ee=U.getBoundingClientRect();B=ee.left+ee.width/2,K=ee.top+ee.height/2}const de=Z.instanceId;n!=="CPU"&&_&&v&&v.send({type:"EVOLVE_ANIM",payload:{playerId:P,followerIndex:V,useSep:x,targetId:b,instanceId:de}}),Xi({card:Z,evolvedImageUrl:Z.evolvedImageUrl,startX:B,startY:K,phase:"ZOOM_IN",followerIndex:V,useSep:x,targetId:b,sourcePlayerId:P}),xt("fon.mp3",.7)},_f=$.useRef(null),_I=$.useCallback(m=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",m),m==="WHITE_FADE"&&xt("fon.mp3",.7),m==="LAND"&&xt("gan.mp3",.6),m==="DONE"){const x=Ji.current;if(x&&!x.isRemote){const O={type:"EVOLVE",playerId:x.sourcePlayerId||P,payload:{followerIndex:x.followerIndex,useSep:x.useSep,targetId:x.targetId}};I(O),v&&n!=="CPU"&&v.send({type:"ACTION",payload:O})}Xi(null)}else Xi(x=>x?{...x,phase:m}:null)},[v,I,n,P,xt]),xf=(m,x,b)=>{var Ve,me,X,ce,re,ae;const j=Tr.current.hand[m];if(!j){console.warn("[handlePlayCard] Card not found at index:",m);return}if(j.instanceId&&ha.current===j.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",j.instanceId);return}if(fn.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}fn.current=!0,ha.current=j.instanceId||null,xt("card.mp3",.5);const V=(Ve=j.triggers)==null?void 0:Ve.find(W=>W.trigger==="FANFARE"),Z=V==null?void 0:V.effects[0];let U=w;const B=(Z==null?void 0:Z.targetType)==="SELECT_ALLY_FOLLOWER"||(Z==null?void 0:Z.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";Z&&(B||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(Z.type))&&(U=P);const K=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],de=j.type==="SPELL"&&((me=j.triggers)==null?void 0:me.some(W=>W.effects.some(oe=>oe.targetType&&K.includes(oe.targetType))))||j.type==="FOLLOWER"&&(((ce=(X=j.triggerAbilities)==null?void 0:X.FANFARE)==null?void 0:ce.targetType)&&K.includes(j.triggerAbilities.FANFARE.targetType)||((re=j.triggers)==null?void 0:re.some(W=>W.trigger==="FANFARE"&&W.effects.some(oe=>oe.targetType&&K.includes(oe.targetType))))),ge=rt.current.players[U].board.some(W=>{var oe,ve;return W&&(U===P||!((oe=W.passiveAbilities)!=null&&oe.includes("STEALTH"))&&!((ve=W.passiveAbilities)!=null&&ve.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${de}, allowedTarget: ${U}, hasValidTargets: ${ge}`),de&&ge){ai({type:"PLAY",sourceIndex:m,sourceInstanceId:j.instanceId,allowedTargetPlayerId:U}),Ur(null);return}const Ee=window.innerWidth/2,Qe=window.innerHeight/2;let Te,Ye;if(j.type==="FOLLOWER"){const oe=rt.current.players[P].board.filter(Ae=>Ae!==null),ve=oe.length+1,Oe=oe.length,Ce=di*p,Re=(Oe-(ve-1)/2)*Ce,_e=(ae=Yi.current)==null?void 0:ae.getBoundingClientRect();Te=(_e?_e.left+_e.width/2:window.innerWidth/2)+Re,Ye=window.innerHeight/2+70*p}const Ze=()=>{j.type!=="SPELL"&&(xt("gan.mp3",.6),$n()),us({type:"PLAY_CARD",playerId:P,payload:{cardIndex:m,instanceId:j.instanceId}}),Fn(null),setTimeout(()=>{fn.current=!1},100)},Ge=j.type==="FOLLOWER"?rt.current.players[P].board.filter(W=>W!==null).length:void 0;n!=="CPU"&&_&&v&&v.send({type:"PLAY_CARD_ANIM",payload:{playerId:P,cardIndex:m,card:j,targetBoardIndex:Ge}}),Fn({card:j,sourceIndex:m,startX:x,startY:b,targetX:Ee,targetY:Qe,finalX:Te,finalY:Ye,playerClass:(le==null?void 0:le.class)||"SENKA",onComplete:Ze}),setTimeout(()=>{Fn(W=>(W==null?void 0:W.card.id)===j.id?(Ze(),null):W)},2e3)},us=m=>{I(m),n!=="CPU"&&_&&!m.isRemote&&(v==null||v.send({type:"ACTION",payload:m}))};$.useEffect(()=>{if(!Dt&&_f.current){const m=_f.current;_f.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",m.playerId),us({type:"EVOLVE",playerId:m.playerId,payload:{followerIndex:m.followerIndex,useSep:m.useSep,targetId:m.targetId}})}},[Dt,P,us]);const Tr=$.useRef(le),rt=$.useRef(g);$.useEffect(()=>{Tr.current=le,rt.current=g},[le,g]);const ar=$.useRef(!1);$.useEffect(()=>{const m=cf.current,x=le.hand.length,b=Le.hand.length;if(x>m.player){const O=x-m.player;da({isPlayer:!0,count:O}),xt("card.mp3",.5),setTimeout(()=>da(null),lf)}if(b>m.opponent){const O=b-m.opponent;da({isPlayer:!1,count:O}),xt("card.mp3",.5),setTimeout(()=>da(null),lf)}cf.current={player:x,opponent:b}},[le.hand.length,Le.hand.length,Rt,xt]),L.useEffect(()=>{g.activePlayerId===P&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),fn.current=!1,ha.current=null,Qi.current=!1)},[g.activePlayerId,g.turnCount,P]),L.useEffect(()=>{if(n==="CPU")return;const m=setInterval(()=>{fn.current&&!pa.current&&!Ji.current&&!it&&g.activePlayerId===P&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),fn.current=!1)},3e3);return()=>clearInterval(m)},[n,it,g.activePlayerId,P]),L.useEffect(()=>{if(n!=="CPU")return;if(g.winnerId){ds.current=!1;return}const m=`${g.turnCount}-${g.activePlayerId}`;if(g.activePlayerId===P){ds.current=!1;return}if(g.activePlayerId===w){if(ds.current||mf.current===m)return;(async()=>{var Te,Ye,Ze,Ge,Ve,me;ds.current=!0,mf.current=m;const b=async(X=300)=>{await new Promise(ae=>setTimeout(ae,X));const ce=()=>{const ae=rt.current,W=ae.pendingEffects&&ae.pendingEffects.length>0,oe=yf.current.length>0,ve=vf.current.length>0,Oe=pa.current!==null,Ce=Ji.current!==null;return!W&&!oe&&!ve&&!Oe&&!Ce};let re=0;for(;!ce()&&re<60;){await new Promise(W=>setTimeout(W,100)),re++;const ae=rt.current;if(ae.pendingEffects&&ae.pendingEffects.length>0&&!Fr.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const W=ae.pendingEffects[0];I({type:"RESOLVE_EFFECT",playerId:W.sourcePlayerId,payload:{targetId:W.targetId}}),await new Promise(oe=>setTimeout(oe,200))}}},O=(X,ce)=>{var re;return X?!!((re=X.passiveAbilities)!=null&&re.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},j=(X,ce)=>{var re;return!ce||!X?!1:(re=ce.passiveAbilities)!=null&&re.includes("BANE")&&!X.hasBarrier?!0:(ce.currentAttack||0)>=X.currentHealth},V=(X,ce)=>{var re;return!ce||!X?!1:(re=X.passiveAbilities)!=null&&re.includes("BANE")?!ce.hasBarrier:X.currentAttack>=ce.currentHealth},Z=X=>{var oe,ve,Oe;let ce=0;const re=X.players[w].board.filter(Ce=>Ce!==null),W=X.players[P].board.filter(Ce=>Ce!==null).some(Ce=>{var Re,_e;return((Re=Ce.passiveAbilities)==null?void 0:Re.includes("WARD"))&&!((_e=Ce.passiveAbilities)!=null&&_e.includes("STEALTH"))});for(const Ce of re)!Ce.canAttack||!((oe=Ce.passiveAbilities)!=null&&oe.includes("STORM")||Ce.turnPlayed!==X.turnCount)||W&&!((ve=Ce.passiveAbilities)!=null&&ve.includes("STEALTH"))&&!Ce.hadStealth||(ce+=Ce.currentAttack||0,(Oe=Ce.passiveAbilities)!=null&&Oe.includes("DOUBLE_ATTACK")&&(ce+=Ce.currentAttack||0));return ce},U=X=>{var ae,W,oe;let ce=0;const re=X.players[P].board.filter(ve=>ve!==null);for(const ve of re)ce+=ve.currentAttack||0,(ae=ve.passiveAbilities)!=null&&ae.includes("DOUBLE_ATTACK")&&(ce+=ve.currentAttack||0),(W=ve.passiveAbilities)!=null&&W.includes("BANE")&&(ce+=15),(oe=ve.passiveAbilities)!=null&&oe.includes("STORM")&&(ce+=10);return ce},B=(X,ce)=>{var Re,_e,Je,Ae;let re=X.cost*10;const ae=ce.players[P].board.filter($e=>$e!==null),W=ce.players[w].board.filter($e=>$e!==null),oe=ce.players[P].hp,ve=ce.players[w].hp,Oe=ce.players[w].pp;if((Re=X.passiveAbilities)!=null&&Re.includes("STORM")){const $e=Z(ce),De=X.attack||0;$e+De>=oe?re+=500:oe<=10?re+=100:re+=30}if(ae.length>0){const $e=X.triggers||[],De=U(ce);for(const It of $e)if(It.trigger==="FANFARE")for(const Be of It.effects||[]){if(Be.type==="DESTROY"&&(re+=60+(De>10?30:0)),Be.type==="RANDOM_DESTROY"){const qe=Be.value||1;re+=40*qe+(De>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(Be.type)&&(re+=35),Be.type==="AOE_DAMAGE"&&(re+=25*Math.min(ae.length,3))}}ve<=10&&((_e=X.passiveAbilities)!=null&&_e.includes("WARD")&&(re+=80),re+=20),X.cost===Oe?re+=15:Oe-X.cost<=1&&(re+=10);const Ce=X.triggers||[];for(const $e of Ce)if($e.trigger==="FANFARE")for(const De of $e.effects||[])De.type==="DRAW"&&(re+=20*(De.value||1)),(De.type==="SUMMON_CARD"||De.type==="SUMMON_CARD_RUSH")&&(re+=30),De.type==="GENERATE_CARD"&&(re+=15),De.type==="HEAL"&&(re+=ve<15?25:10);return X.type==="FOLLOWER"&&((X.attack||0)+(X.health||0)>=X.cost*2.5&&(re+=15),(Je=X.passiveAbilities)!=null&&Je.includes("WARD")&&ae.length>0&&(re+=25),(Ae=X.passiveAbilities)!=null&&Ae.includes("BANE")&&(re+=20)),X.type==="FOLLOWER"&&W.length>=5&&(re-=200),re},K=(X,ce,re,ae)=>{let W=0;const oe=re.players[P].board.filter(_e=>_e!==null),ve=re.players[w].board.filter(_e=>_e!==null),Oe=X.triggers||[],Ce=ae?"SUPER_EVOLVE":"EVOLVE";let Re=!1;for(const _e of Oe)if(_e.trigger===Ce){Re=!0;for(const Je of _e.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Je.type)&&(W+=oe.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Je.type)&&(W+=60),Je.type==="BUFF_STATS"){const Ae=Je.targetType||"SELF";Ae==="ALL_OTHER_FOLLOWERS"||Ae==="ALL_FOLLOWERS"?W+=25*Math.max(1,ve.length-1):W+=30}Je.type==="DRAW"&&(W+=35),Je.type==="GENERATE_CARD"&&(W+=25)}}return X.canAttack?(W+=30,W+=(X.currentAttack||0)*5):W+=(X.currentAttack||0)*2,X.cost>=6&&Re&&(W+=20),!Re&&X.cost<=3&&(W-=30),W},de=(X,ce)=>{const ae=X.players[w].board.filter(Ae=>Ae!==null),W=X.players[P].board.filter(Ae=>Ae!==null),oe=X.players[P].hp,ve=X.players[w].hp,Oe=X.turnCount,Ce=ae.filter(Ae=>Ae&&!Ae.hasEvolved);if(Ce.length===0)return!1;const Re=Ce.map((Ae,$e)=>({c:Ae,i:$e,score:K(Ae,$e,X,ce)})),_e=Math.max(...Re.map(Ae=>Ae.score));if(oe<=12&&ae.some(Ae=>Ae&&Ae.canAttack)||ve<=10)return!0;const Je=U(X);return Je>=8&&Ce.some($e=>{const De=$e.triggers||[];for(const It of De)if(It.trigger===(ce?"SUPER_EVOLVE":"EVOLVE")){for(const Be of It.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(Be.type))return!0}return!1})&&W.length>0||_e>=80||ce&&_e>=50?!0:Oe<=5&&ve>=15&&Je<8?_e>=100:_e<30?!1:_e>=50},ee=(X,ce,re)=>{var Oe,Ce,Re,_e,Je;const ae=((Oe=X.passiveAbilities)==null?void 0:Oe.includes("STORM"))||X.turnPlayed!==re.turnCount,W=ce.map((Ae,$e)=>({c:Ae,i:$e})).filter(({c:Ae})=>{var $e,De;return Ae!==null&&!(($e=Ae.passiveAbilities)!=null&&$e.includes("STEALTH"))&&!((De=Ae.passiveAbilities)!=null&&De.includes("AURA"))});if(!(((Ce=X.passiveAbilities)==null?void 0:Ce.includes("STEALTH"))||X.hadStealth)){const Ae=W.find(({c:$e})=>{var De;return(De=$e.passiveAbilities)==null?void 0:De.includes("WARD")});if(Ae)return O(Ae.c)?{index:-1,isLeader:!1}:{index:Ae.i,isLeader:!1}}let ve={index:-1,isLeader:ae,score:ae?0:-1e3};for(const{c:Ae,i:$e}of W){if(O(Ae))continue;let De=0;const It=X.isEvolved,Be=(Re=Ae.passiveAbilities)==null?void 0:Re.includes("BANE"),qe=j(X,Ae);V(X,Ae)?(De+=50,De+=(Ae.currentAttack||0)*5,qe?Be&&It?De-=60:Be&&(De-=30):De+=30,Be&&!qe&&(De+=40),(_e=Ae.passiveAbilities)!=null&&_e.includes("STORM")&&(De+=30),(Je=Ae.passiveAbilities)!=null&&Je.includes("DOUBLE_ATTACK")&&(De+=35)):!qe&&X.currentAttack>=Ae.currentHealth/2?De+=10:qe&&(De-=50,It&&(De-=40),(Ae.currentAttack||0)>=5&&(De+=10)),De>ve.score&&(ve={index:$e,isLeader:!1,score:De})}return ae&&(ve.index===-1||ve.score<=0)?{index:-1,isLeader:!0}:ve},ge=d==="EASY"?1200:d==="HARD"?400:800;if(await new Promise(X=>setTimeout(X,ge)),!ds.current)return;let Ee=0;const Qe=d==="EASY"?1:d==="HARD"?5:3;for(;Ee<Qe;){const X=rt.current,ce=X.players[w].hand,re=X.players[w].pp,W=X.players[w].board.filter(Be=>Be!==null).length>=5;let oe=ce.map((Be,qe)=>({...Be,originalIndex:qe})).filter(Be=>Be.cost<=re).filter(Be=>!(Be.type==="FOLLOWER"&&W));if(oe.length===0||(d==="HARD"?oe=oe.sort((Be,qe)=>B(qe,X)-B(Be,X)):oe=oe.sort((Be,qe)=>qe.cost-Be.cost),d==="EASY"&&Math.random()<.3&&Ee>0))break;const ve=oe[0];let Oe;const Re=X.players[P].board.filter(Be=>{var qe,_t;return Be&&!((qe=Be.passiveAbilities)!=null&&qe.includes("STEALTH"))&&!((_t=Be.passiveAbilities)!=null&&_t.includes("AURA"))});Re.length>0&&(d==="HARD"?Oe=[...Re].sort((qe,_t)=>{var bt,Tt;let at=(qe.currentAttack||0)+(qe.currentHealth||0),pt=(_t.currentAttack||0)+(_t.currentHealth||0);return(bt=qe.passiveAbilities)!=null&&bt.includes("BANE")&&(at+=10),(Tt=_t.passiveAbilities)!=null&&Tt.includes("BANE")&&(pt+=10),pt-at})[0].instanceId:Oe=Re[0].instanceId);const _e=window.innerWidth-20*p-80*p/2,Je=20*p+110*p/2,Ae=window.innerWidth/2,$e=window.innerHeight/2;let De,It;if(ve.type==="FOLLOWER"){const qe=rt.current.players[w].board.filter(xc=>xc!==null),_t=qe.length+1,at=qe.length,pt=di*p,bt=(at-(_t-1)/2)*pt,Tt=(Te=Yi.current)==null?void 0:Te.getBoundingClientRect();De=(Tt?Tt.left+Tt.width/2:window.innerWidth/2)+bt,It=window.innerHeight/2-70*p}Fn({card:ve,sourceIndex:-1,startX:_e,startY:Je,targetX:Ae,targetY:$e,finalX:De,finalY:It,playerClass:(Le==null?void 0:Le.class)||"SENKA",onComplete:()=>{if(ve.type!=="SPELL"&&(xt("gan.mp3",.6),$n()),I({type:"PLAY_CARD",playerId:w,payload:{cardIndex:ve.originalIndex,targetId:Oe,instanceId:ve.instanceId}}),ve.id==="c_amandava"&&rt.current.players[P].board.forEach((qe,_t)=>{if(qe){const at=qe.instanceId;setTimeout(()=>{Wt("SHOT",P,_t,at)},200)}}),ve.id==="c_azya"){if(setTimeout(()=>{Wt("THUNDER",P,-1)},200),Oe){const qe=rt.current.players[P].board.findIndex(_t=>(_t==null?void 0:_t.instanceId)===Oe);qe!==-1&&setTimeout(()=>{Wt("ICE",P,qe,Oe)},400)}setTimeout(()=>{const Be=rt.current.players[P].board,qe=Be.filter(_t=>_t!==null);if(qe.length>0){const _t=qe[Math.floor(Math.random()*qe.length)],at=Be.findIndex(pt=>(pt==null?void 0:pt.instanceId)===(_t==null?void 0:_t.instanceId));at!==-1&&Wt("WATER",P,at,_t==null?void 0:_t.instanceId)}},600)}Fn(null)}}),await b(600),Ee++}{const X=rt.current,ce=X.players[w],re=w===X.firstPlayerId,ae=X.turnCount,W=T_(ce,ae,re);if((w_(ce,ae,re)||W)&&ce.board.length>0){const ve=ce.board.map((Oe,Ce)=>({c:Oe,i:Ce})).filter(({c:Oe})=>Oe&&Oe.type==="FOLLOWER"&&!Oe.hasEvolved);if(ve.length>0){let Oe;const Ce=W;if(d==="HARD"&&(de(X,Ce)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),d==="HARD"&&!de(X,Ce))Oe=null;else if(d==="EASY")Oe=ve[Math.floor(Math.random()*ve.length)];else{const _e=ve.map(({c:Je,i:Ae})=>({c:Je,i:Ae,score:K(Je,Ae,X,Ce)}));_e.sort((Je,Ae)=>Ae.score-Je.score),d==="HARD"&&_e[0].score<5?(console.log("[AI HARD] Evolution target score too low:",_e[0].score),Oe=null):Oe=_e[0]}if(Oe){let _e;const Ae=X.players[P].board.filter(De=>{var It,Be;return De!==null&&!((It=De.passiveAbilities)!=null&&It.includes("STEALTH"))&&!((Be=De.passiveAbilities)!=null&&Be.includes("AURA"))});Ae.length>0&&(d==="HARD"?_e=[...Ae].sort((It,Be)=>{var at,pt,bt,Tt;let qe=(It.currentAttack||0)*2+(It.currentHealth||0),_t=(Be.currentAttack||0)*2+(Be.currentHealth||0);return(at=It.passiveAbilities)!=null&&at.includes("BANE")&&(qe+=10),(pt=Be.passiveAbilities)!=null&&pt.includes("BANE")&&(_t+=10),(bt=It.passiveAbilities)!=null&&bt.includes("DOUBLE_ATTACK")&&(qe+=5),(Tt=Be.passiveAbilities)!=null&&Tt.includes("DOUBLE_ATTACK")&&(_t+=5),_t-qe})[0].instanceId:_e=Ae[0].instanceId);const $e=(Ye=or.current[Oe.i])==null?void 0:Ye.getBoundingClientRect();$e?(Xi({card:Oe.c,evolvedImageUrl:Oe.c.evolvedImageUrl,startX:$e.left+$e.width/2,startY:$e.top+$e.height/2,useSep:Ce,phase:"ZOOM_IN",followerIndex:Oe.i,sourcePlayerId:w,targetId:_e}),await b(800)):(us({type:"EVOLVE",playerId:w,payload:{followerIndex:Oe.i,useSep:Ce,targetId:_e}}),await b(400))}}}}{let X=!0,ce=0;const re=ae=>{if(d!=="HARD")return!1;const W=ae.players[P].hp;return Z(ae)>=W};for(;X&&ce<15;){if(rt.current.winnerId){X=!1;break}ce++;const ae=rt.current,W=ae.players[w].board,oe=ae.players[P].board,ve=re(ae);let Oe=!1;for(let Ce=0;Ce<W.length;Ce++){const Re=W[Ce];if(!Re||!Re.canAttack)continue;let _e=-1,Je=!0;const Ae=((Ze=Re.passiveAbilities)==null?void 0:Ze.includes("STEALTH"))||Re.hadStealth,$e=Ae?-1:oe.findIndex(at=>{var pt,bt;return at&&((pt=at.passiveAbilities)==null?void 0:pt.includes("WARD"))&&!((bt=at.passiveAbilities)!=null&&bt.includes("STEALTH"))&&!O(at)});if(ve&&$e===-1)if(((Ge=Re.passiveAbilities)==null?void 0:Ge.includes("STORM"))||Re.turnPlayed!==ae.turnCount)_e=-1,Je=!0;else{const bt=oe.map((Tt,gs)=>({c:Tt,idx:gs})).filter(({c:Tt})=>{var gs,xc;return Tt&&!((gs=Tt.passiveAbilities)!=null&&gs.includes("STEALTH"))&&!((xc=Tt.passiveAbilities)!=null&&xc.includes("AURA"))&&!O(Tt)});if(bt.length>0)_e=bt[0].idx,Je=!1;else continue}else if($e!==-1)_e=$e,Je=!1;else if(d==="EASY"){const at=oe.map((bt,Tt)=>({c:bt,idx:Tt})).filter(({c:bt})=>{var Tt,gs;return bt&&!((Tt=bt.passiveAbilities)!=null&&Tt.includes("STEALTH"))&&!((gs=bt.passiveAbilities)!=null&&gs.includes("AURA"))&&!O(bt)}),pt=((Ve=Re.passiveAbilities)==null?void 0:Ve.includes("STORM"))||Re.turnPlayed!==ae.turnCount;if(!pt&&at.length>0)_e=at[Math.floor(Math.random()*at.length)].idx,Je=!1;else{if(!pt&&at.length===0)continue;pt&&at.length>0&&Math.random()<.5&&(_e=at[Math.floor(Math.random()*at.length)].idx,Je=!1)}}else{const at=ee(Re,oe,ae);if(_e=at.index,Je=at.isLeader,_e===-1&&!Je)continue}const De=(me=Re.passiveAbilities)==null?void 0:me.includes("STORM"),It=Re.turnPlayed===ae.turnCount;if(!De&&It&&Je){const at=oe.map((pt,bt)=>({c:pt,idx:bt})).filter(({c:pt})=>{var bt,Tt;return pt&&!((bt=pt.passiveAbilities)!=null&&bt.includes("STEALTH"))&&!((Tt=pt.passiveAbilities)!=null&&Tt.includes("AURA"))&&!O(pt)});if(at.length>0){const pt=Ae?null:at.find(({c:bt})=>{var Tt;return(Tt=bt.passiveAbilities)==null?void 0:Tt.includes("WARD")});pt?_e=pt.idx:_e=at[0].idx,Je=!1}else continue}const Be=Je?null:oe[_e],qe=Be?Be.instanceId:void 0,_t=Re.instanceId;if(_t&&(ic(_t),setTimeout(()=>ic(null),300)),Wt(Re.attackEffectType||"SLASH",P,Je?-1:_e,qe),!Je&&_e>=0){const at=oe[_e];if(at&&(at.currentAttack||0)>0){const pt=at.instanceId;setTimeout(()=>{pt&&(oc(pt),setTimeout(()=>oc(null),300)),Wt(at.attackEffectType||"SLASH",w,Ce,_t)},200)}}Oe=!0,await b(1e3),I({type:"ATTACK",playerId:w,payload:{attackerIndex:Ce,targetIndex:_e,targetIsLeader:Je}}),await b(1e3);break}Oe||(X=!1)}}if(await b(300),rt.current.winnerId){ds.current=!1;return}I({type:"END_TURN",playerId:w}),ds.current=!1})()}},[g.activePlayerId,g.turnCount,n,g.phase,d,g.winnerId]);const _m=(m,x)=>{if(An.current||Xe||Gi.length>0)return;const b=le.hand[x];m.stopPropagation();const O="touches"in m?m.touches[0].clientX:m.clientX,j="touches"in m?m.touches[0].clientY:m.clientY,V=m.currentTarget.getBoundingClientRect();if(!zr){uf(!0),Br({card:b,owner:"PLAYER",source:"HAND"}),ff.current=!0;return}if(Br({card:b,owner:"PLAYER",source:"HAND"}),g.activePlayerId!==P)return;if(fn.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const Z=rt.current;if(Z.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(Z.pendingEffects&&Z.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const U={sourceType:"HAND",sourceIndex:x,sourceInstanceId:b.instanceId,startX:V.left+V.width/2,startY:V.top+V.height/2,currentX:O,currentY:j,offsetX:0,offsetY:0,canDrag:!0};Ur(U),An.current=U},xm=(m,x,b)=>{m.stopPropagation();const O="touches"in m?m.touches[0].clientX:m.clientX,j="touches"in m?m.touches[0].clientY:m.clientY,V=rt.current;if(V.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const Z=V.players[P].board,U=b?Z.findIndex(K=>K&&K.instanceId===b):x,B=U>=0?Z[U]:null;if(it&&it.allowedTargetPlayerId===P&&B){bf("FOLLOWER",U,P,b);return}if(B&&Br({card:B,owner:"PLAYER",source:"BOARD"}),V.pendingEffects&&V.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(V.activePlayerId===P&&(B!=null&&B.canAttack)){const K=m.currentTarget.getBoundingClientRect(),de={x:K.left+K.width/2,y:K.top+K.height/2},ee={sourceType:"BOARD",sourceIndex:U,sourceInstanceId:B.instanceId,startX:de.x,startY:de.y,currentX:O,currentY:j,offsetX:0,offsetY:0};Ur(ee),An.current=ee}},mc=(m,x=!1)=>{if(g.activePlayerId!==P)return;m.stopPropagation();const b="touches"in m?m.touches[0].clientX:m.clientX,O="touches"in m?m.touches[0].clientY:m.clientY,j=rt.current;if(j.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if(j.pendingEffects&&j.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const V=P===g.firstPlayerId;if(x){if(!T_(le,g.turnCount,V))return}else if(!w_(le,g.turnCount,V))return;const Z=m.currentTarget.getBoundingClientRect(),U=Z.left+Z.width/2,B=Z.top+Z.height/2,K={sourceType:"EVOLVE",sourceIndex:0,startX:U,startY:B,currentX:b,currentY:O,offsetX:0,offsetY:0,useSep:x};Ur(K),An.current=K},bm=L.useCallback(m=>{Sr.current&&(clearTimeout(Sr.current),Sr.current=null);const x={stampId:m,playerId:P,playerClass:Er,timestamp:Date.now()},b=qy(m);b&&xt(b,.6),Wi(null),requestAnimationFrame(()=>{Wi(x)}),e==="ONLINE"&&v&&v.send({type:"STAMP",stampId:m,playerClass:Er}),Sr.current=setTimeout(()=>{Wi(O=>(O==null?void 0:O.timestamp)===x.timestamp?null:O),Sr.current=null},3e3)},[P,Er,e,v]),xI=L.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),li.current){const x=li.current.getBoundingClientRect();$r.current={x:x.left+x.width/2,y:x.top+x.height/2}}else $r.current={x:m.clientX,y:m.clientY};Z0(!0),Zl(null)},[]),Em=$.useRef(null);$.useEffect(()=>{Em.current=tf},[tf]),L.useEffect(()=>{if(!ef)return;const m=b=>{if(!$r.current)return;const O=b.clientX-$r.current.x,j=b.clientY-$r.current.y,V=Math.sqrt(O*O+j*j),Z=Math.atan2(j,O)*(180/Math.PI);if(V>=200&&V<=320&&j<0){const de=180- -Z,ee=Math.floor(de/22.5),Ee=Math.max(0,Math.min(7,ee))+1;Zl(Ee)}else Zl(null)},x=()=>{const b=Em.current;b&&bm(b),Z0(!1),Zl(null),$r.current=null};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",x)}},[ef,bm]),L.useEffect(()=>{const m=(O,j,V=!1)=>{var B,K,de,ee;if(!An.current)return;const{canDrag:Z,sourceType:U}=An.current;if(!(U==="HAND"&&!Z)&&(An.current={...An.current,currentX:O,currentY:j},Ur(ge=>ge?{...ge,currentX:O,currentY:j}:null),V&&(U==="BOARD"||U==="EVOLVE"))){const ge=Ki.current;if(ge){const Te=ge.getBoundingClientRect();if(O>=Te.left&&O<=Te.right&&j>=Te.top&&j<=Te.bottom){Yn({type:"LEADER",index:0,playerId:w});return}}const Ee=rt.current,Qe=((B=Ee.players[w])==null?void 0:B.board)||[];for(let Te=0;Te<or.current.length;Te++){const Ye=or.current[Te];if(Ye&&Qe[Te]){const Ze=Ye.getBoundingClientRect();if(O>=Ze.left&&O<=Ze.right&&j>=Ze.top&&j<=Ze.bottom){Yn({type:"FOLLOWER",index:Te,playerId:w,instanceId:(K=Qe[Te])==null?void 0:K.instanceId});return}}}if(U==="EVOLVE"){const Te=((de=Ee.players[P])==null?void 0:de.board)||[];for(let Ye=0;Ye<wr.current.length;Ye++){const Ze=wr.current[Ye];if(Ze&&Te[Ye]){const Ge=Ze.getBoundingClientRect();if(O>=Ge.left&&O<=Ge.right&&j>=Ge.top&&j<=Ge.bottom){Yn({type:"FOLLOWER",index:Ye,playerId:P,instanceId:(ee=Te[Ye])==null?void 0:ee.instanceId});return}}}}Yn(null)}},x=O=>{m(O.clientX,O.clientY)},b=O=>{O.touches.length>0&&(An.current&&O.preventDefault(),m(O.touches[0].clientX,O.touches[0].clientY,!0))};return window.addEventListener("mousemove",x),window.addEventListener("touchmove",b,{passive:!1}),()=>{window.removeEventListener("mousemove",x),window.removeEventListener("touchmove",b)}},[]);const Sm=$.useRef(null),bI=$.useRef(null);L.useEffect(()=>{Sm.current=ft,bI.current=ft},[ft]),L.useEffect(()=>{const m=()=>{var j,V,Z,U,B,K,de,ee,ge,Ee,Qe,Te,Ye;const b=An.current,O=Sm.current;if(rt.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Ur(null),An.current=null,Yn(null);return}if(b){if(b.sourceType==="HAND"){if(fn.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),An.current=null,Ur(null);return}const Ze=Math.sqrt(Math.pow(b.startX-b.currentX,2)+Math.pow(b.startY-b.currentY,2)),Ge=b.currentY<window.innerHeight-200*p;if(b.canDrag&&Ze>30&&Ge){const Ve=Tr.current.hand[b.sourceIndex];if(Tr.current.pp>=Ve.cost){const me=((V=(j=Ve.triggerAbilities)==null?void 0:j.FANFARE)==null?void 0:V.targetType)==="SELECT_FOLLOWER"||((Z=Ve.triggers)==null?void 0:Z.some(ae=>ae.trigger==="FANFARE"&&ae.effects.some(W=>W.targetType==="SELECT_FOLLOWER"))),X=((B=(U=Ve.triggerAbilities)==null?void 0:U.FANFARE)==null?void 0:B.targetType)==="SELECT_ALLY_FOLLOWER"||((K=Ve.triggers)==null?void 0:K.some(ae=>ae.trigger==="FANFARE"&&ae.effects.some(W=>W.targetType==="SELECT_ALLY_FOLLOWER"))),ce=((ee=(de=Ve.triggerAbilities)==null?void 0:de.FANFARE)==null?void 0:ee.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((ge=Ve.triggers)==null?void 0:ge.some(ae=>ae.trigger==="FANFARE"&&ae.effects.some(W=>W.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(me||X||ce){const ae=X||ce?P:w;rt.current.players[ae].board.some(ve=>{var Oe,Ce;return!(!ve||ae!==P&&((Oe=ve.passiveAbilities)!=null&&Oe.includes("STEALTH")||(Ce=ve.passiveAbilities)!=null&&Ce.includes("AURA")))})?(fn.current=!0,ha.current=Ve.instanceId||null,ai({type:"PLAY",sourceIndex:b.sourceIndex,sourceInstanceId:Ve.instanceId,allowedTargetPlayerId:ae}),ar.current=!0,setTimeout(()=>{ar.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),xf(b.sourceIndex,b.startX,b.startY),Br(null),ar.current=!0,setTimeout(()=>{ar.current=!1},100))}else xf(b.sourceIndex,b.startX,b.startY),Br(null),ar.current=!0,setTimeout(()=>{ar.current=!1},100);An.current=null,Ur(null);return}}else b.canDrag||uf(!0)}else if(b.sourceType==="BOARD"){if(O&&O.playerId===w){const Ge=rt.current.players[w],Ve=Ge.board.filter(W=>{var oe,ve;return W&&((oe=W.passiveAbilities)==null?void 0:oe.includes("WARD"))&&!((ve=W.passiveAbilities)!=null&&ve.includes("STEALTH"))});let me=!1;const X=W=>W?Ge.board.findIndex(oe=>oe&&oe.instanceId===W):-1,ce=O.type==="LEADER"?-1:X(O.instanceId),re=Tr.current.board[b.sourceIndex],ae=((Ee=re==null?void 0:re.passiveAbilities)==null?void 0:Ee.includes("STEALTH"))||(re==null?void 0:re.hadStealth);if(Ve.length>0&&!ae){if(O.type==="LEADER")me=!0;else if(O.type==="FOLLOWER"&&ce>=0){const W=Ge.board[ce];W&&!((Qe=W.passiveAbilities)!=null&&Qe.includes("WARD"))&&(me=!0)}}if(me)console.log("UI: Attack blocked by WARD");else{const W=Tr.current.board.findIndex(Je=>Je&&Je.instanceId===b.sourceInstanceId),oe=W>=0?Tr.current.board[W]:null,ve=(Te=oe==null?void 0:oe.passiveAbilities)==null?void 0:Te.includes("RUSH"),Oe=(Ye=oe==null?void 0:oe.passiveAbilities)==null?void 0:Ye.includes("STORM"),Ce=(oe==null?void 0:oe.turnPlayed)===rt.current.turnCount,Re=O.type==="LEADER",_e=ce;if(Re&&ve&&!Oe&&Ce)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(W<0||!oe){console.log("UI: Attack blocked - invalid attacker");return}const Je=rt.current;if(Je.pendingEffects&&Je.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Ae=O.instanceId,$e=b.sourceInstanceId,De=!Re&&_e>=0?Ge.board[_e]:null;us({type:"ATTACK",playerId:P,payload:{attackerIndex:W,targetIndex:Re?-1:_e,targetIsLeader:Re}}),$e&&(ic($e),setTimeout(()=>ic(null),300));const Be=(oe==null?void 0:oe.attackEffectType)||"SLASH";if(Wt(Be,w,Re?-1:_e,Ae),$n(),!Re&&De&&(De.currentAttack||0)>0){const qe=De.instanceId;setTimeout(()=>{qe&&(oc(qe),setTimeout(()=>oc(null),300)),Wt(De.attackEffectType||"SLASH",P,W,$e)},200)}}}}}else if(b.sourceType==="EVOLVE"&&O&&O.type==="FOLLOWER"&&O.playerId===P){const Ze=O.index,Ve=aa.current[Ze],me=(Ve==null?void 0:Ve.instanceId)||O.instanceId,X=Tr.current.board,ce=me?X.findIndex($e=>$e&&$e.instanceId===me):Ze,re=ce>=0?X[ce]:null;if(!re)return;if(re.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const W=b.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],ve=(()=>{var De,It;const $e=(It=(De=re==null?void 0:re.triggerAbilities)==null?void 0:De.EVOLVE)==null?void 0:It.targetType;if($e)return $e;for(const Be of(re==null?void 0:re.triggers)||[])if(W.includes(Be.trigger)){for(const qe of Be.effects)if(qe.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(qe.targetType))return qe.targetType}return null})(),Oe=!!ve,Ce=ve==="SELECT_ALLY_FOLLOWER"||ve==="SELECT_OTHER_ALLY_FOLLOWER",Re=ve==="SELECT_OTHER_ALLY_FOLLOWER",_e=Ce?P:w,Ae=rt.current.players[_e].board.some($e=>{var De,It;return!(!$e||Ce&&Re&&$e.instanceId===me||!Ce&&((De=$e.passiveAbilities)!=null&&De.includes("STEALTH")||(It=$e.passiveAbilities)!=null&&It.includes("AURA")))});Oe&&Ae?(ai({type:"EVOLVE",sourceIndex:ce,sourceInstanceId:me,sourceVisualIndex:Ze,useSep:b.useSep,allowedTargetPlayerId:_e,excludeInstanceId:Re?me:void 0}),ar.current=!0,setTimeout(()=>{ar.current=!1},100)):(gc(Ze,b.useSep,void 0,me),ar.current=!0,setTimeout(()=>{ar.current=!1},100))}}b&&b.sourceType==="HAND"&&b.canDrag&&(cm(b.sourceIndex),setTimeout(()=>cm(null),300)),Ur(null),An.current=null,Yn(null)},x=()=>{m()};return window.addEventListener("mouseup",m),window.addEventListener("touchend",x),()=>{window.removeEventListener("mouseup",m),window.removeEventListener("touchend",x)}},[w,P,zr,p]);const EI=()=>{if(!ar.current){if(it){it.type==="PLAY"&&(fn.current=!1),ai(null);return}if(zr){if(ff.current){ff.current=!1;return}uf(!1),Br(null),je(null)}}},fs=()=>{if(!J||J.sourceType!=="BOARD"&&J.sourceType!=="EVOLVE")return"";const m=J.currentX-J.startX,x=J.currentY-J.startY,b=Math.sqrt(m*m+x*x);if(b<10)return"";const O=(J.startX+J.currentX)/2,j=(J.startY+J.currentY)/2,V=Math.min(200,b*.3),Z=Math.abs(m),U=Math.min(150,Z*.4),B=V+U,de=-(m/(b+1))*B*.5,ee=-B*.8,ge=O+de,Ee=j+ee;return`M${J.startX},${J.startY} Q${ge},${Ee} ${J.currentX},${J.currentY}`},bf=(m,x,b,O)=>{var Z;if(!it)return;if(it.allowedTargetPlayerId&&it.allowedTargetPlayerId!==b){console.log("Invalid target side");return}if(it.excludeInstanceId&&O===it.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),$n();return}let j,V=x;if(m==="FOLLOWER"){if(O&&(V=g.players[b].board.findIndex(B=>B&&B.instanceId===O),V<0))return;const U=g.players[b].board[V];if(!U)return;if(j=U.instanceId,b!==P){const B=U.passiveAbilities||[];if(B.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),xt("cancel"),$n();return}if(B.includes("AURA")){console.log("Cannot target unit with AURA"),xt("cancel"),$n();return}}}else return;if(it.type==="PLAY"){const U=Tr.current;let B=it.sourceIndex,K=U.hand[B];if(it.sourceInstanceId){const Ge=U.hand.findIndex(Ve=>Ve.instanceId===it.sourceInstanceId);if(Ge>=0)B=Ge,K=U.hand[Ge],console.log(`[handleTargetClick] Using sourceInstanceId ${it.sourceInstanceId}, found at index ${Ge} (was ${it.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",it.sourceInstanceId),ai(null);return}}if(!K){console.error("[handleTargetClick] Card not found at index:",B),ai(null),fn.current=!1;return}fn.current=!0,ha.current=K.instanceId||null,K.id==="c_y"&&(Wt("SUMI","p2",V,j),rt.current.players[w].board.forEach((Ve,me)=>{if(Ve){const X=Ve.instanceId;setTimeout(()=>{Wt("SUMI",w,me,X)},300)}})),K.id==="s_resignation_proxy"&&(Wt("SUMI",b,V,j),setTimeout(()=>{const Ge=rt.current.players[P].board,Ve=[];if(Ge.forEach((me,X)=>{me&&Ve.push({index:X,instanceId:me.instanceId})}),Ve.length>0){const me=Ve[Math.floor(Math.random()*Ve.length)];Wt("SUMI",P,me.index,me.instanceId)}},500)),K.id==="c_azya"&&(Wt("THUNDER",w,-1),setTimeout(()=>{Wt("ICE",b,V,j)},300),setTimeout(()=>{const Ge=rt.current.players[w].board,Ve=Ge.filter(me=>me!==null);if(Ve.length>0){const me=Ve[Math.floor(Math.random()*Ve.length)],X=Ge.findIndex(ce=>(ce==null?void 0:ce.instanceId)===(me==null?void 0:me.instanceId));X!==-1&&Wt("WATER",w,X,me==null?void 0:me.instanceId)}},600));const de=window.innerWidth/2,ee=window.innerHeight-200*p/2,ge=window.innerWidth/2,Ee=window.innerHeight/2,Qe=()=>{K.type==="SPELL"||$n(),us({type:"PLAY_CARD",playerId:P,payload:{cardIndex:B,targetId:j,instanceId:K.instanceId}}),K.id==="c_amandava"&&rt.current.players[w].board.forEach((me,X)=>{if(me){const ce=me.instanceId;setTimeout(()=>{Wt("SHOT",w,X,ce)},200)}}),Fn(null),setTimeout(()=>{fn.current=!1},100)};let Te,Ye;if(K.type==="FOLLOWER"){const Ve=rt.current.players[P].board.filter(oe=>oe!==null),me=Ve.length+1,X=Ve.length,ce=di*p,re=(X-(me-1)/2)*ce,ae=(Z=Yi.current)==null?void 0:Z.getBoundingClientRect();Te=(ae?ae.left+ae.width/2:window.innerWidth/2)+re,Ye=window.innerHeight/2+70*p}const Ze=K.type==="FOLLOWER"?rt.current.players[P].board.filter(Ge=>Ge!==null).length:void 0;n!=="CPU"&&_&&v&&v.send({type:"PLAY_CARD_ANIM",payload:{playerId:P,cardIndex:B,card:K,targetBoardIndex:Ze}}),Fn({card:K,sourceIndex:it.sourceIndex??-1,startX:de,startY:ee,targetX:ge,targetY:Ee,finalX:Te,finalY:Ye,playerClass:(le==null?void 0:le.class)||"SENKA",onComplete:Qe}),setTimeout(()=>{Fn(Ge=>(Ge==null?void 0:Ge.card.id)===K.id?(Qe(),null):Ge)},2e3)}else if(it.type==="EVOLVE"){const U=it.sourceVisualIndex??it.sourceIndex;gc(U,!!it.useSep,j,it.sourceInstanceId)}ai(null)},Im=()=>{if(!Ue||Ue.owner!=="PLAYER")return;if(fn.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const m=le.hand.findIndex(O=>O.id===Ue.card.id);if(m===-1)return;const x=window.innerWidth/2,b=window.innerHeight-200*p/2;xf(m,x,b),Br(null)},[qi,Ef]=$.useState(!1),[yc,Sf]=$.useState(!1),[Yt,If]=$.useState(null),SI=$.useRef(0);$.useEffect(()=>{if(!(Yt!=null&&Yt.active))return;const m=Date.now(),x=800,b=()=>{const O=Date.now()-m;if(O>=x){If(null);return}const j=O/x;If(V=>V?{...V,ringRadius:20+j*100,particles:V.particles.map(Z=>({...Z,x:Z.x+Z.vx,y:Z.y+Z.vy,opacity:1-j}))}:null),requestAnimationFrame(b)};requestAnimationFrame(b)},[Yt==null?void 0:Yt.active]);const wm=(m,x)=>{const b=[];for(let O=0;O<20;O++){const j=Math.random()*Math.PI*2,V=2+Math.random()*3;b.push({id:SI.current++,x:m,y:x,vx:Math.cos(j)*V,vy:Math.sin(j)*V,opacity:1,createdAt:Date.now()})}If({active:!0,x:m,y:x,ringRadius:20,particles:b})},wf=async()=>{if(g.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(g.activePlayerId!==P){console.log("[handleEndTurn] Not my turn, ignoring");return}if(Qi.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}Qi.current=!0,Ef(!0);const m=rt.current.turnCount,x=rt.current.activePlayerId;if(!await(async()=>{const j=()=>{const K=rt.current,de=K.pendingEffects&&K.pendingEffects.length>0,ee=yf.current.length>0,ge=vf.current.length>0,Ee=pa.current!==null,Qe=Ji.current!==null,Te=Fr.current,Ye=fn.current;return!de&&!ee&&!ge&&!Ee&&!Qe&&!Te&&!Ye};let U=0,B=0;for(;U<3e3;){if(rt.current.turnCount!==m||rt.current.activePlayerId!==x)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(j()){if(B++,B>=2)break}else B=0;await new Promise(K=>setTimeout(K,50)),U+=50}return U>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||rt.current.turnCount!==m||rt.current.activePlayerId!==x||rt.current.activePlayerId!==P){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),Qi.current=!1,Ef(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),us({type:"END_TURN",playerId:P}),Qi.current=!1,Ef(!1)},II=L.useCallback(()=>{xt("sisiodosi.mp3",.6);const m=sm.current;if(m){const x=m.getBoundingClientRect();wm(x.left+x.width/2,x.top+x.height/2)}wf()},[xt,wf]),Tm=2-((le==null?void 0:le.evolutionsUsed)||0),Tf=P===g.firstPlayerId,Cm=(m,x)=>x?Math.ceil(g.turnCount/2):Math.floor(g.turnCount/2),km=Cm(P,Tf),wI=Tf?3:2,TI=Tf?4:3,vc=km>=wI,_c=km>=TI,hs=(le==null?void 0:le.canEvolveThisTurn)&&Tm>0&&g.activePlayerId===P&&vc,ps=(le==null?void 0:le.canEvolveThisTurn)&&le.sep>0&&g.activePlayerId===P&&_c,Cf=w===g.firstPlayerId,Rm=Cm(w,Cf),CI=Cf?3:2,kI=Cf?4:3,kf=Rm>=CI,Rf=Rm>=kI,Af=((Nm=le==null?void 0:le.board)==null?void 0:Nm.some(m=>{var x;return(x=m==null?void 0:m.passiveAbilities)==null?void 0:x.includes("LEADER_DAMAGE_CAP")}))??!1,Pf=((jm=Le==null?void 0:Le.board)==null?void 0:jm.some(m=>{var x;return(x=m==null?void 0:m.passiveAbilities)==null?void 0:x.includes("LEADER_DAMAGE_CAP")}))??!1,RI=(le==null?void 0:le.leaderDamageShield)??!1,AI=(Le==null?void 0:Le.leaderDamageShield)??!1,Am=Af||RI,Pm=Pf||AI;return L.useLayoutEffect(()=>{window.scrollTo(0,0),Yi.current&&(Yi.current.scrollTop=0);const m=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",m,{passive:!1}),()=>{window.removeEventListener("scroll",m)}},[]),n==="JOIN"&&!A||Q&&y&&!A?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{children:"..."}),a.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):Q&&We&&A?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{color:"#a0aec0"},children:"..."}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):a.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[F&&a.jsx(qL,{myPlayer:le,opponentPlayer:Le,isFirstPlayer:ls,onComplete:vI,scale:p,onVsImpact:()=>xt("vs.mp3",.7),onCoinToss:()=>xt("coin.mp3",.7),onImpact:()=>xt("gan.mp3",.7),onOrbLand:()=>xt("gan.mp3",.8),onFadeInBoard:()=>Ie(!0),isMobile:G}),a.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:yt>0?`translate(${se.x}px, ${se.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:F&&!R?0:1,transition:"opacity 0.5s ease-in"},onClick:EI,children:[a.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),it&&a.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:it.allowedTargetPlayerId===P?"2px solid #48bb78":"2px solid #f56565"},children:it.allowedTargetPlayerId===P?"":""}),pI&&a.jsx(m3,{onClose:()=>df(!1)}),hI&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>cc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),fI?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[a.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",a.jsx("input",{type:"checkbox",checked:Rt.bgmEnabled,onChange:m=>ua(x=>({...x,bgmEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",a.jsx("input",{type:"checkbox",checked:Rt.seEnabled,onChange:m=>ua(x=>({...x,seEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"BGM"}),a.jsxs("span",{children:[Math.round(Rt.bgm*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Rt.bgm,onChange:m=>ua(x=>({...x,bgm:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"SE"}),a.jsxs("span",{children:[Math.round(Rt.se*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Rt.se,onChange:m=>ua(x=>({...x,se:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:""}),a.jsxs("span",{children:[Math.round(Rt.voice*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Rt.voice,onChange:m=>ua(x=>({...x,voice:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsx("button",{onClick:()=>hm(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>cc(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>hm(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>dc(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),gI&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>dc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),a.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),a.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[a.jsx("button",{onClick:()=>dc(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),a.jsx("button",{onClick:mI,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),a.jsxs("div",{className:pm?"shake-target":"",style:{width:(G?280:340)*p,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:G?`${10*p}px ${12*p}px`:`${20*p}px ${20*p}px ${20*p}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:m=>m.stopPropagation(),children:[a.jsx("div",{style:{marginBottom:(G?6:12)*p},children:a.jsxs("button",{onClick:()=>cc(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:G?3:5},children:[a.jsx("div",{style:{width:(G?22:30)*p,height:(G?2:3)*p,background:"#cbd5e0",marginBottom:(G?4:6)*p}}),a.jsx("div",{style:{width:(G?22:30)*p,height:(G?2:3)*p,background:"#cbd5e0",marginBottom:(G?4:6)*p}}),a.jsx("div",{style:{width:(G?22:30)*p,height:(G?2:3)*p,background:"#cbd5e0"}})]})}),a.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(G?4:8)*p,marginTop:0,marginBottom:0,flexShrink:0,fontSize:G?`${.85*p}rem`:void 0},children:""}),Ue?a.jsx("div",{style:{marginTop:(G?4:10)*p,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:a.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{flexShrink:0},children:[a.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(G?6:12)*p,display:"flex",alignItems:"center",justifyContent:"center",...G?{maxHeight:"28vh"}:{}},children:a.jsx(to,{card:Ue.card,style:{width:"100%",height:"100%",...G?{maxHeight:"28vh"}:{}},variant:"art-only"})}),a.jsx("div",{style:{fontSize:G?`${(Ue.card.name.length>12?.9:Ue.card.name.length>8?1:1.1)*p}rem`:`${Ue.card.name.length>12?1.1:Ue.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(G?4:6)*p,textAlign:"center"},children:Ue.card.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(G?10:15)*p,marginBottom:(G?6:10)*p},children:[a.jsx("div",{style:{width:24*p,height:24*p,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*p}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:Ue.card.cost}),Ue.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"none",children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in Ue.card?Ue.card.currentAttack:Ue.card.attack})]}),Ue.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"#f56565",children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in Ue.card?Ue.card.currentHealth:Ue.card.health})]})]}),a.jsx("div",{style:{fontSize:`${(((($m=Ue.card.description)==null?void 0:$m.length)||0)>150?.7:(((Fm=Ue.card.description)==null?void 0:Fm.length)||0)>100?.8:.9)*p}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*p},children:uI(Ue.card.description)})]}),Ue.card.flavorText&&a.jsx("div",{style:{marginTop:"auto",paddingTop:8*p,paddingBottom:4*p,flexShrink:0},children:a.jsx("div",{style:{fontSize:`${((((Um=Ue.card.flavorText)==null?void 0:Um.length)||0)>100?.6:.7)*p}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:Ue.card.flavorText})})]})}):a.jsx("div",{style:{marginTop:10*p,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*p}rem`},children:""})]}),a.jsxs("div",{ref:Yi,className:pm?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[a.jsxs("div",{ref:Ki,onMouseEnter:()=>Yn({type:"LEADER",playerId:w}),onMouseLeave:()=>Yn(null),onClick:m=>{m.stopPropagation(),it&&bf("LEADER",-1,w)},style:{position:"absolute",top:-20*p,left:"50%",transform:"translateX(-50%)",width:no*p,height:no*p,borderRadius:"50%",zIndex:100,cursor:"default"},children:[a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:Le.class==="AJA"?`url(${el(Le.class)}) center top/cover`:`url(${el(Le.class)}) center/cover`,border:Pf?"4px solid #67e8f9":(ft==null?void 0:ft.type)==="LEADER"&&ft.playerId===w&&!it?"4px solid #f56565":"4px solid #4a5568",boxShadow:Pf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Pm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...g.winnerId===P&&(Ne||st)?{filter:Ne==="white-fade"?"brightness(2) saturate(0.3)":Ne==="explode"||Ne==="result-text"||Ne==="fade-out"||st?"brightness(3) saturate(0) blur(10px)":"none",opacity:Ne==="explode"||Ne==="result-text"||Ne==="fade-out"||st?0:1}:{}},children:Pm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),a.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:te?1:0,transition:"opacity 0.3s ease-in"},children:Le.hp}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:te?kf?1:.5:0,filter:kf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,x)=>{const b=x<2-Le.evolutionsUsed;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?"#ecc94b":"#2d3748",boxShadow:b&&kf?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},x)})})}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:te?Rf?1:.5:0,filter:Rf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,x)=>{const b=x<Le.sep;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?"#9f7aea":"#2d3748",boxShadow:b&&Rf?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},x)})})}),a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:no*p*.75,height:no*p*.75,pointerEvents:"none",zIndex:20,opacity:(ft==null?void 0:ft.type)==="LEADER"&&ft.playerId===w&&J?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[a.jsx("defs",{children:a.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,left:20*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Le.deck.length/5)))].map((m,x)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${x*2*p}px, ${-x*2*p}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:a.jsx("img",{src:ci((Le==null?void 0:Le.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:b=>{b.target.style.display="none",b.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},x)),a.jsx("div",{style:{position:"absolute",bottom:-20*p,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Le.deck.length})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,right:20*p,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:24,height:30},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Le.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Le.graveyard.length,Zu.filter(m=>m.playerId===w).map(m=>a.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),a.jsx("div",{style:{position:"absolute",top:`calc(50% - ${bn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:bn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:un.map((m,x)=>{const b=un.length,O=(x-(b-1)/2)*di*p;return a.jsxs("div",{ref:j=>or.current[x]=j,onMouseEnter:()=>{J&&Yn({type:"FOLLOWER",index:x,playerId:w,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{J&&Yn(null)},onClick:j=>{if(j.stopPropagation(),it){if(!m)return;bf("FOLLOWER",x,w,m==null?void 0:m.instanceId)}else m&&Br({card:m,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${O}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:it&&m&&it.allowedTargetPlayerId===w?"2px solid #f56565":"none",boxShadow:it&&m&&it.allowedTargetPlayerId===w?"0 0 15px #f56565":"none",borderRadius:8,cursor:it?"crosshair":"default",width:an*p,height:bn*p,pointerEvents:"auto",opacity:Dt&&Dt.sourcePlayerId===w&&Dt.followerIndex===x?0:m!=null&&m.isDying?.8:1,transitionProperty:Dt&&Dt.sourcePlayerId===w&&Dt.followerIndex===x?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:am===(m==null?void 0:m.instanceId)||lm===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(to,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:an*p,height:bn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(ft==null?void 0:ft.type)==="FOLLOWER"&&ft.index===x&&(J==null?void 0:J.sourceType)==="BOARD"?"0 0 20px #f56565":(J==null?void 0:J.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:om.has(m.instanceId)}):a.jsx("div",{style:{width:an*p,height:bn*p,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:ci((Le==null?void 0:Le.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(J==null?void 0:J.sourceType)==="BOARD"&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(ft==null?void 0:ft.type)==="FOLLOWER"&&ft.index===x&&ft.playerId===w?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(m==null?void 0:m.instanceId)||`empty-opp-${x}`)})})}),a.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${bn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:bn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:_n.map((m,x)=>{const b=_n.length,O=(x-(b-1)/2)*di*p;return a.jsxs("div",{ref:j=>wr.current[x]=j,onMouseDown:j=>xm(j,x,m==null?void 0:m.instanceId),onTouchStart:j=>xm(j,x,m==null?void 0:m.instanceId),onClick:j=>j.stopPropagation(),onMouseEnter:()=>{J&&Yn({type:"FOLLOWER",index:x,playerId:P,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{J&&Yn(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${O}px)`,transform:`translateX(calc(-50% + ${O}px)) ${(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:an*p,height:bn*p,border:it&&m&&it.allowedTargetPlayerId===P?"2px solid #48bb78":"none",boxShadow:it&&m&&it.allowedTargetPlayerId===P?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?10:1,opacity:Dt&&Dt.sourcePlayerId===P&&Dt.followerIndex===x?0:m!=null&&m.isDying?.8:1,transitionProperty:Dt&&Dt.sourcePlayerId===P&&Dt.followerIndex===x?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:am===(m==null?void 0:m.instanceId)||lm===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(to,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:an*p,height:bn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)&&(ft==null?void 0:ft.type)==="FOLLOWER"?"0 0 30px #f56565":(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"none":"auto"},isSelected:(Ue==null?void 0:Ue.card)===m,isOnBoard:!0,isSpecialSummoning:om.has(m.instanceId),isMyTurn:g.activePlayerId===P}):a.jsx("div",{style:{width:an*p,height:bn*p,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:ci((le==null?void 0:le.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(J==null?void 0:J.sourceType)==="EVOLVE"&&!m.hasEvolved&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:J.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:J.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(ft==null?void 0:ft.type)==="FOLLOWER"&&ft.index===x&&ft.playerId===P?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:J.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:J.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),a.jsx("polygon",{points:"50,5 45,15 55,15",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"95,50 85,45 85,55",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"50,95 55,85 45,85",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"5,50 15,55 15,45",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),a.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(m==null?void 0:m.instanceId)||`empty-plr-${x}`)})})}),a.jsxs("div",{style:{position:"absolute",right:30*p,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*p,zIndex:50},children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsxs("div",{style:{fontSize:`${1.2*p}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",g.turnCount]})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:`${1.8*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Le.pp,"/",Le.maxPp]}),a.jsx("div",{style:{display:"flex",gap:4*p,justifyContent:"center"},children:Array(Math.min(10,Le.maxPp)).fill(0).map((m,x)=>a.jsx("div",{style:{width:10*p,height:10*p,borderRadius:"50%",background:x<Le.pp?"#f6e05e":"#2d3748"}},x))})]}),a.jsxs("div",{style:{position:"relative",width:160*p,height:160*p},children:[a.jsx(e3,{isMyTurn:g.activePlayerId===P,turnCount:g.turnCount,activePlayerId:g.activePlayerId,onTimeUp:II,timerEnabled:h,isGameOver:!!g.winnerId,isPaused:F,scale:p,buttonSize:160,timerDuration:60}),a.jsxs("button",{ref:sm,disabled:g.activePlayerId!==P||qi,onMouseDown:m=>{m.stopPropagation(),g.activePlayerId===P&&!qi&&Sf(!0)},onMouseUp:m=>{var x;if(m.stopPropagation(),yc&&g.activePlayerId===P&&!qi){Sf(!1),xt("sisiodosi.mp3",.6);const b=(x=m.target.closest("button"))==null?void 0:x.getBoundingClientRect();b&&wm(b.left+b.width/2,b.top+b.height/2),wf()}},onMouseLeave:()=>{Sf(!1)},style:{width:160*p,height:160*p,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:qi?"linear-gradient(135deg, #805ad5, #6b46c1)":yc?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":g.activePlayerId===P?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*p}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:g.activePlayerId===P?yc?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:yc?.8:1,cursor:g.activePlayerId===P&&!qi?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[a.jsx("img",{src:et("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),qi?a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${2.4*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:le.extraPpActive?a.jsxs("span",{children:[Math.max(0,le.pp-1),"/",le.maxPp," ",a.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):a.jsxs("span",{children:[le.pp,"/",le.maxPp]})}),a.jsx("div",{style:{display:"flex",gap:3*p,justifyContent:"center"},children:Array(10).fill(0).map((m,x)=>{const b=x<le.pp,O=x<le.maxPp;let j;return b?j="#f6e05e":O?j="#744210":j="#2d3748",a.jsx("div",{style:{width:11*p,height:11*p,borderRadius:"50%",background:j}},x)})})]}),(()=>{const m=P!==g.firstPlayerId,x=g.activePlayerId===P,b=g.turnCount,O=b<=5&&!le.extraPpUsedEarly,j=b>=6&&!le.extraPpUsedLate,V=m&&x&&!le.extraPpActive&&(O||j),Z=le.extraPpActive;if(!m)return null;const U=b<=5&&le.extraPpUsedEarly||b>=6&&le.extraPpUsedLate,B=!V&&!Z;return a.jsxs("button",{disabled:B,onClick:K=>{K.stopPropagation(),B||us({type:"TOGGLE_EXTRA_PP",playerId:P})},style:{width:160*p,height:45*p,borderRadius:12*p,border:Z?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:Z?"linear-gradient(135deg, #ed8936, #dd6b20)":V?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:Z?"white":V?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:Z?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:B?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*p,opacity:U&&!Z?.5:1},children:[a.jsx("span",{children:"PP"}),a.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),Z&&a.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),U&&!Z&&a.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),G?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),df(!0)},style:{position:"absolute",left:15*p,top:120*p,width:64*p,height:64*p,minWidth:64*p,maxWidth:64*p,minHeight:64*p,maxHeight:64*p,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*p}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),a.jsx(y3,{logs:g.logs||[],onCardNameClick:af,scale:p,isMobile:G})]}):a.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),df(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),a.jsxs("div",{style:{width:Math.max(180,220*p),height:Math.max(200,280*p),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*p)}rem`,padding:`${8*p}px ${8*p}px ${8*p}px ${12*p}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),ref:m=>{m&&(m.scrollTop=m.scrollHeight)},children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:4*p,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*p)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*p},children:(g.logs||[]).map((m,x)=>a.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:m},x))})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:32,height:40},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",le.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",le.graveyard.length,Zu.filter(m=>m.playerId===P).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),Ue&&Ue.owner==="PLAYER"&&Ue.source==="HAND"&&zr&&(()=>{const b=((G?Math.max(140,180*p):Math.max(180,220*p))-6)/2,O=le.pp>=Ue.card.cost;return a.jsxs("button",{disabled:!O,onClick:j=>{j.stopPropagation(),Im()},className:O?"play-button-active":"",style:{width:b,background:O?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:O?"pointer":"not-allowed",boxShadow:O?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:j=>j.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",Ue.card.cost]})]})})(),Ue&&Ue.owner==="PLAYER"&&Ue.source==="BOARD"&&(()=>{const m=G?Math.max(140,180*p):Math.max(180,220*p),x=6,b=(m-x)/2,O=Ue.card,j=O==null?void 0:O.hasEvolved,V=!j&&hs,Z=!j&&ps,U=O==null?void 0:O.instanceId,B=le.board.findIndex(ee=>ee&&ee.instanceId===U),K=le.board.slice(0,B+1).filter(ee=>ee).length-1,de=ee=>{B<0||gc(K>=0?K:B,ee,void 0,U)};return a.jsxs("div",{style:{display:"flex",gap:x,pointerEvents:"auto"},onMouseDown:ee=>ee.stopPropagation(),children:[a.jsxs("button",{disabled:!V,onClick:ee=>{ee.stopPropagation(),de(!1)},style:{width:b,background:V?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:V?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:V?"pointer":"not-allowed",boxShadow:V?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:V?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),a.jsxs("button",{disabled:!Z,onClick:ee=>{ee.stopPropagation(),de(!0)},style:{width:b,background:Z?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:Z?"pointer":"not-allowed",boxShadow:Z?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(Ue&&Ue.owner==="PLAYER"&&(Ue.source==="HAND"||Ue.source==="BOARD"))&&(()=>{const m=G?Math.max(140,180*p):Math.max(180,220*p);return a.jsx("div",{style:{width:m,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(z==="TOSSING"||z==="RESULT")&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{width:120*p,height:120*p,margin:`0 auto ${30*p}px`,borderRadius:"50%",background:z==="RESULT"?vt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:z==="RESULT"?`0 0 ${40*p}px ${vt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*p}px ${vt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*p}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:z==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:z==="RESULT"?vt==="FIRST"?"":"":"?"}),a.jsxs("div",{style:{fontSize:z==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:vt==="FIRST"?"#ffd700":vt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:z==="RESULT"?"textPop 0.5s ease-out":"none"},children:[z==="TOSSING"&&"...",z==="RESULT"&&(vt==="FIRST"?"":"")]}),z==="RESULT"&&a.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*p,animation:"fadeIn 0.5s ease-out 0.3s both"},children:vt==="FIRST"?"":""})]}),a.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),ii&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[a.jsx("div",{style:{fontSize:`${3.5*p}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*p}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*p}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),a.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),a.jsxs("div",{ref:li,style:{position:"absolute",bottom:-20*p,left:"50%",transform:"translateX(-50%)",width:no*p,height:no*p,borderRadius:"50%",zIndex:200},children:[a.jsxs("div",{onMouseDown:xI,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:Af?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:Af?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Am?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...g.winnerId&&g.winnerId!==P&&(Ne||st)?{filter:Ne==="white-fade"?"brightness(2) saturate(0.3)":Ne==="explode"||Ne==="result-text"||Ne==="fade-out"||st?"brightness(3) saturate(0) blur(10px)":"none",opacity:Ne==="explode"||Ne==="result-text"||Ne==="fade-out"||st?0:1}:{}},children:[a.jsx("img",{src:el(le.class),style:le.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),Am&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),a.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:te?1:0,transition:"opacity 0.3s ease-in"},children:le.hp}),a.jsx("div",{onMouseDown:m=>mc(m,!1),onTouchStart:m=>mc(m,!1),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:hs?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:hs?"grab":"default",zIndex:10,opacity:te?vc?1:.5:0,filter:vc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:hs?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:hs?"epPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,x)=>{const b=x<Tm;let O="none";return b&&vc&&(O=hs?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?hs?"#fff59d":"#ecc94b":"#2d3748",boxShadow:O,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},x)})})}),a.jsx("div",{onMouseDown:m=>mc(m,!0),onTouchStart:m=>mc(m,!0),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ps?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:ps?"grab":"default",opacity:te?_c?1:.5:0,filter:_c?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ps?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:ps?"sepPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,x)=>{const b=x<le.sep;let O="none";return b&&_c&&(O=ps?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?ps?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:O,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},x)})})})]}),a.jsxs("div",{style:{position:"absolute",bottom:10*p,right:15*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(le.deck.length/5)))].map((m,x)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${x*2*p}px, ${-x*2*p}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:a.jsx("img",{src:ci((le==null?void 0:le.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:b=>{b.target.style.display="none",b.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},x)),a.jsx("div",{style:{position:"absolute",top:-20*p,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:le.deck.length})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*p,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:le.hand.map((m,x)=>{if(Xe!==null&&Xe.sourceIndex===x)return null;const O=le.hand.length;let j=0,V=0,Z=0;if(zr){const B=100*p,K=window.innerWidth-40*p,de=(O-1)*B+an*p;let ee=B;de>K&&(ee=(K-an*p)/Math.max(1,O-1)),j=(x-(O-1)/2)*ee,V=xe===x?-8*p:0,Z=0}else{const B=45*p,K=160*p,de=an*p/2,ee=window.innerWidth/2-K-de,ge=window.innerWidth-340*p-K,Ee=(O-1)*B+an*p;let Qe=B;Ee>ge&&(Qe=(ge-an*p)/Math.max(1,O-1)),j=ee-(O-1-x)*Qe,V=0,Z=(x-(O-1)/2)*3}const U=le.pp>=m.cost&&g.activePlayerId===P;return a.jsx("div",{onMouseDown:B=>{_m(B,x),zr&&je(x===xe?null:x)},onTouchStart:B=>{_m(B,x),zr&&je(x===xe?null:x)},style:{position:"absolute",left:"50%",bottom:5*p,transform:`translateX(calc(-50% + ${j}px)) translateY(${V}px) rotate(${Z}deg) ${(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===x?"scale(1.05) translateY(-10px)":zr?"translateY(-3px)":""}`,transition:dI===x?"all 0.3s ease-in":(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===x?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===x?1e3:x+100,width:(G?80:an)*p,height:(G?115:bn)*p,pointerEvents:"auto",cursor:U?"grab":"not-allowed"},onClick:B=>B.stopPropagation(),children:a.jsx(to,{card:m,turnCount:g.turnCount,isMyTurn:g.activePlayerId===P,isPlayable:U,scale:p,variant:G?"mobile-hand":"normal",style:{width:G?80*p:an*p,height:G?115*p:bn*p,boxShadow:(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===x?"0 0 40px rgba(49, 130, 206, 0.8)":U?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},m.instanceId)})}),G&&a.jsxs("div",{style:{position:"absolute",bottom:200*p,left:15*p,display:"flex",alignItems:"center",gap:10*p,zIndex:601,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:50*p,height:62*p},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*p,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",le.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*p,marginLeft:10*p},children:[a.jsx("div",{style:{fontSize:`${1.87*p}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",le.graveyard.length,Zu.filter(m=>m.playerId===P).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),G&&Ue&&Ue.owner==="PLAYER"&&Ue.source==="HAND"&&zr&&(()=>{const m=Math.max(140,180*p),x=4*p,b=(m-x)/2,O=le.pp>=Ue.card.cost;return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto"},children:[a.jsxs("button",{disabled:!O,onClick:j=>{j.stopPropagation(),Im()},className:O?"play-button-active":"",style:{width:b,background:O?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:O?"pointer":"not-allowed",boxShadow:O?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:j=>j.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:["pp ",Ue.card.cost]})]}),a.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),G&&Ue&&Ue.owner==="PLAYER"&&Ue.source==="BOARD"&&(()=>{const m=Math.max(140,180*p),x=4*p,b=(m-x)/2,O=Ue.card,j=O==null?void 0:O.hasEvolved,V=!j&&hs,Z=!j&&ps,U=O==null?void 0:O.instanceId,B=le.board.findIndex(ee=>ee&&ee.instanceId===U),K=le.board.slice(0,B+1).filter(ee=>ee).length-1,de=ee=>{B<0||gc(K>=0?K:B,ee,void 0,U)};return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto",display:"flex",gap:x},onMouseDown:ee=>ee.stopPropagation(),children:[a.jsxs("button",{disabled:!V,onClick:ee=>{ee.stopPropagation(),de(!1)},style:{width:b,background:V?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:V?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:V?"pointer":"not-allowed",boxShadow:V?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:V?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"EP"})]}),a.jsxs("button",{disabled:!Z,onClick:ee=>{ee.stopPropagation(),de(!0)},style:{width:b,background:Z?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:Z?"pointer":"not-allowed",boxShadow:Z?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),cs&&Array.from({length:cs.count},(m,x)=>{const Z=-(cs.count*80+(cs.count-1)*20-80)/2+x*100,U=cs.isPlayer?ci((le==null?void 0:le.class)||"SENKA"):ci((Le==null?void 0:Le.class)||"SENKA");return a.jsx("div",{style:{position:"absolute",left:cs.isPlayer?"calc(100% - 90px)":90,top:cs.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${Z}px)`,animation:`drawCard${cs.isPlayer?"Player":"Opponent"} ${lf}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+x,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:a.jsx("img",{src:U,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:B=>{B.target.style.display="none",B.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},x)}),a.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),yI.map(m=>a.jsx(p3,{value:m.value,x:m.x,y:m.y,color:m.color,scale:p,onComplete:()=>uc(x=>x.filter(b=>b.id!==m.id))},m.id)),ef&&$r.current&&(()=>{const m=$r.current.x,x=$r.current.y,b=200,O=320,V=180/8,Z=(U,B,K,de)=>{const ee=U*Math.PI/180,ge=B*Math.PI/180,Ee=Math.cos(ee)*de,Qe=-Math.sin(ee)*de,Te=Math.cos(ge)*de,Ye=-Math.sin(ge)*de,Ze=Math.cos(ge)*K,Ge=-Math.sin(ge)*K,Ve=Math.cos(ee)*K,me=-Math.sin(ee)*K;return`M ${Ee} ${Qe} A ${de} ${de} 0 0 0 ${Te} ${Ye} L ${Ze} ${Ge} A ${K} ${K} 0 0 1 ${Ve} ${me} Z`};return a.jsxs("div",{style:{position:"fixed",left:m,top:x,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[a.jsx("svg",{width:O*2+20,height:O+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:a.jsx("g",{transform:`translate(${O+10}, ${O+10})`,children:zg.map((U,B)=>{const K=180-B*V,de=K-V,ee=tf===U.id,Ee=(K+de)/2*Math.PI/180,Qe=(b+O)/2,Te=Math.cos(Ee)*Qe,Ye=-Math.sin(Ee)*Qe,Ze=85;return a.jsxs("g",{children:[a.jsx("path",{d:Z(K,de,b,O),fill:ee?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:ee?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:ee?3:1,style:{transition:"all 0.1s ease-out"}}),a.jsx("defs",{children:a.jsx("clipPath",{id:`stampClip-${U.id}`,children:a.jsx("circle",{cx:Te,cy:Ye,r:Ze/2})})}),a.jsx("image",{href:et(Jy(U.id,Er)),x:Te-Ze/2,y:Ye-Ze/2,width:Ze,height:Ze,clipPath:`url(#stampClip-${U.id})`,style:{transform:ee?"scale(1.15)":"scale(1)",transformOrigin:`${Te}px ${Ye}px`,transition:"transform 0.1s ease-out"}}),a.jsx("circle",{cx:Te,cy:Ye,r:Ze/2,fill:"none",stroke:ee?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:ee?2:1})]},U.id)})})}),a.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),ia&&a.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[a.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:a.jsx("img",{src:et(Jy(ia.stampId,ia.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),ia.playerId!==P&&a.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),a.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},ia.timestamp),a.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:J&&(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsxs("defs",{children:[a.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[a.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"})]})]}),a.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsx("feMerge",{children:a.jsx("feMergeNode",{in:"glow"})})]}),a.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"})]})]}),a.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),a.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]})]}),J.sourceType==="BOARD"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:fs(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),a.jsx("path",{d:fs(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:fs(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:fs(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),J.sourceType==="EVOLVE"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:fs(),fill:"none",stroke:J.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:J.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),a.jsx("path",{d:fs(),fill:"none",stroke:J.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:fs(),fill:"none",stroke:J.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:fs(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:J.startX,cy:J.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:J.startX,cy:J.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),lI.map(m=>{const x=J.sourceType==="EVOLVE"?J.useSep?`rgba(230, 220, 255, ${m.opacity})`:`rgba(255, 255, 230, ${m.opacity})`:`rgba(220, 245, 255, ${m.opacity})`;return a.jsx("circle",{cx:m.x,cy:m.y,r:m.radius,fill:x,filter:"url(#particleGlow)"},m.id)})]})}),Yt&&a.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:Yt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Yt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:Yt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Yt.ringRadius/120)*.6})`,strokeWidth:"2"}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Yt.ringRadius/120)*.9})`}),Yt.particles.map(m=>a.jsx("circle",{cx:m.x,cy:m.y,r:4,fill:`rgba(255, 255, 255, ${m.opacity*.8})`},m.id))]}),Xe&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[a.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${Xe.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${Xe.startX-Xe.targetX}px, ${Xe.startY-Xe.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(Xe.startX-Xe.targetX)*.5}px, ${(Xe.startY-Xe.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${Xe.finalX-Xe.targetX}px), calc(-50% + ${Xe.finalY-Xe.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${Xe.startX-Xe.targetX}px, ${Xe.startY-Xe.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(Xe.startX-Xe.targetX)*.5}px, ${(Xe.startY-Xe.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${Xe.startX-Xe.targetX}px, ${Xe.startY-Xe.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(Xe.startX-Xe.targetX)*.5}px, ${(Xe.startY-Xe.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),a.jsxs("div",{className:"play-card-flipper",onAnimationEnd:Xe.onComplete,style:{position:"absolute",left:Xe.targetX,top:Xe.targetY,width:an*p,height:bn*p,transformStyle:"preserve-3d",animation:Xe.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[a.jsx("div",{className:"play-card-front",children:a.jsx(to,{card:Xe.card,isOnBoard:!0,suppressPassives:!0,scale:p,style:{width:an*p,height:bn*p,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),a.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:a.jsx("img",{src:ci(Xe.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:m=>{const x=m.target;x.style.display="none",x.parentElement&&(x.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),Xe.card.type==="SPELL"&&a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:a.jsx(g3,{x:0,y:0})})]})]}),Gi.length>0&&Gi.map((m,x)=>a.jsx("div",{style:{position:"absolute",left:m.status==="FLY"&&m.targetX!==void 0?m.targetX:window.innerWidth/2+m.xOffset,top:m.status==="FLY"&&m.targetY!==void 0?m.targetY:window.innerHeight/2,transform:m.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+x,pointerEvents:"none",transition:m.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:m.status==="FLY"?.3:1,animation:m.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:a.jsx(to,{card:m.card,scale:p,style:{width:an*p,height:bn*p}})},x)),a.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),ac.map(m=>m.type==="BUFF"?a.jsx(u3,{x:m.x,y:m.y,atkBuff:m.atkBuff??0,hpBuff:m.hpBuff??0,onComplete:()=>Vi(x=>x.filter(b=>b.key!==m.key))},m.key):a.jsx(h3,{type:m.type,x:m.x,y:m.y,onComplete:()=>Vi(x=>x.filter(b=>b.key!==m.key)),audioSettings:Rt,scale:p},m.key)),Dt&&a.jsx(v3,{card:Dt.card,evolvedImageUrl:Dt.evolvedImageUrl,startX:Dt.startX,startY:Dt.startY,phase:Dt.phase,onPhaseChange:_I,onShake:$n,useSep:Dt.useSep,playSE:xt,scale:p,isLightMode:ne}),oi&&a.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*p}px`,width:`calc(100% - ${340*p}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[a.jsx("div",{style:{padding:`${20*p}px ${90*p}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*p}px solid ${oi==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*p}px solid ${oi==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:oi==="EVOLVE_READY"?`0 0 ${50*p}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*p}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*p}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*p}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*p}px`},children:a.jsx("span",{style:{fontSize:`${5*p}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*p}rem`,whiteSpace:"nowrap",textShadow:oi==="EVOLVE_READY"?`0 0 ${15*p}px rgba(255, 215, 0, 1), 0 0 ${30*p}px rgba(255, 180, 0, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`:`0 0 ${15*p}px rgba(180, 0, 255, 1), 0 0 ${30*p}px rgba(140, 0, 255, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`,WebkitTextStroke:oi==="EVOLVE_READY"?`${1.5*p}px #ffd700`:`${1.5*p}px #b400ff`},children:oi==="EVOLVE_READY"?"":""})}),a.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),Pe&&g.winnerId&&a.jsx(ZL,{isVictory:g.winnerId===P,loserLeaderRef:g.winnerId===P?Ki:li,onComplete:()=>{be(!1),Ke(!0),nt(null),kt(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&v&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),v.disconnect())},onPhaseChange:nt,onShakeIntensityChange:kt,scale:p}),g.winnerId&&st&&a.jsx(I3,{winnerId:g.winnerId,playerId:P,playerClass:(le==null?void 0:le.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:nI,opponentRematchRequested:V0,battleStats:{turnCount:g.turnCount,damageDealtToOpponent:ql.damageDealtToOpponent,damageReceivedFromOpponent:ql.damageReceivedFromOpponent,followersDestroyed:ql.followersDestroyed,myFollowersDestroyed:ql.myFollowersDestroyed},selectedCardInfo:sI,onCardInfoClick:qu,victoryReason:rI,isRankedMatch:n==="RANKED_MATCH",ratingResult:iI,onRematching:i,onRematch:m=>{e==="ONLINE"?(G0(!0),V0?(v==null||v.send({type:"REMATCH_ACCEPT"}),gf(m)):(v==null||v.send({type:"REMATCH_REQUEST"}),X0(m))):gf(m)},onLeave:s})]})]})},T3=async()=>(await MP(Jl)).user,C3=async(t,e)=>(await zP(Jl,t,e)).user,k3=async(t,e)=>{const n=Jl.currentUser;if(!n)throw new Error("No user logged in");const r=Ui.credential(t,e);return(await UP(n,r)).user},R3=async()=>{await VP(Jl)},A3=t=>GP(Jl,t),P_=1280,O_=720,P3=({onRegisterSuccess:t,onBack:e})=>{const[n,r]=L.useState(""),[s,i]=L.useState(""),[o,l]=L.useState(""),[c,d]=L.useState(""),[u,h]=L.useState(!1),[f,E]=L.useState(1);L.useEffect(()=>{const _=()=>{const S=window.innerWidth/P_,p=window.innerHeight/O_;E(Math.min(S,p))};return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[]);const k=_=>/^[a-zA-Z0-9_]{3,20}$/.test(_),T=_=>`${_}@tenfubu-game.local`,N=async()=>{if(d(""),!n||!s||!o){d("");return}if(!k(n)){d("ID3-20");return}if(s.length<6){d("6");return}if(s!==o){d("");return}h(!0);try{const _=T(n);await k3(_,s),t()}catch(_){console.error("Registration error:",_),console.error("Error code:",_==null?void 0:_.code),console.error("Error message:",_==null?void 0:_.message);const S=(_==null?void 0:_.code)||"";d(S==="auth/email-already-in-use"?"ID":S==="auth/invalid-email"?"ID":S==="auth/weak-password"?"6":S==="auth/requires-recent-login"?"":S==="auth/provider-already-linked"?"ID":S==="auth/credential-already-in-use"?"ID":` (${S||"unknown error"})`)}finally{h(!1)}},v=_=>{_.key==="Enter"&&!u&&N()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:P_*f,height:O_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:_=>r(_.target.value),onKeyPress:v,placeholder:"player123",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:_=>_.currentTarget.style.borderColor="#4a9eff",onBlur:_=>_.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"3-20"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"6"}),a.jsx("input",{type:"password",value:s,onChange:_=>i(_.target.value),onKeyPress:v,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:_=>_.currentTarget.style.borderColor="#4a9eff",onBlur:_=>_.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:o,onChange:_=>l(_.target.value),onKeyPress:v,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:_=>_.currentTarget.style.borderColor="#4a9eff",onBlur:_=>_.currentTarget.style.borderColor="#444"})]}),c&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:c}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:e,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",opacity:u?.5:1},onMouseEnter:_=>!u&&(_.currentTarget.style.background="#666"),onMouseLeave:_=>!u&&(_.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:N,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:u?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:u?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:_=>!u&&(_.currentTarget.style.transform="scale(1.05)"),onMouseLeave:_=>!u&&(_.currentTarget.style.transform="scale(1)"),children:u?"...":""})]}),a.jsxs("div",{style:{marginTop:20*f,padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(74, 158, 255, 0.1)",border:"1px solid rgba(74, 158, 255, 0.3)",fontSize:13*f,color:"#aaa",textAlign:"center",lineHeight:1.6},children:["ID",a.jsx("br",{}),""]})]})]})})},L_=1280,D_=720,O3=({onLoginSuccess:t,onBack:e})=>{const[n,r]=L.useState(""),[s,i]=L.useState(""),[o,l]=L.useState(""),[c,d]=L.useState(!1),[u,h]=L.useState(1);L.useEffect(()=>{const T=()=>{const N=window.innerWidth/L_,v=window.innerHeight/D_;h(Math.min(N,v))};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const f=T=>`${T}@tenfubu-game.local`,E=async()=>{if(l(""),!n||!s){l("ID");return}d(!0);try{const T=f(n);await C3(T,s),t()}catch(T){const N=(T==null?void 0:T.code)||"";l(N==="auth/user-not-found"?"":N==="auth/wrong-password"?"":N==="auth/invalid-email"?"ID":N==="auth/invalid-credential"?"ID":"")}finally{d(!1)}},k=T=>{T.key==="Enter"&&!c&&E()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:L_*u,height:D_*u,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*u,fontWeight:"bold",color:"#fff",marginBottom:40*u,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*u,display:"flex",flexDirection:"column",gap:20*u},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:T=>r(T.target.value),onKeyPress:k,placeholder:"player123",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:T=>T.currentTarget.style.borderColor="#4a9eff",onBlur:T=>T.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:s,onChange:T=>i(T.target.value),onKeyPress:k,placeholder:"",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:T=>T.currentTarget.style.borderColor="#4a9eff",onBlur:T=>T.currentTarget.style.borderColor="#444"})]}),o&&a.jsx("div",{style:{padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*u,textAlign:"center"},children:o}),a.jsxs("div",{style:{display:"flex",gap:16*u,marginTop:20*u},children:[a.jsx("button",{onClick:e,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:T=>!c&&(T.currentTarget.style.background="#666"),onMouseLeave:T=>!c&&(T.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:E,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:T=>!c&&(T.currentTarget.style.transform="scale(1.05)"),onMouseLeave:T=>!c&&(T.currentTarget.style.transform="scale(1)"),children:c?"...":""})]}),a.jsx("div",{style:{marginTop:20*u,padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 200, 80, 0.1)",border:"1px solid rgba(255, 200, 80, 0.3)",fontSize:13*u,color:"#ffcc80",textAlign:"center",lineHeight:1.6},children:" "})]})]})})},M_=1280,N_=720,L3=({playerId:t,currentPlayerName:e,onUpdateSuccess:n,onBack:r})=>{const[s,i]=L.useState(e),[o,l]=L.useState(""),[c,d]=L.useState(!1),[u,h]=L.useState(!1),[f,E]=L.useState(1);L.useEffect(()=>{const N=()=>{const v=window.innerWidth/M_,_=window.innerHeight/N_;E(Math.min(v,_))};return N(),window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const k=async()=>{if(l(""),h(!1),!s.trim()){l("");return}if(s.length>20){l("20");return}if(!t){l("ID");return}d(!0);try{await fL(t,s.trim()),h(!0),setTimeout(()=>{n(s.trim())},1e3)}catch(N){console.error("Failed to update player name:",N),l("")}finally{d(!1)}},T=N=>{N.key==="Enter"&&!c&&k()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:M_*f,height:N_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"text",value:s,onChange:N=>i(N.target.value),onKeyPress:T,placeholder:"",disabled:c,maxLength:20,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:N=>N.currentTarget.style.borderColor="#4a9eff",onBlur:N=>N.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"20"})]}),o&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:o}),u&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(80, 255, 120, 0.2)",border:"2px solid #50ff78",color:"#50ff78",fontSize:14*f,textAlign:"center"},children:" "}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:r,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:N=>!c&&(N.currentTarget.style.background="#666"),onMouseLeave:N=>!c&&(N.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:k,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:N=>!c&&(N.currentTarget.style.transform="scale(1.05)"),onMouseLeave:N=>!c&&(N.currentTarget.style.transform="scale(1)"),children:c?"...":""})]})]})]})})},D3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},M3=D3("/bgm/tenfubu.mp3"),Vc={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},N3=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...Vc,...r,bgmEnabled:n,seEnabled:n}}return{...Vc,...e}}return Vc}catch{return Vc}},j3=()=>{const[t,e]=L.useState(!1);return L.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function $3(){const[t,e]=L.useState("TITLE"),[n,r]=L.useState("SENKA"),[s,i]=L.useState("CPU"),[o,l]=L.useState(""),[c,d]=L.useState(void 0),[u,h]=L.useState("NORMAL"),[f,E]=L.useState(null),[k,T]=L.useState(!0),[N,v]=L.useState(null),[_,S]=L.useState(null),[p,D]=L.useState(!0),[H,ne]=L.useState(()=>{const se=localStorage.getItem("timerEnabled");return se!==null?JSON.parse(se):!0}),[G,q]=L.useState(()=>localStorage.getItem("playerName")||""),[he,xe]=L.useState(void 0),[je,fe]=L.useState(void 0),ie=j3(),P=L.useRef(null),[w,C]=L.useState(!1),[y,g]=L.useState(N3),[I,A]=L.useState(()=>localStorage.getItem("homeCardId")),M=se=>se&&se.endsWith("@tenfubu-game.local")?se.replace("@tenfubu-game.local",""):null;L.useEffect(()=>{const se=A3(async Fe=>{if(console.log(" Auth state changed:",{uid:Fe==null?void 0:Fe.uid,email:Fe==null?void 0:Fe.email,isAnonymous:Fe==null?void 0:Fe.isAnonymous}),Fe){E(Fe.uid),T(Fe.isAnonymous),v(Fe.email),S(M(Fe.email));const z=M(Fe.email);console.log(" State updated:",{playerId:Fe.uid,isAnonymous:Fe.isAnonymous,userId:z});try{await h_(Fe.uid,z||"anonymous",G||"")}catch(ut){console.error("Failed to create player data:",ut)}}else try{const z=await T3();E(z.uid),T(!0),v(null),S(null),await h_(z.uid,"anonymous",G||"")}catch(z){console.error("Failed to sign in:",z)}D(!1)});return()=>se()},[]),L.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(y))},[y]);const Q=L.useCallback(se=>{g(Fe=>({...Fe,...se}))},[]),F=L.useCallback((se,Fe)=>{P.current=se,C(!0),Fe&&d(Fe),e("GAME")},[]),ye=L.useCallback((se,Fe,z,ut,vt)=>{P.current=se,C(!0),d(Fe),xe(ut),fe(vt),e("GAME")},[]),R=L.useCallback(se=>{P.current&&(P.current.disconnect(),P.current=null),C(!1),d(void 0),xe(void 0),fe(void 0),r(se),e("MATCHMAKING")},[]),Ie=L.useRef(null),te=L.useRef(!1);L.useEffect(()=>{const se=new Audio(M3);return se.loop=!0,se.volume=y.bgmEnabled?y.bgm:0,Ie.current=se,te.current=!0,()=>{se.pause(),se.src=""}},[]),L.useEffect(()=>{const se=Ie.current;!se||!te.current||(se.volume=y.bgmEnabled?y.bgm:0,y.bgmEnabled?se.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&se.play().catch(()=>{}):se.pause())},[y.bgm,y.bgmEnabled,t]),L.useEffect(()=>{const se=Ie.current;se&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?se.paused&&y.bgmEnabled&&se.play().catch(()=>{}):(se.pause(),se.currentTime=0))},[t,y.bgmEnabled]),L.useEffect(()=>{const se=()=>{const Fe=Ie.current;Fe&&Fe.paused&&y.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&Fe.play().catch(()=>{})};return document.addEventListener("click",se),()=>document.removeEventListener("click",se)},[t,y.bgmEnabled]);const Y=L.useCallback((se,Fe)=>{i(se),Fe&&l(Fe),e("CLASS_SELECT")},[]),Pe=L.useCallback(se=>{r(se),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),be=L.useCallback(()=>{P.current&&(P.current.disconnect(),P.current=null),C(!1),e("TITLE"),l(""),i("CPU"),d(void 0),xe(void 0),fe(void 0)},[]),We=L.useCallback(se=>{A(se),localStorage.setItem("homeCardId",se)},[]),we=L.useCallback(()=>{e("REGISTER")},[]),Me=L.useCallback(()=>{e("LOGIN")},[]),mt=L.useCallback(()=>{e("TITLE")},[]),tt=L.useCallback(()=>{e("TITLE")},[]),st=L.useCallback(async()=>{try{await R3(),e("TITLE")}catch(se){console.error("Failed to logout:",se)}},[]),Ke=L.useCallback(()=>{e("TITLE")},[]),Ne=L.useCallback(()=>{e("TITLE")},[]),nt=L.useCallback(()=>{e("PROFILE")},[]),yt=L.useCallback(se=>{q(se),localStorage.setItem("playerName",se),e("TITLE")},[]),kt=L.useCallback(()=>{e("TITLE")},[]);return p?a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",color:"white",fontSize:"1.5rem",fontWeight:"bold"},children:"Loading..."}):a.jsxs("div",{className:"app-container",children:[ie&&a.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[a.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),a.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),a.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),a.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&a.jsx(N2,{onStartConfig:Y,audioSettings:y,onAudioSettingsChange:Q,playerId:f,onSetHomeCard:We,homeCardId:I,isAnonymous:k,userId:_,onNavigateToRegister:we,onNavigateToLogin:Me,onNavigateToProfile:nt,onLogout:st}),t==="CLASS_SELECT"&&a.jsx(_L,{onSelectClass:Pe,onBack:be,gameMode:s,aiDifficulty:u,onDifficultyChange:h,playerName:G,onPlayerNameChange:se=>{q(se),localStorage.setItem("playerName",se)},timerEnabled:H,onTimerEnabledChange:se=>{ne(se),localStorage.setItem("timerEnabled",JSON.stringify(se))},playerId:f}),t==="LOBBY"&&a.jsx(HL,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:F,onBack:be}),t==="MATCHMAKING"&&a.jsx(YL,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:G||"",playerId:f,onGameStart:ye,onCancel:be}),t==="GAME"&&a.jsx(w3,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:be,onRematching:R,networkAdapter:P.current,networkConnected:w,opponentClass:c,aiDifficulty:u,playerName:G||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:H,playerId:f,opponentPlayerId:he,opponentRating:je}),t==="REGISTER"&&a.jsx(P3,{onRegisterSuccess:mt,onBack:Ke}),t==="LOGIN"&&a.jsx(O3,{onLoginSuccess:tt,onBack:Ne}),t==="PROFILE"&&a.jsx(L3,{playerId:f,currentPlayerName:G,onUpdateSuccess:yt,onBack:kt})]})}bh.createRoot(document.getElementById("root")).render(a.jsx($3,{}));
