
# 2025-12-24: 進化演出のさらなるブラッシュアップ

## 概要
ユーザーからのフィードバックに基づき、進化演出の「チャージ中のパーティクル表示」と「カード反転時の裏面描画」に関する修正を行いました。

## 変更内容

### 1. チャージ用パーティクルの持続時間調整
**課題**:
`WHITE_FADE`フェーズ（エネルギーチャージ）中に、パーティクルが中央に集まりきる前に消えてしまったり、生成が早めに止まってしまうため、チャージ後半で画面が寂しくなっていた。

**解決策**:
- `EvolutionAnimation`コンポーネント内のパーティクル生成ロジックを変更。
- `delay`（生成遅延）の範囲を `0~1.0s` から `0~1.8s` に拡大し、フェーズ終了直前まで新しいパーティクルが発生するようにした。
- `chargeParticleIn`アニメーションのキーフレームを変更し、アニメーション終了時（`100%`）の `opacity` を `0` ではなく `1` に設定。これにより、パーティクルが中央に到達した後も消滅せず、`FLIP`フェーズに移行して一括消去されるまで表示され続けるようになった。

```typescript
// 変更後のキーフレーム生成ロジック（一部抜粋）
100% { opacity: 1; transform: rotate(${p.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
```

### 2. カード反転時の裏面描画（シームレスな進化）
**課題**:
カードが回転して裏面が見え始めた瞬間に、まだ画像が切り替わっておらず、元のイラストが反転した状態が一瞬見えてしまっていた。

**解決策**:
- CSS 3D Transformsの `backface-visibility: hidden` と `transform: rotateY(180deg)` を活用した、物理的な「両面カード」構造にレンダリングを変更。
- これまでは回転角度に応じてJSで画像を差し替えていたが、表面（進化前）と裏面（進化後・予め180度回転済み）を常に同時にレンダリングするようにした。
- これにより、カードが90度を超えて裏返った瞬間、物理的に裏側に配置されている進化後のイラストが自然に表示されるようになった。

```typescript
{/* --- FRONT FACE (Original) --- */}
<div style={{ ..., backfaceVisibility: 'hidden' }}>
    <img src={card.imageUrl} ... />
</div>

{/* --- BACK FACE (Evolved) --- */}
<div style={{ ..., backfaceVisibility: 'hidden', transform: 'rotateY(180deg)' }}>
    <img src={evolvedImageUrl} ... />
</div>
```

## 結果
- チャージ演出が最後まで途切れず、より「溜めている」感が出た。
- 進化時のカード回転が完全にシームレスになり、イラストの切り替わりによる違和感が解消された。
