# タスクリスト (Task List)

## 完了済み
- [x] ボードの安定性向上のための `null` プレースホルダー実装
- [x] `RAY` エフェクトの 8x8 標準化
- [x] 進化アニメーションの AI ターゲット ID 修正
- [x] 効果音 (SE) の統合 (thunder, water, ray, yami, ice, gan, fon)
- [x] `fire` アニメーションエフェクトの追加
- [x] `shot` アニメーションのサイズ調整 (50%)
- [x] 「amandava」の進化後イラスト設定 (`amandava_2.png`)
- [x] 「ヴァルキリー」の攻撃エフェクトを `RAY` に変更
- [x] プロジェクトマップ (`project_map.md`) の作成と運用ルールの適用
- [x] CPU のターゲット制限（潜伏/オーラ無視）
- [x] カード使用時の UI 表示位置の調整 (ボードエリア中央)
- [x] `GameScreen.tsx` のリンター警告解消
- [x] 手札展開の挙動安定化 (最初のクリックで離した際に閉じないように修正)
- [x] 新カード「大和」の実装
- [x] 新カード「ユウリ」「水氷龍」の実装
- [x] ゆうなぎのイラストパス更新（yunagi.png, yunagi_2.png）
- [x] Monoのイラストパス更新（Mono.png, Mono_2.png）
- [x] 青ツバキのイラストパス更新（blue_tsubaki.png, blue_tsubaki_2.png）
- [x] クラス別固定デッキシステムの実装（せんかデッキ / あじゃデッキ）

- [x] 「amandava」カードを `MOCK_CARDS` に追加
- [x] エンジンに `RANDOM_SET_HP` 効果を実装
- [x] 「amandava」のビジュアルエフェクトを `GameScreen.tsx` に追加
- [x] ルイ・ユーの効果変更 (ファンファーレでcyorienaを場に出す)
- [x] cyorienaをコスト2に調整 (特殊召喚のみだがデータ上の整合性のため)
- [x] ダメージアニメーションのタイミング調整 (着弾を速く、その後の余韻を長く)
- [x] cyorienaをトークン化し、デッキから除外 (あじゃデッキを40枚に修正)
- [x] cyorienaの実装
- [x] 翼 (Tsubasa)の実装
- [x] BGMがリロード後に再生されない問題の修正
- [x] 破壊効果 (DESTROY) の演出追加 (Kasuga用/IMPACTエフェクト)
- [x] 回復効果の演出調整 (water.mp3)
- [x] アニメーションの緩急（メリハリ）の強化 (停滞時間の延長と着地移動の高速化)
- [x] 進化エフェクトの強化 (パーティクル、光の帯、矢印グロー)
- [x] 進化ターゲットマーカーのズレ修正
- [x] スペルプレイ時のカード描画ミス修正
- [x] 演出のシーケンス制御の精緻化（「茶トラ」等の追加演出の完遂保証）
- [x] CPUターンの遅延解消（非演出効果の高速化 1200ms -> 50ms）
- [x] 特殊召喚（「てんふぶのヤベー2人」等）が動作しない不具合の修正（デッドロックの解消）
- [x] 相手側の特殊召喚アニメーションの適用
- [x] BGMパターンの追加（'Jade Moon.mp3' の導入）
- [x] ビジュアルの細かな修正 (マーカー位置、矢印グロー、スペル描画ミス)
- [x] スペルプレイ時のパーティクル表示エラーの修正
- [x] オーバーキル時のダメージ数値表示（マイナス表示）の改善
- [x] 再戦（Rematch）機能の安定化（演出リセットとBGMの復旧）
- [x] リーダー回復演出の強化（振動の抑制とソフトなグロー効果の実装）
- [x] 残っている Lint エラーの解消（ESLint未設定のためビルド・型チェックで確認）
- [x] 「あじゃ」のランダム回収効果の修正（RANDOM_BOUNCEに変更し、RANDOM_BOUNCEをエンジンに実装）
- [x] 交戦時に「Unknownを攻撃」となる不具合の修正（対象不在時の早期リターン追加）
- [x] 進化アニメーションのエネルギーチャージ時間を1秒短縮（2.4s → 1.4s）
- [x] ダメージ（赤）と回復（緑）の数値をオシャレなフォントにし、サイズを2倍程度に拡大
- [x] 体力が0になったフォロワーが破壊エフェクトを経て場を去るまでのラグを短縮（1.2s → 0.7s）
- [x] 交戦で破壊される際、攻撃側・防御側の両方に常に破壊エフェクト（IMPACT）を表示するように修正
- [x] 進化時のエフェクト最適化（黄色/紫グローの軽量化 - SVGフィルター、boxShadow、blurを削減）
- [x] CPUの進化・超進化ターンのルール修正（firstPlayerIdを正しく設定し、先攻/後攻の制限を厳密に適用）
- [x] 守護（WARD）の整合性担保（STEALTH付きWARDは保護効果を持たないよう修正）
- [x] カードプレイ時の演出修正 (手札からはフェードインなし、特殊召喚はあり)
- [x] カード破壊時のエフェクト変更 (IMPACT削除、発光フェードアウトのみ)
- [x] 進化演出のタメ時間調整 (0.5秒延長)
- [x] コイントスの回転時間短縮 (1.8s → 0.8s)
- [x] BGMとSEのオンオフ設定の分離
- [x] 進化演出の調整 (チャージアニメーション、裏面描画の修正)
- [x] フォロワー攻撃可能ハイライトの修正 (自ターンのみ適用)
- [x] 交戦時の赤色ハイライト追加
- [x] ダメージ表記のフォント変更 (Times New Roman, Normal)
- [x] 進化演出の裏面表示バグ修正 (transformStyle: preserve-3d追加)
- [x] 相手のカードプレイ時の効果音追加
- [x] 戦闘アニメーション効果音の修正 (seEnabled対応)
- [x] 戦闘ダメージ未発生バグの修正 (パラメータキャプチャ)
- [x] BGMに「amaama.mp3」を追加
- [x] BGMに「kingetsu.mp3」を追加
- [x] 「なゆた」のコスト変更 (5→4)
- [x] 新カード「ありす」の実装
- [x] 「ぽてち」の進化後イラスト追加 (potechi_2.png)
- [x] あじゃデッキ構成変更 (ウララ→ありす)
- [x] 白ツバキの効果変更 (進化時：しゑこ召喚追加)
- [x] ルイ・ユーのコスト変更 (6→7)
- [x] カード攻撃エフェクトアニメーションの統一
- [x] 4K/フルHD対応レイアウトの改善:
  - 黒帯問題の修正（独立したX/Y軸スケーリング）
  - アニメーション/エフェクトの位置ズレ修正（座標変換の統一）
  - SVG矢印の位置修正（ゲームコンテナ内配置）
  - UI要素のレスポンシブ対応:
    - ユニフォームスケール（アスペクト比維持）の導入
    - 相対配置(left: 50%など)への変更
    - ウィンドウサイズ追従（動的サイズ計算）
    - 相手リーダー配置修正（top: -20 scale）
    - ボード座標の重なり解消（余白70scaleに最適化）
    - 手札の画面端見切れ防止（右端基準+マージン160scale）
    - 手札の操作性向上（クリック選択、Playable緑発光追加）
    - ドラッグ/エフェクトのエラー解消（DOMベース座標取得 getCenter/getTargetCoords 導入）
    - エフェクトアニメーション座標の動的追従（各所アニメーション座標を新ボード配置に対応）
    - 進化アニメーションのカードサイズ追従（scaleプロパティ対応）
- [x] 4K対応レスポンシブデザインの実装 (useScaleFactor、transform: scale、座標変換)
- [x] UI/ロジックの追加修正
    - 進化対象選択時の進行不能バグ修正（useSepフラグの受け渡し修正）
    - カードプレイアニメーション着地座標のズレ修正（CARD_SPACING定数適用）
    - 相手リーダーUIのスタイル統一（スケール適用漏れの修正）
    - 進化アニメーションの無限リセットバグ修正（useEffect依存配列の修正）
    - 進化アニメーションの画像切替不具合修正（JSによる表示制御の導入）
    - 味方フォロワーを対象とする効果の実装（「翼」の修正）
    - 進化アニメーションのサイズ調整（演出中3/4サイズ、演出開始時の盤面カード即時非表示）
    - カードプレイアニメーションの座標・着地サイズ修正（scale 1.0、盤面サイズとの同期）
    - カード効果の修正（「米」コスト0、「あじゃ」のバフ対象をつぶまる・ゆうなぎ・なゆたに限定）
    - 召喚・特殊召喚の演出改善（通常召喚のフェード廃止、特殊召喚のフェード維持）
    - 特殊召喚時の不透明度アニメーションの修正（Card.cssのtransition削除による挙動安定化）
- [x] 交戦時のダメージ未発生バグ修正（ATTACK dispatchのレースコンディション解消）
    - 原因: 1秒のsetTimeout後にdispatchしていたため、その間にゲーム状態が変化してdispatchが無視される場合があった
    - 修正: 攻撃開始時に即座にdispatchし、アニメーションは並行して実行するように変更
- [x] 進化時の対象選択クリックが反応しない問題の修正
    - 原因: フォロワー/リーダーのクリックイベントがバブリングして親要素のhandleBackgroundClickが発火し、targetingStateがリセットされていた
    - 修正: 対象要素のonClickにe.stopPropagation()を追加
- [x] 手札UI改善
    - 手札展開時のカード間隔を調整（maxSpacing: 115→100）
    - 手札の折りたたみを背景クリック時のみに変更（カードプレイ後も展開を維持）
- [x] 手札枚数表示・プレイボタンの位置調整
    - 手札カードと重ならないよう、上方向に移動（bottom: 30 → 220 * scale）
- [x] カード生成アニメーションの座標修正
    - 原因: window座標（スクリーン座標）とゲーム座標（BASE_WIDTH/HEIGHT基準）の不一致
    - 修正: ゲーム座標系に統一し、プレイヤー/相手によって目標位置を分岐
- [x] CPU戦でしゑこから出たカードが攻撃できないバグの修正 <!-- id: 4 -->
- [x] カード情報を表示しようとすると消えるバグの修正 <!-- id: 5 -->
- [x] カードプレイ時に手札のカードが消える(バックハンドスマッシュ消失)バグの修正 <!-- id: 6 -->
- [x] 解像度変更時にスペル演出の位置がズレるバグの修正 <!-- id: 7 -->
- [x] 1ターンに1回しか進化できないように制限 <!-- id: 8 -->
- [x] 進化・超進化可能ターンの修正（先攻5/7, 後攻4/6） <!-- id: 9 -->
- [x] 進化・超進化可能時のターン開始時通知の実装（UIブラッシュアップ済み） <!-- id: 10 -->
- [x] BGMに「kingetsu.mp3」を追加
- [x] 「しゑこ」の効果変更（味方対象バフの実装）
- [x] 新カード「クレイジー・ナックラーズ」の実装
- [x] 「侍茶」の効果変更（ドロー追加・全体バフ）
- [x] 「ウララ」のスタッツおよび効果変更（体力+1、バリア追加）
- [x] あじゃデッキの構成変更（ウララ追加、ルイ・ユー/Y/saraの枚数調整）
- [x] 「しあ」の効果変更（コスト2 2/1、ファンファーレでランダム2体に1ダメージ）
- [x] せんかデッキの構成変更（クレイジー・ナックラーズ/しあ追加、曲音/大和削除）
- [x] 1ターンに1回の進化制限を正しく適用（通信対戦での同期ずれ修正）
- [x] 「ウララ」の進化時イラストを「urara_2.png」へ変更 <!-- id: 11 -->
- [x] 再戦時にBGMが切り替わるように修正（連続して同じBGMが流れないように） <!-- id: 12 -->
- [x] instanceId使用による手札カードの正確な特定（クエイクハウリング/翼などのバグ修正） <!-- id: 13 -->
- [x] 「あじゃ」のエフェクト表示順序修正（リーダーダメージ→フォロワー破壊の順で表示） <!-- id: 14 -->
- [x] 「ウララ」のスタッツ変更(2/2)と通常イラストの更新(urara.png) <!-- id: 15 -->

## 今後の予定
- [ ] 各カードのエフェクト定義の整理とクリーンアップ
- [x] 通信対戦機能の修復 (Phase 1)
    - [x] LobbyScreenの実装 (待ち受け画面、接続状態表示)
    - [x] App.tsxの遷移ロジック修正
    - [x] GameScreenへのネットワークアダプタ受け渡し
    - [x] package.jsonに--hostオプション追加（別PC間接続対応）
- [x] 通信対戦機能の修復 (Phase 2) - プレイヤーID/同期の修正
    - [x] HOST/JOINでプレイヤーIDを分離（HOST=p1, JOIN=p2）
    - [x] HOSTがゲーム初期化→JOINへINIT_GAMEで同期
    - [x] クラス情報の交換（CLASS_INFOメッセージ）
    - [x] JOINの待機画面（gameSynced状態管理）
    - [x] dispatchAndSendによるアクション同期（END_TURN, PLAY_CARD, ATTACK, EVOLVE）
    - [x] リモートアクションのビジュアルエフェクト対応
- [ ] 通信対戦機能の検証と強化 (Phase 3)
    - [ ] 動作検証
    - [ ] 切断時の再接続ハンドリング (必要であれば)
- [ ] Web公開・デプロイ計画
    - [ ] GitHub Pagesまたは Vercel/Netlifyへのデプロイ
    - [ ] PeerJS公開シグナリングサーバーの利用確認
    - [ ] HTTPS対応（WebRTCはHTTPSが必要）
    - [ ] NAT越え対策（TURN サーバーの検討）
