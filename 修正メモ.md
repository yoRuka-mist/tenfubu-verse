# 修正完了内容

## 1. 守護表示の問題修正 ✅
- **問題**: ぶっちーが出した3体のまなりーのうち、最後の1体にしか守護が表示されない
- **原因**: Card.tsxで守護エフェクトが`playSummonAnim`中は非表示になっていた
- **修正**: `playSummonAnim`条件を削除し、召喚アニメーション中も守護シールドを表示
- **結果**: 全てのまなりーに守護シールドが正しく表示されるようになった

## 2. カードエフェクトタイプの追加 ✅
### 新規エフェクトタイプ追加
- **FIRE**: types.tsとGameScreen.tsxに追加
- **SLASH**: GameScreen.tsxに追加(スプライト画像: `/effects/slash.png`)

### カードへのエフェクト適用
- ✅ **青ツバキ**: SLASH
- ✅ **ヴァルキリー**: FIRE  
- ✅ **大和**: SLASH
- ✅ **cyoriena**: RAY
- ✅ **ゆうなぎ**: SLASH
- ✅ **曲音**: WATER
- ✅ **しあ**: SLASH

## 3. エンジン修正 ✅
- `SUMMON_CARD`処理で`passiveAbilities`を明示的にコピーするよう修正
- 重複した`attackEffectType`プロパティを削除

## 4. 交戦破壊時の破壊エフェクト追加 ✅
- **実装**: visualPlayerBoard / visualOpponentBoard の isDying 状態を監視
- **効果**: カードが破壊される(isDying になる)際に IMPACT エフェクトを再生
- **場所**: GameScreen.tsx に useEffect を追加

## 5. 進化エフェクト最適化 ✅
- **SVGフィルター軽量化**: stdDeviation を削減、feMergeNode の数を削減
- **boxShadow 軽量化**: 多層の影を単層に削減
- **blur 軽量化**: blur(40px) → blur(20px)
- **光の玉**: 外側グロー層を削除し、メインオーブに統合

## 6. CPU進化ターンルール修正 ✅
- **問題**: コイントスでプレイヤーが後攻になった場合、firstPlayerId が更新されていなかった
- **修正**: firstPlayerId を 'p2' に更新するよう修正
- **影響**: 進化可能ターンの計算が正しくなった(先攻T5/後攻T4)

## 7. 守護(WARD)整合性修正 ✅
- **問題**: STEALTH付きWARDユニットが保護効果を持っていた(攻撃できないのにWARD強制)
- **修正**: engine.ts と GameScreen.tsx のWARDチェックからSTEALTH持ちを除外
- **結果**: STEALTH付きWARDは保護効果を持たなくなった

## 8. 4K対応レスポンシブデザインの実装 ✅
- **実装**: useScaleFactorフックで画面サイズに応じたスケール係数を計算
- **基準解像度**: 1920x1080 (Full HD)
- **スケーリング方式**: transform: scale()で全体を均等にスケーリング
- **座標変換**: screenToGameCoords関数でエフェクト・ダメージ数値の座標を正しく変換
- **結果**: 4K (3840x2160)では全UI要素が2倍に拡大され、適切なサイズで表示

## 9. 通信対戦時のコイントスランダム化 ✅
- **問題**: HOSTが毎回先攻になっていた
- **修正**: `Math.random()`を使用して、HOSTも50%の確率で後攻になるように変更
- **結果**: 通信対戦時も公平にランダムで先攻/後攻が決定される

## 10. あじゃのバフ強化 ✅
- **変更前**: +1/+1
- **変更後**: +2/+2
- **影響**: 超進化時に召喚される「つぶまる」「ゆうなぎ」「なゆた」が+2/+2のバフを受ける

## 11. 進化時の突進重複付与バグ修正 ✅
- **問題**: STORMを持っているカード(Yなど)が進化時にRUSHも付与されていた
- **修正**: 
  - 通常進化: STORMまたはRUSHを既に持っている場合は付与しない
  - 超進化: STORMを持っている場合はRUSHを付与しない
- **結果**: 意図しない突進付与が発生しなくなる

## 12. 退職代行の自分のフォロワー破壊効果修正 ✅
- **問題**: 退職代行の「自分のフォロワー1体をランダムに破壊する」効果が発動していなかった
- **原因**: PLAY_CARD/EVOLVE時のRANDOM_DESTROY事前計算で、targetType='SELF'の場合でも常に相手のボードを参照していた
- **修正**: targetType='SELF'の場合は自分のボード(sourcePlayerId)を参照するように修正
- **ファイル**: engine.ts line 1648, 1812
- **結果**: 退職代行が正しく自分のフォロワーも破壊するようになった

## 13. しゑこの突進について 🔍
- **確認結果**: 
  - しゑこのカード定義: `passiveAbilities: ['RUSH']` ✅
  - SUMMON_CARD処理: `canAttack: template.passiveAbilities?.includes('STORM') || template.passiveAbilities?.includes('RUSH')` ✅
  - passiveAbilitiesのコピー: `passiveAbilities: template.passiveAbilities ? [...template.passiveAbilities] : undefined` ✅
- **理論的には正しく動作するはず**: 
  - しゑこはRUSHを持っているので、召喚時に`canAttack: true`になる
  - もし攻撃できない場合は、別の原因(UIの表示問題など)の可能性がある
- **推奨**: 実際にテストして、攻撃可能かどうか確認してください

## 残作業
- 各カードのエフェクト定義の整理とクリーンアップ
- しゑこの突進が実際に機能するか確認
